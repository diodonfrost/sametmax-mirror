<!DOCTYPE html>
<!--[if IE 7]>
<html class="ie ie7" lang="en-US">
<![endif]-->
<!--[if IE 8]>
<html class="ie ie8" lang="en-US">
<![endif]-->
<!--[if !(IE 7) | !(IE 8)  ]><!-->
<html lang="en-US">                          
<!--<![endif]-->
					<head>
				    <meta charset="UTF-8" />
				    <meta http-equiv="X-UA-Compatible" content="IE=9; IE=8; IE=7; IE=EDGE" />
            				    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
				    <link rel="profile" href="http://gmpg.org/xfn/11" />
				    <link rel="pingback" href="http://sametmax.com/xmlrpc.php" />

				   <!-- Icons font support for IE6-7  -->
				    <!--[if lt IE 8]>
				      <script src="http://sametmax.com/wp-content/themes/customizr/inc/assets/css/fonts/lte-ie7.js"></script>
				    <![endif]-->
				    <style type="text/css" id="customizr-inline-fonts">@font-face{font-family:genericons;src:url('../wp-content/themes/customizr/inc/assets/css/fonts/fonts/genericons-regular-webfont.eot');src:url('../wp-content/themes/customizr/inc/assets/css/fonts/fonts/genericons-regular-webfont.eot%3F') format('embedded-opentype'),url('../wp-content/themes/customizr/inc/assets/css/fonts/fonts/genericons-regular-webfont.woff') format('woff'),url('../wp-content/themes/customizr/inc/assets/css/fonts/fonts/genericons-regular-webfont.ttf') format('truetype'),url('../wp-content/themes/customizr/inc/assets/css/fonts/fonts/genericons-regular-webfont.svg') format('svg')}@font-face{font-family:entypo;src:url('http://sametmax.com/wp-content/themes/customizr/inc/assets/css/fonts/fonts/entypo.eot);src:url(http://sametmax.com/wp-content/themes/customizr/inc/assets/css/fonts/fonts/entypo.eot?#iefix') format('embedded-opentype'),url('../wp-content/themes/customizr/inc/assets/css/fonts/fonts/entypo.woff') format('woff'),url('../wp-content/themes/customizr/inc/assets/css/fonts/fonts/entypo.ttf') format('truetype'),url('../wp-content/themes/customizr/inc/assets/css/fonts/fonts/entypo.svg') format('svg')}</style><title>Explication de code : python-mss &#8211; Sam &amp; Max</title>
<link rel='dns-prefetch' href='http://s0.wp.com/' />
<link rel='dns-prefetch' href='http://secure.gravatar.com/' />
<link rel='dns-prefetch' href='http://s.w.org/' />
<link rel="alternate" type="application/rss+xml" title="Sam &amp; Max &raquo; Feed" href="../feed.1" />
<link rel="alternate" type="application/rss+xml" title="Sam &amp; Max &raquo; Comments Feed" href="../comments/feed/index.html" />
<link rel="alternate" type="application/rss+xml" title="Sam &amp; Max &raquo; Explication de code : python-mss Comments Feed" href="feed/index.html" />
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2.4\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2.4\/svg\/","svgExt":".svg","source":{"concatemoji":"http:\/\/sametmax.com\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.9.7"}};
			!function(a,b,c){function d(a,b){var c=String.fromCharCode;l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,a),0,0);var d=k.toDataURL();l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,b),0,0);var e=k.toDataURL();return d===e}function e(a){var b;if(!l||!l.fillText)return!1;switch(l.textBaseline="top",l.font="600 32px Arial",a){case"flag":return!(b=d([55356,56826,55356,56819],[55356,56826,8203,55356,56819]))&&(b=d([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]),!b);case"emoji":return b=d([55357,56692,8205,9792,65039],[55357,56692,8203,9792,65039]),!b}return!1}function f(a){var c=b.createElement("script");c.src=a,c.defer=c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var g,h,i,j,k=b.createElement("canvas"),l=k.getContext&&k.getContext("2d");for(j=Array("flag","emoji"),c.supports={everything:!0,everythingExceptFlag:!0},i=0;i<j.length;i++)c.supports[j[i]]=e(j[i]),c.supports.everything=c.supports.everything&&c.supports[j[i]],"flag"!==j[i]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[j[i]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(h=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",h,!1),a.addEventListener("load",h,!1)):(a.attachEvent("onload",h),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),g=c.source||{},g.concatemoji?f(g.concatemoji):g.wpemoji&&g.twemoji&&(f(g.twemoji),f(g.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<link rel='stylesheet' id='contact-form-7-css'  href='../wp-content/plugins/contact-form-7/includes/css/styles.css%3Fver=5.0.2.css' type='text/css' media='all' />
<link rel='stylesheet' id='wp-polls-css'  href='../wp-content/plugins/wp-polls/polls-css.css%3Fver=2.73.8.css' type='text/css' media='all' />
<style id='wp-polls-inline-css' type='text/css'>
.wp-polls .pollbar {
	margin: 1px;
	font-size: 6px;
	line-height: 8px;
	height: 8px;
	background-image: url('../wp-content/plugins/wp-polls/images/default/pollbg.gif');
	border: 1px solid #c8c8c8;
}

</style>
<link rel='stylesheet' id='wp-syntax-css-css'  href='../wp-content/plugins/wp-syntax/css/wp-syntax.css%3Fver=1.1.css' type='text/css' media='all' />
<link rel='stylesheet' id='dashicons-css'  href='../wp-includes/css/dashicons.min.css%3Fver=4.9.7.css' type='text/css' media='all' />
<link rel='stylesheet' id='customizr-skin-css'  href='../wp-content/themes/customizr/inc/assets/css/black2.min.css%3Fver=3.2.10.css' type='text/css' media='all' />
<style id='customizr-skin-inline-css' type='text/css'>

.sticky-enabled .tc-shrink-on .site-logo img {
						height:30px!important;width:auto!important
					}

					.sticky-enabled .tc-shrink-on .brand .site-title {
						font-size:0.6em;opacity:0.8;line-height:1.2em
					}

.tc-rectangular-thumb {
            max-height: 250px;
            height :250px
          }

          .single .tc-rectangular-thumb {
            max-height: 250px;
            height :250px
          }


</style>
<link rel='stylesheet' id='customizr-style-css'  href='../wp-content/themes/customizr/style.css%3Fver=3.2.10.css' type='text/css' media='all' />
<link rel='stylesheet' id='fancyboxcss-css'  href='../wp-content/themes/customizr/inc/assets/js/fancybox/jquery.fancybox-1.3.4.min.css%3Fver=4.9.7.css' type='text/css' media='all' />
<link rel='stylesheet' id='jetpack-widget-social-icons-styles-css'  href='../wp-content/plugins/jetpack/modules/widgets/social-icons/social-icons.css%3Fver=20170506.css' type='text/css' media='all' />
<link rel='stylesheet' id='social-logos-css'  href='../wp-content/plugins/jetpack/_inc/social-logos/social-logos.min.css%3Fver=1.css' type='text/css' media='all' />
<link rel='stylesheet' id='jetpack_css-css'  href='../wp-content/plugins/jetpack/css/jetpack.css%3Fver=6.3.2.css' type='text/css' media='all' />
<script type='text/javascript' src='../wp-includes/js/jquery/jquery.js%3Fver=1.12.4'></script>
<script type='text/javascript' src='../wp-includes/js/jquery/jquery-migrate.min.js%3Fver=1.4.1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var TCParams = {"FancyBoxState":"1","FancyBoxAutoscale":"1","SliderName":"","SliderDelay":"","SliderHover":"1","SmoothScroll":"linear","ReorderBlocks":"1","CenterSlides":"1","HasComments":"","LeftSidebarClass":".span3.left.tc-sidebar","RightSidebarClass":".span3.right.tc-sidebar","LoadModernizr":"1","stickyCustomOffset":"0","stickyHeader":"1","dropdowntoViewport":"0","timerOnScrollAllBrowsers":"1"};
/* ]]> */
</script>
<script type='text/javascript' src='../wp-content/themes/customizr/inc/assets/js/tc-scripts.min.js%3Fver=3.2.10'></script>
<link rel='https://api.w.org/' href='../wp-json/index.html' />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://sametmax.com/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="../wp-includes/wlwmanifest.xml" /> 
<link rel='prev' title='Wrap in Try / Except dans Sublime Text' href='http://sametmax.com/wrap-in-try-except-dans-sublime-text/' />
<link rel='next' title='Beuuuuuuuuuuu' href='../beuuuuuuuuuuu/index.html' />
<meta name="generator" content="WordPress 4.9.7" />
<link rel="canonical" href="index.html" />
<link rel='shortlink' href='https://wp.me/p2ckfk-2oH' />
<link rel="alternate" type="application/json+oembed" href="../wp-json/oembed/1.0/embed%3Furl=http:%252F%252Fsametmax.com%252Fexplication-de-code-python-mss%252F" />
<link rel="alternate" type="text/xml+oembed" href="../wp-json/oembed/1.0/embed%3Furl=http:%252F%252Fsametmax.com%252Fexplication-de-code-python-mss%252F&amp;format=xml" />

<link rel='dns-prefetch' href='http://v0.wordpress.com/'/>
<style type="text/css" media="all">
/* <![CDATA[ */
@import url("../wp-content/plugins/wp-table-reloaded/css/plugin.css%3Fver=1.9.4.css");
@import url("../wp-content/plugins/wp-table-reloaded/css/datatables.css%3Fver=1.9.4.css");
/* ]]> */
</style><link rel="shortcut icon" href="../wp-content/uploads/2015/06/favicon.png" type="image/png">
<!-- Jetpack Open Graph Tags -->
<meta property="og:type" content="article" />
<meta property="og:title" content="Explication de code : python-mss" />
<meta property="og:url" content="http://sametmax.com/explication-de-code-python-mss/" />
<meta property="og:description" content="Ca faisait longtemps qu&#8217;on avait pas eu une petite explication de code dans le cadre de notre politique &#8220;envoyez nous les codes que vous ne pigez pas&#8221;.

Celle-ci est un peu part…" />
<meta property="article:published_time" content="2014-02-22T14:19:02+00:00" />
<meta property="article:modified_time" content="2014-02-27T17:58:33+00:00" />
<meta property="og:site_name" content="Sam &amp; Max" />
<meta property="og:image" content="http://sametmax.com/wp-content/uploads/2014/02/yu1p0xS.jpg" />
<meta property="og:image:width" content="640" />
<meta property="og:image:height" content="853" />
<meta property="og:locale" content="en_US" />
<meta name="twitter:text:title" content="Explication de code : python-mss" />
<meta name="twitter:image" content="http://sametmax.com/wp-content/uploads/2014/02/yu1p0xS.jpg?w=640" />
<meta name="twitter:card" content="summary_large_image" />

<!-- End Jetpack Open Graph Tags -->
			<link rel="stylesheet" type="text/css" id="wp-custom-css" href="../index.html%3Fcustom-css=3b3670f11a.css" />
						    <!--Icons size hack for IE8 and less -->
				    <!--[if lt IE 9]>
				      <link href="http://sametmax.com/wp-content/themes/customizr/inc/assets/css/fonts/ie8-hacks.css" rel="stylesheet" type="text/css"/>
				    <![endif]-->
				</head>
				
	<body class="post-template-default single single-post postid-9219 single-format-standard tc-fade-hover-links tc-sticky-header tc-transparent-on-scroll" itemscope itemtype="http://schema.org/WebPage">
		
		
	   	<header class="tc-header clearfix row-fluid tc-tagline-off tc-title-logo-on  tc-shrink-on tc-menu-on logo-left" role="banner">
			      <div class="brand span3 pull-left ">

        <h1><a class="site-title" href="../index.html" title="Sam &amp; Max | Du code, du cul">Sam &amp; Max</a></h1>
      </div> <!-- brand span3 pull-left -->
      <div class="container outside"><h2 class="site-description">Du code, du cul</h2></div>      	<div class="navbar-wrapper clearfix span9 tc-submenu-fade tc-submenu-move tc-open-on-hover left">
        	<div class="navbar resp">
          		<div class="navbar-inner" role="navigation">
            		<div class="row-fluid">
              		<div class="social-block span5" ><a class="social-icon icon-feed" href="../feed/rss/index.html" title="Subscribe to my rss feed"  ></a></div><h2 class="span7 inside site-description">Du code, du cul</h2><button type="button" class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse"><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><div class="nav-collapse collapse tc-hover-menu-wrapper"><div class="menu-top-menu-container"><ul id="menu-top-menu-2" class="nav tc-hover-menu"><li class="menu-item menu-item-type-taxonomy menu-item-object-category current-post-ancestor current-menu-parent current-post-parent menu-item-1702"><a href="../category/programmation/index.html">Prog</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-1703"><a href="../category/administration-system/index.html">Admin Sys</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-1704"><a href="../category/philo-et-culture/index.html">Philo &#038; culture</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-1706"><a href="../category/cul/index.html">Cul</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-3340"><a href="../cours-et-tutos/index.html">Cours &#038; tutos</a></li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-1707"><a title="Les meilleurs blogs du Web" href="http://multiboards.net/">Multiboards</a></li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-12415"><a href="../planet-python-fr/index.html">Veille Python Fr</a></li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-15634"><a href="http://indexerror.net">Questions Python</a></li>
</ul></div></div>          			</div>
          		</div><!-- /.navbar-inner -->
        	</div><!-- /.navbar resp -->
      	</div><!-- /.navbar-wrapper -->
    			</header>
		<div id="tc-reset-margin-top" class="container-fluid" style="margin-top:103px"></div><div id="main-wrapper" class="container">

        
    <div class="container" role="main">
        <div class="row column-content-wrapper">

                            
                <div id="content" class="span9 article-container">
                    
                    
                        
                                                                                    
                                                                    <article id="post-9219" class="row-fluid post-9219 post type-post status-publish format-standard has-post-thumbnail hentry category-programmation tag-linux tag-mac tag-python tag-screenshot tag-windows">
                                                <header class="entry-header">
          <h1 class="entry-title format-icon">Explication de code : python-mss</h1>            <div class="entry-meta">
                This entry was posted in <a class="btn btn-mini" href="../category/programmation/index.html" title="View all posts in Programmation"> Programmation </a> and tagged <a class="btn btn-mini btn-tag" href="../tag/linux/index.html" title="View all posts in linux"> linux </a><a class="btn btn-mini btn-tag" href="../tag/mac/index.html" title="View all posts in mac"> mac </a><a class="btn btn-mini btn-tag" href="../tag/python/index.html" title="View all posts in python"> python </a><a class="btn btn-mini btn-tag" href="../tag/screenshot/index.html" title="View all posts in screenshot"> screenshot </a><a class="btn btn-mini btn-tag" href="../tag/windows/index.html" title="View all posts in windows"> windows </a> on <a href="../2014/02/22/index.html" title="14:19" rel="bookmark"><time class="entry-date updated" datetime="2014-02-22T14:19:02+00:00">22/02/2014</time></a> <span class="by-author">by <span class="author vcard"><a class="url fn n" href="../author/sam/index.html" title="View all posts by Sam" rel="author">Sam</a></span></span>             </div><!-- .entry-meta -->
            <hr class="featurette-divider __before_content">        </header>
            

          <section class="entry-content ">
              <p>Ca faisait longtemps qu&#8217;on avait pas eu une petite explication de code dans le cadre de notre politique &#8220;<a href="../notre-programme-envoyez-nous-les-scripts-que-vous-ne-pigez-pas-est-toujours-dactu/index.html">envoyez nous les codes que vous ne pigez pas</a>&#8220;.</p>
<p>Celle-ci est un peu particulière.</p>
<p>D&#8217;abord parce qu&#8217;elle traine dans la boîte mail depuis un siècle ou deux. Je pense que l&#8217;auteur de la demande n&#8217;en a plus besoin&#8230;</p>
<p>Ensuite parce que le code est assez complexe, notamment à cause de l&#8217;utilisateur d&#8217;API C. Donc si vous n&#8217;avez pas des notions de C, vous n&#8217;allez rien piger. En effet je ne vais pas expliquer les bases de C ou de Python, ce n&#8217;est pas un tuto, donc il me faut des prérequis. Je vous invite quand même à vous rafraichir la mémoire en utilisant notre <a href="../appeler-du-code-c-depuis-python-avec-ctypes/index.html">introduction au module ctypes</a> car il est massivement utilisé dans ce code.</p>
<p>Exceptionnellement, je ne vais pas pondre de version alternative car :</p>
<ul>
<li>le code est très très long, et j&#8217;ai déjà passé mon samedi matin à écrire cet article.</li>
<li>je n&#8217;ai pas de mac pour tester cette partie.</li>
</ul>
<p>Comme d&#8217;habitude, je vais faire des remarques parfois critiques sur le code, mais mon intention n&#8217;est bien entendu pas de faire du tord à l&#8217;auteur. C&#8217;est pédagogique pour les lecteurs. D&#8217;ailleurs ce bout de code est assez impressionnant et a du demander des heures et des heures de travail tant au niveau du code que de la recherche d&#8217;information. J&#8217;insiste donc sur mon respect pour l&#8217;auteur. On est pas sur bashfr.</p>
<p>Je tiens tout de même à prévenir que la lib ne fonctionne pas sur ma machine, plante sur certains appels, ou produits des screenshots illisibles. Je ne doute néanmoins pas de la compétence de l&#8217;auteur, ce qu&#8217;il essaye de faire est vraiment compliqué, et ne pense que Python n&#8217;est pas son premier langage.</p>
<p>On m&#8217;a signalé dans le twitcoutuer qu&#8217;il manque de la zik :</p>

<!-- iframe plugin v.4.3 wordpress.org/plugins/iframe/ -->
<iframe width="420" height="315" src="http://www.youtube.com/embed/RV2NKk1ATew" frameborder="0" 0="allowfullscreen" scrolling="yes" class="iframe-class"></iframe>

<p>Normalement le but de la lib est de permettre de faire des screenshots en pure Python sous Windows, Linux et Mac. Exemple de code sous Linux :</p>

<div class="wp_syntax" style="position:relative;"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #66cc66;">&gt;&gt;&gt;</span> <span style="color: #ff7700;font-weight:bold;">from</span> mss <span style="color: #ff7700;font-weight:bold;">import</span> MSSLinux
<span style="color: #66cc66;">&gt;&gt;&gt;</span> mss <span style="color: #66cc66;">=</span> MSSLinux<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> screnshots <span style="color: #66cc66;">=</span> mss.<span style="color: black;">save</span><span style="color: black;">&#40;</span>output<span style="color: #66cc66;">=</span><span style="color: #483d8b;">'/tmp/screenshots'</span><span style="color: #66cc66;">,</span> oneshot<span style="color: #66cc66;">=</span><span style="color: #008000;">True</span><span style="color: black;">&#41;</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> <span style="color: #008000;">list</span><span style="color: black;">&#40;</span>screnshots<span style="color: black;">&#41;</span>
<span style="color: black;">&#91;</span>u<span style="color: #483d8b;">'/tmp/screenshots-full.png'</span><span style="color: black;">&#93;</span></pre></td></tr></table><p class="theCode" style="display:none;">&gt;&gt;&gt; from mss import MSSLinux
&gt;&gt;&gt; mss = MSSLinux()
&gt;&gt;&gt; screnshots = mss.save(output='/tmp/screenshots', oneshot=True)
&gt;&gt;&gt; list(screnshots)
[u'/tmp/screenshots-full.png']</p></div>

<p>Et voici le code commenté. C&#8217;est un gros morceau, et bien complexes, avec des notions parfois que je ne maitrise pas. J&#8217;ai pu faire des erreurs et dire des bêtises. Si l&#8217;auteur passe par là, il a bien entendu un droit de réponse.</p>

<div class="wp_syntax" style="position:relative;"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #808080; font-style: italic;">#!/usr/bin/env python</span>
<span style="color: #808080; font-style: italic;"># -*- coding: utf-8 -*-</span>
&nbsp;
<span style="color: #483d8b;">''' A cross-platform multi-screen shot module in pure python using ctypes.
&nbsp;
    This module is maintained by Mickaël Schoentgen &lt;contact@tiger-222.fr&gt;.
    If you find problems, please submit bug reports/patches via the
    GitHub issue tracker (https://github.com/BoboTiG/python-mss/issues).
&nbsp;
    Note: please keep this module compatible to Python 2.6.
&nbsp;
    Still needed:
    * support for additional systems
&nbsp;
    Many thanks to all those who helped (in no particular order):
&nbsp;
      Oros, Eownis
&nbsp;
    History:
&nbsp;
    &lt;see Git checkin messages for history&gt;
&nbsp;
    0.0.1 - first release
    0.0.2 - add support for python 3 on Windows and GNU/Linux
    0.0.3 - MSSImage: remove PNG filters
          - MSSImage: remove 'ext' argument, using only PNG
          - MSSImage: do not overwrite existing image files
          - MSSImage: few optimizations into png()
          - MSSLinux: few optimizations into get_pixels()
    0.0.4 - MSSLinux: use of memoization =&gt; huge time/operations gains
    0.0.5 - MSSWindows: few optimizations into _arrange()
          - MSSImage: code simplified
&nbsp;
    You can always get the latest version of this module at:
&nbsp;
            https://raw.github.com/BoboTiG/python-mss/master/mss.py
&nbsp;
    If that URL should fail, try contacting the author.
'''</span>
&nbsp;
<span style="color: #ff7700;font-weight:bold;">from</span> <span style="color: #dc143c;">__future__</span> <span style="color: #ff7700;font-weight:bold;">import</span> <span style="color: black;">&#40;</span>unicode_literals<span style="color: #66cc66;">,</span> absolute_import<span style="color: #66cc66;">,</span>
                        division<span style="color: #66cc66;">,</span> print_function<span style="color: black;">&#41;</span>
&nbsp;
__version__ <span style="color: #66cc66;">=</span> <span style="color: #483d8b;">'0.0.5'</span>
__author__ <span style="color: #66cc66;">=</span> <span style="color: #483d8b;">&quot;Mickaël 'Tiger-222' Schoentgen&quot;</span>
__copyright__ <span style="color: #66cc66;">=</span> <span style="color: #483d8b;">'''
    Copyright (c) 2013, Mickaël 'Tiger-222' Schoentgen
&nbsp;
    Permission to use, copy, modify, and distribute this software and its
    documentation for any purpose and without fee or royalty is hereby
    granted, provided that the above copyright notice appear in all copies
    and that both that copyright notice and this permission notice appear
    in supporting documentation or portions thereof, including
    modifications, that you make.
'''</span>
&nbsp;
<span style="color: #808080; font-style: italic;"># Bon je vais pas vous expliquer ce que les lignes du dessus font hein...hein</span>
&nbsp;
&nbsp;
<span style="color: #808080; font-style: italic;"># __all__ liste les objets importables si on fait from mss import *</span>
<span style="color: #808080; font-style: italic;"># ce qui limite la pollution du namespace avec tout un tas de choses inutiles</span>
<span style="color: #808080; font-style: italic;"># comme pack, isfile, system, etc. qui sont quelques lignes plus bas.</span>
__all__ <span style="color: #66cc66;">=</span> <span style="color: black;">&#91;</span><span style="color: #483d8b;">'MSSImage'</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'MSSLinux'</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'MSSMac'</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'MSSWindows'</span><span style="color: black;">&#93;</span>
&nbsp;
<span style="color: #808080; font-style: italic;"># Permet de trouve une bibliothèqe via son nom sur le système en cherchant</span>
<span style="color: #808080; font-style: italic;"># divers chemins standard à l'OS</span>
<span style="color: #ff7700;font-weight:bold;">from</span> ctypes.<span style="color: black;">util</span> <span style="color: #ff7700;font-weight:bold;">import</span> find_library
&nbsp;
<span style="color: #808080; font-style: italic;"># Permet une forme de sérialisation des types simples qui est compatible</span>
<span style="color: #808080; font-style: italic;"># entre Python et C</span>
<span style="color: #ff7700;font-weight:bold;">from</span> <span style="color: #dc143c;">struct</span> <span style="color: #ff7700;font-weight:bold;">import</span> pack
&nbsp;
<span style="color: #808080; font-style: italic;"># Permet de vérifier si un fichier existe et n'est pas un dossier</span>
<span style="color: #ff7700;font-weight:bold;">from</span> <span style="color: #dc143c;">os</span>.<span style="color: black;">path</span> <span style="color: #ff7700;font-weight:bold;">import</span> isfile
&nbsp;
<span style="color: #808080; font-style: italic;"># Permet de récupérer le nom de l'OS</span>
<span style="color: #ff7700;font-weight:bold;">from</span> <span style="color: #dc143c;">platform</span> <span style="color: #ff7700;font-weight:bold;">import</span> system
&nbsp;
<span style="color: #808080; font-style: italic;"># Divers opérations sur le système</span>
<span style="color: #ff7700;font-weight:bold;">import</span> <span style="color: #dc143c;">sys</span>
&nbsp;
<span style="color: #808080; font-style: italic;"># Compression zip</span>
<span style="color: #ff7700;font-weight:bold;">import</span> <span style="color: #dc143c;">zlib</span>
&nbsp;
<span style="color: #808080; font-style: italic;"># On importe conditionnellement des packages selon le système sur lequel on</span>
<span style="color: #808080; font-style: italic;"># est. La raison de cela est que certains packages n'existe pas (ou ne sont pas</span>
<span style="color: #808080; font-style: italic;"># utiles) sur certains OS.</span>
&nbsp;
<span style="color: #808080; font-style: italic;"># Darwin, c'est l'OS open source qui sert de base au Mac. C'est</span>
<span style="color: #808080; font-style: italic;"># un mélange de NeXTSTEP et de FreeBSD.</span>
<span style="color: #ff7700;font-weight:bold;">if</span> system<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span> <span style="color: #66cc66;">==</span> <span style="color: #483d8b;">'Darwin'</span>:
    <span style="color: #808080; font-style: italic;"># Quartz est la techno derrière l'affichage des Mac incluant notament</span>
    <span style="color: #808080; font-style: italic;"># le compositeur graphique et moteur de rendu 2D. Il a un binding Python</span>
    <span style="color: #808080; font-style: italic;"># intégré puisque les Mac utilisent Python un peu partout. A ce demander</span>
    <span style="color: #808080; font-style: italic;"># pourquoi ces neuneus nous ont collé objectifs C pour le dev.</span>
    <span style="color: #ff7700;font-weight:bold;">from</span> Quartz <span style="color: #ff7700;font-weight:bold;">import</span> *
    <span style="color: #808080; font-style: italic;"># On importe juste l'équivalent du mimetype sous Mac pour le PNG. C'est</span>
    <span style="color: #808080; font-style: italic;"># une &quot;constante&quot;</span>
    <span style="color: #ff7700;font-weight:bold;">from</span> LaunchServices <span style="color: #ff7700;font-weight:bold;">import</span> kUTTypePNG
&nbsp;
&nbsp;
<span style="color: #ff7700;font-weight:bold;">elif</span> system<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span> <span style="color: #66cc66;">==</span> <span style="color: #483d8b;">'Linux'</span>:
&nbsp;
    <span style="color: #808080; font-style: italic;"># Accès aux variables d'environnement</span>
    <span style="color: #ff7700;font-weight:bold;">from</span> <span style="color: #dc143c;">os</span> <span style="color: #ff7700;font-weight:bold;">import</span> environ
    <span style="color: #808080; font-style: italic;"># Fonction pour transformer ~ dans les chemin d'accès en chemin vers</span>
    <span style="color: #808080; font-style: italic;"># le dossier utilisateur</span>
    <span style="color: #ff7700;font-weight:bold;">from</span> <span style="color: #dc143c;">os</span>.<span style="color: black;">path</span> <span style="color: #ff7700;font-weight:bold;">import</span> expanduser
    <span style="color: #808080; font-style: italic;"># Parseur de xml</span>
    <span style="color: #ff7700;font-weight:bold;">import</span> <span style="color: #dc143c;">xml</span>.<span style="color: black;">etree</span>.<span style="color: black;">ElementTree</span> <span style="color: #ff7700;font-weight:bold;">as</span> ET
&nbsp;
    <span style="color: #808080; font-style: italic;"># 'byref' permet d'obtenir un pointer sur une fonction c,</span>
    <span style="color: #808080; font-style: italic;"># 'cast' est similaire à l'opérateur cast en c et permet le type casting</span>
    <span style="color: #808080; font-style: italic;"># d'un objet c, 'cdll' permet de charger des shared lib C</span>
    <span style="color: #ff7700;font-weight:bold;">from</span> ctypes <span style="color: #ff7700;font-weight:bold;">import</span> byref<span style="color: #66cc66;">,</span> cast<span style="color: #66cc66;">,</span> cdll
&nbsp;
    <span style="color: #808080; font-style: italic;"># je ne sais pas pourquoi ça n'a pas été fait une seule ligne...</span>
    <span style="color: #808080; font-style: italic;"># Tout ça représente les types c éponymes, mais en plus Structure est une</span>
    <span style="color: #808080; font-style: italic;"># classe abstraite dont on peut hériter faire une classe qui peut être</span>
    <span style="color: #808080; font-style: italic;"># passée en paramètre à une fonction C qui attend un struc.</span>
    <span style="color: #ff7700;font-weight:bold;">from</span> ctypes <span style="color: #ff7700;font-weight:bold;">import</span> <span style="color: black;">&#40;</span>
        c_char_p<span style="color: #66cc66;">,</span> c_int<span style="color: #66cc66;">,</span> c_int32<span style="color: #66cc66;">,</span> c_uint<span style="color: #66cc66;">,</span> c_uint32<span style="color: #66cc66;">,</span>
        c_ulong<span style="color: #66cc66;">,</span> c_void_p<span style="color: #66cc66;">,</span> POINTER<span style="color: #66cc66;">,</span> Structure
    <span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># On hérite de Structure ce qui nous fait pour le moment une structure</span>
    <span style="color: #808080; font-style: italic;"># vide</span>
    <span style="color: #ff7700;font-weight:bold;">class</span> Display<span style="color: black;">&#40;</span>Structure<span style="color: black;">&#41;</span>:
        <span style="color: #ff7700;font-weight:bold;">pass</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># Une structure représentant les attributs d'une fenêtre pour le serveur</span>
    <span style="color: #808080; font-style: italic;"># d'affichage sous Linux.</span>
    <span style="color: #ff7700;font-weight:bold;">class</span> XWindowAttributes<span style="color: black;">&#40;</span>Structure<span style="color: black;">&#41;</span>:
        _fields_ <span style="color: #66cc66;">=</span> <span style="color: black;">&#91;</span>
            <span style="color: black;">&#40;</span><span style="color: #483d8b;">'x'</span><span style="color: #66cc66;">,</span>                     c_int32<span style="color: black;">&#41;</span><span style="color: #66cc66;">,</span>
            <span style="color: black;">&#40;</span><span style="color: #483d8b;">'y'</span><span style="color: #66cc66;">,</span>                     c_int32<span style="color: black;">&#41;</span><span style="color: #66cc66;">,</span>
            <span style="color: black;">&#40;</span><span style="color: #483d8b;">'width'</span><span style="color: #66cc66;">,</span>                 c_int32<span style="color: black;">&#41;</span><span style="color: #66cc66;">,</span>
            <span style="color: black;">&#40;</span><span style="color: #483d8b;">'height'</span><span style="color: #66cc66;">,</span>                c_int32<span style="color: black;">&#41;</span><span style="color: #66cc66;">,</span>
            <span style="color: black;">&#40;</span><span style="color: #483d8b;">'border_width'</span><span style="color: #66cc66;">,</span>          c_int32<span style="color: black;">&#41;</span><span style="color: #66cc66;">,</span>
            <span style="color: black;">&#40;</span><span style="color: #483d8b;">'depth'</span><span style="color: #66cc66;">,</span>                 c_int32<span style="color: black;">&#41;</span><span style="color: #66cc66;">,</span>
            <span style="color: black;">&#40;</span><span style="color: #483d8b;">'visual'</span><span style="color: #66cc66;">,</span>                c_ulong<span style="color: black;">&#41;</span><span style="color: #66cc66;">,</span>
            <span style="color: black;">&#40;</span><span style="color: #483d8b;">'root'</span><span style="color: #66cc66;">,</span>                  c_ulong<span style="color: black;">&#41;</span><span style="color: #66cc66;">,</span>
            <span style="color: black;">&#40;</span><span style="color: #483d8b;">'class'</span><span style="color: #66cc66;">,</span>                 c_int32<span style="color: black;">&#41;</span><span style="color: #66cc66;">,</span>
            <span style="color: black;">&#40;</span><span style="color: #483d8b;">'bit_gravity'</span><span style="color: #66cc66;">,</span>           c_int32<span style="color: black;">&#41;</span><span style="color: #66cc66;">,</span>
            <span style="color: black;">&#40;</span><span style="color: #483d8b;">'win_gravity'</span><span style="color: #66cc66;">,</span>           c_int32<span style="color: black;">&#41;</span><span style="color: #66cc66;">,</span>
            <span style="color: black;">&#40;</span><span style="color: #483d8b;">'backing_store'</span><span style="color: #66cc66;">,</span>         c_int32<span style="color: black;">&#41;</span><span style="color: #66cc66;">,</span>
            <span style="color: black;">&#40;</span><span style="color: #483d8b;">'backing_planes'</span><span style="color: #66cc66;">,</span>        c_ulong<span style="color: black;">&#41;</span><span style="color: #66cc66;">,</span>
            <span style="color: black;">&#40;</span><span style="color: #483d8b;">'backing_pixel'</span><span style="color: #66cc66;">,</span>         c_ulong<span style="color: black;">&#41;</span><span style="color: #66cc66;">,</span>
            <span style="color: black;">&#40;</span><span style="color: #483d8b;">'save_under'</span><span style="color: #66cc66;">,</span>            c_int32<span style="color: black;">&#41;</span><span style="color: #66cc66;">,</span>
            <span style="color: black;">&#40;</span><span style="color: #483d8b;">'colourmap'</span><span style="color: #66cc66;">,</span>             c_ulong<span style="color: black;">&#41;</span><span style="color: #66cc66;">,</span>
            <span style="color: black;">&#40;</span><span style="color: #483d8b;">'mapinstalled'</span><span style="color: #66cc66;">,</span>          c_uint32<span style="color: black;">&#41;</span><span style="color: #66cc66;">,</span>
            <span style="color: black;">&#40;</span><span style="color: #483d8b;">'map_state'</span><span style="color: #66cc66;">,</span>             c_uint32<span style="color: black;">&#41;</span><span style="color: #66cc66;">,</span>
            <span style="color: black;">&#40;</span><span style="color: #483d8b;">'all_event_masks'</span><span style="color: #66cc66;">,</span>       c_ulong<span style="color: black;">&#41;</span><span style="color: #66cc66;">,</span>
            <span style="color: black;">&#40;</span><span style="color: #483d8b;">'your_event_mask'</span><span style="color: #66cc66;">,</span>       c_ulong<span style="color: black;">&#41;</span><span style="color: #66cc66;">,</span>
            <span style="color: black;">&#40;</span><span style="color: #483d8b;">'do_not_propagate_mask'</span><span style="color: #66cc66;">,</span> c_ulong<span style="color: black;">&#41;</span><span style="color: #66cc66;">,</span>
            <span style="color: black;">&#40;</span><span style="color: #483d8b;">'override_redirect'</span><span style="color: #66cc66;">,</span>     c_int32<span style="color: black;">&#41;</span><span style="color: #66cc66;">,</span>
            <span style="color: black;">&#40;</span><span style="color: #483d8b;">'screen'</span><span style="color: #66cc66;">,</span>                c_ulong<span style="color: black;">&#41;</span>
        <span style="color: black;">&#93;</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># structure définissant une image telle qu'elle existe dans la mémoire</span>
    <span style="color: #808080; font-style: italic;"># d'un client du serveur d'affichage</span>
    <span style="color: #ff7700;font-weight:bold;">class</span> XImage<span style="color: black;">&#40;</span>Structure<span style="color: black;">&#41;</span>:
        _fields_ <span style="color: #66cc66;">=</span> <span style="color: black;">&#91;</span>
            <span style="color: black;">&#40;</span><span style="color: #483d8b;">'width'</span>            <span style="color: #66cc66;">,</span> c_int<span style="color: black;">&#41;</span><span style="color: #66cc66;">,</span>
            <span style="color: black;">&#40;</span><span style="color: #483d8b;">'height'</span>           <span style="color: #66cc66;">,</span> c_int<span style="color: black;">&#41;</span><span style="color: #66cc66;">,</span>
            <span style="color: black;">&#40;</span><span style="color: #483d8b;">'xoffset'</span>          <span style="color: #66cc66;">,</span> c_int<span style="color: black;">&#41;</span><span style="color: #66cc66;">,</span>
            <span style="color: black;">&#40;</span><span style="color: #483d8b;">'format'</span>           <span style="color: #66cc66;">,</span> c_int<span style="color: black;">&#41;</span><span style="color: #66cc66;">,</span>
            <span style="color: black;">&#40;</span><span style="color: #483d8b;">'data'</span>             <span style="color: #66cc66;">,</span> c_char_p<span style="color: black;">&#41;</span><span style="color: #66cc66;">,</span>
            <span style="color: black;">&#40;</span><span style="color: #483d8b;">'byte_order'</span>       <span style="color: #66cc66;">,</span> c_int<span style="color: black;">&#41;</span><span style="color: #66cc66;">,</span>
            <span style="color: black;">&#40;</span><span style="color: #483d8b;">'bitmap_unit'</span>      <span style="color: #66cc66;">,</span> c_int<span style="color: black;">&#41;</span><span style="color: #66cc66;">,</span>
            <span style="color: black;">&#40;</span><span style="color: #483d8b;">'bitmap_bit_order'</span> <span style="color: #66cc66;">,</span> c_int<span style="color: black;">&#41;</span><span style="color: #66cc66;">,</span>
            <span style="color: black;">&#40;</span><span style="color: #483d8b;">'bitmap_pad'</span>       <span style="color: #66cc66;">,</span> c_int<span style="color: black;">&#41;</span><span style="color: #66cc66;">,</span>
            <span style="color: black;">&#40;</span><span style="color: #483d8b;">'depth'</span>            <span style="color: #66cc66;">,</span> c_int<span style="color: black;">&#41;</span><span style="color: #66cc66;">,</span>
            <span style="color: black;">&#40;</span><span style="color: #483d8b;">'bytes_per_line'</span>   <span style="color: #66cc66;">,</span> c_int<span style="color: black;">&#41;</span><span style="color: #66cc66;">,</span>
            <span style="color: black;">&#40;</span><span style="color: #483d8b;">'bits_per_pixel'</span>   <span style="color: #66cc66;">,</span> c_int<span style="color: black;">&#41;</span><span style="color: #66cc66;">,</span>
            <span style="color: black;">&#40;</span><span style="color: #483d8b;">'red_mask'</span>         <span style="color: #66cc66;">,</span> c_ulong<span style="color: black;">&#41;</span><span style="color: #66cc66;">,</span>
            <span style="color: black;">&#40;</span><span style="color: #483d8b;">'green_mask'</span>       <span style="color: #66cc66;">,</span> c_ulong<span style="color: black;">&#41;</span><span style="color: #66cc66;">,</span>
            <span style="color: black;">&#40;</span><span style="color: #483d8b;">'blue_mask'</span>        <span style="color: #66cc66;">,</span> c_ulong<span style="color: black;">&#41;</span>
        <span style="color: black;">&#93;</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># Apparement la fonction pack avec ce format va être appelée souvent</span>
    <span style="color: #808080; font-style: italic;"># doc l'auteur se fait un raccourci. Le format en question est 'B', donc</span>
    <span style="color: #808080; font-style: italic;"># du unsigned char, et '&lt;', donc du little endian. Et là vous comprenez</span>
    <span style="color: #808080; font-style: italic;"># le bonheur de travailler dans un langage de haut niveau comme Python.</span>
    <span style="color: #ff7700;font-weight:bold;">def</span> b<span style="color: black;">&#40;</span>x<span style="color: black;">&#41;</span>:
        <span style="color: #ff7700;font-weight:bold;">return</span> pack<span style="color: black;">&#40;</span>b<span style="color: #483d8b;">'&lt;B'</span><span style="color: #66cc66;">,</span> x<span style="color: black;">&#41;</span>
&nbsp;
<span style="color: #ff7700;font-weight:bold;">elif</span> system<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span> <span style="color: #66cc66;">==</span> <span style="color: #483d8b;">'Windows'</span>:
&nbsp;
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">from</span> ctypes <span style="color: #ff7700;font-weight:bold;">import</span> <span style="color: black;">&#40;</span>
&nbsp;
        <span style="color: #808080; font-style: italic;"># 'memset' fait pareil que memset en C : on rempli un bloc de mémoire</span>
        <span style="color: #808080; font-style: italic;"># avec les bytes passés en param mais il n'est pas utilisé dans le code,</span>
        <span style="color: #808080; font-style: italic;"># donc je suppose que c'est un oubli. 'pointer' va créer une instance de</span>
        <span style="color: #808080; font-style: italic;"># la classe qui permet de manipuler un pointer sur un type c en Python.</span>
        <span style="color: #808080; font-style: italic;"># 'sizeof', même chose que l'opérateur c, ça retourne la taille en bytes</span>
        <span style="color: #808080; font-style: italic;"># d'un type</span>
        <span style="color: #808080; font-style: italic;"># c. 'windll', comme 'cdll' plus haut, mais l'appel des fonctions suit</span>
        <span style="color: #808080; font-style: italic;"># la convention stdcall typique de la win32api et pas la convention c</span>
        <span style="color: #808080; font-style: italic;"># standard.</span>
        byref<span style="color: #66cc66;">,</span> memset<span style="color: #66cc66;">,</span> pointer<span style="color: #66cc66;">,</span> sizeof<span style="color: #66cc66;">,</span> windll<span style="color: #66cc66;">,</span>
        <span style="color: #808080; font-style: italic;"># Représentation du type void en c, aliasé sous deux noms. Je n'ai pas</span>
        <span style="color: #808080; font-style: italic;"># vraiment compris l'interêt de le faire, excepté pour explicitement</span>
        <span style="color: #808080; font-style: italic;"># montrer quand on l'utilise dans un appel qui attend LPRECT (un pointer</span>
        <span style="color: #808080; font-style: italic;"># sur une struc qui représente un rectangle ou un pointer sur void)</span>
        c_void_p <span style="color: #ff7700;font-weight:bold;">as</span> LPRECT<span style="color: #66cc66;">,</span>
        c_void_p <span style="color: #ff7700;font-weight:bold;">as</span> LPVOID<span style="color: #66cc66;">,</span>
        <span style="color: #808080; font-style: italic;"># créer un array de char en c</span>
        create_string_buffer<span style="color: #66cc66;">,</span>
        <span style="color: #808080; font-style: italic;"># ça on a vu</span>
        Structure<span style="color: #66cc66;">,</span>
        POINTER<span style="color: #66cc66;">,</span>
        <span style="color: #808080; font-style: italic;"># Ceci est une fonction. Pourquoi c'est en majuscule, je n'en sais rien.</span>
        <span style="color: #808080; font-style: italic;"># Une incohérence dans l'API. En tout cas ça permet de retourner</span>
        <span style="color: #808080; font-style: italic;"># un prototype de fonction qui respecte la convention stdcall.</span>
        WINFUNCTYPE<span style="color: #66cc66;">,</span>
    <span style="color: black;">&#41;</span>
    <span style="color: #808080; font-style: italic;"># Des &quot;constantes&quot; qui représentent des types spécifiques à l'API widows</span>
    <span style="color: #808080; font-style: italic;"># Notez que le PEP8 n'est pas respecté, mais bon, vu la taille du code,</span>
    <span style="color: #808080; font-style: italic;"># il y a forcément des coquilles, c'est normal. Certains comme SHORT</span>
    <span style="color: #808080; font-style: italic;"># et HANDLE ne sont pas utilisés.</span>
    <span style="color: #ff7700;font-weight:bold;">from</span> ctypes.<span style="color: black;">wintypes</span> <span style="color: #ff7700;font-weight:bold;">import</span> <span style="color: black;">&#40;</span>
        BOOL<span style="color: #66cc66;">,</span> DOUBLE<span style="color: #66cc66;">,</span> DWORD<span style="color: #66cc66;">,</span> HANDLE<span style="color: #66cc66;">,</span> HBITMAP<span style="color: #66cc66;">,</span> HDC<span style="color: #66cc66;">,</span> HGDIOBJ<span style="color: #66cc66;">,</span>
        HWND<span style="color: #66cc66;">,</span> INT<span style="color: #66cc66;">,</span> LPARAM<span style="color: #66cc66;">,</span> LONG<span style="color: #66cc66;">,</span>RECT<span style="color: #66cc66;">,</span>SHORT<span style="color: #66cc66;">,</span> UINT<span style="color: #66cc66;">,</span> WORD
    <span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># Structure contenant les information sur les dimentions et la couleur</span>
    <span style="color: #808080; font-style: italic;"># d'un BMP (on appelle ça aussi un bitmap ou DIB, donc dans les docs</span>
    <span style="color: #808080; font-style: italic;"># vous verrez l'une ou l'autre de ces appellations)</span>
    <span style="color: #ff7700;font-weight:bold;">class</span> BITMAPINFOHEADER<span style="color: black;">&#40;</span>Structure<span style="color: black;">&#41;</span>:
        _fields_ <span style="color: #66cc66;">=</span> <span style="color: black;">&#91;</span>
            <span style="color: black;">&#40;</span><span style="color: #483d8b;">'biSize'</span><span style="color: #66cc66;">,</span>          DWORD<span style="color: black;">&#41;</span><span style="color: #66cc66;">,</span>
            <span style="color: black;">&#40;</span><span style="color: #483d8b;">'biWidth'</span><span style="color: #66cc66;">,</span>         LONG<span style="color: black;">&#41;</span><span style="color: #66cc66;">,</span>
            <span style="color: black;">&#40;</span><span style="color: #483d8b;">'biHeight'</span><span style="color: #66cc66;">,</span>        LONG<span style="color: black;">&#41;</span><span style="color: #66cc66;">,</span>
            <span style="color: black;">&#40;</span><span style="color: #483d8b;">'biPlanes'</span><span style="color: #66cc66;">,</span>        WORD<span style="color: black;">&#41;</span><span style="color: #66cc66;">,</span>
            <span style="color: black;">&#40;</span><span style="color: #483d8b;">'biBitCount'</span><span style="color: #66cc66;">,</span>      WORD<span style="color: black;">&#41;</span><span style="color: #66cc66;">,</span>
            <span style="color: black;">&#40;</span><span style="color: #483d8b;">'biCompression'</span><span style="color: #66cc66;">,</span>   DWORD<span style="color: black;">&#41;</span><span style="color: #66cc66;">,</span>
            <span style="color: black;">&#40;</span><span style="color: #483d8b;">'biSizeImage'</span><span style="color: #66cc66;">,</span>     DWORD<span style="color: black;">&#41;</span><span style="color: #66cc66;">,</span>
            <span style="color: black;">&#40;</span><span style="color: #483d8b;">'biXPelsPerMeter'</span><span style="color: #66cc66;">,</span> LONG<span style="color: black;">&#41;</span><span style="color: #66cc66;">,</span>
            <span style="color: black;">&#40;</span><span style="color: #483d8b;">'biYPelsPerMeter'</span><span style="color: #66cc66;">,</span> LONG<span style="color: black;">&#41;</span><span style="color: #66cc66;">,</span>
            <span style="color: black;">&#40;</span><span style="color: #483d8b;">'biClrUsed'</span><span style="color: #66cc66;">,</span>       DWORD<span style="color: black;">&#41;</span><span style="color: #66cc66;">,</span>
            <span style="color: black;">&#40;</span><span style="color: #483d8b;">'biClrImportant'</span><span style="color: #66cc66;">,</span>  DWORD<span style="color: black;">&#41;</span>
        <span style="color: black;">&#93;</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># Un wrapper sur la structure précédente, je suppose nécessaire pour</span>
    <span style="color: #808080; font-style: italic;"># être compatible avec une des bizarreries de l'API windows.</span>
    <span style="color: #ff7700;font-weight:bold;">class</span> BITMAPINFO<span style="color: black;">&#40;</span>Structure<span style="color: black;">&#41;</span>:
        _fields_ <span style="color: #66cc66;">=</span> <span style="color: black;">&#91;</span>
            <span style="color: black;">&#40;</span><span style="color: #483d8b;">'bmiHeader'</span><span style="color: #66cc66;">,</span> BITMAPINFOHEADER<span style="color: black;">&#41;</span><span style="color: #66cc66;">,</span>
            <span style="color: black;">&#40;</span><span style="color: #483d8b;">'bmiColors'</span><span style="color: #66cc66;">,</span> DWORD * <span style="color: #ff4500;">3</span><span style="color: black;">&#41;</span>
        <span style="color: black;">&#93;</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># Là j’avoue je ne comprends pas trop le principe. Il tente de vérifier</span>
    <span style="color: #808080; font-style: italic;"># si le système est du Python 2, si oui il ne caste pas la string en bytes</span>
    <span style="color: #808080; font-style: italic;"># car le type de base des strings est déjà de type bytes (ce qui n'est</span>
    <span style="color: #808080; font-style: italic;"># pas le cas en Python 3 : c'est un type unicode). Donc il fabrique la</span>
    <span style="color: #808080; font-style: italic;"># fonction raccourcie selon la version. Sauf qu'il ne le fait pas</span>
    <span style="color: #808080; font-style: italic;"># dans la condition pour linux. Du coup je pige pas trop comment il</span>
    <span style="color: #808080; font-style: italic;"># s'en sort. Il est compatible que 2.7 sous Linux ?</span>
    <span style="color: #808080; font-style: italic;"># Dans tous les cas ces fonctions pourraient être en dehors de la clause</span>
    <span style="color: #808080; font-style: italic;"># if, tout comme certains imports pour des raisons de DRY.</span>
    <span style="color: #ff7700;font-weight:bold;">if</span> <span style="color: #dc143c;">sys</span>.<span style="color: black;">version</span> <span style="color: #66cc66;">&lt;</span> <span style="color: #483d8b;">'3'</span>:
        <span style="color: #ff7700;font-weight:bold;">def</span> b<span style="color: black;">&#40;</span>x<span style="color: black;">&#41;</span>:
            <span style="color: #ff7700;font-weight:bold;">return</span> x
    <span style="color: #ff7700;font-weight:bold;">else</span>:
        <span style="color: #ff7700;font-weight:bold;">def</span> b<span style="color: black;">&#40;</span>x<span style="color: black;">&#41;</span>:
            <span style="color: #ff7700;font-weight:bold;">return</span> pack<span style="color: black;">&#40;</span>b<span style="color: #483d8b;">'&lt;B'</span><span style="color: #66cc66;">,</span> x<span style="color: black;">&#41;</span>
&nbsp;
&nbsp;
<span style="color: #808080; font-style: italic;"># Moi aussi j'adore mettre des commentaires comme ça dans mon code.mon</span>
<span style="color: #808080; font-style: italic;"># Que ceux qui n'aiment pas aillent se faire foutre.</span>
&nbsp;
&nbsp;
<span style="color: #808080; font-style: italic;"># ----------------------------------------------------------------------</span>
<span style="color: #808080; font-style: italic;"># --- [ C'est parti mon kiki ! ] ---------------------------------------</span>
<span style="color: #808080; font-style: italic;"># ----------------------------------------------------------------------</span>
&nbsp;
<span style="color: #808080; font-style: italic;"># Comme précisé dans la docstring, c'est une classe de base. Ca implemente</span>
<span style="color: #808080; font-style: italic;"># essentiellement le logging du mode debug et la logique d'enregistrement</span>
<span style="color: #808080; font-style: italic;"># des fichiers.</span>
<span style="color: #ff7700;font-weight:bold;">class</span> MSS<span style="color: black;">&#40;</span><span style="color: #008000;">object</span><span style="color: black;">&#41;</span>:
    <span style="color: #483d8b;">''' This class will be overloaded by a system specific one.
        It checkes if there is a class available for the current system.
        Raise an exception if no one found.
    '''</span>
&nbsp;
&nbsp;
    <span style="color: #808080; font-style: italic;"># De l'initialisation, pas super intéressant...</span>
    DEBUG <span style="color: #66cc66;">=</span> <span style="color: #008000;">False</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> <span style="color: #0000cd;">__init__</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> debug<span style="color: #66cc66;">=</span><span style="color: #008000;">False</span><span style="color: black;">&#41;</span>:
        <span style="color: #483d8b;">''' Global vars and class overload. '''</span>
&nbsp;
        <span style="color: #008000;">self</span>.<span style="color: black;">DEBUG</span> <span style="color: #66cc66;">=</span> debug
        <span style="color: #008000;">self</span>.<span style="color: black;">monitors</span> <span style="color: #66cc66;">=</span> <span style="color: black;">&#91;</span><span style="color: black;">&#93;</span>
        <span style="color: #008000;">self</span>.<span style="color: black;">oneshot</span> <span style="color: #66cc66;">=</span> <span style="color: #008000;">False</span>
&nbsp;
        <span style="color: #808080; font-style: italic;"># L'init présuppose quand même qu'une classe fille a une fonction</span>
        <span style="color: #808080; font-style: italic;">#  init. Je vois pas trop l'interêt car ça peut se faire par héritage</span>
        <span style="color: #808080; font-style: italic;"># ou alors quitte à faire ça, autant faire en utilisant un système</span>
        <span style="color: #808080; font-style: italic;"># de call back sur des events genre &quot;oninit&quot;, c'est plus propre, plus</span>
        <span style="color: #808080; font-style: italic;"># découplé et ça tombe pas en marche si la fonction init() n'existe pas</span>
        <span style="color: #808080; font-style: italic;"># dans l'enfant.</span>
        <span style="color: #008000;">self</span>.<span style="color: black;">init</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># Une fonction print un peut élaborée qui permet d'afficher rapidement</span>
    <span style="color: #808080; font-style: italic;"># le contenu qu'on lui passe en paramètre de manière formatté pour le debug.</span>
    <span style="color: #808080; font-style: italic;"># Utiliser le module logging aurait été préférable, mais c'est tellement</span>
    <span style="color: #808080; font-style: italic;"># chiant à setup que je comprends qu'il ait eu la flemme.</span>
    <span style="color: #ff7700;font-weight:bold;">def</span> debug<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> method<span style="color: #66cc66;">=</span><span style="color: #483d8b;">''</span><span style="color: #66cc66;">,</span> scalar<span style="color: #66cc66;">=</span><span style="color: #008000;">None</span><span style="color: #66cc66;">,</span> value<span style="color: #66cc66;">=</span><span style="color: #008000;">None</span><span style="color: black;">&#41;</span>:
        <span style="color: #483d8b;">''' Simple debug output. '''</span>
&nbsp;
        <span style="color: #ff7700;font-weight:bold;">if</span> <span style="color: #008000;">self</span>.<span style="color: black;">DEBUG</span>:
            <span style="color: #ff7700;font-weight:bold;">if</span> scalar <span style="color: #ff7700;font-weight:bold;">is</span> <span style="color: #008000;">None</span>:
                <span style="color: #ff7700;font-weight:bold;">print</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">':: '</span> + method + <span style="color: #483d8b;">'()'</span><span style="color: black;">&#41;</span>
            <span style="color: #ff7700;font-weight:bold;">else</span>:
                <span style="color: #ff7700;font-weight:bold;">print</span><span style="color: black;">&#40;</span>method + <span style="color: #483d8b;">'()'</span><span style="color: #66cc66;">,</span> scalar<span style="color: #66cc66;">,</span> <span style="color: #008000;">type</span><span style="color: black;">&#40;</span>value<span style="color: black;">&#41;</span>.__name__<span style="color: #66cc66;">,</span> value<span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># La fonction &quot;kifétou&quot;. Elle demande la création des screenshots, les</span>
    <span style="color: #808080; font-style: italic;"># sauvegarde dans des fichiers png dans un dossier. Il aurait été sympa</span>
    <span style="color: #808080; font-style: italic;"># de découper cette fonction en sous fonctions : une prendre le screen</span>
    <span style="color: #808080; font-style: italic;"># d'un moniteur, une pour recupérer le screenshot tout forme d'objet image,</span>
    <span style="color: #808080; font-style: italic;"># etc. Là la seule option c'est &quot;tu prends tout, tu sauves tout&quot;. C'est pas</span>
    <span style="color: #808080; font-style: italic;"># très souple, et dur à tester.</span>
    <span style="color: #ff7700;font-weight:bold;">def</span> save<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> output<span style="color: #66cc66;">=</span><span style="color: #483d8b;">'mss'</span><span style="color: #66cc66;">,</span> oneshot<span style="color: #66cc66;">=</span><span style="color: #008000;">False</span><span style="color: black;">&#41;</span>:
        <span style="color: #483d8b;">''' For each monitor, grab a screen shot and save it to a file.
&nbsp;
            Parameters:
             - output - string - the output filename without extension
             - oneshot - boolean - grab only one screen shot of all monitors
&nbsp;
            This is a generator which returns created files:
                'output-1.png',
                'output-2.png',
                ...,
                'output-NN.png'
                or
                'output-full.png'
        '''</span>
&nbsp;
        <span style="color: #008000;">self</span>.<span style="color: black;">debug</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'save'</span><span style="color: black;">&#41;</span>
&nbsp;
        <span style="color: #808080; font-style: italic;"># Là on voit un antipattern très courrant en POO : mettre des paramètres</span>
        <span style="color: #808080; font-style: italic;"># pour un appel de méthode directement en attribut pour toute la classe.</span>
        <span style="color: #808080; font-style: italic;"># Cela veut dire qu'un appel à cette fonction &quot;lock&quot; la classe dans</span>
        <span style="color: #808080; font-style: italic;"># un état dépendant de cet appel. En plus de réduire à néant les possibilités</span>
        <span style="color: #808080; font-style: italic;"># de multithreading et rendre les tests compliqués, ça veut dire aussi</span>
        <span style="color: #808080; font-style: italic;"># que tout débuggage doit tenir compte de l'état de la classe. Et bien</span>
        <span style="color: #808080; font-style: italic;"># entendu, ça veut dire qu'on ne peut pas avoir plusieurs états en</span>
        <span style="color: #808080; font-style: italic;"># parallèles, à moins d'instancier plusieurs classes. Il vaudrait mieux</span>
        <span style="color: #808080; font-style: italic;"># que tout ça soit passé en paramètres, quitte à faire un autre objet</span>
        <span style="color: #808080; font-style: italic;"># nommé &quot;config&quot; qui contienne tout ça.</span>
        <span style="color: #808080; font-style: italic;">#</span>
        <span style="color: #808080; font-style: italic;"># En tout cas, ça stoque le param &quot;oneshot&quot; et la liste des moniteurs</span>
        <span style="color: #808080; font-style: italic;"># retournés par le code fourni par la classe fille puisque</span>
        <span style="color: #808080; font-style: italic;"># enum_display_monitors n'est pas défini dans cette classe.</span>
        <span style="color: #008000;">self</span>.<span style="color: black;">oneshot</span> <span style="color: #66cc66;">=</span> oneshot
        <span style="color: #008000;">self</span>.<span style="color: black;">monitors</span> <span style="color: #66cc66;">=</span> <span style="color: #008000;">self</span>.<span style="color: black;">enum_display_monitors</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span> <span style="color: #ff7700;font-weight:bold;">or</span> <span style="color: black;">&#91;</span><span style="color: black;">&#93;</span>
&nbsp;
        <span style="color: #008000;">self</span>.<span style="color: black;">debug</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'save'</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'oneshot'</span><span style="color: #66cc66;">,</span> <span style="color: #008000;">self</span>.<span style="color: black;">oneshot</span><span style="color: black;">&#41;</span>
&nbsp;
        <span style="color: #808080; font-style: italic;"># On lève une exception si il est impossible de trouver des écrans dont</span>
        <span style="color: #808080; font-style: italic;"># on peut faire la capture, ce qui est une bonne chose. Mais une bonne</span>
        <span style="color: #808080; font-style: italic;"># pratique serait de faire :</span>
        <span style="color: #808080; font-style: italic;"># class ScreenshotError(Exception):</span>
        <span style="color: #808080; font-style: italic;">#     pass</span>
        <span style="color: #808080; font-style: italic;"># Afin d'avoir quelque chose de plus significatif que ValueError.</span>
        <span style="color: #808080; font-style: italic;"># De plus, ce code est typique d'un programmeur d'un autre langage</span>
        <span style="color: #808080; font-style: italic;"># qui apprend encore les idiomes Python car cette condition pourrait</span>
        <span style="color: #808080; font-style: italic;"># se réduire à :</span>
        <span style="color: #808080; font-style: italic;"># if not self.monitors: &lt;- pas besoin de len</span>
        <span style="color: #808080; font-style: italic;">#     raise ScreenshotError('MSS: no monitor found.'))</span>
        <span style="color: #ff7700;font-weight:bold;">if</span> <span style="color: #008000;">len</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span>.<span style="color: black;">monitors</span><span style="color: black;">&#41;</span> <span style="color: #66cc66;">&lt;</span> <span style="color: #ff4500;">1</span>:
            <span style="color: #ff7700;font-weight:bold;">raise</span> <span style="color: #008000;">ValueError</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'MSS: no monitor found.'</span><span style="color: black;">&#41;</span>
&nbsp;
        <span style="color: #808080; font-style: italic;"># Monitors screen shots!</span>
        <span style="color: #808080; font-style: italic;"># On itère sur les écrans, et on fait un screen par écran. Même remarque</span>
        <span style="color: #808080; font-style: italic;"># sur le fait que l'auteur cherche encore ses marques en Python (notez</span>
        <span style="color: #808080; font-style: italic;"># bien que c'est naturel, personne n'a la science infuse et mon style</span>
        <span style="color: #808080; font-style: italic;"># est horrible dans les autres langages), car ici le compteur i est</span>
        <span style="color: #808080; font-style: italic;"># aventageusement remplacé par :</span>
        <span style="color: #808080; font-style: italic;"># for i, monitor in enumerate(self.monitors)</span>
        i <span style="color: #66cc66;">=</span> <span style="color: #ff4500;">1</span>
        <span style="color: #ff7700;font-weight:bold;">for</span> monitor <span style="color: #ff7700;font-weight:bold;">in</span> <span style="color: #008000;">self</span>.<span style="color: black;">monitors</span>:
            <span style="color: #008000;">self</span>.<span style="color: black;">debug</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'save'</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'monitor'</span><span style="color: #66cc66;">,</span> monitor<span style="color: black;">&#41;</span>
&nbsp;
            <span style="color: #808080; font-style: italic;"># Si on ne fait qu'un gros screenshot, on l'appelle name-full.png</span>
            <span style="color: #808080; font-style: italic;"># sinon name-numero_du_moniteur.png</span>
            <span style="color: #ff7700;font-weight:bold;">if</span> <span style="color: #008000;">self</span>.<span style="color: black;">oneshot</span>:
                filename <span style="color: #66cc66;">=</span> output + <span style="color: #483d8b;">'-full'</span>
            <span style="color: #ff7700;font-weight:bold;">else</span>:
                filename <span style="color: #66cc66;">=</span> output + <span style="color: #483d8b;">'-'</span> + <span style="color: #008000;">str</span><span style="color: black;">&#40;</span>i<span style="color: black;">&#41;</span>
                i +<span style="color: #66cc66;">=</span> <span style="color: #ff4500;">1</span>
            filename +<span style="color: #66cc66;">=</span> <span style="color: #483d8b;">'.png'</span>
&nbsp;
            <span style="color: #808080; font-style: italic;"># Si le fichier n'existe pas, on l'écrit. Ceci est encore une</span>
            <span style="color: #808080; font-style: italic;"># erreur car une API métier ne doit pas faire ce genre de</span>
            <span style="color: #808080; font-style: italic;"># vérification. Il devrait écraser les fichiers. Il est en revanche</span>
            <span style="color: #808080; font-style: italic;"># possible de mettre un système de callback pour réagir si le</span>
            <span style="color: #808080; font-style: italic;"># fichier existe. Mais le comportement par défaut devrait être</span>
            <span style="color: #808080; font-style: italic;"># d'écraser le fichiers, sinon une personne qui ne lit pas le code</span>
            <span style="color: #808080; font-style: italic;"># source va croire que le code ne marche pas. De plus, il est plus</span>
            <span style="color: #808080; font-style: italic;"># rare de ne pas vouloir écraser les fichiers d'origine que</span>
            <span style="color: #808080; font-style: italic;"># l'inverse. Enfin, puisqu'on ne controle pas le nommage des fichiers</span>
            <span style="color: #808080; font-style: italic;"># depuis l'extérieur de la classe, il n'y a pas de moyen de réagir</span>
            <span style="color: #808080; font-style: italic;"># proprement pour dire &quot;je veux garder les anciens fichiers et</span>
            <span style="color: #808080; font-style: italic;"># avoir les nouveaux quand même&quot; à part utilise un dossier différent</span>
            <span style="color: #808080; font-style: italic;"># à chaque fois.</span>
            <span style="color: #ff7700;font-weight:bold;">if</span> <span style="color: #ff7700;font-weight:bold;">not</span> isfile<span style="color: black;">&#40;</span>filename<span style="color: black;">&#41;</span>:
&nbsp;
                <span style="color: #808080; font-style: italic;"># On récupère l'array de pixels en utilisant le code de la</span>
                <span style="color: #808080; font-style: italic;"># classe fille une fois de plus. C'est nécessaire puisque ça</span>
                <span style="color: #808080; font-style: italic;"># dépend de l'OS.</span>
                <span style="color: #808080; font-style: italic;"># Ce code ne fait pas du tout ce que vous croyez. get_pixels</span>
                <span style="color: #808080; font-style: italic;"># va sauvegarder l'image sans self.image, et retourner 1.</span>
                <span style="color: #808080; font-style: italic;"># C'est donc une fonction qui marche via ses effets de bords,</span>
                <span style="color: #808080; font-style: italic;"># ce qui est une très mauvaise pratique.</span>
                pixels <span style="color: #66cc66;">=</span> <span style="color: #008000;">self</span>.<span style="color: black;">get_pixels</span><span style="color: black;">&#40;</span>monitor<span style="color: black;">&#41;</span>
&nbsp;
                <span style="color: #808080; font-style: italic;"># Même remarque que sur l'autre exception. De plus l'exception</span>
                <span style="color: #808080; font-style: italic;"># devrait être levée au niveau de get_pixels, pas au niveau</span>
                <span style="color: #808080; font-style: italic;"># de save(). Il y a un mélange de base niveau et de haut</span>
                <span style="color: #808080; font-style: italic;"># niveau dans cette classe qui rend l'API assez maladroite.</span>
                <span style="color: #808080; font-style: italic;"># D'ailleurs get_pixels ne retourne jamais None...</span>
                <span style="color: #ff7700;font-weight:bold;">if</span> pixels <span style="color: #ff7700;font-weight:bold;">is</span> <span style="color: #008000;">None</span>:
                    <span style="color: #ff7700;font-weight:bold;">raise</span> <span style="color: #008000;">ValueError</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'MSS: no data to process.'</span><span style="color: black;">&#41;</span>
&nbsp;
                <span style="color: #808080; font-style: italic;"># Bon, ça c'est super crade. En gros il délègue le save à une</span>
                <span style="color: #808080; font-style: italic;"># méthode si elle existe, et sinon le fait à la main.</span>
                <span style="color: #808080; font-style: italic;"># L'héritage est fait pour ça, et il aurait été préférable</span>
                <span style="color: #808080; font-style: italic;"># de faire une méthode save(pixels, size, filename) générique</span>
                <span style="color: #808080; font-style: italic;"># et ensuite l'écraser dans les enfants. Peut être que c'est un</span>
                <span style="color: #808080; font-style: italic;"># dev C et qu'il n'est pas encore très à l'aise avec le POO.</span>
                <span style="color: #808080; font-style: italic;"># Il est possible que l'auteur ait rencontré des problèmes du</span>
                <span style="color: #808080; font-style: italic;"># fait d'une inconsistance d'api et n'ai pas su le gérer en</span>
                <span style="color: #808080; font-style: italic;"># mettant un adapter par dessus. Quand je vous dis que les</span>
                <span style="color: #808080; font-style: italic;"># design pattern c'est parfois utile :)</span>
                <span style="color: #ff7700;font-weight:bold;">if</span> <span style="color: #008000;">hasattr</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'save_'</span><span style="color: black;">&#41;</span>:
                    img_out <span style="color: #66cc66;">=</span> <span style="color: #008000;">self</span>.<span style="color: black;">save_</span><span style="color: black;">&#40;</span>output<span style="color: #66cc66;">=</span>filename<span style="color: black;">&#41;</span>
                <span style="color: #ff7700;font-weight:bold;">else</span>:
                    img <span style="color: #66cc66;">=</span> MSSImage<span style="color: black;">&#40;</span>pixels<span style="color: #66cc66;">,</span> monitor<span style="color: black;">&#91;</span>b<span style="color: #483d8b;">'width'</span><span style="color: black;">&#93;</span><span style="color: #66cc66;">,</span> monitor<span style="color: black;">&#91;</span>b<span style="color: #483d8b;">'height'</span><span style="color: black;">&#93;</span><span style="color: black;">&#41;</span>
                    img_out <span style="color: #66cc66;">=</span> img.<span style="color: black;">dump</span><span style="color: black;">&#40;</span>filename<span style="color: black;">&#41;</span>
                <span style="color: #008000;">self</span>.<span style="color: black;">debug</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'save'</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'img_out'</span><span style="color: #66cc66;">,</span> img_out<span style="color: black;">&#41;</span>
                <span style="color: #ff7700;font-weight:bold;">if</span> img_out:
                    <span style="color: #808080; font-style: italic;"># Etant donné que la génération du screenshot prend du</span>
                    <span style="color: #808080; font-style: italic;"># temps et qu'il y en a plusieurs, l'auteur a intelligemment</span>
                    <span style="color: #808080; font-style: italic;"># choisit de faire un générateur, ce qui permet de ne pas</span>
                    <span style="color: #808080; font-style: italic;"># attendre que tous les screenshots soient terminé avant</span>
                    <span style="color: #808080; font-style: italic;"># de d'avoir un premier résultat.</span>
                    <span style="color: #ff7700;font-weight:bold;">yield</span> img_out
            <span style="color: #ff7700;font-weight:bold;">else</span>:
                <span style="color: #ff7700;font-weight:bold;">yield</span> filename + <span style="color: #483d8b;">' (already exists)'</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># Les fameuses méthodes délégues aux classes filles. Un petit</span>
    <span style="color: #808080; font-style: italic;"># NotImplemented serait mieux que pass car c'est plus explicite, mais</span>
    <span style="color: #808080; font-style: italic;"># rien de grave.</span>
    <span style="color: #ff7700;font-weight:bold;">def</span> enum_display_monitors<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        <span style="color: #483d8b;">''' Get positions of all monitors.
&nbsp;
            If self.oneshot is True, this function has to return a dict
            with dimensions of all monitors at the same time.
            If the monitor has rotation, you have to deal with inside this method.
&nbsp;
            Must returns a dict with a minima:
            {
                'left':   the x-coordinate of the upper-left corner,
                'top':    the y-coordinate of the upper-left corner,
                'width':  the width,
                'height': the height
            }
        '''</span>
        <span style="color: #ff7700;font-weight:bold;">pass</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> get_pixels<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> monitor_infos<span style="color: black;">&#41;</span>:
        <span style="color: #483d8b;">''' Retrieve screen pixels for a given monitor.
&nbsp;
            monitor_infos should contain at least:
            {
                'left':   the x-coordinate of the upper-left corner,
                'top':    the y-coordinate of the upper-left corner,
                'width':  the width,
                'heigth': the height
            }
&nbsp;
            Returns a dict with pixels.
        '''</span>
        <span style="color: #ff7700;font-weight:bold;">pass</span>
&nbsp;
<span style="color: #808080; font-style: italic;"># Maintenant on par dans les détails de l'implémentation de l'algo qui récupère</span>
<span style="color: #808080; font-style: italic;"># les screenshots qui est spécifique à chaque OS.</span>
<span style="color: #ff7700;font-weight:bold;">class</span> MSSMac<span style="color: black;">&#40;</span>MSS<span style="color: black;">&#41;</span>:
    <span style="color: #483d8b;">''' Mutli-screen shot implementation for Mac OSX.
        It uses intensively the Quartz.
    '''</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># Bon, du coup plutôt que de faire une fonction init, il aurait mieux</span>
    <span style="color: #808080; font-style: italic;"># valut faire une fonction __init__ qui appelle super().</span>
    <span style="color: #ff7700;font-weight:bold;">def</span> init<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        <span style="color: #483d8b;">''' Mac OSX initialisations '''</span>
        <span style="color: #008000;">self</span>.<span style="color: black;">debug</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'init'</span><span style="color: black;">&#41;</span>
        <span style="color: #ff7700;font-weight:bold;">pass</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># Là c'est le gros du boulot, et c'est là que je vous dis que l'auteur</span>
    <span style="color: #808080; font-style: italic;"># c'est vraiment super cassé le cul pour trouver toutes ces infos sur</span>
    <span style="color: #808080; font-style: italic;"># les APIS propres à chaque système, et en plus en C. Kudos.</span>
    <span style="color: #ff7700;font-weight:bold;">def</span> enum_display_monitors<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        <span style="color: #483d8b;">''' Get positions of one or more monitors.
            Returns a dict with minimal requirements (see MSS class).
        '''</span>
&nbsp;
        <span style="color: #008000;">self</span>.<span style="color: black;">debug</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'enum_display_monitors'</span><span style="color: black;">&#41;</span>
&nbsp;
        results <span style="color: #66cc66;">=</span> <span style="color: black;">&#91;</span><span style="color: black;">&#93;</span>
        <span style="color: #808080; font-style: italic;"># Si il y a un seul screen à prend, on se fait pas chier et on prend</span>
        <span style="color: #808080; font-style: italic;"># un rectangle de taille infinie pour les limites du screen. Je</span>
        <span style="color: #808080; font-style: italic;"># suppose que l'OS est capable de se démerder avec ça et borner</span>
        <span style="color: #808080; font-style: italic;"># à la taille du matos automatiquement. C'est un truc de faignasse, et</span>
        <span style="color: #808080; font-style: italic;"># c'est plutôt malin.</span>
        <span style="color: #ff7700;font-weight:bold;">if</span> <span style="color: #008000;">self</span>.<span style="color: black;">oneshot</span>:
            rect <span style="color: #66cc66;">=</span> CGRectInfinite
            results.<span style="color: black;">append</span><span style="color: black;">&#40;</span><span style="color: black;">&#123;</span>
                b<span style="color: #483d8b;">'left'</span>  : <span style="color: #008000;">int</span><span style="color: black;">&#40;</span>rect.<span style="color: black;">origin</span>.<span style="color: black;">x</span><span style="color: black;">&#41;</span><span style="color: #66cc66;">,</span>
                b<span style="color: #483d8b;">'top'</span>   : <span style="color: #008000;">int</span><span style="color: black;">&#40;</span>rect.<span style="color: black;">origin</span>.<span style="color: black;">y</span><span style="color: black;">&#41;</span><span style="color: #66cc66;">,</span>
                b<span style="color: #483d8b;">'width'</span> : <span style="color: #008000;">int</span><span style="color: black;">&#40;</span>rect.<span style="color: black;">size</span>.<span style="color: black;">width</span><span style="color: black;">&#41;</span><span style="color: #66cc66;">,</span>
                b<span style="color: #483d8b;">'height'</span>: <span style="color: #008000;">int</span><span style="color: black;">&#40;</span>rect.<span style="color: black;">size</span>.<span style="color: black;">height</span><span style="color: black;">&#41;</span>
            <span style="color: black;">&#125;</span><span style="color: black;">&#41;</span>
        <span style="color: #ff7700;font-weight:bold;">else</span>:
            <span style="color: #808080; font-style: italic;"># Par contre là il faut se taper le calcul des coordonnées de</span>
            <span style="color: #808080; font-style: italic;"># rectangle à la main</span>
&nbsp;
            <span style="color: #808080; font-style: italic;"># Cette variable est requise par CGGetActiveDisplayList mais</span>
            <span style="color: #808080; font-style: italic;"># comme le suggère le commentaire de l'auteur ci-dessous : LOL.</span>
            max_displays <span style="color: #66cc66;">=</span> <span style="color: #ff4500;">32</span>  <span style="color: #808080; font-style: italic;"># Peut-être augmenté, si besoin...</span>
&nbsp;
            <span style="color: #808080; font-style: italic;"># Apparemment il est possible que l'affichage ait subit une</span>
            <span style="color: #808080; font-style: italic;"># rotation. Je suppose que MacOS anticipait déjà l’existence des</span>
            <span style="color: #808080; font-style: italic;"># tablettes à l'époque.</span>
            rotations <span style="color: #66cc66;">=</span> <span style="color: black;">&#123;</span><span style="color: #ff4500;">0.0</span>: <span style="color: #483d8b;">'normal'</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">90.0</span>: <span style="color: #483d8b;">'right'</span><span style="color: #66cc66;">,</span> -<span style="color: #ff4500;">90.0</span>: <span style="color: #483d8b;">'left'</span><span style="color: black;">&#125;</span>
&nbsp;
            <span style="color: #808080; font-style: italic;"># On demande les affichages qui sont effectivement en court</span>
            <span style="color: #808080; font-style: italic;"># d'utilisation, et on récupère un identifiant unique pour chacun</span>
            <span style="color: #808080; font-style: italic;"># d'entre deux.</span>
            res<span style="color: #66cc66;">,</span> ids<span style="color: #66cc66;">,</span> count <span style="color: #66cc66;">=</span> CGGetActiveDisplayList<span style="color: black;">&#40;</span>max_displays<span style="color: #66cc66;">,</span> <span style="color: #008000;">None</span><span style="color: #66cc66;">,</span> <span style="color: #008000;">None</span><span style="color: black;">&#41;</span>
            <span style="color: #ff7700;font-weight:bold;">for</span> display <span style="color: #ff7700;font-weight:bold;">in</span> ids:
                <span style="color: #808080; font-style: italic;"># On interroge l'API Mac pour avoir ses coordonnées, et on</span>
                <span style="color: #808080; font-style: italic;"># les extrait.</span>
                rect <span style="color: #66cc66;">=</span> CGRectStandardize<span style="color: black;">&#40;</span>CGDisplayBounds<span style="color: black;">&#40;</span>display<span style="color: black;">&#41;</span><span style="color: black;">&#41;</span>
                left<span style="color: #66cc66;">,</span> top <span style="color: #66cc66;">=</span> rect.<span style="color: black;">origin</span>.<span style="color: black;">x</span><span style="color: #66cc66;">,</span> rect.<span style="color: black;">origin</span>.<span style="color: black;">y</span>
                width<span style="color: #66cc66;">,</span> height <span style="color: #66cc66;">=</span> rect.<span style="color: black;">size</span>.<span style="color: black;">width</span><span style="color: #66cc66;">,</span> rect.<span style="color: black;">size</span>.<span style="color: black;">height</span>
                <span style="color: #808080; font-style: italic;"># Correction des coordonnées en cas de rotation.</span>
                rot <span style="color: #66cc66;">=</span> CGDisplayRotation<span style="color: black;">&#40;</span>display<span style="color: black;">&#41;</span>
                rotation <span style="color: #66cc66;">=</span> rotations<span style="color: black;">&#91;</span>rot<span style="color: black;">&#93;</span>
                <span style="color: #ff7700;font-weight:bold;">if</span> rotation <span style="color: #ff7700;font-weight:bold;">in</span> <span style="color: black;">&#91;</span><span style="color: #483d8b;">'left'</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'right'</span><span style="color: black;">&#93;</span>:
                    width<span style="color: #66cc66;">,</span> height <span style="color: #66cc66;">=</span> height<span style="color: #66cc66;">,</span> width
&nbsp;
                <span style="color: #808080; font-style: italic;"># Et on insère le résultat dans la liste des monitors. On</span>
                <span style="color: #808080; font-style: italic;"># aurait pu yielder aussi comme dans save(), mais bon, c'est</span>
                <span style="color: #808080; font-style: italic;"># parce que je yield partout que je dis ça.</span>
                results.<span style="color: black;">append</span><span style="color: black;">&#40;</span><span style="color: black;">&#123;</span>
                    b<span style="color: #483d8b;">'left'</span>    : <span style="color: #008000;">int</span><span style="color: black;">&#40;</span>left<span style="color: black;">&#41;</span><span style="color: #66cc66;">,</span>
                    b<span style="color: #483d8b;">'top'</span>     : <span style="color: #008000;">int</span><span style="color: black;">&#40;</span>top<span style="color: black;">&#41;</span><span style="color: #66cc66;">,</span>
                    b<span style="color: #483d8b;">'width'</span>   : <span style="color: #008000;">int</span><span style="color: black;">&#40;</span>width<span style="color: black;">&#41;</span><span style="color: #66cc66;">,</span>
                    b<span style="color: #483d8b;">'height'</span>  : <span style="color: #008000;">int</span><span style="color: black;">&#40;</span>height<span style="color: black;">&#41;</span><span style="color: #66cc66;">,</span>
                    b<span style="color: #483d8b;">'rotation'</span>: rotation
                <span style="color: black;">&#125;</span><span style="color: black;">&#41;</span>
        <span style="color: #ff7700;font-weight:bold;">return</span> results
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> get_pixels<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> monitor<span style="color: black;">&#41;</span>:
        <span style="color: #483d8b;">''' Retreive all pixels from a monitor. Pixels have to be RGB.
        '''</span>
&nbsp;
        <span style="color: #008000;">self</span>.<span style="color: black;">debug</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'get_pixels'</span><span style="color: black;">&#41;</span>
&nbsp;
        <span style="color: #808080; font-style: italic;"># On récupère les coordonnées retournées par enum_display_monitors</span>
        <span style="color: #808080; font-style: italic;"># et on en fait un CGRect qui est nécessaire pour CGWindowListCreateImage.</span>
        width<span style="color: #66cc66;">,</span> height <span style="color: #66cc66;">=</span> monitor<span style="color: black;">&#91;</span>b<span style="color: #483d8b;">'width'</span><span style="color: black;">&#93;</span><span style="color: #66cc66;">,</span> monitor<span style="color: black;">&#91;</span>b<span style="color: #483d8b;">'height'</span><span style="color: black;">&#93;</span>
        left<span style="color: #66cc66;">,</span> top <span style="color: #66cc66;">=</span> monitor<span style="color: black;">&#91;</span>b<span style="color: #483d8b;">'left'</span><span style="color: black;">&#93;</span><span style="color: #66cc66;">,</span> monitor<span style="color: black;">&#91;</span>b<span style="color: #483d8b;">'top'</span><span style="color: black;">&#93;</span>
        rect <span style="color: #66cc66;">=</span> CGRect<span style="color: black;">&#40;</span><span style="color: black;">&#40;</span>left<span style="color: #66cc66;">,</span> top<span style="color: black;">&#41;</span><span style="color: #66cc66;">,</span> <span style="color: black;">&#40;</span>width<span style="color: #66cc66;">,</span> height<span style="color: black;">&#41;</span><span style="color: black;">&#41;</span>
        <span style="color: #808080; font-style: italic;"># CGWindowListCreateImage retourne l'image à ces coordonnées.</span>
        <span style="color: #808080; font-style: italic;"># Les 3 derniers paramètres sont là grace à &quot;from Quartz import *&quot;</span>
        <span style="color: #808080; font-style: italic;"># (c'est pour ça que je vous dis de ne pas le faire, car c'est pas</span>
        <span style="color: #808080; font-style: italic;"># facile à retracer). kCGWindowListOptionOnScreenOnly force l'inclusion</span>
        <span style="color: #808080; font-style: italic;"># uniquement des fenêtre affichées et non celles hors écran.</span>
        <span style="color: #808080; font-style: italic;"># kCGNullWindowID est l'équivalent de None, dans ce contexte. C'est</span>
        <span style="color: #808080; font-style: italic;"># la fenêtre de référence, et on en veut aucune.</span>
        <span style="color: #808080; font-style: italic;"># kCGWindowImageDefault demande de capturer le fenêtre ET sa décoration</span>
        <span style="color: #808080; font-style: italic;"># (comme les ombres portées).</span>
        <span style="color: #808080; font-style: italic;"># Ces deux derniers params sont les valeurs par défaut donc je ne sais</span>
        <span style="color: #808080; font-style: italic;"># pas pourquoi il les passent.</span>
        <span style="color: #008000;">self</span>.<span style="color: black;">image</span> <span style="color: #66cc66;">=</span> CGWindowListCreateImage<span style="color: black;">&#40;</span>
                    rect<span style="color: #66cc66;">,</span> kCGWindowListOptionOnScreenOnly<span style="color: #66cc66;">,</span>
                    kCGNullWindowID<span style="color: #66cc66;">,</span> kCGWindowImageDefault<span style="color: black;">&#41;</span>
&nbsp;
        <span style="color: #808080; font-style: italic;"># Comme je le disais dans save(), la fonction ne retourne PAS l'objet</span>
        <span style="color: #808080; font-style: italic;"># image mais 1. L'image est stockée dans self.image et ce sont les</span>
        <span style="color: #808080; font-style: italic;"># autres méthodes qui tapent dans cet attribut. C'est mal.</span>
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #ff4500;">1</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># la fameurse méthode save_ utilisée par save()...</span>
    <span style="color: #ff7700;font-weight:bold;">def</span> save_<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> output<span style="color: black;">&#41;</span>:
        <span style="color: #483d8b;">''' Special method to not use MSSImage class. '''</span>
&nbsp;
        <span style="color: #008000;">self</span>.<span style="color: black;">debug</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'save_'</span><span style="color: black;">&#41;</span>
&nbsp;
        <span style="color: #808080; font-style: italic;"># résolution du png</span>
        dpi <span style="color: #66cc66;">=</span> <span style="color: #ff4500;">72</span>
        <span style="color: #808080; font-style: italic;"># chemin du png. Tout est URL dans Mac OS. Un chemin de fichier</span>
        <span style="color: #808080; font-style: italic;"># est une URL file://</span>
        url <span style="color: #66cc66;">=</span> NSURL.<span style="color: black;">fileURLWithPath_</span><span style="color: black;">&#40;</span>output<span style="color: black;">&#41;</span>
        <span style="color: #808080; font-style: italic;"># On fabrique l'objet fichier</span>
        dest <span style="color: #66cc66;">=</span> CGImageDestinationCreateWithURL<span style="color: black;">&#40;</span>url<span style="color: #66cc66;">,</span> kUTTypePNG<span style="color: #66cc66;">,</span> <span style="color: #ff4500;">1</span><span style="color: #66cc66;">,</span> <span style="color: #008000;">None</span><span style="color: black;">&#41;</span>
        properties <span style="color: #66cc66;">=</span> <span style="color: black;">&#123;</span>
            kCGImagePropertyDPIWidth: dpi<span style="color: #66cc66;">,</span>
            kCGImagePropertyDPIHeight: dpi<span style="color: #66cc66;">,</span>
        <span style="color: black;">&#125;</span>
        <span style="color: #808080; font-style: italic;"># On met notre image dans l'objet fichier. Là il faut se souvenir</span>
        <span style="color: #808080; font-style: italic;"># que save() appelle get_pixel() qui remplit self.image puis appelle</span>
        <span style="color: #808080; font-style: italic;"># save_() derrière. Je vous l'avais dis que les effets de bord, ça</span>
        <span style="color: #808080; font-style: italic;"># craint).</span>
        CGImageDestinationAddImage<span style="color: black;">&#40;</span>dest<span style="color: #66cc66;">,</span> <span style="color: #008000;">self</span>.<span style="color: black;">image</span><span style="color: #66cc66;">,</span> properties<span style="color: black;">&#41;</span>
        <span style="color: #808080; font-style: italic;"># On écrit notre objet fichier sur le disk.</span>
        <span style="color: #ff7700;font-weight:bold;">if</span> <span style="color: #ff7700;font-weight:bold;">not</span> CGImageDestinationFinalize<span style="color: black;">&#40;</span>dest<span style="color: black;">&#41;</span>:
            output <span style="color: #66cc66;">=</span> <span style="color: #008000;">None</span>
&nbsp;
        <span style="color: #808080; font-style: italic;"># L'auteur vide ouput si CGImageDestinationFinalize à échoué. Il</span>
        <span style="color: #808080; font-style: italic;"># vaudrait mieux lever une exception.</span>
        <span style="color: #ff7700;font-weight:bold;">return</span> output
&nbsp;
<span style="color: #808080; font-style: italic;"># On passe à l'implémentation Linux.</span>
<span style="color: #ff7700;font-weight:bold;">class</span> MSSLinux<span style="color: black;">&#40;</span>MSS<span style="color: black;">&#41;</span>:
    <span style="color: #483d8b;">''' Mutli-screen shot implementation for GNU/Linux.
        It uses intensively the Xlib.
    '''</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># Fait un travail de nettoyage quand l'objet est garbage collecté, en</span>
    <span style="color: #808080; font-style: italic;"># l'occurence ferme la connection avec le serveur x. Je rappelle que</span>
    <span style="color: #808080; font-style: italic;"># l'appel à __del__ n'est pas garanti donc mieux faut faire une méthode</span>
    <span style="color: #808080; font-style: italic;"># close() officielle et un context manager avec un finally.</span>
    <span style="color: #ff7700;font-weight:bold;">def</span> <span style="color: #0000cd;">__del__</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        <span style="color: #483d8b;">''' Disconnect from X server '''</span>
&nbsp;
        <span style="color: #008000;">self</span>.<span style="color: black;">debug</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'__del__'</span><span style="color: black;">&#41;</span>
&nbsp;
        <span style="color: #ff7700;font-weight:bold;">if</span> <span style="color: #008000;">self</span>.<span style="color: black;">display</span>:
            <span style="color: #008000;">self</span>.<span style="color: black;">XCloseDisplay</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span>.<span style="color: black;">display</span><span style="color: black;">&#41;</span>
&nbsp;
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> init<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        <span style="color: #483d8b;">''' GNU/Linux initialisations '''</span>
&nbsp;
        <span style="color: #008000;">self</span>.<span style="color: black;">debug</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'init'</span><span style="color: black;">&#41;</span>
&nbsp;
        <span style="color: #808080; font-style: italic;"># on charge la shared lib du serveur x</span>
        x11 <span style="color: #66cc66;">=</span> find_library<span style="color: black;">&#40;</span><span style="color: #483d8b;">'X11'</span><span style="color: black;">&#41;</span>
        <span style="color: #ff7700;font-weight:bold;">if</span> x11 <span style="color: #ff7700;font-weight:bold;">is</span> <span style="color: #008000;">None</span>:
            <span style="color: #ff7700;font-weight:bold;">raise</span> <span style="color: #008000;">OSError</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'MSSLinux: no X11 library found.'</span><span style="color: black;">&#41;</span>
        <span style="color: #ff7700;font-weight:bold;">else</span>:
            xlib <span style="color: #66cc66;">=</span> cdll.<span style="color: black;">LoadLibrary</span><span style="color: black;">&#40;</span>x11<span style="color: black;">&#41;</span>
&nbsp;
        <span style="color: #008000;">self</span>.<span style="color: black;">debug</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'init'</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'xlib'</span><span style="color: #66cc66;">,</span> xlib<span style="color: black;">&#41;</span>
&nbsp;
        <span style="color: #808080; font-style: italic;"># Aliasing des méthode de xlib. Pourquoi ? Aucune idée.</span>
        <span style="color: #808080; font-style: italic;"># passer l'objet xlib le parait plus logique. Peut être qu'il y a</span>
        <span style="color: #808080; font-style: italic;"># une raison technique liée au mapping ctypes, mais je ne la connais</span>
        <span style="color: #808080; font-style: italic;"># pas.</span>
        <span style="color: #008000;">self</span>.<span style="color: black;">XOpenDisplay</span> <span style="color: #66cc66;">=</span> xlib.<span style="color: black;">XOpenDisplay</span>
        <span style="color: #008000;">self</span>.<span style="color: black;">XDefaultScreen</span> <span style="color: #66cc66;">=</span> xlib.<span style="color: black;">XDefaultScreen</span>
        <span style="color: #008000;">self</span>.<span style="color: black;">XDefaultRootWindow</span> <span style="color: #66cc66;">=</span> xlib.<span style="color: black;">XDefaultRootWindow</span>
        <span style="color: #008000;">self</span>.<span style="color: black;">XGetWindowAttributes</span> <span style="color: #66cc66;">=</span> xlib.<span style="color: black;">XGetWindowAttributes</span>
        <span style="color: #008000;">self</span>.<span style="color: black;">XAllPlanes</span> <span style="color: #66cc66;">=</span> xlib.<span style="color: black;">XAllPlanes</span>
        <span style="color: #008000;">self</span>.<span style="color: black;">XGetImage</span> <span style="color: #66cc66;">=</span> xlib.<span style="color: black;">XGetImage</span>
        <span style="color: #008000;">self</span>.<span style="color: black;">XGetPixel</span> <span style="color: #66cc66;">=</span> xlib.<span style="color: black;">XGetPixel</span>
        <span style="color: #008000;">self</span>.<span style="color: black;">XFree</span> <span style="color: #66cc66;">=</span> xlib.<span style="color: black;">XFree</span>
        <span style="color: #008000;">self</span>.<span style="color: black;">XCloseDisplay</span> <span style="color: #66cc66;">=</span> xlib.<span style="color: black;">XCloseDisplay</span>
&nbsp;
        <span style="color: #808080; font-style: italic;"># ctypes permet de spécifier pour chaque fonction des types attendus</span>
        <span style="color: #808080; font-style: italic;"># en paramètre et en valeur de retour. Cela permet l'autocasting</span>
        <span style="color: #808080; font-style: italic;"># de types compatibles et une exception explicite en cas de passage</span>
        <span style="color: #808080; font-style: italic;"># de mauvais paramètres plutôt qu'un core dump.</span>
        <span style="color: #808080; font-style: italic;"># L'auteur ici à mis ce code un peu lourd dans des méthodes dédiées et</span>
        <span style="color: #808080; font-style: italic;"># préfixées de _ puisqu'à usage interne.</span>
        <span style="color: #008000;">self</span>._set_argtypes<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
        <span style="color: #008000;">self</span>._set_restypes<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
&nbsp;
        <span style="color: #808080; font-style: italic;"># On récupère l'affichage en cours en tapant dans les variables</span>
        <span style="color: #808080; font-style: italic;"># d'environnement. Le jobby-jobba et du au fait qu'il veut garder</span>
        <span style="color: #808080; font-style: italic;"># la compatibilité Python 3 et 2.7 et qu'il faut accomoder</span>
        <span style="color: #808080; font-style: italic;"># les types str/unicode/bytes.</span>
        <span style="color: #808080; font-style: italic;"># C'est une vérification pour éviter un segfault si il n'y pas de</span>
        <span style="color: #808080; font-style: italic;"># serveur x qui tourne.</span>
        display <span style="color: #66cc66;">=</span> <span style="color: #008000;">None</span>
        <span style="color: #008000;">self</span>.<span style="color: black;">display</span> <span style="color: #66cc66;">=</span> <span style="color: #008000;">None</span>
        <span style="color: #ff7700;font-weight:bold;">try</span>:
            <span style="color: #ff7700;font-weight:bold;">if</span> <span style="color: #dc143c;">sys</span>.<span style="color: black;">version</span> <span style="color: #66cc66;">&gt;</span> <span style="color: #483d8b;">'3'</span>:
                display <span style="color: #66cc66;">=</span> <span style="color: #dc143c;">bytes</span><span style="color: black;">&#40;</span>environ<span style="color: black;">&#91;</span><span style="color: #483d8b;">'DISPLAY'</span><span style="color: black;">&#93;</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'utf-8'</span><span style="color: black;">&#41;</span>
            <span style="color: #ff7700;font-weight:bold;">else</span>:
                display <span style="color: #66cc66;">=</span> environ<span style="color: black;">&#91;</span><span style="color: #483d8b;">'DISPLAY'</span><span style="color: black;">&#93;</span>
        <span style="color: #ff7700;font-weight:bold;">except</span> <span style="color: #008000;">KeyError</span>:
            err <span style="color: #66cc66;">=</span> <span style="color: #483d8b;">'MSSLinux: $DISPLAY not set. Stopping to prevent segfault.'</span>
            <span style="color: #ff7700;font-weight:bold;">raise</span> <span style="color: #008000;">ValueError</span><span style="color: black;">&#40;</span>err<span style="color: black;">&#41;</span>
        <span style="color: #008000;">self</span>.<span style="color: black;">debug</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'init'</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'$DISPLAY'</span><span style="color: #66cc66;">,</span> display<span style="color: black;">&#41;</span>
&nbsp;
        <span style="color: #808080; font-style: italic;"># On récupère l'écran par défaut et la fenêtre racine sur l'affichage</span>
        <span style="color: #808080; font-style: italic;"># en cours.</span>
&nbsp;
        <span style="color: #808080; font-style: italic;"># At this point, if there is no running server, it could end on</span>
        <span style="color: #808080; font-style: italic;"># a segmentation fault. And we cannot catch it.</span>
        <span style="color: #008000;">self</span>.<span style="color: black;">display</span> <span style="color: #66cc66;">=</span> <span style="color: #008000;">self</span>.<span style="color: black;">XOpenDisplay</span><span style="color: black;">&#40;</span>display<span style="color: black;">&#41;</span>
        <span style="color: #008000;">self</span>.<span style="color: black;">debug</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'init'</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'display'</span><span style="color: #66cc66;">,</span> <span style="color: #008000;">self</span>.<span style="color: black;">display</span><span style="color: black;">&#41;</span>
        <span style="color: #008000;">self</span>.<span style="color: black;">screen</span> <span style="color: #66cc66;">=</span> <span style="color: #008000;">self</span>.<span style="color: black;">XDefaultScreen</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span>.<span style="color: black;">display</span><span style="color: black;">&#41;</span>
        <span style="color: #008000;">self</span>.<span style="color: black;">debug</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'init'</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'screen'</span><span style="color: #66cc66;">,</span> <span style="color: #008000;">self</span>.<span style="color: black;">screen</span><span style="color: black;">&#41;</span>
        <span style="color: #008000;">self</span>.<span style="color: black;">root</span> <span style="color: #66cc66;">=</span> <span style="color: #008000;">self</span>.<span style="color: black;">XDefaultRootWindow</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span>.<span style="color: black;">display</span><span style="color: #66cc66;">,</span> <span style="color: #008000;">self</span>.<span style="color: black;">screen</span><span style="color: black;">&#41;</span>
        <span style="color: #008000;">self</span>.<span style="color: black;">debug</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'init'</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'root'</span><span style="color: #66cc66;">,</span> <span style="color: #008000;">self</span>.<span style="color: black;">root</span><span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># les deux méthodes qui servent à manuellement définir les types</span>
    <span style="color: #808080; font-style: italic;"># des autres méthodes dont j'ai parlé plus haut.</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> _set_argtypes<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        <span style="color: #483d8b;">''' Functions arguments '''</span>
&nbsp;
        <span style="color: #008000;">self</span>.<span style="color: black;">debug</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'_set_argtypes'</span><span style="color: black;">&#41;</span>
&nbsp;
        <span style="color: #008000;">self</span>.<span style="color: black;">XOpenDisplay</span>.<span style="color: black;">argtypes</span> <span style="color: #66cc66;">=</span> <span style="color: black;">&#91;</span>c_char_p<span style="color: black;">&#93;</span>
        <span style="color: #008000;">self</span>.<span style="color: black;">XDefaultScreen</span>.<span style="color: black;">argtypes</span> <span style="color: #66cc66;">=</span> <span style="color: black;">&#91;</span>POINTER<span style="color: black;">&#40;</span>Display<span style="color: black;">&#41;</span><span style="color: black;">&#93;</span>
        <span style="color: #008000;">self</span>.<span style="color: black;">XDefaultRootWindow</span>.<span style="color: black;">argtypes</span> <span style="color: #66cc66;">=</span> <span style="color: black;">&#91;</span>POINTER<span style="color: black;">&#40;</span>Display<span style="color: black;">&#41;</span><span style="color: #66cc66;">,</span> c_int<span style="color: black;">&#93;</span>
        <span style="color: #008000;">self</span>.<span style="color: black;">XGetWindowAttributes</span>.<span style="color: black;">argtypes</span> <span style="color: #66cc66;">=</span> <span style="color: black;">&#91;</span>POINTER<span style="color: black;">&#40;</span>Display<span style="color: black;">&#41;</span><span style="color: #66cc66;">,</span>
            POINTER<span style="color: black;">&#40;</span>XWindowAttributes<span style="color: black;">&#41;</span><span style="color: #66cc66;">,</span> POINTER<span style="color: black;">&#40;</span>XWindowAttributes<span style="color: black;">&#41;</span><span style="color: black;">&#93;</span>
        <span style="color: #008000;">self</span>.<span style="color: black;">XAllPlanes</span>.<span style="color: black;">argtypes</span> <span style="color: #66cc66;">=</span> <span style="color: black;">&#91;</span><span style="color: black;">&#93;</span>
        <span style="color: #008000;">self</span>.<span style="color: black;">XGetImage</span>.<span style="color: black;">argtypes</span> <span style="color: #66cc66;">=</span> <span style="color: black;">&#91;</span>POINTER<span style="color: black;">&#40;</span>Display<span style="color: black;">&#41;</span><span style="color: #66cc66;">,</span> POINTER<span style="color: black;">&#40;</span>Display<span style="color: black;">&#41;</span><span style="color: #66cc66;">,</span>
            c_int<span style="color: #66cc66;">,</span> c_int<span style="color: #66cc66;">,</span> c_uint<span style="color: #66cc66;">,</span> c_uint<span style="color: #66cc66;">,</span> c_ulong<span style="color: #66cc66;">,</span> c_int<span style="color: black;">&#93;</span>
        <span style="color: #008000;">self</span>.<span style="color: black;">XGetPixel</span>.<span style="color: black;">argtypes</span> <span style="color: #66cc66;">=</span> <span style="color: black;">&#91;</span>POINTER<span style="color: black;">&#40;</span>XImage<span style="color: black;">&#41;</span><span style="color: #66cc66;">,</span> c_int<span style="color: #66cc66;">,</span> c_int<span style="color: black;">&#93;</span>
        <span style="color: #008000;">self</span>.<span style="color: black;">XFree</span>.<span style="color: black;">argtypes</span> <span style="color: #66cc66;">=</span> <span style="color: black;">&#91;</span>POINTER<span style="color: black;">&#40;</span>XImage<span style="color: black;">&#41;</span><span style="color: black;">&#93;</span>
        <span style="color: #008000;">self</span>.<span style="color: black;">XCloseDisplay</span>.<span style="color: black;">argtypes</span> <span style="color: #66cc66;">=</span> <span style="color: black;">&#91;</span>POINTER<span style="color: black;">&#40;</span>Display<span style="color: black;">&#41;</span><span style="color: black;">&#93;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> _set_restypes<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        <span style="color: #483d8b;">''' Functions return type '''</span>
&nbsp;
        <span style="color: #008000;">self</span>.<span style="color: black;">debug</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'_set_restypes'</span><span style="color: black;">&#41;</span>
&nbsp;
        <span style="color: #008000;">self</span>.<span style="color: black;">XOpenDisplay</span>.<span style="color: black;">restype</span> <span style="color: #66cc66;">=</span> POINTER<span style="color: black;">&#40;</span>Display<span style="color: black;">&#41;</span>
        <span style="color: #008000;">self</span>.<span style="color: black;">XDefaultScreen</span>.<span style="color: black;">restype</span> <span style="color: #66cc66;">=</span> c_int
        <span style="color: #008000;">self</span>.<span style="color: black;">XDefaultRootWindow</span>.<span style="color: black;">restype</span> <span style="color: #66cc66;">=</span> POINTER<span style="color: black;">&#40;</span>XWindowAttributes<span style="color: black;">&#41;</span>
        <span style="color: #008000;">self</span>.<span style="color: black;">XGetWindowAttributes</span>.<span style="color: black;">restype</span> <span style="color: #66cc66;">=</span> c_int
        <span style="color: #008000;">self</span>.<span style="color: black;">XAllPlanes</span>.<span style="color: black;">restype</span> <span style="color: #66cc66;">=</span> c_ulong
        <span style="color: #008000;">self</span>.<span style="color: black;">XGetImage</span>.<span style="color: black;">restype</span> <span style="color: #66cc66;">=</span> POINTER<span style="color: black;">&#40;</span>XImage<span style="color: black;">&#41;</span>
        <span style="color: #008000;">self</span>.<span style="color: black;">XGetPixel</span>.<span style="color: black;">restype</span> <span style="color: #66cc66;">=</span> c_ulong
        <span style="color: #008000;">self</span>.<span style="color: black;">XFree</span>.<span style="color: black;">restype</span> <span style="color: #66cc66;">=</span> c_void_p
        <span style="color: #008000;">self</span>.<span style="color: black;">XCloseDisplay</span>.<span style="color: black;">restype</span> <span style="color: #66cc66;">=</span> c_void_p
&nbsp;
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> enum_display_monitors<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        <span style="color: #483d8b;">''' Get positions of one or more monitors.
            Returns a dict with minimal requirements (see MSS class).
        '''</span>
&nbsp;
        <span style="color: #008000;">self</span>.<span style="color: black;">debug</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'enum_display_monitors'</span><span style="color: black;">&#41;</span>
&nbsp;
        results <span style="color: #66cc66;">=</span> <span style="color: black;">&#91;</span><span style="color: black;">&#93;</span>
        <span style="color: #ff7700;font-weight:bold;">if</span> <span style="color: #008000;">self</span>.<span style="color: black;">oneshot</span>:
            <span style="color: #808080; font-style: italic;"># Dans le cas d'un seul screenshot pour tout, on récupère juste</span>
            <span style="color: #808080; font-style: italic;"># les coordonnées de la fenêtre racine.</span>
            gwa <span style="color: #66cc66;">=</span> XWindowAttributes<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
            <span style="color: #008000;">self</span>.<span style="color: black;">XGetWindowAttributes</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span>.<span style="color: black;">display</span><span style="color: #66cc66;">,</span> <span style="color: #008000;">self</span>.<span style="color: black;">root</span><span style="color: #66cc66;">,</span> byref<span style="color: black;">&#40;</span>gwa<span style="color: black;">&#41;</span><span style="color: black;">&#41;</span>
            results.<span style="color: black;">append</span><span style="color: black;">&#40;</span><span style="color: black;">&#123;</span>
                b<span style="color: #483d8b;">'left'</span>  : <span style="color: #008000;">int</span><span style="color: black;">&#40;</span>gwa.<span style="color: black;">x</span><span style="color: black;">&#41;</span><span style="color: #66cc66;">,</span>
                b<span style="color: #483d8b;">'top'</span>   : <span style="color: #008000;">int</span><span style="color: black;">&#40;</span>gwa.<span style="color: black;">y</span><span style="color: black;">&#41;</span><span style="color: #66cc66;">,</span>
                b<span style="color: #483d8b;">'width'</span> : <span style="color: #008000;">int</span><span style="color: black;">&#40;</span>gwa.<span style="color: black;">width</span><span style="color: black;">&#41;</span><span style="color: #66cc66;">,</span>
                b<span style="color: #483d8b;">'height'</span>: <span style="color: #008000;">int</span><span style="color: black;">&#40;</span>gwa.<span style="color: black;">height</span><span style="color: black;">&#41;</span>
            <span style="color: black;">&#125;</span><span style="color: black;">&#41;</span>
        <span style="color: #ff7700;font-weight:bold;">else</span>:
&nbsp;
            <span style="color: #808080; font-style: italic;"># Sinon on parse le fichier XML de config pour essayer de</span>
            <span style="color: #808080; font-style: italic;"># trouver les coordonnées. Je ne suis pas certain que ce soit</span>
            <span style="color: #808080; font-style: italic;"># une bonne stratégie puisque le fichier monitors.xml contient</span>
            <span style="color: #808080; font-style: italic;"># tous les moniteurs jamais branché sur la machine, y compris ceux</span>
            <span style="color: #808080; font-style: italic;"># qu'on a pas branché depuis 1000 ans...</span>
&nbsp;
            <span style="color: #808080; font-style: italic;"># It is a little more complicated, we have to guess all stuff</span>
            <span style="color: #808080; font-style: italic;"># from ~/.config/monitors.xml, if present.</span>
            monitors <span style="color: #66cc66;">=</span> expanduser<span style="color: black;">&#40;</span><span style="color: #483d8b;">'~/.config/monitors.xml'</span><span style="color: black;">&#41;</span>
            <span style="color: #ff7700;font-weight:bold;">if</span> <span style="color: #ff7700;font-weight:bold;">not</span> isfile<span style="color: black;">&#40;</span>monitors<span style="color: black;">&#41;</span>:
                <span style="color: #808080; font-style: italic;"># Ici, lever une exception serait pas mal.</span>
                <span style="color: #808080; font-style: italic;"># A la place, l'auteur choisit de mettre oneshot et de relancer</span>
                <span style="color: #808080; font-style: italic;"># la capture. Donc au lieu d'avoir ce qu'on demande ou une</span>
                <span style="color: #808080; font-style: italic;"># erreur, on a ce qu'on demande ou ce qu'on ne demande pas.</span>
                <span style="color: #808080; font-style: italic;"># Encore une fois, j'en profite pour souligner qu'il faut</span>
                <span style="color: #808080; font-style: italic;"># éviter ce genre de config à base de site effects. Devoir</span>
                <span style="color: #808080; font-style: italic;"># setter un attribut pour avoir un résultat différent à cette</span>
                <span style="color: #808080; font-style: italic;"># méthode n'est pas très propre.</span>
                <span style="color: #008000;">self</span>.<span style="color: black;">debug</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'ERROR'</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'MSSLinux: enum_display_monitors() failed (no monitors.xml).'</span><span style="color: black;">&#41;</span>
                <span style="color: #008000;">self</span>.<span style="color: black;">oneshot</span> <span style="color: #66cc66;">=</span> <span style="color: #008000;">True</span>
                <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>.<span style="color: black;">enum_display_monitors</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
&nbsp;
            <span style="color: #808080; font-style: italic;"># Le XML est une collection de noeuds 'configuration' qui représentent</span>
            <span style="color: #808080; font-style: italic;"># chacun un moniteur. On récupère ici le premier noeud 'configurations'</span>
            tree <span style="color: #66cc66;">=</span> ET.<span style="color: black;">parse</span><span style="color: black;">&#40;</span>monitors<span style="color: black;">&#41;</span>
            root <span style="color: #66cc66;">=</span> tree.<span style="color: black;">getroot</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
            config <span style="color: #66cc66;">=</span> root.<span style="color: black;">findall</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'configuration'</span><span style="color: black;">&#41;</span><span style="color: black;">&#91;</span>-<span style="color: #ff4500;">1</span><span style="color: black;">&#93;</span>
            conf <span style="color: #66cc66;">=</span> <span style="color: black;">&#91;</span><span style="color: black;">&#93;</span>
            <span style="color: #808080; font-style: italic;"># chaque noeud &quot;configurations&quot; à une série de noeuds ouput qui</span>
            <span style="color: #808080; font-style: italic;"># représentent chaque format de sortie (VGA, HDMI, etc). On</span>
            <span style="color: #808080; font-style: italic;"># boucle dessus.</span>
            <span style="color: #ff7700;font-weight:bold;">for</span> output <span style="color: #ff7700;font-weight:bold;">in</span> config.<span style="color: black;">findall</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'output'</span><span style="color: black;">&#41;</span>:
                name <span style="color: #66cc66;">=</span> output.<span style="color: black;">get</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'name'</span><span style="color: black;">&#41;</span>
                <span style="color: #ff7700;font-weight:bold;">if</span> name <span style="color: #66cc66;">!=</span> <span style="color: #483d8b;">'default'</span>:
                    <span style="color: #808080; font-style: italic;"># On récupère les coordonnées, la rotation, on extrait,</span>
                    <span style="color: #808080; font-style: italic;"># on corrige, on ajoute à la liste... Bref, même topo</span>
                    <span style="color: #808080; font-style: italic;"># qu'avec MacOsX.</span>
                    x <span style="color: #66cc66;">=</span> output.<span style="color: black;">find</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'x'</span><span style="color: black;">&#41;</span>
                    y <span style="color: #66cc66;">=</span> output.<span style="color: black;">find</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'y'</span><span style="color: black;">&#41;</span>
                    width <span style="color: #66cc66;">=</span> output.<span style="color: black;">find</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'width'</span><span style="color: black;">&#41;</span>
                    height <span style="color: #66cc66;">=</span> output.<span style="color: black;">find</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'height'</span><span style="color: black;">&#41;</span>
                    rotation <span style="color: #66cc66;">=</span> output.<span style="color: black;">find</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'rotation'</span><span style="color: black;">&#41;</span>
                    <span style="color: #ff7700;font-weight:bold;">if</span> <span style="color: #008000;">None</span> <span style="color: #ff7700;font-weight:bold;">not</span> <span style="color: #ff7700;font-weight:bold;">in</span> <span style="color: black;">&#91;</span>x<span style="color: #66cc66;">,</span> y<span style="color: #66cc66;">,</span> width<span style="color: #66cc66;">,</span> height<span style="color: black;">&#93;</span> <span style="color: #ff7700;font-weight:bold;">and</span> name <span style="color: #ff7700;font-weight:bold;">not</span> <span style="color: #ff7700;font-weight:bold;">in</span> conf:
                        conf.<span style="color: black;">append</span><span style="color: black;">&#40;</span>name<span style="color: black;">&#41;</span>
                        <span style="color: #ff7700;font-weight:bold;">if</span> rotation.<span style="color: black;">text</span> <span style="color: #ff7700;font-weight:bold;">in</span> <span style="color: black;">&#91;</span><span style="color: #483d8b;">'left'</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'right'</span><span style="color: black;">&#93;</span>:
                            width<span style="color: #66cc66;">,</span> height <span style="color: #66cc66;">=</span> height<span style="color: #66cc66;">,</span> width
                        results.<span style="color: black;">append</span><span style="color: black;">&#40;</span><span style="color: black;">&#123;</span>
                            b<span style="color: #483d8b;">'left'</span>    : <span style="color: #008000;">int</span><span style="color: black;">&#40;</span>x.<span style="color: black;">text</span><span style="color: black;">&#41;</span><span style="color: #66cc66;">,</span>
                            b<span style="color: #483d8b;">'top'</span>     : <span style="color: #008000;">int</span><span style="color: black;">&#40;</span>y.<span style="color: black;">text</span><span style="color: black;">&#41;</span><span style="color: #66cc66;">,</span>
                            b<span style="color: #483d8b;">'width'</span>   : <span style="color: #008000;">int</span><span style="color: black;">&#40;</span>width.<span style="color: black;">text</span><span style="color: black;">&#41;</span><span style="color: #66cc66;">,</span>
                            b<span style="color: #483d8b;">'height'</span>  : <span style="color: #008000;">int</span><span style="color: black;">&#40;</span>height.<span style="color: black;">text</span><span style="color: black;">&#41;</span><span style="color: #66cc66;">,</span>
                            b<span style="color: #483d8b;">'rotation'</span>: rotation.<span style="color: black;">text</span>
                        <span style="color: black;">&#125;</span><span style="color: black;">&#41;</span>
        <span style="color: #ff7700;font-weight:bold;">return</span> results
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> get_pixels<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> monitor<span style="color: black;">&#41;</span>:
        <span style="color: #483d8b;">''' Retreive all pixels from a monitor. Pixels have to be RGB.
        '''</span>
&nbsp;
        <span style="color: #008000;">self</span>.<span style="color: black;">debug</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'get_pixels'</span><span style="color: black;">&#41;</span>
&nbsp;
        <span style="color: #808080; font-style: italic;"># On récupère les coordonnées des monitors revoyées par enum_display_monitors</span>
        width<span style="color: #66cc66;">,</span> height <span style="color: #66cc66;">=</span> monitor<span style="color: black;">&#91;</span>b<span style="color: #483d8b;">'width'</span><span style="color: black;">&#93;</span><span style="color: #66cc66;">,</span> monitor<span style="color: black;">&#91;</span>b<span style="color: #483d8b;">'height'</span><span style="color: black;">&#93;</span>
        left<span style="color: #66cc66;">,</span> top <span style="color: #66cc66;">=</span> monitor<span style="color: black;">&#91;</span>b<span style="color: #483d8b;">'left'</span><span style="color: black;">&#93;</span><span style="color: #66cc66;">,</span> monitor<span style="color: black;">&#91;</span>b<span style="color: #483d8b;">'top'</span><span style="color: black;">&#93;</span>
        ZPixmap <span style="color: #66cc66;">=</span> <span style="color: #ff4500;">2</span>
&nbsp;
        <span style="color: #808080; font-style: italic;"># On récupère un masque de pixels pour l'ensemble de l'affichage</span>
        allplanes <span style="color: #66cc66;">=</span> <span style="color: #008000;">self</span>.<span style="color: black;">XAllPlanes</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
        <span style="color: #008000;">self</span>.<span style="color: black;">debug</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'get_pixels'</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'allplanes'</span><span style="color: #66cc66;">,</span> allplanes<span style="color: black;">&#41;</span>
&nbsp;
        <span style="color: #808080; font-style: italic;"># Visiblement un fix. C'est ce qu'on appelle un commentaire utile.</span>
        <span style="color: #808080; font-style: italic;"># Fix for XGetImage: expected LP_Display instance instead of LP_XWindowAttributes</span>
        root <span style="color: #66cc66;">=</span> cast<span style="color: black;">&#40;</span><span style="color: #008000;">self</span>.<span style="color: black;">root</span><span style="color: #66cc66;">,</span> POINTER<span style="color: black;">&#40;</span>Display<span style="color: black;">&#41;</span><span style="color: black;">&#41;</span>
&nbsp;
        <span style="color: #808080; font-style: italic;"># On récupère un dump des pixels pour les coordonnées en cours, de</span>
        <span style="color: #808080; font-style: italic;"># l'affichage en cours, on lui applique le masque de pixel mais</span>
        <span style="color: #808080; font-style: italic;"># je ne sais pas pourquoi on doit le faire. x11 est une bestiole</span>
        <span style="color: #808080; font-style: italic;"># très tarabiscotée, et mes recherches n'ont rien donné. L'auteur</span>
        <span style="color: #808080; font-style: italic;"># a du bien s'amuser à trouver comment faire ce genre de chose.</span>
        image <span style="color: #66cc66;">=</span> <span style="color: #008000;">self</span>.<span style="color: black;">XGetImage</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span>.<span style="color: black;">display</span><span style="color: #66cc66;">,</span> root<span style="color: #66cc66;">,</span> left<span style="color: #66cc66;">,</span> top<span style="color: #66cc66;">,</span> width<span style="color: #66cc66;">,</span>
            height<span style="color: #66cc66;">,</span> allplanes<span style="color: #66cc66;">,</span> ZPixmap<span style="color: black;">&#41;</span>
        <span style="color: #ff7700;font-weight:bold;">if</span> image <span style="color: #ff7700;font-weight:bold;">is</span> <span style="color: #008000;">None</span>:
            <span style="color: #ff7700;font-weight:bold;">raise</span> <span style="color: #008000;">ValueError</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'MSSLinux: XGetImage() failed.'</span><span style="color: black;">&#41;</span>
&nbsp;
        <span style="color: #808080; font-style: italic;"># Les pixels doivent être récupérés en RGB. L'auteur fait donc une</span>
        <span style="color: #808080; font-style: italic;"># fonction de conversion (c'est une fonction inline, donc jetable)</span>
        <span style="color: #808080; font-style: italic;"># puis l'applique à la liste des pixels qu'il récupère dans l'image.</span>
        <span style="color: #808080; font-style: italic;"># Une simple boucle for aurait fait l'affaire mais l'auteur a mis</span>
        <span style="color: #808080; font-style: italic;"># en place une stratégie de mémoisation (mise en cache) dans la fonction.</span>
        <span style="color: #808080; font-style: italic;"># Vu que la fonction est inline, un simple dico aurait aussi fait</span>
        <span style="color: #808080; font-style: italic;"># l'affaire. Mais une il est très possible qu'on lui ait donné</span>
        <span style="color: #808080; font-style: italic;"># le truc et comme il n'est pas habitué à Python il a juste copié/collé.</span>
        <span style="color: #808080; font-style: italic;"># Je le fais souvent en Java / C donc je vais pas lui jeter la pierre.</span>
        <span style="color: #ff7700;font-weight:bold;">def</span> pix<span style="color: black;">&#40;</span>pixel<span style="color: #66cc66;">,</span> _resultats<span style="color: #66cc66;">=</span><span style="color: black;">&#123;</span><span style="color: black;">&#125;</span><span style="color: black;">&#41;</span>:
            <span style="color: #483d8b;">''' Apply shifts to a pixel to get the RGB values.
                This method uses of memoization.
            '''</span>
            <span style="color: #808080; font-style: italic;"># La mise en cache se fait à ce niveau.</span>
            <span style="color: #ff7700;font-weight:bold;">if</span> <span style="color: #ff7700;font-weight:bold;">not</span> pixel <span style="color: #ff7700;font-weight:bold;">in</span> _resultats:
                <span style="color: #808080; font-style: italic;"># Là c'est du byte shifting, mais quelle logique exacte est</span>
                <span style="color: #808080; font-style: italic;"># implémentée, aucune idée. Il faudrait regarder les algos</span>
                <span style="color: #808080; font-style: italic;"># de conversion pixels vers RGB et trouver celui qui est</span>
                <span style="color: #808080; font-style: italic;"># appliqué. C'est le genre de truc que je copie/colle car</span>
                <span style="color: #808080; font-style: italic;"># je suis trop feignant et tester que ça marche est plus rapide</span>
                <span style="color: #808080; font-style: italic;"># que comprendre.</span>
                _resultats<span style="color: black;">&#91;</span>pixel<span style="color: black;">&#93;</span> <span style="color: #66cc66;">=</span> b<span style="color: black;">&#40;</span><span style="color: black;">&#40;</span>pixel &amp; <span style="color: #ff4500;">16711680</span><span style="color: black;">&#41;</span> <span style="color: #66cc66;">&gt;&gt;</span> <span style="color: #ff4500;">16</span><span style="color: black;">&#41;</span> + b<span style="color: black;">&#40;</span><span style="color: black;">&#40;</span>pixel &amp; <span style="color: #ff4500;">65280</span><span style="color: black;">&#41;</span> <span style="color: #66cc66;">&gt;&gt;</span> <span style="color: #ff4500;">8</span><span style="color: black;">&#41;</span> + b<span style="color: black;">&#40;</span>pixel &amp; <span style="color: #ff4500;">255</span><span style="color: black;">&#41;</span>
            <span style="color: #ff7700;font-weight:bold;">return</span> _resultats<span style="color: black;">&#91;</span>pixel<span style="color: black;">&#93;</span>
&nbsp;
        <span style="color: #808080; font-style: italic;"># Aliasing de la fonction pour gagner en vitesse en évitant un lookup</span>
        <span style="color: #808080; font-style: italic;"># d'attribut dans une boucle.</span>
        get_pix <span style="color: #66cc66;">=</span> <span style="color: #008000;">self</span>.<span style="color: black;">XGetPixel</span>
        <span style="color: #808080; font-style: italic;"># Boucle de conversion via une liste en intention.</span>
        pixels <span style="color: #66cc66;">=</span> <span style="color: black;">&#91;</span>pix<span style="color: black;">&#40;</span>get_pix<span style="color: black;">&#40;</span>image<span style="color: #66cc66;">,</span> x<span style="color: #66cc66;">,</span> y<span style="color: black;">&#41;</span><span style="color: black;">&#41;</span> <span style="color: #ff7700;font-weight:bold;">for</span> y <span style="color: #ff7700;font-weight:bold;">in</span> <span style="color: #008000;">range</span><span style="color: black;">&#40;</span>height<span style="color: black;">&#41;</span> <span style="color: #ff7700;font-weight:bold;">for</span> x <span style="color: #ff7700;font-weight:bold;">in</span> <span style="color: #008000;">range</span><span style="color: black;">&#40;</span>width<span style="color: black;">&#41;</span><span style="color: black;">&#93;</span>
&nbsp;
        <span style="color: #808080; font-style: italic;"># Ici get_pixels retourne l'objet image plutôt que de la sauver</span>
        <span style="color: #808080; font-style: italic;"># dans un attribut self.image. Ouch.</span>
        <span style="color: #008000;">self</span>.<span style="color: black;">XFree</span><span style="color: black;">&#40;</span>image<span style="color: black;">&#41;</span>
        <span style="color: #ff7700;font-weight:bold;">return</span> b<span style="color: #483d8b;">''</span>.<span style="color: black;">join</span><span style="color: black;">&#40;</span>pixels<span style="color: black;">&#41;</span>
&nbsp;
<span style="color: #808080; font-style: italic;"># On passe maintenant à l'implémentation pour Windows</span>
&nbsp;
<span style="color: #ff7700;font-weight:bold;">class</span> MSSWindows<span style="color: black;">&#40;</span>MSS<span style="color: black;">&#41;</span>:
    <span style="color: #483d8b;">''' Mutli-screen shot implementation for Microsoft Windows. '''</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># Même topo que pour la version Linux. Même principe que son init.</span>
    <span style="color: #ff7700;font-weight:bold;">def</span> init<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        <span style="color: #483d8b;">''' Windows initialisations '''</span>
&nbsp;
        <span style="color: #008000;">self</span>.<span style="color: black;">debug</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'init'</span><span style="color: black;">&#41;</span>
&nbsp;
        <span style="color: #008000;">self</span>.<span style="color: black;">GetSystemMetrics</span> <span style="color: #66cc66;">=</span> windll.<span style="color: black;">user32</span>.<span style="color: black;">GetSystemMetrics</span>
        <span style="color: #008000;">self</span>.<span style="color: black;">EnumDisplayMonitors</span> <span style="color: #66cc66;">=</span> windll.<span style="color: black;">user32</span>.<span style="color: black;">EnumDisplayMonitors</span>
        <span style="color: #008000;">self</span>.<span style="color: black;">GetWindowDC</span> <span style="color: #66cc66;">=</span> windll.<span style="color: black;">user32</span>.<span style="color: black;">GetWindowDC</span>
        <span style="color: #008000;">self</span>.<span style="color: black;">CreateCompatibleDC</span> <span style="color: #66cc66;">=</span> windll.<span style="color: black;">gdi32</span>.<span style="color: black;">CreateCompatibleDC</span>
        <span style="color: #008000;">self</span>.<span style="color: black;">CreateCompatibleBitmap</span> <span style="color: #66cc66;">=</span> windll.<span style="color: black;">gdi32</span>.<span style="color: black;">CreateCompatibleBitmap</span>
        <span style="color: #008000;">self</span>.<span style="color: black;">SelectObject</span> <span style="color: #66cc66;">=</span> windll.<span style="color: black;">gdi32</span>.<span style="color: black;">SelectObject</span>
        <span style="color: #008000;">self</span>.<span style="color: black;">BitBlt</span> <span style="color: #66cc66;">=</span> windll.<span style="color: black;">gdi32</span>.<span style="color: black;">BitBlt</span>
        <span style="color: #008000;">self</span>.<span style="color: black;">GetDIBits</span> <span style="color: #66cc66;">=</span> windll.<span style="color: black;">gdi32</span>.<span style="color: black;">GetDIBits</span>
        <span style="color: #008000;">self</span>.<span style="color: black;">DeleteObject</span> <span style="color: #66cc66;">=</span> windll.<span style="color: black;">gdi32</span>.<span style="color: black;">DeleteObject</span>
&nbsp;
        <span style="color: #008000;">self</span>._set_argtypes<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
        <span style="color: #008000;">self</span>._set_restypes<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> _set_argtypes<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        <span style="color: #483d8b;">''' Functions arguments '''</span>
&nbsp;
        <span style="color: #008000;">self</span>.<span style="color: black;">debug</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'_set_argtypes'</span><span style="color: black;">&#41;</span>
&nbsp;
        <span style="color: #008000;">self</span>.<span style="color: black;">MONITORENUMPROC</span> <span style="color: #66cc66;">=</span> WINFUNCTYPE<span style="color: black;">&#40;</span>INT<span style="color: #66cc66;">,</span> DWORD<span style="color: #66cc66;">,</span> DWORD<span style="color: #66cc66;">,</span>
            POINTER<span style="color: black;">&#40;</span>RECT<span style="color: black;">&#41;</span><span style="color: #66cc66;">,</span> DOUBLE<span style="color: black;">&#41;</span>
        <span style="color: #008000;">self</span>.<span style="color: black;">GetSystemMetrics</span>.<span style="color: black;">argtypes</span> <span style="color: #66cc66;">=</span> <span style="color: black;">&#91;</span>INT<span style="color: black;">&#93;</span>
        <span style="color: #008000;">self</span>.<span style="color: black;">EnumDisplayMonitors</span>.<span style="color: black;">argtypes</span> <span style="color: #66cc66;">=</span> <span style="color: black;">&#91;</span>HDC<span style="color: #66cc66;">,</span> LPRECT<span style="color: #66cc66;">,</span>
            <span style="color: #008000;">self</span>.<span style="color: black;">MONITORENUMPROC</span><span style="color: #66cc66;">,</span> LPARAM<span style="color: black;">&#93;</span>
        <span style="color: #008000;">self</span>.<span style="color: black;">GetWindowDC</span>.<span style="color: black;">argtypes</span> <span style="color: #66cc66;">=</span> <span style="color: black;">&#91;</span>HWND<span style="color: black;">&#93;</span>
        <span style="color: #008000;">self</span>.<span style="color: black;">CreateCompatibleDC</span>.<span style="color: black;">argtypes</span> <span style="color: #66cc66;">=</span> <span style="color: black;">&#91;</span>HDC<span style="color: black;">&#93;</span>
        <span style="color: #008000;">self</span>.<span style="color: black;">CreateCompatibleBitmap</span>.<span style="color: black;">argtypes</span> <span style="color: #66cc66;">=</span> <span style="color: black;">&#91;</span>HDC<span style="color: #66cc66;">,</span> INT<span style="color: #66cc66;">,</span> INT<span style="color: black;">&#93;</span>
        <span style="color: #008000;">self</span>.<span style="color: black;">SelectObject</span>.<span style="color: black;">argtypes</span> <span style="color: #66cc66;">=</span> <span style="color: black;">&#91;</span>HDC<span style="color: #66cc66;">,</span> HGDIOBJ<span style="color: black;">&#93;</span>
        <span style="color: #008000;">self</span>.<span style="color: black;">BitBlt</span>.<span style="color: black;">argtypes</span> <span style="color: #66cc66;">=</span> <span style="color: black;">&#91;</span>HDC<span style="color: #66cc66;">,</span> INT<span style="color: #66cc66;">,</span> INT<span style="color: #66cc66;">,</span> INT<span style="color: #66cc66;">,</span> INT<span style="color: #66cc66;">,</span> HDC<span style="color: #66cc66;">,</span> INT<span style="color: #66cc66;">,</span> INT<span style="color: #66cc66;">,</span> DWORD<span style="color: black;">&#93;</span>
        <span style="color: #008000;">self</span>.<span style="color: black;">DeleteObject</span>.<span style="color: black;">argtypes</span> <span style="color: #66cc66;">=</span> <span style="color: black;">&#91;</span>HGDIOBJ<span style="color: black;">&#93;</span>
        <span style="color: #008000;">self</span>.<span style="color: black;">GetDIBits</span>.<span style="color: black;">argtypes</span> <span style="color: #66cc66;">=</span> <span style="color: black;">&#91;</span>HDC<span style="color: #66cc66;">,</span> HBITMAP<span style="color: #66cc66;">,</span> UINT<span style="color: #66cc66;">,</span> UINT<span style="color: #66cc66;">,</span> LPVOID<span style="color: #66cc66;">,</span>
            POINTER<span style="color: black;">&#40;</span>BITMAPINFO<span style="color: black;">&#41;</span><span style="color: #66cc66;">,</span> UINT<span style="color: black;">&#93;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> _set_restypes<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        <span style="color: #483d8b;">''' Functions return type '''</span>
&nbsp;
        <span style="color: #008000;">self</span>.<span style="color: black;">debug</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'_set_restypes'</span><span style="color: black;">&#41;</span>
&nbsp;
        <span style="color: #008000;">self</span>.<span style="color: black;">GetSystemMetrics</span>.<span style="color: black;">restypes</span> <span style="color: #66cc66;">=</span> INT
        <span style="color: #008000;">self</span>.<span style="color: black;">EnumDisplayMonitors</span>.<span style="color: black;">restypes</span> <span style="color: #66cc66;">=</span> BOOL
        <span style="color: #008000;">self</span>.<span style="color: black;">GetWindowDC</span>.<span style="color: black;">restypes</span> <span style="color: #66cc66;">=</span> HDC
        <span style="color: #008000;">self</span>.<span style="color: black;">CreateCompatibleDC</span>.<span style="color: black;">restypes</span> <span style="color: #66cc66;">=</span> HDC
        <span style="color: #008000;">self</span>.<span style="color: black;">CreateCompatibleBitmap</span>.<span style="color: black;">restypes</span> <span style="color: #66cc66;">=</span> HBITMAP
        <span style="color: #008000;">self</span>.<span style="color: black;">SelectObject</span>.<span style="color: black;">restypes</span> <span style="color: #66cc66;">=</span> HGDIOBJ
        <span style="color: #008000;">self</span>.<span style="color: black;">BitBlt</span>.<span style="color: black;">restypes</span> <span style="color: #66cc66;">=</span>  BOOL
        <span style="color: #008000;">self</span>.<span style="color: black;">GetDIBits</span>.<span style="color: black;">restypes</span> <span style="color: #66cc66;">=</span> INT
        <span style="color: #008000;">self</span>.<span style="color: black;">DeleteObject</span>.<span style="color: black;">restypes</span> <span style="color: #66cc66;">=</span> BOOL
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> enum_display_monitors<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        <span style="color: #483d8b;">''' Get positions of one or more monitors.
            Returns a dict with minimal requirements (see MSS class).
        '''</span>
&nbsp;
        <span style="color: #008000;">self</span>.<span style="color: black;">debug</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'enum_display_monitors'</span><span style="color: black;">&#41;</span>
&nbsp;
        <span style="color: #808080; font-style: italic;"># le code qui permet de récupérer les moniteurs est visiblement</span>
        <span style="color: #808080; font-style: italic;"># asynchrone, donc on fabrique un callback qui va remplir le tableau</span>
        <span style="color: #808080; font-style: italic;"># des résultats.</span>
&nbsp;
        <span style="color: #ff7700;font-weight:bold;">def</span> _callback<span style="color: black;">&#40;</span>monitor<span style="color: #66cc66;">,</span> dc<span style="color: #66cc66;">,</span> rect<span style="color: #66cc66;">,</span> data<span style="color: black;">&#41;</span>:
            rct <span style="color: #66cc66;">=</span> rect.<span style="color: black;">contents</span>
            results.<span style="color: black;">append</span><span style="color: black;">&#40;</span><span style="color: black;">&#123;</span>
                b<span style="color: #483d8b;">'left'</span>  : <span style="color: #008000;">int</span><span style="color: black;">&#40;</span>rct.<span style="color: black;">left</span><span style="color: black;">&#41;</span><span style="color: #66cc66;">,</span>
                b<span style="color: #483d8b;">'top'</span>   : <span style="color: #008000;">int</span><span style="color: black;">&#40;</span>rct.<span style="color: black;">top</span><span style="color: black;">&#41;</span><span style="color: #66cc66;">,</span>
                b<span style="color: #483d8b;">'width'</span> : <span style="color: #008000;">int</span><span style="color: black;">&#40;</span>rct.<span style="color: black;">right</span> - rct.<span style="color: black;">left</span><span style="color: black;">&#41;</span><span style="color: #66cc66;">,</span>
                b<span style="color: #483d8b;">'height'</span>: <span style="color: #008000;">int</span><span style="color: black;">&#40;</span>rct.<span style="color: black;">bottom</span> -rct.<span style="color: black;">top</span><span style="color: black;">&#41;</span>
            <span style="color: black;">&#125;</span><span style="color: black;">&#41;</span>
            <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #ff4500;">1</span>
&nbsp;
        results <span style="color: #66cc66;">=</span> <span style="color: black;">&#91;</span><span style="color: black;">&#93;</span>
        <span style="color: #808080; font-style: italic;"># si c'est juste un seul screenshot, c'est un appel synchrone</span>
        <span style="color: #ff7700;font-weight:bold;">if</span> <span style="color: #008000;">self</span>.<span style="color: black;">oneshot</span>:
            <span style="color: #808080; font-style: italic;"># ce sont des constantes qui déterminent quelle info ont veut que</span>
            <span style="color: #808080; font-style: italic;"># GetSystemMetrics renvoit. Ici on demande les coordonnées de tout</span>
            <span style="color: #808080; font-style: italic;"># l'écran, une par une.</span>
            SM_XVIRTUALSCREEN <span style="color: #66cc66;">=</span> <span style="color: #ff4500;">76</span>
            SM_YVIRTUALSCREEN <span style="color: #66cc66;">=</span> <span style="color: #ff4500;">77</span>
            SM_CXVIRTUALSCREEN <span style="color: #66cc66;">=</span> <span style="color: #ff4500;">78</span>
            SM_CYVIRTUALSCREEN <span style="color: #66cc66;">=</span> <span style="color: #ff4500;">79</span>
            left <span style="color: #66cc66;">=</span> <span style="color: #008000;">self</span>.<span style="color: black;">GetSystemMetrics</span><span style="color: black;">&#40;</span>SM_XVIRTUALSCREEN<span style="color: black;">&#41;</span>
            right <span style="color: #66cc66;">=</span> <span style="color: #008000;">self</span>.<span style="color: black;">GetSystemMetrics</span><span style="color: black;">&#40;</span>SM_CXVIRTUALSCREEN<span style="color: black;">&#41;</span>
            top <span style="color: #66cc66;">=</span> <span style="color: #008000;">self</span>.<span style="color: black;">GetSystemMetrics</span><span style="color: black;">&#40;</span>SM_YVIRTUALSCREEN<span style="color: black;">&#41;</span>
            bottom <span style="color: #66cc66;">=</span> <span style="color: #008000;">self</span>.<span style="color: black;">GetSystemMetrics</span><span style="color: black;">&#40;</span>SM_CYVIRTUALSCREEN<span style="color: black;">&#41;</span>
            results.<span style="color: black;">append</span><span style="color: black;">&#40;</span><span style="color: black;">&#123;</span>
                b<span style="color: #483d8b;">'left'</span>  : <span style="color: #008000;">int</span><span style="color: black;">&#40;</span>left<span style="color: black;">&#41;</span><span style="color: #66cc66;">,</span>
                b<span style="color: #483d8b;">'top'</span>   : <span style="color: #008000;">int</span><span style="color: black;">&#40;</span>top<span style="color: black;">&#41;</span><span style="color: #66cc66;">,</span>
                b<span style="color: #483d8b;">'width'</span> : <span style="color: #008000;">int</span><span style="color: black;">&#40;</span>right - left<span style="color: black;">&#41;</span><span style="color: #66cc66;">,</span>
                b<span style="color: #483d8b;">'height'</span>: <span style="color: #008000;">int</span><span style="color: black;">&#40;</span>bottom - top<span style="color: black;">&#41;</span>
            <span style="color: black;">&#125;</span><span style="color: black;">&#41;</span>
        <span style="color: #ff7700;font-weight:bold;">else</span>:
            <span style="color: #808080; font-style: italic;"># On enrobe le callback Python dans un proxy qui le rend</span>
            <span style="color: #808080; font-style: italic;"># utilisable par le code C</span>
            callback <span style="color: #66cc66;">=</span> <span style="color: #008000;">self</span>.<span style="color: black;">MONITORENUMPROC</span><span style="color: black;">&#40;</span>_callback<span style="color: black;">&#41;</span>
            <span style="color: #808080; font-style: italic;"># On demande à windows de nous lister les moniteurs, et comme</span>
            <span style="color: #808080; font-style: italic;"># cet appel est asynchrone, on lui passe un callback pour qu'il</span>
            <span style="color: #808080; font-style: italic;"># replisse la liste au fur et à mesure</span>
            <span style="color: #008000;">self</span>.<span style="color: black;">EnumDisplayMonitors</span><span style="color: black;">&#40;</span><span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span> callback<span style="color: #66cc66;">,</span> <span style="color: #ff4500;">0</span><span style="color: black;">&#41;</span>
&nbsp;
        <span style="color: #808080; font-style: italic;"># On retourne la liste. A ce stade là, on ne sait pas si la liste</span>
        <span style="color: #808080; font-style: italic;"># est vide, à moitié remplie ou complètement remplie. Utiliser du</span>
        <span style="color: #808080; font-style: italic;"># code asynchrone au milieu d'une lib synchrone, c'est assez dangereux</span>
        <span style="color: #808080; font-style: italic;"># donc je me demande comment il retombe sur ses pieds.</span>
        <span style="color: #ff7700;font-weight:bold;">return</span> results
&nbsp;
    <span style="color: #808080; font-style: italic;"># A ce stade là il est 13h, j'ai commencé à 9h et j'ai la dalle. J'en ai</span>
    <span style="color: #808080; font-style: italic;"># marre de commenter ce code. 'envoyez-vous les codes que vous pigez pas'</span>
    <span style="color: #808080; font-style: italic;"># est une idée à la con. Je vous hais tous. Mon coloc va me ramener des</span>
    <span style="color: #808080; font-style: italic;"># frites.</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> get_pixels<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> monitor<span style="color: black;">&#41;</span>:
        <span style="color: #483d8b;">''' Retreive all pixels from a monitor. Pixels have to be RGB. '''</span>
&nbsp;
        <span style="color: #008000;">self</span>.<span style="color: black;">debug</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'get_pixels'</span><span style="color: black;">&#41;</span>
&nbsp;
        <span style="color: #808080; font-style: italic;"># Encore une fois on récupère les coordonnées des moniteurs filées</span>
        <span style="color: #808080; font-style: italic;"># par enum_display_monitors</span>
        width<span style="color: #66cc66;">,</span> height <span style="color: #66cc66;">=</span> monitor<span style="color: black;">&#91;</span>b<span style="color: #483d8b;">'width'</span><span style="color: black;">&#93;</span><span style="color: #66cc66;">,</span> monitor<span style="color: black;">&#91;</span>b<span style="color: #483d8b;">'height'</span><span style="color: black;">&#93;</span>
        left<span style="color: #66cc66;">,</span> top <span style="color: #66cc66;">=</span> monitor<span style="color: black;">&#91;</span>b<span style="color: #483d8b;">'left'</span><span style="color: black;">&#93;</span><span style="color: #66cc66;">,</span> monitor<span style="color: black;">&#91;</span>b<span style="color: #483d8b;">'top'</span><span style="color: black;">&#93;</span>
&nbsp;
        <span style="color: #808080; font-style: italic;"># Reajustement de la taille de la largeur. Je suppose que c'est</span>
        <span style="color: #808080; font-style: italic;"># empirique, mais je peux me tromper.</span>
        good_width <span style="color: #66cc66;">=</span> <span style="color: black;">&#40;</span>width * <span style="color: #ff4500;">3</span> + <span style="color: #ff4500;">3</span><span style="color: black;">&#41;</span> &amp; -<span style="color: #ff4500;">4</span>
        <span style="color: #808080; font-style: italic;"># Valeur de paramètre qui dit de copier directement dans le rectangle</span>
        <span style="color: #808080; font-style: italic;"># des destination.</span>
        SRCCOPY <span style="color: #66cc66;">=</span> <span style="color: #ff4500;">0xCC0020</span>
        DIB_RGB_COLORS <span style="color: #66cc66;">=</span> <span style="color: #ff4500;">0</span>
&nbsp;
        <span style="color: #808080; font-style: italic;"># Récupère le Device Context (title bar, menus, and scroll bars, etc)</span>
        srcdc <span style="color: #66cc66;">=</span> <span style="color: #008000;">self</span>.<span style="color: black;">GetWindowDC</span><span style="color: black;">&#40;</span><span style="color: #ff4500;">0</span><span style="color: black;">&#41;</span>
        <span style="color: #808080; font-style: italic;"># On fabrique une copie en mémoire.</span>
        memdc <span style="color: #66cc66;">=</span> <span style="color: #008000;">self</span>.<span style="color: black;">CreateCompatibleDC</span><span style="color: black;">&#40;</span>srcdc<span style="color: black;">&#41;</span>
        <span style="color: #808080; font-style: italic;"># On fabrique un bitmap basé sur ce DC</span>
        bmp <span style="color: #66cc66;">=</span> <span style="color: #008000;">self</span>.<span style="color: black;">CreateCompatibleBitmap</span><span style="color: black;">&#40;</span>srcdc<span style="color: #66cc66;">,</span> width<span style="color: #66cc66;">,</span> height<span style="color: black;">&#41;</span>
        <span style="color: #808080; font-style: italic;"># On injecte un bitmap dans le DC en mémoire.</span>
        <span style="color: #008000;">self</span>.<span style="color: black;">SelectObject</span><span style="color: black;">&#40;</span>memdc<span style="color: #66cc66;">,</span> bmp<span style="color: black;">&#41;</span>
        <span style="color: #808080; font-style: italic;"># On transfert les bits d'un DC à l'autre.</span>
        <span style="color: #008000;">self</span>.<span style="color: black;">BitBlt</span><span style="color: black;">&#40;</span>memdc<span style="color: #66cc66;">,</span> <span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span> width<span style="color: #66cc66;">,</span> height<span style="color: #66cc66;">,</span> srcdc<span style="color: #66cc66;">,</span> left<span style="color: #66cc66;">,</span> top<span style="color: #66cc66;">,</span> SRCCOPY<span style="color: black;">&#41;</span>
        <span style="color: #808080; font-style: italic;"># On fabrique le header du BMP</span>
        bmi <span style="color: #66cc66;">=</span> BITMAPINFO<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
        bmi.<span style="color: black;">bmiHeader</span>.<span style="color: black;">biSize</span> <span style="color: #66cc66;">=</span> sizeof<span style="color: black;">&#40;</span>BITMAPINFOHEADER<span style="color: black;">&#41;</span>
        bmi.<span style="color: black;">bmiHeader</span>.<span style="color: black;">biWidth</span> <span style="color: #66cc66;">=</span> width
        bmi.<span style="color: black;">bmiHeader</span>.<span style="color: black;">biHeight</span> <span style="color: #66cc66;">=</span> height
        bmi.<span style="color: black;">bmiHeader</span>.<span style="color: black;">biBitCount</span> <span style="color: #66cc66;">=</span> <span style="color: #ff4500;">24</span>
        bmi.<span style="color: black;">bmiHeader</span>.<span style="color: black;">biPlanes</span> <span style="color: #66cc66;">=</span> <span style="color: #ff4500;">1</span>
        buffer_len <span style="color: #66cc66;">=</span> height * good_width
        <span style="color: #808080; font-style: italic;"># On fabrique un array de char</span>
        pixels <span style="color: #66cc66;">=</span> create_string_buffer<span style="color: black;">&#40;</span>buffer_len<span style="color: black;">&#41;</span>
        <span style="color: #808080; font-style: italic;"># On récupère les bits du bitmap issu du DC</span>
        bits <span style="color: #66cc66;">=</span> <span style="color: #008000;">self</span>.<span style="color: black;">GetDIBits</span><span style="color: black;">&#40;</span>memdc<span style="color: #66cc66;">,</span> bmp<span style="color: #66cc66;">,</span> <span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span> height<span style="color: #66cc66;">,</span> byref<span style="color: black;">&#40;</span>pixels<span style="color: black;">&#41;</span><span style="color: #66cc66;">,</span>
            pointer<span style="color: black;">&#40;</span>bmi<span style="color: black;">&#41;</span><span style="color: #66cc66;">,</span> DIB_RGB_COLORS<span style="color: black;">&#41;</span>
&nbsp;
        <span style="color: #008000;">self</span>.<span style="color: black;">debug</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'get_pixels'</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'srcdc'</span><span style="color: #66cc66;">,</span> srcdc<span style="color: black;">&#41;</span>
        <span style="color: #008000;">self</span>.<span style="color: black;">debug</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'get_pixels'</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'memdc'</span><span style="color: #66cc66;">,</span> memdc<span style="color: black;">&#41;</span>
        <span style="color: #008000;">self</span>.<span style="color: black;">debug</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'get_pixels'</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'bmp'</span><span style="color: #66cc66;">,</span> bmp<span style="color: black;">&#41;</span>
        <span style="color: #008000;">self</span>.<span style="color: black;">debug</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'get_pixels'</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'buffer_len'</span><span style="color: #66cc66;">,</span> buffer_len<span style="color: black;">&#41;</span>
        <span style="color: #008000;">self</span>.<span style="color: black;">debug</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'get_pixels'</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'bits'</span><span style="color: #66cc66;">,</span> bits<span style="color: black;">&#41;</span>
        <span style="color: #008000;">self</span>.<span style="color: black;">debug</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'get_pixels'</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'len(pixels.raw)'</span><span style="color: #66cc66;">,</span> <span style="color: #008000;">len</span><span style="color: black;">&#40;</span>pixels.<span style="color: black;">raw</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span>
&nbsp;
        <span style="color: #808080; font-style: italic;"># Nettoyage des objets.</span>
        <span style="color: #808080; font-style: italic;"># Clean up</span>
        <span style="color: #008000;">self</span>.<span style="color: black;">DeleteObject</span><span style="color: black;">&#40;</span>srcdc<span style="color: black;">&#41;</span>
        <span style="color: #008000;">self</span>.<span style="color: black;">DeleteObject</span><span style="color: black;">&#40;</span>memdc<span style="color: black;">&#41;</span>
        <span style="color: #008000;">self</span>.<span style="color: black;">DeleteObject</span><span style="color: black;">&#40;</span>bmp<span style="color: black;">&#41;</span>
&nbsp;
        <span style="color: #808080; font-style: italic;"># Apparemment la récupération peut échouer et on peut vérifier</span>
        <span style="color: #808080; font-style: italic;"># cet échec en checkant la longueur. Après la cause de l'échec est</span>
        <span style="color: #808080; font-style: italic;"># un mystère</span>
        <span style="color: #ff7700;font-weight:bold;">if</span> bits <span style="color: #66cc66;">!=</span> height <span style="color: #ff7700;font-weight:bold;">or</span> <span style="color: #008000;">len</span><span style="color: black;">&#40;</span>pixels.<span style="color: black;">raw</span><span style="color: black;">&#41;</span> <span style="color: #66cc66;">!=</span> buffer_len:
            <span style="color: #ff7700;font-weight:bold;">raise</span> <span style="color: #008000;">ValueError</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'MSSWindows: GetDIBits() failed.'</span><span style="color: black;">&#41;</span>
&nbsp;
        <span style="color: #808080; font-style: italic;"># Réorganise les bits dans le bonne ordre et converti le format</span>
        <span style="color: #808080; font-style: italic;"># de couleur de BGR vers RGB</span>
&nbsp;
        <span style="color: #808080; font-style: italic;"># Note that the origin of the returned image is in the</span>
        <span style="color: #808080; font-style: italic;"># bottom-left corner, 32-bit aligned. And it is BGR.</span>
        <span style="color: #808080; font-style: italic;"># Need to &quot;arrange&quot; that.</span>
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>._arrange<span style="color: black;">&#40;</span>pixels.<span style="color: black;">raw</span><span style="color: #66cc66;">,</span> good_width<span style="color: #66cc66;">,</span> height<span style="color: black;">&#41;</span>
&nbsp;
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> _arrange<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> data<span style="color: #66cc66;">,</span> width<span style="color: #66cc66;">,</span> height<span style="color: black;">&#41;</span>:
        <span style="color: #483d8b;">''' Reorganises data when the origin of the image is in the
            bottom-left corner and converts BGR triple to RGB. '''</span>
&nbsp;
        <span style="color: #008000;">self</span>.<span style="color: black;">debug</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'_arrange'</span><span style="color: black;">&#41;</span>
&nbsp;
        <span style="color: #808080; font-style: italic;"># On crée une nouvelle liste pleine de zéro, et on la rempli</span>
        <span style="color: #808080; font-style: italic;"># avec la nouvelle position des pixels.</span>
        total <span style="color: #66cc66;">=</span> width * height
        scanlines <span style="color: #66cc66;">=</span> <span style="color: black;">&#91;</span>b<span style="color: #483d8b;">'0'</span><span style="color: black;">&#93;</span> * total
        <span style="color: #ff7700;font-weight:bold;">for</span> y <span style="color: #ff7700;font-weight:bold;">in</span> <span style="color: #008000;">range</span><span style="color: black;">&#40;</span>height<span style="color: black;">&#41;</span>:
            off <span style="color: #66cc66;">=</span> width * <span style="color: black;">&#40;</span>y + <span style="color: #ff4500;">1</span><span style="color: black;">&#41;</span>
            offset <span style="color: #66cc66;">=</span> total - off
            <span style="color: #ff7700;font-weight:bold;">for</span> x <span style="color: #ff7700;font-weight:bold;">in</span> <span style="color: #008000;">range</span><span style="color: black;">&#40;</span><span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span> width - <span style="color: #ff4500;">2</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">3</span><span style="color: black;">&#41;</span>:
                <span style="color: #808080; font-style: italic;"># On inverse aussi la position du bleu et du rouge</span>
                scanlines<span style="color: black;">&#91;</span>off+x:off+x+<span style="color: #ff4500;">3</span><span style="color: black;">&#93;</span> <span style="color: #66cc66;">=</span> b<span style="color: black;">&#40;</span>data<span style="color: black;">&#91;</span>offset+x+<span style="color: #ff4500;">2</span><span style="color: black;">&#93;</span><span style="color: black;">&#41;</span><span style="color: #66cc66;">,</span> b<span style="color: black;">&#40;</span>data<span style="color: black;">&#91;</span>offset+x+<span style="color: #ff4500;">1</span><span style="color: black;">&#93;</span><span style="color: black;">&#41;</span><span style="color: #66cc66;">,</span> b<span style="color: black;">&#40;</span>data<span style="color: black;">&#91;</span>offset+x<span style="color: black;">&#93;</span><span style="color: black;">&#41;</span>
        <span style="color: #ff7700;font-weight:bold;">return</span> b<span style="color: #483d8b;">''</span>.<span style="color: black;">join</span><span style="color: black;">&#40;</span>scanlines<span style="color: black;">&#41;</span>
&nbsp;
<span style="color: #808080; font-style: italic;"># Un wrapper pour dumper un array de pixels dans un fichier</span>
<span style="color: #808080; font-style: italic;"># Typiquement un truc qui aurait pu tenir dans une fonction au lieu d'une classe.</span>
&nbsp;
<span style="color: #ff7700;font-weight:bold;">class</span> MSSImage<span style="color: black;">&#40;</span><span style="color: #008000;">object</span><span style="color: black;">&#41;</span>:
    <span style="color: #483d8b;">''' This is a class to save data (raw pixels) to a picture file.
    '''</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> <span style="color: #0000cd;">__init__</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> data<span style="color: #66cc66;">=</span><span style="color: #008000;">None</span><span style="color: #66cc66;">,</span> width<span style="color: #66cc66;">=</span><span style="color: #ff4500;">1</span><span style="color: #66cc66;">,</span> height<span style="color: #66cc66;">=</span><span style="color: #ff4500;">1</span><span style="color: black;">&#41;</span>:
        <span style="color: #008000;">self</span>.<span style="color: black;">data</span> <span style="color: #66cc66;">=</span> data
        <span style="color: #008000;">self</span>.<span style="color: black;">width</span> <span style="color: #66cc66;">=</span> <span style="color: #008000;">int</span><span style="color: black;">&#40;</span>width<span style="color: black;">&#41;</span>
        <span style="color: #008000;">self</span>.<span style="color: black;">height</span> <span style="color: #66cc66;">=</span> <span style="color: #008000;">int</span><span style="color: black;">&#40;</span>height<span style="color: black;">&#41;</span>
&nbsp;
        <span style="color: #ff7700;font-weight:bold;">if</span> <span style="color: #008000;">self</span>.<span style="color: black;">data</span> <span style="color: #ff7700;font-weight:bold;">is</span> <span style="color: #008000;">None</span>:
            <span style="color: #ff7700;font-weight:bold;">raise</span> <span style="color: #008000;">ValueError</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'MSSImage: no data to process.'</span><span style="color: black;">&#41;</span>
        <span style="color: #ff7700;font-weight:bold;">elif</span> <span style="color: #008000;">self</span>.<span style="color: black;">width</span> <span style="color: #66cc66;">&lt;</span> <span style="color: #ff4500;">1</span> <span style="color: #ff7700;font-weight:bold;">or</span> <span style="color: #008000;">self</span>.<span style="color: black;">height</span> <span style="color: #66cc66;">&lt;</span> <span style="color: #ff4500;">1</span>:
            <span style="color: #ff7700;font-weight:bold;">raise</span> <span style="color: #008000;">ValueError</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'MSSImage: width or height must be positive.'</span><span style="color: black;">&#41;</span>
&nbsp;
&nbsp;
    <span style="color: #808080; font-style: italic;"># Tout le boulot se passe ici.</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> dump<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> output<span style="color: black;">&#41;</span>:
        <span style="color: #483d8b;">''' Dump data to the image file.
            Pure python PNG implementation.
            Image represented as RGB tuples, no interlacing.
            http://inaps.org/journal/comment-fonctionne-le-png
        '''</span>
&nbsp;
        <span style="color: #808080; font-style: italic;"># On ouvre le fichier en mode écriture binaire.</span>
&nbsp;
        <span style="color: #ff7700;font-weight:bold;">with</span> <span style="color: #008000;">open</span><span style="color: black;">&#40;</span>output<span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'wb'</span><span style="color: black;">&#41;</span> <span style="color: #ff7700;font-weight:bold;">as</span> fileh:
            <span style="color: #808080; font-style: italic;"># Pour cette partie il faut connaitre les subtilités du format PNG</span>
            <span style="color: #808080; font-style: italic;"># pour comprendre, ce qui n'est pas mon cas. Donc je vais faire</span>
            <span style="color: #808080; font-style: italic;"># de la déduction au gros doigt mouillé.</span>
&nbsp;
            <span style="color: #808080; font-style: italic;"># Ca prend les données en pixel, ça en fait des morceaux de la bonne taille,</span>
            <span style="color: #808080; font-style: italic;"># organisés en rangés de pixels puisqu'il y a range(height) rangés.</span>
            to_take <span style="color: #66cc66;">=</span> <span style="color: black;">&#40;</span><span style="color: #008000;">self</span>.<span style="color: black;">width</span> * <span style="color: #ff4500;">3</span> + <span style="color: #ff4500;">3</span><span style="color: black;">&#41;</span> &amp; -<span style="color: #ff4500;">4</span>
            padding <span style="color: #66cc66;">=</span> <span style="color: #ff4500;">0</span> <span style="color: #ff7700;font-weight:bold;">if</span> to_take % <span style="color: #ff4500;">8</span> <span style="color: #66cc66;">==</span> <span style="color: #ff4500;">0</span> <span style="color: #ff7700;font-weight:bold;">else</span> <span style="color: black;">&#40;</span>to_take % <span style="color: #ff4500;">8</span><span style="color: black;">&#41;</span> // <span style="color: #ff4500;">2</span>
            height<span style="color: #66cc66;">,</span> data <span style="color: #66cc66;">=</span> <span style="color: #008000;">self</span>.<span style="color: black;">height</span><span style="color: #66cc66;">,</span> <span style="color: #008000;">self</span>.<span style="color: black;">data</span>
            scanlines <span style="color: #66cc66;">=</span> <span style="color: black;">&#91;</span>b<span style="color: #483d8b;">''</span>.<span style="color: black;">join</span><span style="color: black;">&#40;</span><span style="color: black;">&#91;</span>b<span style="color: #483d8b;">'0'</span><span style="color: #66cc66;">,</span> data<span style="color: black;">&#91;</span>to_take*y:to_take*y+to_take-padding<span style="color: black;">&#93;</span><span style="color: black;">&#93;</span><span style="color: black;">&#41;</span> <span style="color: #ff7700;font-weight:bold;">for</span> y <span style="color: #ff7700;font-weight:bold;">in</span> <span style="color: #008000;">range</span><span style="color: black;">&#40;</span>height<span style="color: black;">&#41;</span><span style="color: black;">&#93;</span>
&nbsp;
            <span style="color: #808080; font-style: italic;"># les &quot;magic bytes&quot;, le marqueur du début de fichier qui indique</span>
            <span style="color: #808080; font-style: italic;"># que c'est un fichier png</span>
            magic <span style="color: #66cc66;">=</span> pack<span style="color: black;">&#40;</span>b<span style="color: #483d8b;">'&gt;8B'</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">137</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">80</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">78</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">71</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">13</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">10</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">26</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">10</span><span style="color: black;">&#41;</span>
&nbsp;
            <span style="color: #808080; font-style: italic;"># Les metadata du fichiers : taille de l'image, une somme de</span>
            <span style="color: #808080; font-style: italic;"># controle, la profondeur de couleur, méthode de compression,</span>
            <span style="color: #808080; font-style: italic;"># le mode d'entrelacement, etc.</span>
            <span style="color: #808080; font-style: italic;"># Header: size, marker, data, CRC32</span>
            ihdr <span style="color: #66cc66;">=</span> <span style="color: black;">&#91;</span>b<span style="color: #483d8b;">''</span><span style="color: #66cc66;">,</span> b<span style="color: #483d8b;">'IHDR'</span><span style="color: #66cc66;">,</span> b<span style="color: #483d8b;">''</span><span style="color: #66cc66;">,</span> b<span style="color: #483d8b;">''</span><span style="color: black;">&#93;</span>
            ihdr<span style="color: black;">&#91;</span><span style="color: #ff4500;">2</span><span style="color: black;">&#93;</span> <span style="color: #66cc66;">=</span> pack<span style="color: black;">&#40;</span>b<span style="color: #483d8b;">'&gt;2I5B'</span><span style="color: #66cc66;">,</span> <span style="color: #008000;">self</span>.<span style="color: black;">width</span><span style="color: #66cc66;">,</span> <span style="color: #008000;">self</span>.<span style="color: black;">height</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">8</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">2</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">0</span><span style="color: black;">&#41;</span>
            ihdr<span style="color: black;">&#91;</span><span style="color: #ff4500;">3</span><span style="color: black;">&#93;</span> <span style="color: #66cc66;">=</span> pack<span style="color: black;">&#40;</span>b<span style="color: #483d8b;">'&gt;I'</span><span style="color: #66cc66;">,</span> <span style="color: #dc143c;">zlib</span>.<span style="color: black;">crc32</span><span style="color: black;">&#40;</span>b<span style="color: #483d8b;">''</span>.<span style="color: black;">join</span><span style="color: black;">&#40;</span>ihdr<span style="color: black;">&#91;</span><span style="color: #ff4500;">1</span>:<span style="color: #ff4500;">3</span><span style="color: black;">&#93;</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span> &amp; <span style="color: #ff4500;">0xffffffff</span><span style="color: black;">&#41;</span>
            ihdr<span style="color: black;">&#91;</span><span style="color: #ff4500;">0</span><span style="color: black;">&#93;</span> <span style="color: #66cc66;">=</span> pack<span style="color: black;">&#40;</span>b<span style="color: #483d8b;">'&gt;I'</span><span style="color: #66cc66;">,</span> <span style="color: #008000;">len</span><span style="color: black;">&#40;</span>ihdr<span style="color: black;">&#91;</span><span style="color: #ff4500;">2</span><span style="color: black;">&#93;</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span>
&nbsp;
            <span style="color: #808080; font-style: italic;"># l'image en elle même avec un marker de départ, les pixels</span>
            <span style="color: #808080; font-style: italic;"># et une somme de controle</span>
            <span style="color: #808080; font-style: italic;"># Data: size, marker, data, CRC32</span>
            idat <span style="color: #66cc66;">=</span> <span style="color: black;">&#91;</span>b<span style="color: #483d8b;">''</span><span style="color: #66cc66;">,</span> b<span style="color: #483d8b;">'IDAT'</span><span style="color: #66cc66;">,</span> b<span style="color: #483d8b;">''</span><span style="color: #66cc66;">,</span> b<span style="color: #483d8b;">''</span><span style="color: black;">&#93;</span>
            idat<span style="color: black;">&#91;</span><span style="color: #ff4500;">2</span><span style="color: black;">&#93;</span> <span style="color: #66cc66;">=</span> <span style="color: #dc143c;">zlib</span>.<span style="color: black;">compress</span><span style="color: black;">&#40;</span>b<span style="color: #483d8b;">''</span>.<span style="color: black;">join</span><span style="color: black;">&#40;</span>scanlines<span style="color: black;">&#41;</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">9</span><span style="color: black;">&#41;</span>
            idat<span style="color: black;">&#91;</span><span style="color: #ff4500;">3</span><span style="color: black;">&#93;</span> <span style="color: #66cc66;">=</span> pack<span style="color: black;">&#40;</span>b<span style="color: #483d8b;">'&gt;I'</span><span style="color: #66cc66;">,</span> <span style="color: #dc143c;">zlib</span>.<span style="color: black;">crc32</span><span style="color: black;">&#40;</span>b<span style="color: #483d8b;">''</span>.<span style="color: black;">join</span><span style="color: black;">&#40;</span>idat<span style="color: black;">&#91;</span><span style="color: #ff4500;">1</span>:<span style="color: #ff4500;">3</span><span style="color: black;">&#93;</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span> &amp; <span style="color: #ff4500;">0xffffffff</span><span style="color: black;">&#41;</span>
            idat<span style="color: black;">&#91;</span><span style="color: #ff4500;">0</span><span style="color: black;">&#93;</span> <span style="color: #66cc66;">=</span> pack<span style="color: black;">&#40;</span>b<span style="color: #483d8b;">'&gt;I'</span><span style="color: #66cc66;">,</span> <span style="color: #008000;">len</span><span style="color: black;">&#40;</span>idat<span style="color: black;">&#91;</span><span style="color: #ff4500;">2</span><span style="color: black;">&#93;</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span>
&nbsp;
            <span style="color: #808080; font-style: italic;"># Les metadata à la fin du fichier qui sont vides.</span>
            <span style="color: #808080; font-style: italic;"># Footer: size, marker, None, CRC32</span>
            iend <span style="color: #66cc66;">=</span> <span style="color: black;">&#91;</span>b<span style="color: #483d8b;">''</span><span style="color: #66cc66;">,</span> b<span style="color: #483d8b;">'IEND'</span><span style="color: #66cc66;">,</span> b<span style="color: #483d8b;">''</span><span style="color: #66cc66;">,</span> b<span style="color: #483d8b;">''</span><span style="color: black;">&#93;</span>
            iend<span style="color: black;">&#91;</span><span style="color: #ff4500;">3</span><span style="color: black;">&#93;</span> <span style="color: #66cc66;">=</span> pack<span style="color: black;">&#40;</span>b<span style="color: #483d8b;">'&gt;I'</span><span style="color: #66cc66;">,</span> <span style="color: #dc143c;">zlib</span>.<span style="color: black;">crc32</span><span style="color: black;">&#40;</span>iend<span style="color: black;">&#91;</span><span style="color: #ff4500;">1</span><span style="color: black;">&#93;</span><span style="color: black;">&#41;</span> &amp; <span style="color: #ff4500;">0xffffffff</span><span style="color: black;">&#41;</span>
            iend<span style="color: black;">&#91;</span><span style="color: #ff4500;">0</span><span style="color: black;">&#93;</span> <span style="color: #66cc66;">=</span> pack<span style="color: black;">&#40;</span>b<span style="color: #483d8b;">'&gt;I'</span><span style="color: #66cc66;">,</span> <span style="color: #008000;">len</span><span style="color: black;">&#40;</span>iend<span style="color: black;">&#91;</span><span style="color: #ff4500;">2</span><span style="color: black;">&#93;</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span>
&nbsp;
            <span style="color: #808080; font-style: italic;"># On écrit le fichier, et on retourne son nom</span>
            fileh.<span style="color: black;">write</span><span style="color: black;">&#40;</span>magic + b<span style="color: #483d8b;">''</span>.<span style="color: black;">join</span><span style="color: black;">&#40;</span>ihdr<span style="color: black;">&#41;</span> + b<span style="color: #483d8b;">''</span>.<span style="color: black;">join</span><span style="color: black;">&#40;</span>idat<span style="color: black;">&#41;</span> + b<span style="color: #483d8b;">''</span>.<span style="color: black;">join</span><span style="color: black;">&#40;</span>iend<span style="color: black;">&#41;</span><span style="color: black;">&#41;</span>
            <span style="color: #ff7700;font-weight:bold;">return</span> output
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">None</span>
&nbsp;
<span style="color: #808080; font-style: italic;"># Un exemple d'usage avec l'habituel if __name__ pour éviter de</span>
<span style="color: #808080; font-style: italic;"># le lancer à l'import</span>
<span style="color: #ff7700;font-weight:bold;">if</span> __name__ <span style="color: #66cc66;">==</span> <span style="color: #483d8b;">'__main__'</span>:
&nbsp;
    systems <span style="color: #66cc66;">=</span> <span style="color: black;">&#123;</span>
        <span style="color: #483d8b;">'Darwin'</span> : MSSMac<span style="color: #66cc66;">,</span>
        <span style="color: #483d8b;">'Linux'</span>  : MSSLinux<span style="color: #66cc66;">,</span>
        <span style="color: #483d8b;">'Windows'</span>: MSSWindows
    <span style="color: black;">&#125;</span>
    <span style="color: #ff7700;font-weight:bold;">try</span>:
        MSS <span style="color: #66cc66;">=</span> systems<span style="color: black;">&#91;</span>system<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: black;">&#93;</span>
    <span style="color: #ff7700;font-weight:bold;">except</span> <span style="color: #008000;">KeyError</span>:
        err <span style="color: #66cc66;">=</span> <span style="color: #483d8b;">'System &quot;{0}&quot; not implemented.'</span>.<span style="color: black;">format</span><span style="color: black;">&#40;</span>system<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span>
        <span style="color: #ff7700;font-weight:bold;">raise</span> <span style="color: #008000;">NotImplementedError</span><span style="color: black;">&#40;</span>err<span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">try</span>:
        mss <span style="color: #66cc66;">=</span> MSS<span style="color: black;">&#40;</span>debug<span style="color: #66cc66;">=</span><span style="color: #008000;">False</span><span style="color: black;">&#41;</span>
&nbsp;
        <span style="color: #808080; font-style: italic;"># One screen shot per monitor</span>
        <span style="color: #ff7700;font-weight:bold;">for</span> filename <span style="color: #ff7700;font-weight:bold;">in</span> mss.<span style="color: black;">save</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>:
            <span style="color: #ff7700;font-weight:bold;">print</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'File &quot;{0}&quot; created.'</span>.<span style="color: black;">format</span><span style="color: black;">&#40;</span>filename<span style="color: black;">&#41;</span><span style="color: black;">&#41;</span>
&nbsp;
        <span style="color: #808080; font-style: italic;"># A shot to grab them all :)</span>
        <span style="color: #ff7700;font-weight:bold;">for</span> filename <span style="color: #ff7700;font-weight:bold;">in</span> mss.<span style="color: black;">save</span><span style="color: black;">&#40;</span>oneshot<span style="color: #66cc66;">=</span><span style="color: #008000;">True</span><span style="color: black;">&#41;</span>:
            <span style="color: #ff7700;font-weight:bold;">print</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'File &quot;{0}&quot; created.'</span>.<span style="color: black;">format</span><span style="color: black;">&#40;</span>filename<span style="color: black;">&#41;</span><span style="color: black;">&#41;</span>
    <span style="color: #ff7700;font-weight:bold;">except</span> <span style="color: #008000;">Exception</span> <span style="color: #ff7700;font-weight:bold;">as</span> ex:
        <span style="color: #ff7700;font-weight:bold;">print</span><span style="color: black;">&#40;</span>ex<span style="color: black;">&#41;</span>
        <span style="color: #ff7700;font-weight:bold;">raise</span></pre></td></tr></table><p class="theCode" style="display:none;">#!/usr/bin/env python
# -*- coding: utf-8 -*-

''' A cross-platform multi-screen shot module in pure python using ctypes.

    This module is maintained by Mickaël Schoentgen &lt;contact@tiger-222.fr&gt;.
    If you find problems, please submit bug reports/patches via the
    GitHub issue tracker (https://github.com/BoboTiG/python-mss/issues).

    Note: please keep this module compatible to Python 2.6.

    Still needed:
    * support for additional systems

    Many thanks to all those who helped (in no particular order):

      Oros, Eownis

    History:

    &lt;see Git checkin messages for history&gt;

    0.0.1 - first release
    0.0.2 - add support for python 3 on Windows and GNU/Linux
    0.0.3 - MSSImage: remove PNG filters
          - MSSImage: remove 'ext' argument, using only PNG
          - MSSImage: do not overwrite existing image files
          - MSSImage: few optimizations into png()
          - MSSLinux: few optimizations into get_pixels()
    0.0.4 - MSSLinux: use of memoization =&gt; huge time/operations gains
    0.0.5 - MSSWindows: few optimizations into _arrange()
          - MSSImage: code simplified

    You can always get the latest version of this module at:

            https://raw.github.com/BoboTiG/python-mss/master/mss.py

    If that URL should fail, try contacting the author.
'''

from __future__ import (unicode_literals, absolute_import,
                        division, print_function)

__version__ = '0.0.5'
__author__ = &quot;Mickaël 'Tiger-222' Schoentgen&quot;
__copyright__ = '''
    Copyright (c) 2013, Mickaël 'Tiger-222' Schoentgen

    Permission to use, copy, modify, and distribute this software and its
    documentation for any purpose and without fee or royalty is hereby
    granted, provided that the above copyright notice appear in all copies
    and that both that copyright notice and this permission notice appear
    in supporting documentation or portions thereof, including
    modifications, that you make.
'''

# Bon je vais pas vous expliquer ce que les lignes du dessus font hein...hein


# __all__ liste les objets importables si on fait from mss import *
# ce qui limite la pollution du namespace avec tout un tas de choses inutiles
# comme pack, isfile, system, etc. qui sont quelques lignes plus bas.
__all__ = ['MSSImage', 'MSSLinux', 'MSSMac', 'MSSWindows']

# Permet de trouve une bibliothèqe via son nom sur le système en cherchant
# divers chemins standard à l'OS
from ctypes.util import find_library

# Permet une forme de sérialisation des types simples qui est compatible
# entre Python et C
from struct import pack

# Permet de vérifier si un fichier existe et n'est pas un dossier
from os.path import isfile

# Permet de récupérer le nom de l'OS
from platform import system

# Divers opérations sur le système
import sys

# Compression zip
import zlib

# On importe conditionnellement des packages selon le système sur lequel on
# est. La raison de cela est que certains packages n'existe pas (ou ne sont pas
# utiles) sur certains OS.

# Darwin, c'est l'OS open source qui sert de base au Mac. C'est
# un mélange de NeXTSTEP et de FreeBSD.
if system() == 'Darwin':
    # Quartz est la techno derrière l'affichage des Mac incluant notament
    # le compositeur graphique et moteur de rendu 2D. Il a un binding Python
    # intégré puisque les Mac utilisent Python un peu partout. A ce demander
    # pourquoi ces neuneus nous ont collé objectifs C pour le dev.
    from Quartz import *
    # On importe juste l'équivalent du mimetype sous Mac pour le PNG. C'est
    # une &quot;constante&quot;
    from LaunchServices import kUTTypePNG


elif system() == 'Linux':

    # Accès aux variables d'environnement
    from os import environ
    # Fonction pour transformer ~ dans les chemin d'accès en chemin vers
    # le dossier utilisateur
    from os.path import expanduser
    # Parseur de xml
    import xml.etree.ElementTree as ET

    # 'byref' permet d'obtenir un pointer sur une fonction c,
    # 'cast' est similaire à l'opérateur cast en c et permet le type casting
    # d'un objet c, 'cdll' permet de charger des shared lib C
    from ctypes import byref, cast, cdll

    # je ne sais pas pourquoi ça n'a pas été fait une seule ligne...
    # Tout ça représente les types c éponymes, mais en plus Structure est une
    # classe abstraite dont on peut hériter faire une classe qui peut être
    # passée en paramètre à une fonction C qui attend un struc.
    from ctypes import (
        c_char_p, c_int, c_int32, c_uint, c_uint32,
        c_ulong, c_void_p, POINTER, Structure
    )

    # On hérite de Structure ce qui nous fait pour le moment une structure
    # vide
    class Display(Structure):
        pass

    # Une structure représentant les attributs d'une fenêtre pour le serveur
    # d'affichage sous Linux.
    class XWindowAttributes(Structure):
        _fields_ = [
            ('x',                     c_int32),
            ('y',                     c_int32),
            ('width',                 c_int32),
            ('height',                c_int32),
            ('border_width',          c_int32),
            ('depth',                 c_int32),
            ('visual',                c_ulong),
            ('root',                  c_ulong),
            ('class',                 c_int32),
            ('bit_gravity',           c_int32),
            ('win_gravity',           c_int32),
            ('backing_store',         c_int32),
            ('backing_planes',        c_ulong),
            ('backing_pixel',         c_ulong),
            ('save_under',            c_int32),
            ('colourmap',             c_ulong),
            ('mapinstalled',          c_uint32),
            ('map_state',             c_uint32),
            ('all_event_masks',       c_ulong),
            ('your_event_mask',       c_ulong),
            ('do_not_propagate_mask', c_ulong),
            ('override_redirect',     c_int32),
            ('screen',                c_ulong)
        ]

    # structure définissant une image telle qu'elle existe dans la mémoire
    # d'un client du serveur d'affichage
    class XImage(Structure):
        _fields_ = [
            ('width'            , c_int),
            ('height'           , c_int),
            ('xoffset'          , c_int),
            ('format'           , c_int),
            ('data'             , c_char_p),
            ('byte_order'       , c_int),
            ('bitmap_unit'      , c_int),
            ('bitmap_bit_order' , c_int),
            ('bitmap_pad'       , c_int),
            ('depth'            , c_int),
            ('bytes_per_line'   , c_int),
            ('bits_per_pixel'   , c_int),
            ('red_mask'         , c_ulong),
            ('green_mask'       , c_ulong),
            ('blue_mask'        , c_ulong)
        ]

    # Apparement la fonction pack avec ce format va être appelée souvent
    # doc l'auteur se fait un raccourci. Le format en question est 'B', donc
    # du unsigned char, et '&lt;', donc du little endian. Et là vous comprenez
    # le bonheur de travailler dans un langage de haut niveau comme Python.
    def b(x):
        return pack(b'&lt;B', x)

elif system() == 'Windows':


    from ctypes import (

        # 'memset' fait pareil que memset en C : on rempli un bloc de mémoire
        # avec les bytes passés en param mais il n'est pas utilisé dans le code,
        # donc je suppose que c'est un oubli. 'pointer' va créer une instance de
        # la classe qui permet de manipuler un pointer sur un type c en Python.
        # 'sizeof', même chose que l'opérateur c, ça retourne la taille en bytes
        # d'un type
        # c. 'windll', comme 'cdll' plus haut, mais l'appel des fonctions suit
        # la convention stdcall typique de la win32api et pas la convention c
        # standard.
        byref, memset, pointer, sizeof, windll,
        # Représentation du type void en c, aliasé sous deux noms. Je n'ai pas
        # vraiment compris l'interêt de le faire, excepté pour explicitement
        # montrer quand on l'utilise dans un appel qui attend LPRECT (un pointer
        # sur une struc qui représente un rectangle ou un pointer sur void)
        c_void_p as LPRECT,
        c_void_p as LPVOID,
        # créer un array de char en c
        create_string_buffer,
        # ça on a vu
        Structure,
        POINTER,
        # Ceci est une fonction. Pourquoi c'est en majuscule, je n'en sais rien.
        # Une incohérence dans l'API. En tout cas ça permet de retourner
        # un prototype de fonction qui respecte la convention stdcall.
        WINFUNCTYPE,
    )
    # Des &quot;constantes&quot; qui représentent des types spécifiques à l'API widows
    # Notez que le PEP8 n'est pas respecté, mais bon, vu la taille du code,
    # il y a forcément des coquilles, c'est normal. Certains comme SHORT
    # et HANDLE ne sont pas utilisés.
    from ctypes.wintypes import (
        BOOL, DOUBLE, DWORD, HANDLE, HBITMAP, HDC, HGDIOBJ,
        HWND, INT, LPARAM, LONG,RECT,SHORT, UINT, WORD
    )

    # Structure contenant les information sur les dimentions et la couleur
    # d'un BMP (on appelle ça aussi un bitmap ou DIB, donc dans les docs
    # vous verrez l'une ou l'autre de ces appellations)
    class BITMAPINFOHEADER(Structure):
        _fields_ = [
            ('biSize',          DWORD),
            ('biWidth',         LONG),
            ('biHeight',        LONG),
            ('biPlanes',        WORD),
            ('biBitCount',      WORD),
            ('biCompression',   DWORD),
            ('biSizeImage',     DWORD),
            ('biXPelsPerMeter', LONG),
            ('biYPelsPerMeter', LONG),
            ('biClrUsed',       DWORD),
            ('biClrImportant',  DWORD)
        ]

    # Un wrapper sur la structure précédente, je suppose nécessaire pour
    # être compatible avec une des bizarreries de l'API windows.
    class BITMAPINFO(Structure):
        _fields_ = [
            ('bmiHeader', BITMAPINFOHEADER),
            ('bmiColors', DWORD * 3)
        ]

    # Là j’avoue je ne comprends pas trop le principe. Il tente de vérifier
    # si le système est du Python 2, si oui il ne caste pas la string en bytes
    # car le type de base des strings est déjà de type bytes (ce qui n'est
    # pas le cas en Python 3 : c'est un type unicode). Donc il fabrique la
    # fonction raccourcie selon la version. Sauf qu'il ne le fait pas
    # dans la condition pour linux. Du coup je pige pas trop comment il
    # s'en sort. Il est compatible que 2.7 sous Linux ?
    # Dans tous les cas ces fonctions pourraient être en dehors de la clause
    # if, tout comme certains imports pour des raisons de DRY.
    if sys.version &lt; '3':
        def b(x):
            return x
    else:
        def b(x):
            return pack(b'&lt;B', x)


# Moi aussi j'adore mettre des commentaires comme ça dans mon code.mon
# Que ceux qui n'aiment pas aillent se faire foutre.


# ----------------------------------------------------------------------
# --- [ C'est parti mon kiki ! ] ---------------------------------------
# ----------------------------------------------------------------------

# Comme précisé dans la docstring, c'est une classe de base. Ca implemente
# essentiellement le logging du mode debug et la logique d'enregistrement
# des fichiers.
class MSS(object):
    ''' This class will be overloaded by a system specific one.
        It checkes if there is a class available for the current system.
        Raise an exception if no one found.
    '''


    # De l'initialisation, pas super intéressant...
    DEBUG = False

    def __init__(self, debug=False):
        ''' Global vars and class overload. '''

        self.DEBUG = debug
        self.monitors = []
        self.oneshot = False

        # L'init présuppose quand même qu'une classe fille a une fonction
        #  init. Je vois pas trop l'interêt car ça peut se faire par héritage
        # ou alors quitte à faire ça, autant faire en utilisant un système
        # de call back sur des events genre &quot;oninit&quot;, c'est plus propre, plus
        # découplé et ça tombe pas en marche si la fonction init() n'existe pas
        # dans l'enfant.
        self.init()

    # Une fonction print un peut élaborée qui permet d'afficher rapidement
    # le contenu qu'on lui passe en paramètre de manière formatté pour le debug.
    # Utiliser le module logging aurait été préférable, mais c'est tellement
    # chiant à setup que je comprends qu'il ait eu la flemme.
    def debug(self, method='', scalar=None, value=None):
        ''' Simple debug output. '''

        if self.DEBUG:
            if scalar is None:
                print(':: ' + method + '()')
            else:
                print(method + '()', scalar, type(value).__name__, value)

    # La fonction &quot;kifétou&quot;. Elle demande la création des screenshots, les
    # sauvegarde dans des fichiers png dans un dossier. Il aurait été sympa
    # de découper cette fonction en sous fonctions : une prendre le screen
    # d'un moniteur, une pour recupérer le screenshot tout forme d'objet image,
    # etc. Là la seule option c'est &quot;tu prends tout, tu sauves tout&quot;. C'est pas
    # très souple, et dur à tester.
    def save(self, output='mss', oneshot=False):
        ''' For each monitor, grab a screen shot and save it to a file.

            Parameters:
             - output - string - the output filename without extension
             - oneshot - boolean - grab only one screen shot of all monitors

            This is a generator which returns created files:
                'output-1.png',
                'output-2.png',
                ...,
                'output-NN.png'
                or
                'output-full.png'
        '''

        self.debug('save')

        # Là on voit un antipattern très courrant en POO : mettre des paramètres
        # pour un appel de méthode directement en attribut pour toute la classe.
        # Cela veut dire qu'un appel à cette fonction &quot;lock&quot; la classe dans
        # un état dépendant de cet appel. En plus de réduire à néant les possibilités
        # de multithreading et rendre les tests compliqués, ça veut dire aussi
        # que tout débuggage doit tenir compte de l'état de la classe. Et bien
        # entendu, ça veut dire qu'on ne peut pas avoir plusieurs états en
        # parallèles, à moins d'instancier plusieurs classes. Il vaudrait mieux
        # que tout ça soit passé en paramètres, quitte à faire un autre objet
        # nommé &quot;config&quot; qui contienne tout ça.
        #
        # En tout cas, ça stoque le param &quot;oneshot&quot; et la liste des moniteurs
        # retournés par le code fourni par la classe fille puisque
        # enum_display_monitors n'est pas défini dans cette classe.
        self.oneshot = oneshot
        self.monitors = self.enum_display_monitors() or []

        self.debug('save', 'oneshot', self.oneshot)

        # On lève une exception si il est impossible de trouver des écrans dont
        # on peut faire la capture, ce qui est une bonne chose. Mais une bonne
        # pratique serait de faire :
        # class ScreenshotError(Exception):
        #     pass
        # Afin d'avoir quelque chose de plus significatif que ValueError.
        # De plus, ce code est typique d'un programmeur d'un autre langage
        # qui apprend encore les idiomes Python car cette condition pourrait
        # se réduire à :
        # if not self.monitors: &lt;- pas besoin de len
        #     raise ScreenshotError('MSS: no monitor found.'))
        if len(self.monitors) &lt; 1:
            raise ValueError('MSS: no monitor found.')

        # Monitors screen shots!
        # On itère sur les écrans, et on fait un screen par écran. Même remarque
        # sur le fait que l'auteur cherche encore ses marques en Python (notez
        # bien que c'est naturel, personne n'a la science infuse et mon style
        # est horrible dans les autres langages), car ici le compteur i est
        # aventageusement remplacé par :
        # for i, monitor in enumerate(self.monitors)
        i = 1
        for monitor in self.monitors:
            self.debug('save', 'monitor', monitor)

            # Si on ne fait qu'un gros screenshot, on l'appelle name-full.png
            # sinon name-numero_du_moniteur.png
            if self.oneshot:
                filename = output + '-full'
            else:
                filename = output + '-' + str(i)
                i += 1
            filename += '.png'

            # Si le fichier n'existe pas, on l'écrit. Ceci est encore une
            # erreur car une API métier ne doit pas faire ce genre de
            # vérification. Il devrait écraser les fichiers. Il est en revanche
            # possible de mettre un système de callback pour réagir si le
            # fichier existe. Mais le comportement par défaut devrait être
            # d'écraser le fichiers, sinon une personne qui ne lit pas le code
            # source va croire que le code ne marche pas. De plus, il est plus
            # rare de ne pas vouloir écraser les fichiers d'origine que
            # l'inverse. Enfin, puisqu'on ne controle pas le nommage des fichiers
            # depuis l'extérieur de la classe, il n'y a pas de moyen de réagir
            # proprement pour dire &quot;je veux garder les anciens fichiers et
            # avoir les nouveaux quand même&quot; à part utilise un dossier différent
            # à chaque fois.
            if not isfile(filename):

                # On récupère l'array de pixels en utilisant le code de la
                # classe fille une fois de plus. C'est nécessaire puisque ça
                # dépend de l'OS.
                # Ce code ne fait pas du tout ce que vous croyez. get_pixels
                # va sauvegarder l'image sans self.image, et retourner 1.
                # C'est donc une fonction qui marche via ses effets de bords,
                # ce qui est une très mauvaise pratique.
                pixels = self.get_pixels(monitor)

                # Même remarque que sur l'autre exception. De plus l'exception
                # devrait être levée au niveau de get_pixels, pas au niveau
                # de save(). Il y a un mélange de base niveau et de haut
                # niveau dans cette classe qui rend l'API assez maladroite.
                # D'ailleurs get_pixels ne retourne jamais None...
                if pixels is None:
                    raise ValueError('MSS: no data to process.')

                # Bon, ça c'est super crade. En gros il délègue le save à une
                # méthode si elle existe, et sinon le fait à la main.
                # L'héritage est fait pour ça, et il aurait été préférable
                # de faire une méthode save(pixels, size, filename) générique
                # et ensuite l'écraser dans les enfants. Peut être que c'est un
                # dev C et qu'il n'est pas encore très à l'aise avec le POO.
                # Il est possible que l'auteur ait rencontré des problèmes du
                # fait d'une inconsistance d'api et n'ai pas su le gérer en
                # mettant un adapter par dessus. Quand je vous dis que les
                # design pattern c'est parfois utile :)
                if hasattr(self, 'save_'):
                    img_out = self.save_(output=filename)
                else:
                    img = MSSImage(pixels, monitor[b'width'], monitor[b'height'])
                    img_out = img.dump(filename)
                self.debug('save', 'img_out', img_out)
                if img_out:
                    # Etant donné que la génération du screenshot prend du
                    # temps et qu'il y en a plusieurs, l'auteur a intelligemment
                    # choisit de faire un générateur, ce qui permet de ne pas
                    # attendre que tous les screenshots soient terminé avant
                    # de d'avoir un premier résultat.
                    yield img_out
            else:
                yield filename + ' (already exists)'

    # Les fameuses méthodes délégues aux classes filles. Un petit
    # NotImplemented serait mieux que pass car c'est plus explicite, mais
    # rien de grave.
    def enum_display_monitors(self):
        ''' Get positions of all monitors.

            If self.oneshot is True, this function has to return a dict
            with dimensions of all monitors at the same time.
            If the monitor has rotation, you have to deal with inside this method.

            Must returns a dict with a minima:
            {
                'left':   the x-coordinate of the upper-left corner,
                'top':    the y-coordinate of the upper-left corner,
                'width':  the width,
                'height': the height
            }
        '''
        pass

    def get_pixels(self, monitor_infos):
        ''' Retrieve screen pixels for a given monitor.

            monitor_infos should contain at least:
            {
                'left':   the x-coordinate of the upper-left corner,
                'top':    the y-coordinate of the upper-left corner,
                'width':  the width,
                'heigth': the height
            }

            Returns a dict with pixels.
        '''
        pass

# Maintenant on par dans les détails de l'implémentation de l'algo qui récupère
# les screenshots qui est spécifique à chaque OS.
class MSSMac(MSS):
    ''' Mutli-screen shot implementation for Mac OSX.
        It uses intensively the Quartz.
    '''

    # Bon, du coup plutôt que de faire une fonction init, il aurait mieux
    # valut faire une fonction __init__ qui appelle super().
    def init(self):
        ''' Mac OSX initialisations '''
        self.debug('init')
        pass

    # Là c'est le gros du boulot, et c'est là que je vous dis que l'auteur
    # c'est vraiment super cassé le cul pour trouver toutes ces infos sur
    # les APIS propres à chaque système, et en plus en C. Kudos.
    def enum_display_monitors(self):
        ''' Get positions of one or more monitors.
            Returns a dict with minimal requirements (see MSS class).
        '''

        self.debug('enum_display_monitors')

        results = []
        # Si il y a un seul screen à prend, on se fait pas chier et on prend
        # un rectangle de taille infinie pour les limites du screen. Je
        # suppose que l'OS est capable de se démerder avec ça et borner
        # à la taille du matos automatiquement. C'est un truc de faignasse, et
        # c'est plutôt malin.
        if self.oneshot:
            rect = CGRectInfinite
            results.append({
                b'left'  : int(rect.origin.x),
                b'top'   : int(rect.origin.y),
                b'width' : int(rect.size.width),
                b'height': int(rect.size.height)
            })
        else:
            # Par contre là il faut se taper le calcul des coordonnées de
            # rectangle à la main

            # Cette variable est requise par CGGetActiveDisplayList mais
            # comme le suggère le commentaire de l'auteur ci-dessous : LOL.
            max_displays = 32  # Peut-être augmenté, si besoin...

            # Apparemment il est possible que l'affichage ait subit une
            # rotation. Je suppose que MacOS anticipait déjà l’existence des
            # tablettes à l'époque.
            rotations = {0.0: 'normal', 90.0: 'right', -90.0: 'left'}

            # On demande les affichages qui sont effectivement en court
            # d'utilisation, et on récupère un identifiant unique pour chacun
            # d'entre deux.
            res, ids, count = CGGetActiveDisplayList(max_displays, None, None)
            for display in ids:
                # On interroge l'API Mac pour avoir ses coordonnées, et on
                # les extrait.
                rect = CGRectStandardize(CGDisplayBounds(display))
                left, top = rect.origin.x, rect.origin.y
                width, height = rect.size.width, rect.size.height
                # Correction des coordonnées en cas de rotation.
                rot = CGDisplayRotation(display)
                rotation = rotations[rot]
                if rotation in ['left', 'right']:
                    width, height = height, width

                # Et on insère le résultat dans la liste des monitors. On
                # aurait pu yielder aussi comme dans save(), mais bon, c'est
                # parce que je yield partout que je dis ça.
                results.append({
                    b'left'    : int(left),
                    b'top'     : int(top),
                    b'width'   : int(width),
                    b'height'  : int(height),
                    b'rotation': rotation
                })
        return results

    def get_pixels(self, monitor):
        ''' Retreive all pixels from a monitor. Pixels have to be RGB.
        '''

        self.debug('get_pixels')

        # On récupère les coordonnées retournées par enum_display_monitors
        # et on en fait un CGRect qui est nécessaire pour CGWindowListCreateImage.
        width, height = monitor[b'width'], monitor[b'height']
        left, top = monitor[b'left'], monitor[b'top']
        rect = CGRect((left, top), (width, height))
        # CGWindowListCreateImage retourne l'image à ces coordonnées.
        # Les 3 derniers paramètres sont là grace à &quot;from Quartz import *&quot;
        # (c'est pour ça que je vous dis de ne pas le faire, car c'est pas
        # facile à retracer). kCGWindowListOptionOnScreenOnly force l'inclusion
        # uniquement des fenêtre affichées et non celles hors écran.
        # kCGNullWindowID est l'équivalent de None, dans ce contexte. C'est
        # la fenêtre de référence, et on en veut aucune.
        # kCGWindowImageDefault demande de capturer le fenêtre ET sa décoration
        # (comme les ombres portées).
        # Ces deux derniers params sont les valeurs par défaut donc je ne sais
        # pas pourquoi il les passent.
        self.image = CGWindowListCreateImage(
                    rect, kCGWindowListOptionOnScreenOnly,
                    kCGNullWindowID, kCGWindowImageDefault)

        # Comme je le disais dans save(), la fonction ne retourne PAS l'objet
        # image mais 1. L'image est stockée dans self.image et ce sont les
        # autres méthodes qui tapent dans cet attribut. C'est mal.
        return 1

    # la fameurse méthode save_ utilisée par save()...
    def save_(self, output):
        ''' Special method to not use MSSImage class. '''

        self.debug('save_')

        # résolution du png
        dpi = 72
        # chemin du png. Tout est URL dans Mac OS. Un chemin de fichier
        # est une URL file://
        url = NSURL.fileURLWithPath_(output)
        # On fabrique l'objet fichier
        dest = CGImageDestinationCreateWithURL(url, kUTTypePNG, 1, None)
        properties = {
            kCGImagePropertyDPIWidth: dpi,
            kCGImagePropertyDPIHeight: dpi,
        }
        # On met notre image dans l'objet fichier. Là il faut se souvenir
        # que save() appelle get_pixel() qui remplit self.image puis appelle
        # save_() derrière. Je vous l'avais dis que les effets de bord, ça
        # craint).
        CGImageDestinationAddImage(dest, self.image, properties)
        # On écrit notre objet fichier sur le disk.
        if not CGImageDestinationFinalize(dest):
            output = None

        # L'auteur vide ouput si CGImageDestinationFinalize à échoué. Il
        # vaudrait mieux lever une exception.
        return output

# On passe à l'implémentation Linux.
class MSSLinux(MSS):
    ''' Mutli-screen shot implementation for GNU/Linux.
        It uses intensively the Xlib.
    '''

    # Fait un travail de nettoyage quand l'objet est garbage collecté, en
    # l'occurence ferme la connection avec le serveur x. Je rappelle que
    # l'appel à __del__ n'est pas garanti donc mieux faut faire une méthode
    # close() officielle et un context manager avec un finally.
    def __del__(self):
        ''' Disconnect from X server '''

        self.debug('__del__')

        if self.display:
            self.XCloseDisplay(self.display)


    def init(self):
        ''' GNU/Linux initialisations '''

        self.debug('init')

        # on charge la shared lib du serveur x
        x11 = find_library('X11')
        if x11 is None:
            raise OSError('MSSLinux: no X11 library found.')
        else:
            xlib = cdll.LoadLibrary(x11)

        self.debug('init', 'xlib', xlib)

        # Aliasing des méthode de xlib. Pourquoi ? Aucune idée.
        # passer l'objet xlib le parait plus logique. Peut être qu'il y a
        # une raison technique liée au mapping ctypes, mais je ne la connais
        # pas.
        self.XOpenDisplay = xlib.XOpenDisplay
        self.XDefaultScreen = xlib.XDefaultScreen
        self.XDefaultRootWindow = xlib.XDefaultRootWindow
        self.XGetWindowAttributes = xlib.XGetWindowAttributes
        self.XAllPlanes = xlib.XAllPlanes
        self.XGetImage = xlib.XGetImage
        self.XGetPixel = xlib.XGetPixel
        self.XFree = xlib.XFree
        self.XCloseDisplay = xlib.XCloseDisplay

        # ctypes permet de spécifier pour chaque fonction des types attendus
        # en paramètre et en valeur de retour. Cela permet l'autocasting
        # de types compatibles et une exception explicite en cas de passage
        # de mauvais paramètres plutôt qu'un core dump.
        # L'auteur ici à mis ce code un peu lourd dans des méthodes dédiées et
        # préfixées de _ puisqu'à usage interne.
        self._set_argtypes()
        self._set_restypes()

        # On récupère l'affichage en cours en tapant dans les variables
        # d'environnement. Le jobby-jobba et du au fait qu'il veut garder
        # la compatibilité Python 3 et 2.7 et qu'il faut accomoder
        # les types str/unicode/bytes.
        # C'est une vérification pour éviter un segfault si il n'y pas de
        # serveur x qui tourne.
        display = None
        self.display = None
        try:
            if sys.version &gt; '3':
                display = bytes(environ['DISPLAY'], 'utf-8')
            else:
                display = environ['DISPLAY']
        except KeyError:
            err = 'MSSLinux: $DISPLAY not set. Stopping to prevent segfault.'
            raise ValueError(err)
        self.debug('init', '$DISPLAY', display)

        # On récupère l'écran par défaut et la fenêtre racine sur l'affichage
        # en cours.

        # At this point, if there is no running server, it could end on
        # a segmentation fault. And we cannot catch it.
        self.display = self.XOpenDisplay(display)
        self.debug('init', 'display', self.display)
        self.screen = self.XDefaultScreen(self.display)
        self.debug('init', 'screen', self.screen)
        self.root = self.XDefaultRootWindow(self.display, self.screen)
        self.debug('init', 'root', self.root)

    # les deux méthodes qui servent à manuellement définir les types
    # des autres méthodes dont j'ai parlé plus haut.

    def _set_argtypes(self):
        ''' Functions arguments '''

        self.debug('_set_argtypes')

        self.XOpenDisplay.argtypes = [c_char_p]
        self.XDefaultScreen.argtypes = [POINTER(Display)]
        self.XDefaultRootWindow.argtypes = [POINTER(Display), c_int]
        self.XGetWindowAttributes.argtypes = [POINTER(Display),
            POINTER(XWindowAttributes), POINTER(XWindowAttributes)]
        self.XAllPlanes.argtypes = []
        self.XGetImage.argtypes = [POINTER(Display), POINTER(Display),
            c_int, c_int, c_uint, c_uint, c_ulong, c_int]
        self.XGetPixel.argtypes = [POINTER(XImage), c_int, c_int]
        self.XFree.argtypes = [POINTER(XImage)]
        self.XCloseDisplay.argtypes = [POINTER(Display)]

    def _set_restypes(self):
        ''' Functions return type '''

        self.debug('_set_restypes')

        self.XOpenDisplay.restype = POINTER(Display)
        self.XDefaultScreen.restype = c_int
        self.XDefaultRootWindow.restype = POINTER(XWindowAttributes)
        self.XGetWindowAttributes.restype = c_int
        self.XAllPlanes.restype = c_ulong
        self.XGetImage.restype = POINTER(XImage)
        self.XGetPixel.restype = c_ulong
        self.XFree.restype = c_void_p
        self.XCloseDisplay.restype = c_void_p


    def enum_display_monitors(self):
        ''' Get positions of one or more monitors.
            Returns a dict with minimal requirements (see MSS class).
        '''

        self.debug('enum_display_monitors')

        results = []
        if self.oneshot:
            # Dans le cas d'un seul screenshot pour tout, on récupère juste
            # les coordonnées de la fenêtre racine.
            gwa = XWindowAttributes()
            self.XGetWindowAttributes(self.display, self.root, byref(gwa))
            results.append({
                b'left'  : int(gwa.x),
                b'top'   : int(gwa.y),
                b'width' : int(gwa.width),
                b'height': int(gwa.height)
            })
        else:

            # Sinon on parse le fichier XML de config pour essayer de
            # trouver les coordonnées. Je ne suis pas certain que ce soit
            # une bonne stratégie puisque le fichier monitors.xml contient
            # tous les moniteurs jamais branché sur la machine, y compris ceux
            # qu'on a pas branché depuis 1000 ans...

            # It is a little more complicated, we have to guess all stuff
            # from ~/.config/monitors.xml, if present.
            monitors = expanduser('~/.config/monitors.xml')
            if not isfile(monitors):
                # Ici, lever une exception serait pas mal.
                # A la place, l'auteur choisit de mettre oneshot et de relancer
                # la capture. Donc au lieu d'avoir ce qu'on demande ou une
                # erreur, on a ce qu'on demande ou ce qu'on ne demande pas.
                # Encore une fois, j'en profite pour souligner qu'il faut
                # éviter ce genre de config à base de site effects. Devoir
                # setter un attribut pour avoir un résultat différent à cette
                # méthode n'est pas très propre.
                self.debug('ERROR', 'MSSLinux: enum_display_monitors() failed (no monitors.xml).')
                self.oneshot = True
                return self.enum_display_monitors()

            # Le XML est une collection de noeuds 'configuration' qui représentent
            # chacun un moniteur. On récupère ici le premier noeud 'configurations'
            tree = ET.parse(monitors)
            root = tree.getroot()
            config = root.findall('configuration')[-1]
            conf = []
            # chaque noeud &quot;configurations&quot; à une série de noeuds ouput qui
            # représentent chaque format de sortie (VGA, HDMI, etc). On
            # boucle dessus.
            for output in config.findall('output'):
                name = output.get('name')
                if name != 'default':
                    # On récupère les coordonnées, la rotation, on extrait,
                    # on corrige, on ajoute à la liste... Bref, même topo
                    # qu'avec MacOsX.
                    x = output.find('x')
                    y = output.find('y')
                    width = output.find('width')
                    height = output.find('height')
                    rotation = output.find('rotation')
                    if None not in [x, y, width, height] and name not in conf:
                        conf.append(name)
                        if rotation.text in ['left', 'right']:
                            width, height = height, width
                        results.append({
                            b'left'    : int(x.text),
                            b'top'     : int(y.text),
                            b'width'   : int(width.text),
                            b'height'  : int(height.text),
                            b'rotation': rotation.text
                        })
        return results

    def get_pixels(self, monitor):
        ''' Retreive all pixels from a monitor. Pixels have to be RGB.
        '''

        self.debug('get_pixels')

        # On récupère les coordonnées des monitors revoyées par enum_display_monitors
        width, height = monitor[b'width'], monitor[b'height']
        left, top = monitor[b'left'], monitor[b'top']
        ZPixmap = 2

        # On récupère un masque de pixels pour l'ensemble de l'affichage
        allplanes = self.XAllPlanes()
        self.debug('get_pixels', 'allplanes', allplanes)

        # Visiblement un fix. C'est ce qu'on appelle un commentaire utile.
        # Fix for XGetImage: expected LP_Display instance instead of LP_XWindowAttributes
        root = cast(self.root, POINTER(Display))

        # On récupère un dump des pixels pour les coordonnées en cours, de
        # l'affichage en cours, on lui applique le masque de pixel mais
        # je ne sais pas pourquoi on doit le faire. x11 est une bestiole
        # très tarabiscotée, et mes recherches n'ont rien donné. L'auteur
        # a du bien s'amuser à trouver comment faire ce genre de chose.
        image = self.XGetImage(self.display, root, left, top, width,
            height, allplanes, ZPixmap)
        if image is None:
            raise ValueError('MSSLinux: XGetImage() failed.')

        # Les pixels doivent être récupérés en RGB. L'auteur fait donc une
        # fonction de conversion (c'est une fonction inline, donc jetable)
        # puis l'applique à la liste des pixels qu'il récupère dans l'image.
        # Une simple boucle for aurait fait l'affaire mais l'auteur a mis
        # en place une stratégie de mémoisation (mise en cache) dans la fonction.
        # Vu que la fonction est inline, un simple dico aurait aussi fait
        # l'affaire. Mais une il est très possible qu'on lui ait donné
        # le truc et comme il n'est pas habitué à Python il a juste copié/collé.
        # Je le fais souvent en Java / C donc je vais pas lui jeter la pierre.
        def pix(pixel, _resultats={}):
            ''' Apply shifts to a pixel to get the RGB values.
                This method uses of memoization.
            '''
            # La mise en cache se fait à ce niveau.
            if not pixel in _resultats:
                # Là c'est du byte shifting, mais quelle logique exacte est
                # implémentée, aucune idée. Il faudrait regarder les algos
                # de conversion pixels vers RGB et trouver celui qui est
                # appliqué. C'est le genre de truc que je copie/colle car
                # je suis trop feignant et tester que ça marche est plus rapide
                # que comprendre.
                _resultats[pixel] = b((pixel &amp; 16711680) &gt;&gt; 16) + b((pixel &amp; 65280) &gt;&gt; 8) + b(pixel &amp; 255)
            return _resultats[pixel]

        # Aliasing de la fonction pour gagner en vitesse en évitant un lookup
        # d'attribut dans une boucle.
        get_pix = self.XGetPixel
        # Boucle de conversion via une liste en intention.
        pixels = [pix(get_pix(image, x, y)) for y in range(height) for x in range(width)]

        # Ici get_pixels retourne l'objet image plutôt que de la sauver
        # dans un attribut self.image. Ouch.
        self.XFree(image)
        return b''.join(pixels)

# On passe maintenant à l'implémentation pour Windows

class MSSWindows(MSS):
    ''' Mutli-screen shot implementation for Microsoft Windows. '''

    # Même topo que pour la version Linux. Même principe que son init.
    def init(self):
        ''' Windows initialisations '''

        self.debug('init')

        self.GetSystemMetrics = windll.user32.GetSystemMetrics
        self.EnumDisplayMonitors = windll.user32.EnumDisplayMonitors
        self.GetWindowDC = windll.user32.GetWindowDC
        self.CreateCompatibleDC = windll.gdi32.CreateCompatibleDC
        self.CreateCompatibleBitmap = windll.gdi32.CreateCompatibleBitmap
        self.SelectObject = windll.gdi32.SelectObject
        self.BitBlt = windll.gdi32.BitBlt
        self.GetDIBits = windll.gdi32.GetDIBits
        self.DeleteObject = windll.gdi32.DeleteObject

        self._set_argtypes()
        self._set_restypes()

    def _set_argtypes(self):
        ''' Functions arguments '''

        self.debug('_set_argtypes')

        self.MONITORENUMPROC = WINFUNCTYPE(INT, DWORD, DWORD,
            POINTER(RECT), DOUBLE)
        self.GetSystemMetrics.argtypes = [INT]
        self.EnumDisplayMonitors.argtypes = [HDC, LPRECT,
            self.MONITORENUMPROC, LPARAM]
        self.GetWindowDC.argtypes = [HWND]
        self.CreateCompatibleDC.argtypes = [HDC]
        self.CreateCompatibleBitmap.argtypes = [HDC, INT, INT]
        self.SelectObject.argtypes = [HDC, HGDIOBJ]
        self.BitBlt.argtypes = [HDC, INT, INT, INT, INT, HDC, INT, INT, DWORD]
        self.DeleteObject.argtypes = [HGDIOBJ]
        self.GetDIBits.argtypes = [HDC, HBITMAP, UINT, UINT, LPVOID,
            POINTER(BITMAPINFO), UINT]

    def _set_restypes(self):
        ''' Functions return type '''

        self.debug('_set_restypes')

        self.GetSystemMetrics.restypes = INT
        self.EnumDisplayMonitors.restypes = BOOL
        self.GetWindowDC.restypes = HDC
        self.CreateCompatibleDC.restypes = HDC
        self.CreateCompatibleBitmap.restypes = HBITMAP
        self.SelectObject.restypes = HGDIOBJ
        self.BitBlt.restypes =  BOOL
        self.GetDIBits.restypes = INT
        self.DeleteObject.restypes = BOOL

    def enum_display_monitors(self):
        ''' Get positions of one or more monitors.
            Returns a dict with minimal requirements (see MSS class).
        '''

        self.debug('enum_display_monitors')

        # le code qui permet de récupérer les moniteurs est visiblement
        # asynchrone, donc on fabrique un callback qui va remplir le tableau
        # des résultats.

        def _callback(monitor, dc, rect, data):
            rct = rect.contents
            results.append({
                b'left'  : int(rct.left),
                b'top'   : int(rct.top),
                b'width' : int(rct.right - rct.left),
                b'height': int(rct.bottom -rct.top)
            })
            return 1

        results = []
        # si c'est juste un seul screenshot, c'est un appel synchrone
        if self.oneshot:
            # ce sont des constantes qui déterminent quelle info ont veut que
            # GetSystemMetrics renvoit. Ici on demande les coordonnées de tout
            # l'écran, une par une.
            SM_XVIRTUALSCREEN = 76
            SM_YVIRTUALSCREEN = 77
            SM_CXVIRTUALSCREEN = 78
            SM_CYVIRTUALSCREEN = 79
            left = self.GetSystemMetrics(SM_XVIRTUALSCREEN)
            right = self.GetSystemMetrics(SM_CXVIRTUALSCREEN)
            top = self.GetSystemMetrics(SM_YVIRTUALSCREEN)
            bottom = self.GetSystemMetrics(SM_CYVIRTUALSCREEN)
            results.append({
                b'left'  : int(left),
                b'top'   : int(top),
                b'width' : int(right - left),
                b'height': int(bottom - top)
            })
        else:
            # On enrobe le callback Python dans un proxy qui le rend
            # utilisable par le code C
            callback = self.MONITORENUMPROC(_callback)
            # On demande à windows de nous lister les moniteurs, et comme
            # cet appel est asynchrone, on lui passe un callback pour qu'il
            # replisse la liste au fur et à mesure
            self.EnumDisplayMonitors(0, 0, callback, 0)

        # On retourne la liste. A ce stade là, on ne sait pas si la liste
        # est vide, à moitié remplie ou complètement remplie. Utiliser du
        # code asynchrone au milieu d'une lib synchrone, c'est assez dangereux
        # donc je me demande comment il retombe sur ses pieds.
        return results

    # A ce stade là il est 13h, j'ai commencé à 9h et j'ai la dalle. J'en ai
    # marre de commenter ce code. 'envoyez-vous les codes que vous pigez pas'
    # est une idée à la con. Je vous hais tous. Mon coloc va me ramener des
    # frites.

    def get_pixels(self, monitor):
        ''' Retreive all pixels from a monitor. Pixels have to be RGB. '''

        self.debug('get_pixels')

        # Encore une fois on récupère les coordonnées des moniteurs filées
        # par enum_display_monitors
        width, height = monitor[b'width'], monitor[b'height']
        left, top = monitor[b'left'], monitor[b'top']

        # Reajustement de la taille de la largeur. Je suppose que c'est
        # empirique, mais je peux me tromper.
        good_width = (width * 3 + 3) &amp; -4
        # Valeur de paramètre qui dit de copier directement dans le rectangle
        # des destination.
        SRCCOPY = 0xCC0020
        DIB_RGB_COLORS = 0

        # Récupère le Device Context (title bar, menus, and scroll bars, etc)
        srcdc = self.GetWindowDC(0)
        # On fabrique une copie en mémoire.
        memdc = self.CreateCompatibleDC(srcdc)
        # On fabrique un bitmap basé sur ce DC
        bmp = self.CreateCompatibleBitmap(srcdc, width, height)
        # On injecte un bitmap dans le DC en mémoire.
        self.SelectObject(memdc, bmp)
        # On transfert les bits d'un DC à l'autre.
        self.BitBlt(memdc, 0, 0, width, height, srcdc, left, top, SRCCOPY)
        # On fabrique le header du BMP
        bmi = BITMAPINFO()
        bmi.bmiHeader.biSize = sizeof(BITMAPINFOHEADER)
        bmi.bmiHeader.biWidth = width
        bmi.bmiHeader.biHeight = height
        bmi.bmiHeader.biBitCount = 24
        bmi.bmiHeader.biPlanes = 1
        buffer_len = height * good_width
        # On fabrique un array de char
        pixels = create_string_buffer(buffer_len)
        # On récupère les bits du bitmap issu du DC
        bits = self.GetDIBits(memdc, bmp, 0, height, byref(pixels),
            pointer(bmi), DIB_RGB_COLORS)

        self.debug('get_pixels', 'srcdc', srcdc)
        self.debug('get_pixels', 'memdc', memdc)
        self.debug('get_pixels', 'bmp', bmp)
        self.debug('get_pixels', 'buffer_len', buffer_len)
        self.debug('get_pixels', 'bits', bits)
        self.debug('get_pixels', 'len(pixels.raw)', len(pixels.raw))

        # Nettoyage des objets.
        # Clean up
        self.DeleteObject(srcdc)
        self.DeleteObject(memdc)
        self.DeleteObject(bmp)

        # Apparemment la récupération peut échouer et on peut vérifier
        # cet échec en checkant la longueur. Après la cause de l'échec est
        # un mystère
        if bits != height or len(pixels.raw) != buffer_len:
            raise ValueError('MSSWindows: GetDIBits() failed.')

        # Réorganise les bits dans le bonne ordre et converti le format
        # de couleur de BGR vers RGB

        # Note that the origin of the returned image is in the
        # bottom-left corner, 32-bit aligned. And it is BGR.
        # Need to &quot;arrange&quot; that.
        return self._arrange(pixels.raw, good_width, height)


    def _arrange(self, data, width, height):
        ''' Reorganises data when the origin of the image is in the
            bottom-left corner and converts BGR triple to RGB. '''

        self.debug('_arrange')

        # On crée une nouvelle liste pleine de zéro, et on la rempli
        # avec la nouvelle position des pixels.
        total = width * height
        scanlines = [b'0'] * total
        for y in range(height):
            off = width * (y + 1)
            offset = total - off
            for x in range(0, width - 2, 3):
                # On inverse aussi la position du bleu et du rouge
                scanlines[off+x:off+x+3] = b(data[offset+x+2]), b(data[offset+x+1]), b(data[offset+x])
        return b''.join(scanlines)

# Un wrapper pour dumper un array de pixels dans un fichier
# Typiquement un truc qui aurait pu tenir dans une fonction au lieu d'une classe.

class MSSImage(object):
    ''' This is a class to save data (raw pixels) to a picture file.
    '''

    def __init__(self, data=None, width=1, height=1):
        self.data = data
        self.width = int(width)
        self.height = int(height)

        if self.data is None:
            raise ValueError('MSSImage: no data to process.')
        elif self.width &lt; 1 or self.height &lt; 1:
            raise ValueError('MSSImage: width or height must be positive.')


    # Tout le boulot se passe ici.

    def dump(self, output):
        ''' Dump data to the image file.
            Pure python PNG implementation.
            Image represented as RGB tuples, no interlacing.
            http://inaps.org/journal/comment-fonctionne-le-png
        '''

        # On ouvre le fichier en mode écriture binaire.

        with open(output, 'wb') as fileh:
            # Pour cette partie il faut connaitre les subtilités du format PNG
            # pour comprendre, ce qui n'est pas mon cas. Donc je vais faire
            # de la déduction au gros doigt mouillé.

            # Ca prend les données en pixel, ça en fait des morceaux de la bonne taille,
            # organisés en rangés de pixels puisqu'il y a range(height) rangés.
            to_take = (self.width * 3 + 3) &amp; -4
            padding = 0 if to_take % 8 == 0 else (to_take % 8) // 2
            height, data = self.height, self.data
            scanlines = [b''.join([b'0', data[to_take*y:to_take*y+to_take-padding]]) for y in range(height)]

            # les &quot;magic bytes&quot;, le marqueur du début de fichier qui indique
            # que c'est un fichier png
            magic = pack(b'&gt;8B', 137, 80, 78, 71, 13, 10, 26, 10)

            # Les metadata du fichiers : taille de l'image, une somme de
            # controle, la profondeur de couleur, méthode de compression,
            # le mode d'entrelacement, etc.
            # Header: size, marker, data, CRC32
            ihdr = [b'', b'IHDR', b'', b'']
            ihdr[2] = pack(b'&gt;2I5B', self.width, self.height, 8, 2, 0, 0, 0)
            ihdr[3] = pack(b'&gt;I', zlib.crc32(b''.join(ihdr[1:3])) &amp; 0xffffffff)
            ihdr[0] = pack(b'&gt;I', len(ihdr[2]))

            # l'image en elle même avec un marker de départ, les pixels
            # et une somme de controle
            # Data: size, marker, data, CRC32
            idat = [b'', b'IDAT', b'', b'']
            idat[2] = zlib.compress(b''.join(scanlines), 9)
            idat[3] = pack(b'&gt;I', zlib.crc32(b''.join(idat[1:3])) &amp; 0xffffffff)
            idat[0] = pack(b'&gt;I', len(idat[2]))

            # Les metadata à la fin du fichier qui sont vides.
            # Footer: size, marker, None, CRC32
            iend = [b'', b'IEND', b'', b'']
            iend[3] = pack(b'&gt;I', zlib.crc32(iend[1]) &amp; 0xffffffff)
            iend[0] = pack(b'&gt;I', len(iend[2]))

            # On écrit le fichier, et on retourne son nom
            fileh.write(magic + b''.join(ihdr) + b''.join(idat) + b''.join(iend))
            return output
        return None

# Un exemple d'usage avec l'habituel if __name__ pour éviter de
# le lancer à l'import
if __name__ == '__main__':

    systems = {
        'Darwin' : MSSMac,
        'Linux'  : MSSLinux,
        'Windows': MSSWindows
    }
    try:
        MSS = systems[system()]
    except KeyError:
        err = 'System &quot;{0}&quot; not implemented.'.format(system())
        raise NotImplementedError(err)

    try:
        mss = MSS(debug=False)

        # One screen shot per monitor
        for filename in mss.save():
            print('File &quot;{0}&quot; created.'.format(filename))

        # A shot to grab them all :)
        for filename in mss.save(oneshot=True):
            print('File &quot;{0}&quot; created.'.format(filename))
    except Exception as ex:
        print(ex)
        raise</p></div>

<div class="sharedaddy sd-sharing-enabled"><div class="robots-nocontent sd-block sd-social sd-social-official sd-sharing"><h3 class="sd-title">Partager:</h3><div class="sd-content"><ul><li class="share-twitter"><a href="https://twitter.com/share" class="twitter-share-button" data-url="http://sametmax.com/explication-de-code-python-mss/" data-text="Explication de code : python-mss"  >Tweet</a></li><li class="share-facebook"><div class="fb-share-button" data-href="http://sametmax.com/explication-de-code-python-mss/" data-layout="button_count"></div></li><li class="share-google-plus-1"><div class="googleplus1_button"><div class="g-plus" data-action="share" data-annotation="bubble" data-href="http://sametmax.com/explication-de-code-python-mss/"></div></div></li><li class="share-email"><a rel="nofollow" data-shared="" class="share-email sd-button" href="index.html%3Fshare=email.html" rel="noopener noreferrer" target="_blank" title="Click to email this to a friend"><span>Email</span></a></li><li><a href="index.html#" class="sharing-anchor sd-button share-more"><span>More</span></a></li><li class="share-end"></li></ul><div class="sharing-hidden"><div class="inner" style="display: none;"><ul><li class="share-reddit"><div class="reddit_button"><iframe src="http://www.reddit.com/static/button/button1.html?newwindow=true&width=120&amp;url=http%3A%2F%2Fsametmax.com%2Fexplication-de-code-python-mss%2F&amp;title=Explication%20de%20code%20%3A%20python-mss" height="22" width="120" scrolling="no" frameborder="0"></iframe></div></li><li class="share-pinterest"><div class="pinterest_button"><a href="https://www.pinterest.com/pin/create/button/?url=http%3A%2F%2Fsametmax.com%2Fexplication-de-code-python-mss%2F&#038;media=http%3A%2F%2Fsametmax.com%2Fwp-content%2Fuploads%2F2014%2F02%2Fyu1p0xS.jpg&#038;description=Explication%20de%20code%20%3A%20python-mss" data-pin-do="buttonPin" data-pin-config="beside"><img src="http://assets.pinterest.com/images/pidgets/pinit_fg_en_rect_gray_20.png" /></a></div></li><li class="share-end"></li><li class="share-tumblr"><a target="_blank" href="https://www.tumblr.com/share/link/?url=http%3A%2F%2Fsametmax.com%2Fexplication-de-code-python-mss%2F&name=Explication%20de%20code%20%3A%20python-mss" title="Share on Tumblr" style="display:inline-block; text-indent:-9999px; overflow:hidden; width:62px; height:20px; background:url('https://platform.tumblr.com/v1/share_2.png') top left no-repeat transparent;">Share on Tumblr</a></li><li class="share-pocket"><div class="pocket_button"><a href="https://getpocket.com/save" class="pocket-btn" data-lang="en" data-save-url="http://sametmax.com/explication-de-code-python-mss/" data-pocket-count="horizontal" >Pocket</a></div></li><li class="share-end"></li><li class="share-end"></li></ul></div></div></div></div></div>                        </section><!-- .entry-content -->

        <footer class="entry-meta"><hr class="featurette-divider"><div class="author-info"><div class="row-fluid"><div class="comment-avatar author-avatar span2"><img alt='' src='http://2.gravatar.com/avatar/bf9ecde8f5e286de6ce5c80206cf9dd6?s=100&#038;d=retro&#038;r=x' srcset='http://2.gravatar.com/avatar/bf9ecde8f5e286de6ce5c80206cf9dd6?s=200&#038;d=retro&#038;r=x 2x' class='avatar avatar-100 photo' height='100' width='100' /></div> <div class="author-description span10"><h3>About Sam</h3><p>Waf !</p><div class="author-link"><a href="../author/sam/index.html" rel="author">View all posts by Sam <span class="meta-nav">&rarr;</span></a></div></div></div></div></footer>                                    </article>
                                
                            
                        
                    
<div id="comments" class="comments-area" >
	<h2 id="tc-comment-title" class="comments-title">9 thoughts on &ldquo;<span>Explication de code : python-mss</span>&rdquo;</h2>              <ul class="commentlist">
                        <li class="comment even thread-even depth-1" id="li-comment-20238">
          
            <article id="comment-20238" class="comment"><div class="row-fluid"><div class="comment-avatar span2"><img alt='' src='http://1.gravatar.com/avatar/457d8df30dd9dd5d780126cf36830979?s=80&#038;d=retro&#038;r=x' srcset='http://1.gravatar.com/avatar/457d8df30dd9dd5d780126cf36830979?s=160&#038;d=retro&#038;r=x 2x' class='avatar avatar-80 photo' height='80' width='80' /></div><div class="span10"> <header class="comment-meta comment-author vcard"><cite class="fn">Roro  </cite> <a class="comment-date" href="index.html#comment-20238"><time datetime="2014-02-22T17:56:52+00:00">22/02/2014 at 17:56</time></a></header>  <section class="comment-content comment"><p>Je dirais même plus : </p>
<p>Avant de m’éplucher cette grosse pomme, bien tranquillement;<br />
je ne dirai qu’un mot au sujet du commentage explicationnel : GENIAL ! Heu…C’est peut-être un peu trop fort non ?<br />
Allez…Alors: Parfait !<br />
Et, à: La ouaaaque barre !</p>
</section></div></div></article>          <!-- #comment-## -->
        </li><!-- #comment-## -->
        <li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-20242">
          
            <article id="comment-20242" class="comment"><div class="row-fluid"><div class="comment-avatar span2"><img alt='' src='http://1.gravatar.com/avatar/a508fd73270790a84a20898ad2387756?s=80&#038;d=retro&#038;r=x' srcset='http://1.gravatar.com/avatar/a508fd73270790a84a20898ad2387756?s=160&#038;d=retro&#038;r=x 2x' class='avatar avatar-80 photo' height='80' width='80' /></div><div class="span10"> <header class="comment-meta comment-author vcard"><cite class="fn">Stéphane  </cite> <a class="comment-date" href="index.html#comment-20242"><time datetime="2014-02-22T23:14:58+00:00">22/02/2014 at 23:14</time></a></header>  <section class="comment-content comment"><p>objectifs C -&gt; objectiveC<br />
Ce n&#8217;est pas parce que le langage est pourri qu&#8217;il faut écorcher son nom ! ;-)</p>
<p>Sinon, c&#8217;est une belle analyse de code.</p>
</section></div></div></article>          <!-- #comment-## -->
        </li><!-- #comment-## -->
        <li class="comment even thread-even depth-1" id="li-comment-20273">
          
            <article id="comment-20273" class="comment"><div class="row-fluid"><div class="comment-avatar span2"><img alt='' src='http://0.gravatar.com/avatar/fc32c6686686ecc595f05ad1885c2fb3?s=80&#038;d=retro&#038;r=x' srcset='http://0.gravatar.com/avatar/fc32c6686686ecc595f05ad1885c2fb3?s=160&#038;d=retro&#038;r=x 2x' class='avatar avatar-80 photo' height='80' width='80' /></div><div class="span10"> <header class="comment-meta comment-author vcard"><cite class="fn">Roro  </cite> <a class="comment-date" href="index.html#comment-20273"><time datetime="2014-02-23T23:28:49+00:00">23/02/2014 at 23:28</time></a></header>  <section class="comment-content comment"><p>Qu&#8217;est-ce que c&#8217;est que ce souk ? Les messages font des petits tous seuls maintenant ?</p>
</section></div></div></article>          <!-- #comment-## -->
        </li><!-- #comment-## -->
        <li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-20335">
          
            <article id="comment-20335" class="comment"><div class="row-fluid"><div class="comment-avatar span2"><img alt='' src='http://1.gravatar.com/avatar/d4e7ba319546752d8abd9a313768e038?s=80&#038;d=retro&#038;r=x' srcset='http://1.gravatar.com/avatar/d4e7ba319546752d8abd9a313768e038?s=160&#038;d=retro&#038;r=x 2x' class='avatar avatar-80 photo' height='80' width='80' /></div><div class="span10"> <header class="comment-meta comment-author vcard"><cite class="fn">blop  </cite> <a class="comment-date" href="index.html#comment-20335"><time datetime="2014-02-24T21:22:12+00:00">24/02/2014 at 21:22</time></a></header>  <section class="comment-content comment"><p>Le lien &#8220;introduction au module ctypes&#8221; ne pointe pas vers la bonne page.</p>
</section></div></div></article>          <!-- #comment-## -->
        <ul class="children">
        <li class="comment byuser comment-author-sam bypostauthor even depth-2" id="li-comment-20336">
          
            <article id="comment-20336" class="comment"><div class="row-fluid"><div class="comment-avatar span2"><img alt='' src='http://2.gravatar.com/avatar/bf9ecde8f5e286de6ce5c80206cf9dd6?s=80&#038;d=retro&#038;r=x' srcset='http://2.gravatar.com/avatar/bf9ecde8f5e286de6ce5c80206cf9dd6?s=160&#038;d=retro&#038;r=x 2x' class='avatar avatar-80 photo' height='80' width='80' /></div><div class="span10"> <header class="comment-meta comment-author vcard"><cite class="fn">Sam <span> Post author</span> </cite> <a class="comment-date" href="index.html#comment-20336"><time datetime="2014-02-24T21:39:34+00:00">24/02/2014 at 21:39</time></a></header>  <section class="comment-content comment"><p>Bien vu, je corrige.</p>
</section></div></div></article>          <!-- #comment-## -->
        </li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
        <li class="comment odd alt thread-even depth-1" id="li-comment-20453">
          
            <article id="comment-20453" class="comment"><div class="row-fluid"><div class="comment-avatar span2"><img alt='' src='http://2.gravatar.com/avatar/2bac06aff1c7f742c9c988c5441885b1?s=80&#038;d=retro&#038;r=x' srcset='http://2.gravatar.com/avatar/2bac06aff1c7f742c9c988c5441885b1?s=160&#038;d=retro&#038;r=x 2x' class='avatar avatar-80 photo' height='80' width='80' /></div><div class="span10"> <header class="comment-meta comment-author vcard"><cite class="fn"><a href='http://jocelyn.delalande.fr' rel='external nofollow' class='url'>Jocelyn</a>  </cite> <a class="comment-date" href="index.html#comment-20453"><time datetime="2014-02-26T11:36:28+00:00">26/02/2014 at 11:36</time></a></header>  <section class="comment-content comment"><p>typo: &#8220;vous n’allez rien pigé&#8221; -&gt; &#8220;vous n&#8217;allez rien piger&#8221;</p>
</section></div></div></article>          <!-- #comment-## -->
        </li><!-- #comment-## -->
        <li class="comment byuser comment-author-sam bypostauthor even thread-odd thread-alt depth-1" id="li-comment-20455">
          
            <article id="comment-20455" class="comment"><div class="row-fluid"><div class="comment-avatar span2"><img alt='' src='http://2.gravatar.com/avatar/bf9ecde8f5e286de6ce5c80206cf9dd6?s=80&#038;d=retro&#038;r=x' srcset='http://2.gravatar.com/avatar/bf9ecde8f5e286de6ce5c80206cf9dd6?s=160&#038;d=retro&#038;r=x 2x' class='avatar avatar-80 photo' height='80' width='80' /></div><div class="span10"> <header class="comment-meta comment-author vcard"><cite class="fn">Sam <span> Post author</span> </cite> <a class="comment-date" href="index.html#comment-20455"><time datetime="2014-02-26T11:49:54+00:00">26/02/2014 at 11:49</time></a></header>  <section class="comment-content comment"><p>Merci.</p>
</section></div></div></article>          <!-- #comment-## -->
        </li><!-- #comment-## -->
        <li class="comment odd alt thread-even depth-1" id="li-comment-20505">
          
            <article id="comment-20505" class="comment"><div class="row-fluid"><div class="comment-avatar span2"><img alt='' src='http://0.gravatar.com/avatar/049b059c7dff31bdc0877866d7d7a655?s=80&#038;d=retro&#038;r=x' srcset='http://0.gravatar.com/avatar/049b059c7dff31bdc0877866d7d7a655?s=160&#038;d=retro&#038;r=x 2x' class='avatar avatar-80 photo' height='80' width='80' /></div><div class="span10"> <header class="comment-meta comment-author vcard"><cite class="fn"><a href='https://tiger-222.fr' rel='external nofollow' class='url'>Tiger-222</a>  </cite> <a class="comment-date" href="index.html#comment-20505"><time datetime="2014-02-27T16:35:09+00:00">27/02/2014 at 16:35</time></a></header>  <section class="comment-content comment"><p>Wooooo ! ^^<br />
Merci Sam, ça fait plaisir que tu puisses passer un peu de temps dessus. C&#8217;est vrai que par endroit ça fait novice, en plus je connais ces &#8220;techniques&#8221;, mais je me suis tellement concentré sur les mécanismes propres à chaque OS que je suis passé à côté&#8230; En tout cas, ça me fera de quoi améliorer la bête :)<br />
Notamment, je ne voyais pas un moyen efficace et pas trop crade pour le coup des init() et des classes en général. J&#8217;avais dans l&#8217;idée de ne créer qu&#8217;une classe MSS() et de la déclarer 3 fois suivant l&#8217;OS. Si tu as une meilleure suggestion, je suis preneur !</p>
<p>Sur quel OS tournes-tu ? Je suis curieux de savoir où ça plante.</p>
<p>Encore merci beaucoup :D</p>
</section></div></div></article>          <!-- #comment-## -->
        </li><!-- #comment-## -->
        <li class="comment even thread-odd thread-alt depth-1" id="li-comment-153310">
          
            <article id="comment-153310" class="comment"><div class="row-fluid"><div class="comment-avatar span2"><img alt='' src='http://2.gravatar.com/avatar/8169f391663dc03e4b4e017934fd6433?s=80&#038;d=retro&#038;r=x' srcset='http://2.gravatar.com/avatar/8169f391663dc03e4b4e017934fd6433?s=160&#038;d=retro&#038;r=x 2x' class='avatar avatar-80 photo' height='80' width='80' /></div><div class="span10"> <header class="comment-meta comment-author vcard"><cite class="fn">Karn  </cite> <a class="comment-date" href="index.html#comment-153310"><time datetime="2014-12-28T01:20:53+00:00">28/12/2014 at 01:20</time></a></header>  <section class="comment-content comment"><p>Hi</p>
<p>I have been trying this but I get an image that is skewed. It could be that the png saving logic is not working?</p>
</section></div></div></article>          <!-- #comment-## -->
        </li><!-- #comment-## -->
              </ul><!-- .commentlist -->
            <p class="nocomments">Comments are closed.</p></div><!-- #comments .comments-area -->


<div class="ie-comment">
Des questions Python sans rapport avec l'article ? Posez-les sur <a href="http://indexerror.net">IndexError</a>.

</div>
        
          <hr class="featurette-divider __after_loop">
          <nav id="nav-below" class="navigation" role="navigation">

              <h3 class="assistive-text">
                Post navigation              </h3>

              <ul class="pager">
                                  <li class="previous">
                    <span class="nav-previous">
                      <a href="http://sametmax.com/wrap-in-try-except-dans-sublime-text/" rel="prev"><span class="meta-nav">&larr;</span> Wrap in Try / Except dans Sublime Text</a>                    </span>
                  </li>
                                                  <li class="next">
                    <span class="nav-next">
                        <a href="../beuuuuuuuuuuu/index.html" rel="next">Beuuuuuuuuuuu <span class="meta-nav">&rarr;</span></a>                    </span>
                  </li>
                              </ul>

          </nav><!-- #nav-below .navigation -->

        
        
                </div><!--.article-container -->

                    
        <div class="span3 right tc-sidebar">
           <div id="right" class="widget-area" role="complementary">
                                                      <aside id="text-9" class="widget widget_text">			<div class="textwidget"><p style="font-size:1.3em"><a href="../mais-ou-je-suis-tombee-la/index.html">Mais où je suis tombé(e) là ?</a></p></div>
		</aside><aside id="text-7" class="widget widget_text">			<div class="textwidget"><img src="http://www.adobe.com/images/pdficon_small.png" width="16" height="16"/> <a href="http://pdfcrowd.com/url_to_pdf/">Télécharger cette page en PDF</a> </div>
		</aside><aside id="text-4" class="widget widget_text">			<div class="textwidget"><br><br><a href="../appel-a-contributeurs-impertinents/index.html"><img src="../wp-content/uploads/2012/07/contributeur.png" width="288px" style="vertical-align: middle;margin-top:-40px;margin-bottom:10px;"></a> </div>
		</aside><aside id="blog_subscription-4" class="widget jetpack_subscription_widget"><h3 class="widget-title">Souscrire à nos conneries</h3>
			<form action="index.html#" method="post" accept-charset="utf-8" id="subscribe-blog-blog_subscription-4">
				<div id="subscribe-text"><p>Entrez votre adresse mail et vous recevrez une notification à chaque nouvel article.</p>
</div><p>Join 1,492 other subscribers</p>
					<p id="subscribe-email">
						<label id="jetpack-subscribe-label" for="subscribe-field-blog_subscription-4">
							Email Address						</label>
						<input type="email" name="email" required="required" class="required" value="" id="subscribe-field-blog_subscription-4" placeholder="Email Address" />
					</p>

					<p id="subscribe-submit">
						<input type="hidden" name="action" value="subscribe" />
						<input type="hidden" name="source" value="http://sametmax.com/explication-de-code-python-mss/" />
						<input type="hidden" name="sub-type" value="widget" />
						<input type="hidden" name="redirect_fragment" value="blog_subscription-4" />
												<input type="submit" value="J&#039;adhère, bon dieu !" name="jetpack_subscriptions_widget" />
					</p>
							</form>

			<script>
			/*
			Custom functionality for safari and IE
			 */
			(function( d ) {
				// In case the placeholder functionality is available we remove labels
				if ( ( 'placeholder' in d.createElement( 'input' ) ) ) {
					var label = d.querySelector( 'label[for=subscribe-field-blog_subscription-4]' );
						label.style.clip 	 = 'rect(1px, 1px, 1px, 1px)';
						label.style.position = 'absolute';
						label.style.height   = '1px';
						label.style.width    = '1px';
						label.style.overflow = 'hidden';
				}

				// Make sure the email value is filled in before allowing submit
				var form = d.getElementById('subscribe-blog-blog_subscription-4'),
					input = d.getElementById('subscribe-field-blog_subscription-4'),
					handler = function( event ) {
						if ( '' === input.value ) {
							input.focus();

							if ( event.preventDefault ){
								event.preventDefault();
							}

							return false;
						}
					};

				if ( window.addEventListener ) {
					form.addEventListener( 'submit', handler, false );
				} else {
					form.attachEvent( 'onsubmit', handler );
				}
			})( document );
			</script>
				
</aside><aside id="tag_cloud-3" class="widget widget_tag_cloud"><h3 class="widget-title">TagCloud</h3><div class="tagcloud"><a href="../tag/0bin/index.html" class="tag-cloud-link tag-link-148 tag-link-position-1" style="font-size: 9.04pt;" aria-label="0bin (11 items)">0bin</a>
<a href="../tag/angularjs/index.html" class="tag-cloud-link tag-link-443 tag-link-position-2" style="font-size: 8.4pt;" aria-label="angularjs (9 items)">angularjs</a>
<a href="../tag/asyncio/index.html" class="tag-cloud-link tag-link-922 tag-link-position-3" style="font-size: 9.04pt;" aria-label="asyncio (11 items)">asyncio</a>
<a href="../tag/autobahn/index.html" class="tag-cloud-link tag-link-979 tag-link-position-4" style="font-size: 8.4pt;" aria-label="autobahn (9 items)">autobahn</a>
<a href="../tag/bash/index.html" class="tag-cloud-link tag-link-14 tag-link-position-5" style="font-size: 10.8pt;" aria-label="bash (19 items)">bash</a>
<a href="../tag/bitcoin/index.html" class="tag-cloud-link tag-link-320 tag-link-position-6" style="font-size: 8.4pt;" aria-label="bitcoin (9 items)">bitcoin</a>
<a href="../tag/blog/index.html" class="tag-cloud-link tag-link-107 tag-link-position-7" style="font-size: 11.84pt;" aria-label="blog (26 items)">blog</a>
<a href="../tag/cache/index.html" class="tag-cloud-link tag-link-333 tag-link-position-8" style="font-size: 8.72pt;" aria-label="cache (10 items)">cache</a>
<a href="../tag/comprehension-lists/index.html" class="tag-cloud-link tag-link-20 tag-link-position-9" style="font-size: 8pt;" aria-label="comprehension-lists (8 items)">comprehension-lists</a>
<a href="../tag/crossbar/index.html" class="tag-cloud-link tag-link-1046 tag-link-position-10" style="font-size: 8.4pt;" aria-label="crossbar (9 items)">crossbar</a>
<a href="../tag/css/index.html" class="tag-cloud-link tag-link-188 tag-link-position-11" style="font-size: 8.4pt;" aria-label="css (9 items)">css</a>
<a href="../tag/cul-2/index.html" class="tag-cloud-link tag-link-33 tag-link-position-12" style="font-size: 9.28pt;" aria-label="cul (12 items)">cul</a>
<a href="../tag/dict/index.html" class="tag-cloud-link tag-link-435 tag-link-position-13" style="font-size: 8pt;" aria-label="dict (8 items)">dict</a>
<a href="../tag/django/index.html" class="tag-cloud-link tag-link-28 tag-link-position-14" style="font-size: 16pt;" aria-label="django (89 items)">django</a>
<a href="../tag/don/index.html" class="tag-cloud-link tag-link-1210 tag-link-position-15" style="font-size: 10.48pt;" aria-label="don (17 items)">don</a>
<a href="../tag/encoding/index.html" class="tag-cloud-link tag-link-54 tag-link-position-16" style="font-size: 8.72pt;" aria-label="encoding (10 items)">encoding</a>
<a href="../tag/git/index.html" class="tag-cloud-link tag-link-18 tag-link-position-17" style="font-size: 12.88pt;" aria-label="git (35 items)">git</a>
<a href="../tag/http/index.html" class="tag-cloud-link tag-link-204 tag-link-position-18" style="font-size: 9.6pt;" aria-label="http (13 items)">http</a>
<a href="../tag/import/index.html" class="tag-cloud-link tag-link-215 tag-link-position-19" style="font-size: 8.4pt;" aria-label="import (9 items)">import</a>
<a href="../tag/ipython/index.html" class="tag-cloud-link tag-link-164 tag-link-position-20" style="font-size: 8.72pt;" aria-label="ipython (10 items)">ipython</a>
<a href="../tag/iterable/index.html" class="tag-cloud-link tag-link-217 tag-link-position-21" style="font-size: 9.84pt;" aria-label="iterable (14 items)">iterable</a>
<a href="../tag/javascript/index.html" class="tag-cloud-link tag-link-96 tag-link-position-22" style="font-size: 14.08pt;" aria-label="javascript (50 items)">javascript</a>
<a href="../tag/jquery/index.html" class="tag-cloud-link tag-link-112 tag-link-position-23" style="font-size: 8pt;" aria-label="jquery (8 items)">jquery</a>
<a href="../tag/linux/index.html" class="tag-cloud-link tag-link-238 tag-link-position-24" style="font-size: 9.04pt;" aria-label="linux (11 items)">linux</a>
<a href="../tag/meta/index.html" class="tag-cloud-link tag-link-102 tag-link-position-25" style="font-size: 17.52pt;" aria-label="meta (138 items)">meta</a>
<a href="../tag/mysql/index.html" class="tag-cloud-link tag-link-82 tag-link-position-26" style="font-size: 8pt;" aria-label="mysql (8 items)">mysql</a>
<a href="../tag/nginx/index.html" class="tag-cloud-link tag-link-183 tag-link-position-27" style="font-size: 9.84pt;" aria-label="nginx (14 items)">nginx</a>
<a href="../tag/nsfw/index.html" class="tag-cloud-link tag-link-319 tag-link-position-28" style="font-size: 9.84pt;" aria-label="nsfw (14 items)">nsfw</a>
<a href="../tag/pep8/index.html" class="tag-cloud-link tag-link-552 tag-link-position-29" style="font-size: 8pt;" aria-label="pep8 (8 items)">pep8</a>
<a href="../tag/pip/index.html" class="tag-cloud-link tag-link-344 tag-link-position-30" style="font-size: 8.72pt;" aria-label="pip (10 items)">pip</a>
<a href="../tag/poo/index.html" class="tag-cloud-link tag-link-549 tag-link-position-31" style="font-size: 10pt;" aria-label="poo (15 items)">poo</a>
<a href="../tag/python/index.html" class="tag-cloud-link tag-link-4 tag-link-position-32" style="font-size: 22pt;" aria-label="python (496 items)">python</a>
<a href="../tag/python-3/index.html" class="tag-cloud-link tag-link-365 tag-link-position-33" style="font-size: 8.4pt;" aria-label="python 3 (9 items)">python 3</a>
<a href="../tag/redis/index.html" class="tag-cloud-link tag-link-196 tag-link-position-34" style="font-size: 8.72pt;" aria-label="redis (10 items)">redis</a>
<a href="../tag/ruby/index.html" class="tag-cloud-link tag-link-325 tag-link-position-35" style="font-size: 8pt;" aria-label="ruby (8 items)">ruby</a>
<a href="../tag/shell/index.html" class="tag-cloud-link tag-link-202 tag-link-position-36" style="font-size: 8.72pt;" aria-label="shell (10 items)">shell</a>
<a href="../tag/sublime-text/index.html" class="tag-cloud-link tag-link-76 tag-link-position-37" style="font-size: 8.4pt;" aria-label="sublime text (9 items)">sublime text</a>
<a href="../tag/ubuntu/index.html" class="tag-cloud-link tag-link-255 tag-link-position-38" style="font-size: 10.24pt;" aria-label="ubuntu (16 items)">ubuntu</a>
<a href="../tag/unicode/index.html" class="tag-cloud-link tag-link-53 tag-link-position-39" style="font-size: 8.4pt;" aria-label="unicode (9 items)">unicode</a>
<a href="../tag/unit-tests/index.html" class="tag-cloud-link tag-link-302 tag-link-position-40" style="font-size: 8.72pt;" aria-label="unit tests (10 items)">unit tests</a>
<a href="../tag/unpacking/index.html" class="tag-cloud-link tag-link-180 tag-link-position-41" style="font-size: 8pt;" aria-label="unpacking (8 items)">unpacking</a>
<a href="../tag/virtualenv/index.html" class="tag-cloud-link tag-link-259 tag-link-position-42" style="font-size: 9.04pt;" aria-label="virtualenv (11 items)">virtualenv</a>
<a href="../tag/wamp/index.html" class="tag-cloud-link tag-link-1039 tag-link-position-43" style="font-size: 10pt;" aria-label="wamp (15 items)">wamp</a>
<a href="../tag/web-2/index.html" class="tag-cloud-link tag-link-758 tag-link-position-44" style="font-size: 8pt;" aria-label="web (8 items)">web</a>
<a href="../tag/yield/index.html" class="tag-cloud-link tag-link-287 tag-link-position-45" style="font-size: 8.4pt;" aria-label="yield (9 items)">yield</a></div>
</aside><aside id="text-5" class="widget widget_text"><h3 class="widget-title"> Envoyez des sioux</h3>			<div class="textwidget"><p><img src="../wp-content/uploads/2013/07/bitcoin.png" width="16" height="16"/> On adooooore les bitcoins :</p>

<p>

<a href="bitcoin:19zAHPPuce4BAhsdy9KaFwVLurEJXMhMAn?amount=1X8&label=SamEtMax">19zAHPPuce4BAhsdy9KaFwVLurEJXMhMAn</a>

</p></div>
		</aside><aside id="nav_menu-3" class="widget widget_nav_menu"><h3 class="widget-title">Nos projets</h3><div class="menu-nos-projets-container"><ul id="menu-nos-projets" class="menu"><li id="menu-item-15841" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-15841"><a href="http://multiboards.net/">Multiboards &#8211; l&#8217;actu geek fr en une page</a></li>
<li id="menu-item-15837" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-15837"><a href="http://0bin.net">0bin &#8211; le pastebin chiffré</a></li>
<li id="menu-item-15838" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-15838"><a href="http://allthatcounts.net">All that counts &#8211; compteur pour jeux</a></li>
<li id="menu-item-15839" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-15839"><a href="https://github.com/sametmax/django-quicky">Django quicky &#8211; quick views for Django</a></li>
<li id="menu-item-15840" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-15840"><a href="https://github.com/sametmax/VizHash.js">VizHash.js &#8211; Hash visuels</a></li>
<li id="menu-item-15842" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-15842"><a href="https://github.com/sametmax/codes-des-articles">Code des articles du blog</a></li>
</ul></div></aside><aside id="text-11" class="widget widget_text"><h3 class="widget-title"> </h3>			<div class="textwidget"> </div>
		</aside><aside id="meta-3" class="widget widget_meta"><h3 class="widget-title">Meta</h3>			<ul>
						<li><a href="../wp-login.php.html">Log in</a></li>
			<li><a href="../feed.1">Entries <abbr title="Really Simple Syndication">RSS</abbr></a></li>
			<li><a href="../comments/feed/index.html">Comments <abbr title="Really Simple Syndication">RSS</abbr></a></li>
			<li><a href="https://wordpress.org/" title="Powered by WordPress, state-of-the-art semantic personal publishing platform.">WordPress.org</a></li>			</ul>
			</aside>                                              </div><!-- #left or #right-->
        </div><!--.tc-sidebar -->

        
        </div><!--.row -->
    </div><!-- .container role: main -->

    
</div><!--#main-wrapper"-->

		<!-- FOOTER -->
		<footer id="footer" class="">
		 					<div class="container footer-widgets ">
					<div class="row widget-area" role="complementary">
												
							<div id="footer_one" class="span4">
																
										<aside id="nav_menu-2" class="widget widget_nav_menu"><h3 class="widget-title">Hors du blog</h3><div class="menu-bottom-menu-container"><ul id="menu-bottom-menu" class="menu"><li id="menu-item-2391" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2391"><a href="../contactez-nous/index.html">Page de contact</a></li>
<li id="menu-item-12230" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-12230"><a href="http://twitter.com/sam_et_max">@sam_et_max sur twitter</a></li>
<li id="menu-item-12285" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-12285"><a href="http://bridge.suumitsu.eu/?action=display&#038;bridge=TwitterBridge&#038;u=sam_et_max&#038;format=AtomFormat">Nos tweets en RSS</a></li>
<li id="menu-item-12231" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-12231"><a href="https://github.com/sametmax/">Fork me, I&#8217;m famous (github)</a></li>
</ul></div></aside>
																							</div><!-- .{$key}_widget_class -->

						
							<div id="footer_two" class="span4">
																
										<aside id="text-8" class="widget widget_text">			<div class="textwidget">Tous les textes de ce blog, sauf signalement contraire, sont sous licence <a href="http://creativecommons.org/licenses/by/3.0/">creative common 3.0 unported</a>.</div>
		</aside>
																							</div><!-- .{$key}_widget_class -->

						
							<div id="footer_three" class="span4">
																
										<aside id="archives-2" class="widget widget_archive"><h3 class="widget-title">Toi aussi, trouve un article obsolète sur notre blog</h3>		<ul>
			<li><a href='../2019/09/index.html'>September 2019</a>&nbsp;(1)</li>
	<li><a href='../2019/06/index.html'>June 2019</a>&nbsp;(1)</li>
	<li><a href='../2019/02/index.html'>February 2019</a>&nbsp;(1)</li>
	<li><a href='../2019/01/index.html'>January 2019</a>&nbsp;(3)</li>
	<li><a href='../2018/12/index.html'>December 2018</a>&nbsp;(1)</li>
	<li><a href='../2018/09/index.html'>September 2018</a>&nbsp;(2)</li>
	<li><a href='../2018/08/index.html'>August 2018</a>&nbsp;(1)</li>
	<li><a href='../2018/07/index.html'>July 2018</a>&nbsp;(3)</li>
	<li><a href='../2018/06/index.html'>June 2018</a>&nbsp;(4)</li>
	<li><a href='../2018/05/index.html'>May 2018</a>&nbsp;(2)</li>
	<li><a href='../2018/03/index.html'>March 2018</a>&nbsp;(2)</li>
	<li><a href='../2018/02/index.html'>February 2018</a>&nbsp;(1)</li>
	<li><a href='../2017/12/index.html'>December 2017</a>&nbsp;(4)</li>
	<li><a href='../2017/11/index.html'>November 2017</a>&nbsp;(5)</li>
	<li><a href='../2017/10/index.html'>October 2017</a>&nbsp;(2)</li>
	<li><a href='../2017/09/index.html'>September 2017</a>&nbsp;(1)</li>
	<li><a href='../2017/07/index.html'>July 2017</a>&nbsp;(5)</li>
	<li><a href='../2017/06/index.html'>June 2017</a>&nbsp;(3)</li>
	<li><a href='../2017/05/index.html'>May 2017</a>&nbsp;(3)</li>
	<li><a href='../2017/04/index.html'>April 2017</a>&nbsp;(2)</li>
	<li><a href='../2017/03/index.html'>March 2017</a>&nbsp;(3)</li>
	<li><a href='../2017/02/index.html'>February 2017</a>&nbsp;(5)</li>
	<li><a href='../2017/01/index.html'>January 2017</a>&nbsp;(5)</li>
	<li><a href='../2016/10/index.html'>October 2016</a>&nbsp;(2)</li>
	<li><a href='../2016/09/index.html'>September 2016</a>&nbsp;(5)</li>
	<li><a href='../2016/08/index.html'>August 2016</a>&nbsp;(2)</li>
	<li><a href='../2016/03/index.html'>March 2016</a>&nbsp;(8)</li>
	<li><a href='../2016/02/index.html'>February 2016</a>&nbsp;(9)</li>
	<li><a href='../2016/01/index.html'>January 2016</a>&nbsp;(16)</li>
	<li><a href='../2015/12/index.html'>December 2015</a>&nbsp;(6)</li>
	<li><a href='../2015/11/index.html'>November 2015</a>&nbsp;(7)</li>
	<li><a href='../2015/10/index.html'>October 2015</a>&nbsp;(2)</li>
	<li><a href='../2015/09/index.html'>September 2015</a>&nbsp;(6)</li>
	<li><a href='../2015/08/index.html'>August 2015</a>&nbsp;(10)</li>
	<li><a href='../2015/07/index.html'>July 2015</a>&nbsp;(18)</li>
	<li><a href='../2015/06/index.html'>June 2015</a>&nbsp;(13)</li>
	<li><a href='../2015/05/index.html'>May 2015</a>&nbsp;(12)</li>
	<li><a href='../2015/04/index.html'>April 2015</a>&nbsp;(13)</li>
	<li><a href='../2015/03/index.html'>March 2015</a>&nbsp;(8)</li>
	<li><a href='../2015/02/index.html'>February 2015</a>&nbsp;(4)</li>
	<li><a href='../2015/01/index.html'>January 2015</a>&nbsp;(21)</li>
	<li><a href='../2014/12/index.html'>December 2014</a>&nbsp;(24)</li>
	<li><a href='../2014/11/index.html'>November 2014</a>&nbsp;(6)</li>
	<li><a href='../2014/10/index.html'>October 2014</a>&nbsp;(18)</li>
	<li><a href='../2014/09/index.html'>September 2014</a>&nbsp;(10)</li>
	<li><a href='../2014/08/index.html'>August 2014</a>&nbsp;(5)</li>
	<li><a href='../2014/07/index.html'>July 2014</a>&nbsp;(11)</li>
	<li><a href='../2014/06/index.html'>June 2014</a>&nbsp;(25)</li>
	<li><a href='../2014/05/index.html'>May 2014</a>&nbsp;(14)</li>
	<li><a href='../2014/04/index.html'>April 2014</a>&nbsp;(10)</li>
	<li><a href='../2014/03/index.html'>March 2014</a>&nbsp;(23)</li>
	<li><a href='../2014/02/index.html'>February 2014</a>&nbsp;(27)</li>
	<li><a href='../2014/01/index.html'>January 2014</a>&nbsp;(17)</li>
	<li><a href='../2013/12/index.html'>December 2013</a>&nbsp;(27)</li>
	<li><a href='../2013/11/index.html'>November 2013</a>&nbsp;(25)</li>
	<li><a href='../2013/10/index.html'>October 2013</a>&nbsp;(27)</li>
	<li><a href='../2013/09/index.html'>September 2013</a>&nbsp;(1)</li>
	<li><a href='../2013/08/index.html'>August 2013</a>&nbsp;(31)</li>
	<li><a href='../2013/07/index.html'>July 2013</a>&nbsp;(32)</li>
	<li><a href='../2013/06/index.html'>June 2013</a>&nbsp;(24)</li>
	<li><a href='../2013/05/index.html'>May 2013</a>&nbsp;(30)</li>
	<li><a href='../2013/04/index.html'>April 2013</a>&nbsp;(31)</li>
	<li><a href='../2013/03/index.html'>March 2013</a>&nbsp;(33)</li>
	<li><a href='../2013/02/index.html'>February 2013</a>&nbsp;(29)</li>
	<li><a href='../2013/01/index.html'>January 2013</a>&nbsp;(34)</li>
	<li><a href='../2012/12/index.html'>December 2012</a>&nbsp;(32)</li>
	<li><a href='../2012/11/index.html'>November 2012</a>&nbsp;(36)</li>
	<li><a href='../2012/10/index.html'>October 2012</a>&nbsp;(35)</li>
	<li><a href='../2012/09/index.html'>September 2012</a>&nbsp;(36)</li>
	<li><a href='../2012/08/index.html'>August 2012</a>&nbsp;(37)</li>
	<li><a href='../2012/07/index.html'>July 2012</a>&nbsp;(33)</li>
	<li><a href='../2012/06/index.html'>June 2012</a>&nbsp;(24)</li>
	<li><a href='../2012/05/index.html'>May 2012</a>&nbsp;(31)</li>
	<li><a href='../2012/04/index.html'>April 2012</a>&nbsp;(20)</li>
	<li><a href='../2012/03/index.html'>March 2012</a>&nbsp;(10)</li>
	<li><a href='../2012/02/index.html'>February 2012</a>&nbsp;(14)</li>
		</ul>
		</aside>
																							</div><!-- .{$key}_widget_class -->

																	</div><!-- .row.widget-area -->
				</div><!--.footer-widgets -->
				    				 <div class="colophon">
			 	<div class="container">
			 		<div class="row-fluid">
					    <div class="span4 social-block pull-left"><span class="tc-footer-social-links-wrapper" ><a class="social-icon icon-feed" href="../feed/rss/index.html" title="Subscribe to my rss feed"  ></a></span></div><div class="span4 credits"><p>&middot; &copy; 2019 <a href="../index.html" title="Sam &amp; Max" rel="bookmark">Sam &amp; Max</a> &middot; Designed by <a href="http://themesandco.com/">Themes &amp; Co</a> &middot;</p></div><div class="span4 backtop"><p class="pull-right"><a class="back-to-top" href="index.html#">Back to top</a></p></div>	      			</div><!-- .row-fluid -->
	      		</div><!-- .container -->
	      	</div><!-- .colophon -->
	    			</footer>
			<div style="display:none">
	<div class="grofile-hash-map-bf9ecde8f5e286de6ce5c80206cf9dd6">
	</div>
	<div class="grofile-hash-map-457d8df30dd9dd5d780126cf36830979">
	</div>
	<div class="grofile-hash-map-a508fd73270790a84a20898ad2387756">
	</div>
	<div class="grofile-hash-map-fc32c6686686ecc595f05ad1885c2fb3">
	</div>
	<div class="grofile-hash-map-d4e7ba319546752d8abd9a313768e038">
	</div>
	<div class="grofile-hash-map-bf9ecde8f5e286de6ce5c80206cf9dd6">
	</div>
	<div class="grofile-hash-map-2bac06aff1c7f742c9c988c5441885b1">
	</div>
	<div class="grofile-hash-map-049b059c7dff31bdc0877866d7d7a655">
	</div>
	<div class="grofile-hash-map-8169f391663dc03e4b4e017934fd6433">
	</div>
	</div>

	<script type="text/javascript">
		window.WPCOM_sharing_counts = {"http:\/\/sametmax.com\/explication-de-code-python-mss\/":9219};
	</script>
			<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
			<div id="fb-root"></div>
			<script>(function(d, s, id) { var js, fjs = d.getElementsByTagName(s)[0]; if (d.getElementById(id)) return; js = d.createElement(s); js.id = id; js.src = 'https://connect.facebook.net/en_US/sdk.js#xfbml=1&appId=249643311490&version=v2.3'; fjs.parentNode.insertBefore(js, fjs); }(document, 'script', 'facebook-jssdk'));</script>
			<script>
			jQuery( document.body ).on( 'post-load', function() {
				if ( 'undefined' !== typeof FB ) {
					FB.XFBML.parse();
				}
			} );
			</script>
						<script>
			function renderGooglePlus1() {
				if ( 'undefined' === typeof gapi ) {
					return;
				}

				jQuery( '.g-plus' ).each(function() {
					var $button = jQuery( this );

					if ( ! $button.data( 'gplus-rendered' ) ) {
						gapi.plusone.render( this, {
							href: $button.attr( 'data-href' ),
							size: $button.attr( 'data-size' ),
							annotation: $button.attr( 'data-annotation' )
						});

						$button.data( 'gplus-rendered', true );
					}
				});
			}

			(function() {
				var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
				po.src = 'https://apis.google.com/js/platform.js';
				po.innerHTML = '{"parsetags": "explicit"}';
				po.onload = renderGooglePlus1;
				var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
			})();

			jQuery( document.body ).on( 'post-load', renderGooglePlus1 );
			</script>
				<div id="sharing_email" style="display: none;">
		<form action="index.html" method="post">
			<label for="target_email">Send to Email Address</label>
			<input type="email" name="target_email" id="target_email" value="" />

			
				<label for="source_name">Your Name</label>
				<input type="text" name="source_name" id="source_name" value="" />

				<label for="source_email">Your Email Address</label>
				<input type="email" name="source_email" id="source_email" value="" />

						<input type="text" id="jetpack-source_f_name" name="source_f_name" class="input" value="" size="25" autocomplete="off" title="This field is for validation and should not be changed" />
			
			<img style="float: right; display: none" class="loading" src="../wp-content/plugins/jetpack/modules/sharedaddy/images/loading.gif" alt="loading" width="16" height="16" />
			<input type="submit" value="Send Email" class="sharing_send" />
			<a rel="nofollow" href="index.html#cancel" class="sharing_cancel">Cancel</a>

			<div class="errors errors-1" style="display: none;">
				Post was not sent - check your email addresses!			</div>

			<div class="errors errors-2" style="display: none;">
				Email check failed, please try again			</div>

			<div class="errors errors-3" style="display: none;">
				Sorry, your blog cannot share posts by email.			</div>
		</form>
	</div>
					<script type="text/javascript">
				// Pinterest shared resources
				var s = document.createElement("script");
				s.type = "text/javascript";
				s.async = true;
				s.setAttribute('data-pin-hover', true);				s.src = window.location.protocol + "//assets.pinterest.com/js/pinit.js";
				var x = document.getElementsByTagName("script")[0];
				x.parentNode.insertBefore(s, x);
				// if 'Pin it' button has 'counts' make container wider
				jQuery(window).load( function(){ jQuery( 'li.share-pinterest a span:visible' ).closest( '.share-pinterest' ).width( '80px' ); } );
			</script>
		<script type="text/javascript" src="https://platform.tumblr.com/v1/share.js"></script>		<script>
		// Don't use Pocket's default JS as it we need to force init new Pocket share buttons loaded via JS.
		function jetpack_sharing_pocket_init() {
			jQuery.getScript( 'https://widgets.getpocket.com/v1/j/btn.js?v=1' );
		}
		jQuery( document ).ready( jetpack_sharing_pocket_init );
		jQuery( document.body ).on( 'post-load', jetpack_sharing_pocket_init );
		</script>
		<script type='text/javascript'>
/* <![CDATA[ */
var wpcf7 = {"apiSettings":{"root":"http:\/\/sametmax.com\/wp-json\/contact-form-7\/v1","namespace":"contact-form-7\/v1"},"recaptcha":{"messages":{"empty":"Please verify that you are not a robot."}}};
/* ]]> */
</script>
<script type='text/javascript' src='../wp-content/plugins/contact-form-7/includes/js/scripts.js%3Fver=5.0.2'></script>
<script type='text/javascript' src='https://s0.wp.com/wp-content/js/devicepx-jetpack.js?ver=201936'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var pollsL10n = {"ajax_url":"http:\/\/sametmax.com\/wp-admin\/admin-ajax.php","text_wait":"Your last request is still being processed. Please wait a while ...","text_valid":"Please choose a valid poll answer.","text_multiple":"Maximum number of choices allowed: ","show_loading":"1","show_fading":"1"};
/* ]]> */
</script>
<script type='text/javascript' src='../wp-content/plugins/wp-polls/polls-js.js%3Fver=2.73.8'></script>
<script type='text/javascript' src='../wp-content/plugins/wp-syntax/js/wp-syntax.js%3Fver=1.1'></script>
<script type='text/javascript' src='https://secure.gravatar.com/js/gprofiles.js?ver=2019Sepaa'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var WPGroHo = {"my_hash":""};
/* ]]> */
</script>
<script type='text/javascript' src='../wp-content/plugins/jetpack/modules/wpgroho.js%3Fver=4.9.7'></script>
<script type='text/javascript' src='../wp-includes/js/comment-reply.min.js%3Fver=4.9.7'></script>
<script type='text/javascript' src='../wp-includes/js/jquery/ui/core.min.js%3Fver=1.11.4'></script>
<script type='text/javascript' src='../wp-content/themes/customizr/inc/assets/js/modernizr.min.js%3Fver=3.2.10'></script>
<script type='text/javascript' src='../wp-content/themes/customizr/inc/assets/js/retina.min.js%3Fver=3.2.10'></script>
<script type='text/javascript' src='../wp-includes/js/wp-embed.min.js%3Fver=4.9.7'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var sharing_js_options = {"lang":"en","counts":"1"};
/* ]]> */
</script>
<script type='text/javascript' src='../wp-content/plugins/jetpack/_inc/build/sharedaddy/sharing.min.js%3Fver=6.3.2'></script>
<script type='text/javascript'>
var windowOpen;
			jQuery( document.body ).on( 'click', 'a.share-facebook', function() {
				// If there's another sharing window open, close it.
				if ( 'undefined' !== typeof windowOpen ) {
					windowOpen.close();
				}
				windowOpen = window.open( jQuery( this ).attr( 'href' ), 'wpcomfacebook', 'menubar=1,resizable=1,width=600,height=400' );
				return false;
			});
</script>
<script type='text/javascript' src='https://stats.wp.com/e-201936.js' async='async' defer='defer'></script>
<script type='text/javascript'>
	_stq = window._stq || [];
	_stq.push([ 'view', {v:'ext',j:'1:6.3.2',blog:'32490438',post:'9219',tz:'0',srv:'sametmax.com'} ]);
	_stq.push([ 'clickTrackerInit', '32490438', '9219' ]);
</script>
<div class="tc-btt-wrapper"><i class="btt-arrow" style="color:#394143"></i></div>	</body>
	</html>