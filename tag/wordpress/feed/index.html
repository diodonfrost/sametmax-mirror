<?xml version="1.0" encoding="UTF-8"?><rss version="2.0"
	xmlns:content="http://purl.org/rss/1.0/modules/content/"
	xmlns:wfw="http://wellformedweb.org/CommentAPI/"
	xmlns:dc="http://purl.org/dc/elements/1.1/"
	xmlns:atom="http://www.w3.org/2005/Atom"
	xmlns:sy="http://purl.org/rss/1.0/modules/syndication/"
	xmlns:slash="http://purl.org/rss/1.0/modules/slash/"
	xmlns:georss="http://www.georss.org/georss" xmlns:geo="http://www.w3.org/2003/01/geo/wgs84_pos#" >

<channel>
	<title>wordpress &#8211; Sam &amp; Max</title>
	<atom:link href="http://sametmax.com/tag/wordpress/feed/" rel="self" type="application/rss+xml" />
	<link>http://sametmax.com</link>
	<description>Du code, du cul</description>
	<lastBuildDate>Thu, 05 Sep 2019 08:22:03 +0000</lastBuildDate>
	<language>en-US</language>
	<sy:updatePeriod>hourly</sy:updatePeriod>
	<sy:updateFrequency>1</sy:updateFrequency>
	<generator>https://wordpress.org/?v=4.9.7</generator>
<site xmlns="com-wordpress:feed-additions:1">32490438</site>	<item>
		<title>Le blog a été migré (enfin presque)</title>
		<link>http://sametmax.com/le-blog-a-ete-migre-enfin-presque/</link>
		<comments>http://sametmax.com/le-blog-a-ete-migre-enfin-presque/#comments</comments>
		<pubDate>Tue, 23 Sep 2014 12:18:43 +0000</pubDate>
		<dc:creator><![CDATA[Sam]]></dc:creator>
				<category><![CDATA[Philo et culture]]></category>
		<category><![CDATA[blog]]></category>
		<category><![CDATA[meta]]></category>
		<category><![CDATA[mi-figue]]></category>
		<category><![CDATA[mi-raisin]]></category>
		<category><![CDATA[migraine]]></category>
		<category><![CDATA[migration]]></category>
		<category><![CDATA[wordpress]]></category>

		<guid isPermaLink="false">http://sametmax.com/?p=12217</guid>
		<description><![CDATA[En gros, vous pouvez de nouveau lire vos articles techniques préférés. Et les autres aussi.
]]></description>
				<content:encoded><![CDATA[<p>Max a pris l&#8217;hébergement et a setup Varnish (sans lequel le WP s&#8217;écroule sous la masse de vos pattes velues), puis j&#8217;ai installé WP 4, et migré la DB et les images.</p>
<p>En gros, vous pouvez de nouveau lire vos articles techniques préférés. Et les autres aussi.</p>
<p>Par contre, feu notre ancien thème (snif, il était si&#8230; si&#8230; attachant&#8230;), et donc tous les easter eggs qui vont avec.</p>
<p>Vous noterez donc un blog moins fun, avec des bugs graphiques et surtout, sans plugins, donc ouvert aux 4 vents aux spams mais sans formulaire de contact. Mouarf.</p>
<p>Je vais corriger ça petit à petit, mais je ne me presse pas, l&#8217;avantage d&#8217;écrire un blog bénévole est qu&#8217;on ne doit rien à personne, donc on peut se gratter les couilles.</p>
<p>0bin, multiboards et allthatcount vont suivre. Je vais probablement les migrer avant de m&#8217;attaquer à la corrections des petits problèmes du blog d&#8217;ailleurs.</p>
<p>La base de données complète a été migrée. Félicitation à l&#8217;équipe de WP pour avoir mis en œuvre un outil de conversion des tables d&#8217;une version à l&#8217;autre parfaitement transparent. C&#8217;est pas facile à faire, et ça marche super bien. Mettez l&#8217;article en favoris, je ne dirais pas souvent du bien de cet outil.</p>
<p>Ça signifie que vos commentaires sont là, les pages statiques aussi, et bien entendu, pour les contributeurs, leurs comptes utilisateurs également. Il y a eu un bug de login ce matin, mais c&#8217;est réparé.</p>
<p>Si vous voyez des trucs qui pètent, merci de les lister en comment ici que je puisse avoir une check list à jour et sans doublons. Avec les URLS c&#8217;est mieux.</p>
<p>Parmi les problèmes que je vois venir : les iframes qui marchent pas, la barre de menu de droite qui déconne, et autres joyeusetés, des médias de mauvaise taille.</p>
<p>Et bonne lecture :)</p>
]]></content:encoded>
			<wfw:commentRss>http://sametmax.com/le-blog-a-ete-migre-enfin-presque/feed/</wfw:commentRss>
		<slash:comments>27</slash:comments>
	<post-id xmlns="com-wordpress:feed-additions:1">12217</post-id><enclosure url="http://sametmax.com/wp-content/uploads/2014/09/discours-1940-1946.jpg" length="13887" type="image/jpg" />	</item>
		<item>
		<title>Initiation à Varnish &#8211; Accélerer un blog WordPress</title>
		<link>http://sametmax.com/initiation-a-varnish-accelerer-un-blog-wordpress/</link>
		<comments>http://sametmax.com/initiation-a-varnish-accelerer-un-blog-wordpress/#comments</comments>
		<pubDate>Sun, 31 Mar 2013 08:54:54 +0000</pubDate>
		<dc:creator><![CDATA[Max]]></dc:creator>
				<category><![CDATA[Administration System]]></category>
		<category><![CDATA[Web]]></category>
		<category><![CDATA[nginx]]></category>
		<category><![CDATA[varnish]]></category>
		<category><![CDATA[wordpress]]></category>

		<guid isPermaLink="false">http://sametmax.com/?p=4416</guid>
		<description><![CDATA[Wordpress est devenu une usine à gaz avec le temps. Naviguer sur un blog sous Wordpress peut devenir pénible lorsque ce dernier a beaucoup de contenu ou de visiteurs. Des plugins censés mettre en cache les pages existent comme WP Cache, il y a aussi une façon d'attaquer le problème autrement avec Varnish.]]></description>
				<content:encoded><![CDATA[<p><a href="https://www.varnish-cache.org/">Varnish</a> est un service qui permet de mettre en cache (sur disque ou en mémoire) certains contenus de votre site. Beaucoup de gros sites l&#8217;utilisent pour sa puissance et ses options de configuration.<br />
Il est plutôt facile à installer mais ça se corse lorsqu&#8217;il faut le configurer car il peut ne rien cacher du tout, surtout avec la config par défaut.</p>
<p>Nous allons voir ici une configuration pour un site sous WordPress avec un serveur Nginx, Varnish étant placé en Front c&#8217;est à dire devant Nginx (il y a aussi le mode sandwich Nginx / Varnish / Backend).</p>
<p><img class="aligncenter size-full wp-image-4417" title="Varnish en Front" src="http://sametmax.com/wp-content/uploads/2013/02/varnish.png" alt="" width="580" height="272" /></p>
<p><strong>Installation de Varnish sous ubuntu:<br />
</strong></p>
<pre lang="bash">
sudo apt-get install varnish
</pre>
<p>Il y a 2 fichiers qu&#8217;il faut retenir pour Varnish, le fichier avec les règles et le fichier de config du service.<br />
<strong><br />
Configurer le service, On va faire en sorte que Varnish écoute sur le port 80:</strong></p>
<pre lang="bash">
vi /etc/default/varnish
</pre>
<pre lang="bash">
DAEMON_OPTS="-a :80 \
             -T localhost:6082 \
             -f /etc/varnish/default.vcl \
             -S /etc/varnish/secret \
             -s malloc,256m"
</pre>
<p>Trouvez cette ligne dans le fichier de conf et mettez 80 pour l&#8217;option -a.<br />
<em>malloc</em> va sauver le cache en mémoire à hauteur de 256 MB, on peut sauvegarder sur disque si on a un SSD (ex: -s file,/var/lib/varnish/varnish_storage.bin,1G&#8221;).</p>
<p><strong>Configurer les règles de cache:</strong></p>
<pre lang="bash">
vi /etc/varnish/default.vcl
</pre>
<pre lang="bash">
#
# Varnish 3 configuration for WordPress
#
# On Debian OS:  /etc/varnish/default.vcl
#
# Nicolas Hennion (aka) Nicolargo
#

# Set the default backend (Nginx server for me)
backend default {
	# My Nginx server listen on IP address 127.0.0.1 and TCP port 8080
	.host = "127.0.0.1";
	.port = "8080";
	# Increase guru timeout
	# http://vincentfretin.ecreall.com/articles/varnish-guru-meditation-on-timeout
	.first_byte_timeout = 300s;
}

# This function is used when a request is send by a HTTP client (Browser) 
sub vcl_recv {
	# Block the forbidden IP addresse
	if (client.ip ~ forbidden) {
        	error 403 "Forbidden";
	}

	# Only cache the following sites
	if ((req.http.host ~ "(sametmax.com)")) { 
		set req.backend = default; 
	} else { 
		return (pass); 
	}

	# Normalize the header, remove the port (in case you're testing this on various TCP ports)
	set req.http.Host = regsub(req.http.Host, ":[0-9]+", "");

	# Post requests will not be cached
	if (req.http.Authorization || req.request == "POST") {
		return (pass);
	}

	# --- WordPress specific configuration
	
	# Did not cache the RSS feed
	if (req.url ~ "/feed") {
		return (pass);
	}

	# Blitz hack
        if (req.url ~ "/mu-.*") {
                return (pass);
        }

	
	# Did not cache the admin and login pages
	if (req.url ~ "/wp-(login|admin)") {
		return (pass);
	}

	# Remove the "has_js" cookie
	set req.http.Cookie = regsuball(req.http.Cookie, "has_js=[^;]+(; )?", "");

	# Remove any Google Analytics based cookies
	set req.http.Cookie = regsuball(req.http.Cookie, "__utm.=[^;]+(; )?", "");

	# Remove the Quant Capital cookies (added by some plugin, all __qca)
	set req.http.Cookie = regsuball(req.http.Cookie, "__qc.=[^;]+(; )?", "");

	# Remove the wp-settings-1 cookie
	set req.http.Cookie = regsuball(req.http.Cookie, "wp-settings-1=[^;]+(; )?", "");

	# Remove the wp-settings-time-1 cookie
	set req.http.Cookie = regsuball(req.http.Cookie, "wp-settings-time-1=[^;]+(; )?", "");

	# Remove the wp test cookie
	set req.http.Cookie = regsuball(req.http.Cookie, "wordpress_test_cookie=[^;]+(; )?", "");

	# Are there cookies left with only spaces or that are empty?
	if (req.http.cookie ~ "^ *$") {
		    unset req.http.cookie;
	}
	
	# Cache the following files extensions 
	if (req.url ~ "\.(css|js|png|gif|jp(e)?g|swf|ico)") {
		unset req.http.cookie;
	}

	# Normalize Accept-Encoding header and compression
	# https://www.varnish-cache.org/docs/3.0/tutorial/vary.html
	if (req.http.Accept-Encoding) {
		# Do no compress compressed files...
		if (req.url ~ "\.(jpg|png|gif|gz|tgz|bz2|tbz|mp3|ogg)$") {
			   	remove req.http.Accept-Encoding;
		} elsif (req.http.Accept-Encoding ~ "gzip") {
		    	set req.http.Accept-Encoding = "gzip";
		} elsif (req.http.Accept-Encoding ~ "deflate") {
		    	set req.http.Accept-Encoding = "deflate";
		} else {
			remove req.http.Accept-Encoding;
		}
	}

	# Check the cookies for wordpress-specific items
	if (req.http.Cookie ~ "wordpress_" || req.http.Cookie ~ "comment_") {
		return (pass);
	}
	if (!req.http.cookie) {
		unset req.http.cookie;
	}
	
	# --- End of WordPress specific configuration

	# Did not cache HTTP authentication and HTTP Cookie
	if (req.http.Authorization || req.http.Cookie) {
		# Not cacheable by default
		return (pass);
	}

	# Define the default grace period to serve cached content
	set req.grace = 30s;
	
	# Cache all others requests
	return (lookup);
}
 
sub vcl_pipe {
	return (pipe);
}
 
sub vcl_pass {
	return (pass);
}
 
# The data on which the hashing will take place
sub vcl_hash {
 	hash_data(req.url);
 	if (req.http.host) {
     	hash_data(req.http.host);
 	} else {
     	hash_data(server.ip);
 	}

	# If the client supports compression, keep that in a different cache
    	if (req.http.Accept-Encoding) {
        	hash_data(req.http.Accept-Encoding);
	}
     
	return (hash);
}
 
# This function is used when a request is sent by our backend (Nginx server)
sub vcl_fetch {
	# Remove some headers we never want to see
	unset beresp.http.Server;
	unset beresp.http.X-Powered-By;

	# For static content strip all backend cookies
	if (req.url ~ "\.(css|js|png|gif|jp(e?)g)|swf|ico") {
		unset beresp.http.cookie;
	}

	# Only allow cookies to be set if we're in admin area
	if (beresp.http.Set-Cookie && req.url !~ "^/wp-(login|admin)") {
        	unset beresp.http.Set-Cookie;
    	}

	# don't cache response to posted requests or those with basic auth
	if ( req.request == "POST" || req.http.Authorization ) {
        	return (hit_for_pass);
    	}
 
    	# don't cache search results
	if ( req.url ~ "\?s=" ){
		return (hit_for_pass);
	}
    
	# only cache status ok
	if ( beresp.status != 200 ) {
		return (hit_for_pass);
	}

	# A TTL of 24h
	set beresp.ttl = 24h;
	
	return (deliver);
}
 
# The routine when we deliver the HTTP request to the user
# Last chance to modify headers that are sent to the client
sub vcl_deliver {
	if (obj.hits > 0) { 
		set resp.http.X-Cache = "cached";
	} else {
		set resp.http.x-Cache = "uncached";
	}

	# Remove some headers: PHP version
	unset resp.http.X-Powered-By;

	# Remove some headers: Apache version & OS
	unset resp.http.Server;

	# Remove some heanders: Varnish
	unset resp.http.Via;
	unset resp.http.X-Varnish;

	return (deliver);
}
 
sub vcl_init {
 	return (ok);
}
 
sub vcl_fini {
 	return (ok);
}
</pre>
<p>Avant toute chose voici la doc :) : <a href="https://www.varnish-cache.org/docs/3.0/">https://www.varnish-cache.org/docs/3.0/</a><br />
Ce qu&#8217;il faut retenir de ce fichier de règles c&#8217;est les parties normalisation, enlever les cookies inutiles (car si cookie alors pas de cache) et ne pas mettre en cache l&#8217;admin. Cette config tourne actuellement sur S&#038;M.</p>
<p>Un point intéressant c&#8217;est le debug, vous pouvez mettre un <em>set resp.http.X-Cache = &#8220;cached&#8221;;</em> et vérifier les headers de votre serveur dans le debug de votre navigateur pour savoir si oui ou non la page servie est en cache.</p>
<p><strong>L&#8217;admin varnish en ligne de commande:</strong><br />
Varnish possède une admin en ligne de commande où l&#8217;on peut par exemple purger le cache d&#8217;une ou plusieurs pages.<br />
Tapez <em>varnishadm</em> dans le shell:</p>
<pre lang="bash">
varnishadm
200        
-----------------------------
Varnish Cache CLI 1.0
-----------------------------
Linux,3.2.0-25-virtual,x86_64,-smalloc,-smalloc,-hcritbit

Type 'help' for command list.
Type 'quit' to close CLI session.

varnish> ban.url /toto/ma-page.php
</pre>
<p>Pour purger une page on va utiliser la commande ban.url et y ajouter une partie de l&#8217;url à purger. On peut utiliser un ban en appelant également une url de purge avec Curl ou Wget pour les automations, il y a un excellent article <a href="http://binbash.fr/2011/11/15/purger-le-cache-de-varnish-3/">sur la purge ici.</a></p>
<p><strong>Configurer Nginx:</strong><br />
Une fois varnish installé, on va modifier un peu nginx pour que la liaison puisse se faire. Ci-dessous l&#8217;exemple de notre conf nginx.</p>
<pre lang="bash">

server {
    listen      8080;
    server_name  sametmax.com  ;
    root         /unrep/sametmax/;  # absolute path to your WordPress installation
    index index.php index.html;
    set_real_ip_from        127.0.0.1;
    real_ip_header          X-Forwarded-For;

    location ~ \.php$ {
        include        /etc/nginx/fastcgi_params;
        fastcgi_pass   127.0.0.1:53217;
        fastcgi_index index.php;
        fastcgi_buffers 8 16k;
        fastcgi_buffer_size 32k;
        fastcgi_param  SCRIPT_FILENAME  $document_root$fastcgi_script_name;
    }

</pre>
<p>Pour PHP on utilise spawn-fcgi que l&#8217;on gère avec <a href="http://supervisord.org/">supervisor</a> dont voici la conf dans /etc/supervisord.conf</p>
<pre lang="bash">
[program:php5-cgi]
command=/usr/local/bin/spawn-fcgi -u adolf -n -a 127.0.0.1 -p 53217 -P /tmp/fastcgi-php.pid -F 4 -- /usr/bin/php-cgi
redirect_stderr=true          ; redirect proc stderr to stdout (default false)
user=sametmax
autostart=true
autorestart=true
startsecs=10
startretries=9999999999999
stdout_logfile=/var/log/php5-cgi/php5-cgi.log
stdout_logfile_maxbytes=10MB   ; max # logfile bytes b4 rotation (default 50MB)
</pre>
<p><strong>Pour résumer:</strong></p>
<p>Dans cette configuration Varnish est en front end et va décider quand servir une page prise dans le cache (disque dur ou RAM) et quand interroger le backend pour servir une nouvelle page.<br />
Sur d&#8217;autres sites à fort trafic on a mis Nginx en front end car il encaisse beaucoup plus les hits et qu&#8217;il fait très bien le boulot pour servir des pages statiques.</p>
<p><strong>Attention!</strong><br />
Même si Varnish n&#8217;est pas compliqué à installer il peut être un vrai casse-tête quand il s&#8217;agit de cacher des pages. Pensez donc bien à normaliser vos headers (user-agent, gzip, etc), utilisez le debug.<br />
Bien configuré Varnish vous booste un serveur avec une réélle efficacité, il nous a sauvé 2 sites jusqu&#8217;à présent, ça sera d&#8217;ailleurs un standard sur nos prochains sites.</p>
]]></content:encoded>
			<wfw:commentRss>http://sametmax.com/initiation-a-varnish-accelerer-un-blog-wordpress/feed/</wfw:commentRss>
		<slash:comments>6</slash:comments>
	<post-id xmlns="com-wordpress:feed-additions:1">4416</post-id><enclosure url="http://sametmax.com/wp-content/uploads/2013/03/back_to_the_future.jpg" length="23411" type="image/jpg" />	</item>
		<item>
		<title>Migrer wordpress d&#8217;un serveur à un autre &#8211; Pense-bête</title>
		<link>http://sametmax.com/migrer-wordpress-dun-serveur-a-un-autre-pense-bete/</link>
		<comments>http://sametmax.com/migrer-wordpress-dun-serveur-a-un-autre-pense-bete/#comments</comments>
		<pubDate>Wed, 09 Jan 2013 08:59:03 +0000</pubDate>
		<dc:creator><![CDATA[Max]]></dc:creator>
				<category><![CDATA[Administration System]]></category>
		<category><![CDATA[migration]]></category>
		<category><![CDATA[ubuntu]]></category>
		<category><![CDATA[wordpress]]></category>

		<guid isPermaLink="false">http://sametmax.com/?p=4050</guid>
		<description><![CDATA[Quand on migre wordpress d'un serveur à autre sans vouloir se taper la réinstall il y a deux trois trucs à pas oublier...]]></description>
				<content:encoded><![CDATA[<p>Si on veut changer de serveur sans se taper la réinstall de wordpress ça peut devenir casse-tête si on oublie deux trois trucs&#8230;</p>
<p>Voici un petit pense-bête avec pour exemple une config Nginx / WordPress / php5-cgi  sur Ubuntu.</p>
<p>serveura.com = serveur sur lequel se trouve l&#8217;ancien WordPress à migrer<br />
serveurb.com = nouveau serveur qui va accueillir WordPress</p>
<p><strong>1. on sauve la db et on l&#8217;upload sur le nouveau serveur (on peut le faire à la fin si le blog a pas mal d&#8217;activité)</strong><br />
Sur le serveur A:</p>
<pre lang="bash">
mysqldump -u user_toto -ppass_toto base_a_toto > /tmp/base_a_toto.sql
rsync -P -azc /tmp/base_a_toto.sql user@serveurb.com:/tmp/base_a_toto.sql</pre>
<p><strong>2. On copie wordpress sur le nouveau serveur</strong><br />
Sur le serveur A:</p>
<pre lang="bash">
rsync -P -azc /home/monsite/wordpress/ user@serveurb.com:/home/monsite/
</pre>
<p><strong>3. Setup et configuration du nouveau serveur</strong><br />
Sur le serveur B:<br />
Installer les packets necessaires:</p>
<pre lang="bash">
apt-get install php5-cgi php5-mysql mysql-server nginx spawn-fcgi sendmail
</pre>
<p>Il faut lancer les services nginx et spawn-cgi (pour ce dernier on peut utiliser <a href="http://supervisord.org/">supervisord</a>)</p>
<p>Nginx:<br />
Editer le fichier /etc/nginx/conf.d/monsite.conf . Attention à bien indiquer le chemin absolu vers votre site pour <em>root</em></p>
<pre lang="bash">
server {
    listen      80;
    server_name  monsite.com www.monsite.com;                   # your domain name
    root         /home/monsite/wordpress;  # absolute path to your WordPress installation
    index index.php index.html;
    
    error_log "/var/log/nginx_error.log";
    access_log  "/var/log/nginx_access.log";

    try_files $uri $uri/ /index.php;

    location ~ \.php$ {
        include        /etc/nginx/fastcgi_params;
        fastcgi_pass   127.0.0.1:53217;
        fastcgi_index index.php;
        fastcgi_buffers 8 16k;
        fastcgi_buffer_size 32k;
        fastcgi_param  SCRIPT_FILENAME  $document_root$fastcgi_script_name;
    }

location = /robots.txt {
        allow all;
        log_not_found off;
        access_log off;
}

# Deny all attempts to access hidden files such as .htaccess, .htpasswd, .DS_Store (Mac).
location ~ /\. {
        deny all;
        access_log off;
        log_not_found off;
}

# Deny access to any files with a .php extension in the uploads directory
location ~* ^/wp-content/uploads/.*.php$ {
        deny all;
        access_log off;
        log_not_found off;
}

# Deny access to any files with a .php extension in the uploads directory for multisite
location ~* /files/(.*).php$ {
        deny all;
        access_log off;
        log_not_found off;
}

}

</pre>
<p><a href="http://serverfault.com/questions/6733/php-what-are-the-advantages-of-fastcgi-over-mod-php">Spawn-Fcgi</a>: C&#8217;est lui qui va lancer php5-cgi pour faire la liaison entre php et nginx. on va le lancer avec supervisor comme si c&#8217;était un service mais mieux.</p>
<p>Installation de Supervisor:</p>
<pre lang="bash">
apt-get install python-setuptools
easy_install supervisor
echo_supervisord_conf > /etc/supervisord.conf
</pre>
<p>Editez le fichier /etc/supervisord.conf pour y rajouter spawn-fcgi, c&#8217;est mieux de lancer php5-cgi avec un user autre que root (www-data ou autre) :</p>
<pre lang="bash">
[program:php5-cgi]
command=/usr/local/bin/spawn-fcgi -n -a 127.0.0.1 -p 53217 -u www-data -f /usr/bin/php5-cgi
redirect_stderr=true 
stdout_logfile=/var/log/php5-cgi.log
stdout_logfile_maxbytes=10MB 
</pre>
<p>Pour lancer Spawn-fcgi:</p>
<pre lang="bash">
supervisorctl restart php5-cgi
</pre>
<p>Mysql: on ajoute mysql au demarrage et on le lance</p>
<pre lang="bash">
chkconfig mysql on
service mysql start
</pre>
<p>Dump de la DB: il faut créer un user et une base sur la nouvelle install, si possible le même que sur l&#8217;ancien serveur pour faciliter la transition.<br />
Sur le serveur B:</p>
<pre lang="bash">
mysql -u root -prootpass
Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 42
Server version: 5.5.28-0ubuntu0.12.04.3 (Ubuntu)

Copyright (c) 2000, 2012, Oracle and/or its affiliates. All rights reserved.

Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

mysql> create database base_a_toto;
Query OK, 1 row affected (0.00 sec)

mysql> GRANT ALL PRIVILEGES ON base_a_toto.* TO "user_toto"@"localhost" identified by "pass_toto";

Query OK, 0 rows affected (16.16 sec)

mysql> FLUSH PRIVILEGES;
Query OK, 0 rows affected (0.00 sec)
</pre>
<p>Et on importe la base de données de serveura.com:</p>
<pre lang="bash">
mysql -u user_toto -ppass_toto base_a_toto < /tmp/base_a_toto.sql 
</pre>
<p><strong>4. Changer les dns</strong><br />
des fois on oublie :) alors changez les dns et attendez un peu, normallement ça devrait crystalliser...</p>
<p>Ca prend pas 5 minutes, même avec les paquets tous prêts. on peut avoir de mauvaises surprises en route. Moi par exemple erreur 500 , pour m'aperçevoir au bout de 2 heures que j'avais pas installé php5-mysql d'où ce tuto ;)</p>
]]></content:encoded>
			<wfw:commentRss>http://sametmax.com/migrer-wordpress-dun-serveur-a-un-autre-pense-bete/feed/</wfw:commentRss>
		<slash:comments>14</slash:comments>
	<post-id xmlns="com-wordpress:feed-additions:1">4050</post-id><enclosure url="http://sametmax.com/wp-content/uploads/2013/01/migration1.jpg" length="79816" type="image/jpg" />	</item>
		<item>
		<title>WordPress, je te hais</title>
		<link>http://sametmax.com/wordpress-je-te-hais/</link>
		<comments>http://sametmax.com/wordpress-je-te-hais/#comments</comments>
		<pubDate>Wed, 18 Jul 2012 16:29:31 +0000</pubDate>
		<dc:creator><![CDATA[Sam]]></dc:creator>
				<category><![CDATA[Programmation]]></category>
		<category><![CDATA[php]]></category>
		<category><![CDATA[wordpress]]></category>

		<guid isPermaLink="false">http://sametmax.com/?p=1203</guid>
		<description><![CDATA[Cherchant à rendre le formulaire commentaires de Sam et Max plus ergonomique, j'ai jeté un coup d'oeil sur le template lié.]]></description>
				<content:encoded><![CDATA[<p>Cherchant à rendre le formulaire commentaires de Sam et Max plus ergonomique, j&#8217;ai jeté un coup d&#8217;oeil sur le template lié.</p>
<p>L&#8217;intégralité du code qui génère le formulaire pourri que vous voyez sous l&#8217;article est ici:</p>
<pre lang="php"><?php if ('open' == $post->comment_status) : ?>
        <?php comment_form( array('label_submit' => esc_attr__( 'Submit Comment', 'Minimal' ), 'title_reply' => '<span>' . esc_attr__( 'Leave a Reply', 'Minimal' ) . '</span>', 'title_reply_to' => esc_attr__( 'Leave a Reply to %s' )) ); ?>
<?php else: ?>

<?php endif; // if you delete this the sky will fall on your head ?>
</div> <!-- end comment-section --></pre>
<p>Je vous passe le commentaire amical qui stipule &#8220;<q>si vous supprimez ceci le ciel vous tombera sur la tête</q>&#8221; et toute remarque désobligeante sur le formatage absolument bordélique de l&#8217;intégralité du fichier.</p>
<p>Non, je reste optimise, je vois un <code>comment_form</code> qui encapsule la génération du formulaire. Peut être une API propre ? J&#8217;ai bon espoir (mais le fait que ce soit une fonction et non une classe aurait du me mettre la puce à l&#8217;oreille).</p>
<p>Je trouve un <a href="http://www.1stwebdesigner.com/wordpress/comment-form-customization/">très bon article</a> qui explique où on trouve ce merveilleux <code>comment_form</code> (ben oui parceque les includes et autoloads en PHP c&#8217;est pas vraiment le truc le plus top pour retrouver la chaîne de dépendances). Et là, je n&#8217;ai rien supprimé, mais le ciel m&#8217;est quand même tombé sur la gueule. Et toute la couche d&#8217;ozone avec.</p>
<p>La valeur par défaut d&#8217;UN des paramètres de la fonction qui génère le formulaire, c&#8217;est ça :</p>
<pre lang="php"><?php $defaults = array( 'fields' => apply_filters( 'comment_form_default_fields', array(
    'author' => '<p class="comment-form-author">' .
                '<label for="author">' . __( 'Name' ) . '</label> ' .
                ( $req ? '<span class="required">*</span>' : '' ) .
                '<input id="author" name="author" type="text" value="' .
                esc_attr( $commenter['comment_author'] ) . '" size="30" tabindex="1"' . $aria_req . ' />' .
                '</p><!-- #form-section-author .form-section -->',
    'email'  => '<p class="comment-form-email">' .
                '<label for="email">' . __( 'Email' ) . '</label> ' .
                ( $req ? '<span class="required">*</span>' : '' ) .
                '<input id="email" name="email" type="text" value="' . esc_attr(  $commenter['comment_author_email'] ) . '" size="30" tabindex="2"' . $aria_req . ' />' .
                '</p><!-- #form-section-email .form-section -->',
    'url'    => '
<p class="comment-form-url">' .</p>

                '<label for="url">' . __( 'Website' ) . '</label>' .
                '<input id="url" name="url" type="text" value="' . esc_attr( $commenter['comment_author_url'] ) . '" size="30" tabindex="3" />' .
                '

<!-- #<span class="hiddenSpellError" pre="">form-section-url</span> .form-section -->' ) ),
    'comment_field' => '<p class="comment-form-comment">' .
                '<label for="comment">' . __( 'Comment' ) . '</label>' .
                '<textarea id="comment" name="comment" cols="45" rows="8" tabindex="4" aria-required="true"></textarea>' .
                '</p><!-- #form-section-comment .form-section -->',
    'must_log_in' => '
<p class="must-log-in">' .  sprintf( __( 'You must be <a href="%s">logged in</a> to post a comment.' ), wp_login_url( apply_filters( 'the_permalink', get_permalink( $post_id ) ) ) ) . '</p>

',
    'logged_in_as' => '
<p class="logged-in-as">' . sprintf( __( 'Logged in as <a href="%s">%s</a>. <a title="Log out of this account" href="%s">Log out?</a></p>

' ), admin_url( 'profile.php' ), $user_identity, wp_logout_url( apply_filters( 'the_permalink', get_permalink( $post_id ) ) ) ),
    'comment_notes_before' => '<p class="comment-notes">' . __( 'Your email is <em>never</em> published nor shared.' ) . ( $req ? __( ' Required fields are marked <span class="required">*</span>' ) : '' ) . '</p>',
    'comment_notes_after' => '<dl class="form-allowed-tags"><dt>' . __( 'You may use these <abbr title="HyperText Markup Language">HTML</abbr> tags and attributes:' ) . '</dt> <dd><code>' . allowed_tags() . '</code></dd>',
    'id_form' => 'commentform',
    'id_submit' => 'submit',
    'title_reply' => __( 'Leave a Reply' ),
    'title_reply_to' => __( 'Leave a Reply to %s' ),
    'cancel_reply_link' => __( 'Cancel reply' ),
    'label_submit' => __( 'Post Comment' ),
); ?></pre>
<p>Je ne sais pas ce qui me rend le plus malade.</p>
<p>L&#8217;absence totale de la notion de template ?</p>
<p>Le fait qu&#8217;on passe l&#8217;intégralité du code HTML en PARAMETRE à une fonction qui est censée générer le formulaire ?</p>
<p>Le fait que le code est absolument inmodifiable car c&#8217;est un mélange de concaténations, d&#8217;arrays et d&#8217;appels à gettext ?</p>
<p>Je voulais juste modifier le HTML du formulaire de comments bordel !</p>
<p>BANG !</p>
]]></content:encoded>
			<wfw:commentRss>http://sametmax.com/wordpress-je-te-hais/feed/</wfw:commentRss>
		<slash:comments>4</slash:comments>
	<post-id xmlns="com-wordpress:feed-additions:1">1203</post-id><enclosure url="http://sametmax.com/wp-content/uploads/2012/07/suicide.jpg" length="" type="image/jpg" />	</item>
		<item>
		<title>Le backup wordpress du pauvre</title>
		<link>http://sametmax.com/le-backup-wordpress-du-pauvre/</link>
		<pubDate>Wed, 18 Jul 2012 15:36:09 +0000</pubDate>
		<dc:creator><![CDATA[Sam]]></dc:creator>
				<category><![CDATA[Administration System]]></category>
		<category><![CDATA[backup]]></category>
		<category><![CDATA[cron]]></category>
		<category><![CDATA[git]]></category>
		<category><![CDATA[mysql]]></category>
		<category><![CDATA[wordpress]]></category>

		<guid isPermaLink="false">http://sametmax.com/?p=1198</guid>
		<description><![CDATA[Quand c'est le blog que vous faites pour le fun, vous n'avez pas envie de mettre en place un système compliqué pour faire un backup facile à restaurer.]]></description>
				<content:encoded><![CDATA[<blockquote><p>Backup&#8217;s, can&#8217;t live with them, can&#8217;t live without them.</p></blockquote>
<p>Mais quand c&#8217;est le blog que vous faites pour le fun, vous n&#8217;avez pas envie de mettre en place un système compliqué pour faire un backup facile à restaurer.</p>
<p>Typiquement, SamEtMax est là pour le lulz, pas pour la corvée. Ce n&#8217;est pas grâve si il se fait pirater, defaced ou whatever. Pas besoin d&#8217;un truc hyper secure. Juste de quoi le remettre sur les rails rapidement, avec le minimum d&#8217;effort.</p>
<p>La solution inspirée par <a href="http://www.la-rache.com/">la méthode Rache</a>:</p>
<ul>
<li>Dans le cron: <code>28 22 * * 1 mysqldump -u user -ppassword database &gt; /chemin/vers/site/backup.sql</code></li>
<li>Un petit <code>git init</code>, <code>git add .</code>, <code>git commit -m "OSEF"</code>;</li>
<li>Un petit <code>git pull</code> sur son laptop (histoire d&#8217;avoir le code sous la main offline)</li>
</ul>
<p>Avec les thêmes le premier fetch fait quand même 250 Mo, le coquin.</p>
<p>Ensuite, un cron sur un autre server qui bouffe pas de BP (genre un server d&#8217;encoding) avec le <code>git pull</code> dedans, et voilà. Sauvegarde complète, automatique et facile à restaurer.</p>
]]></content:encoded>
		<post-id xmlns="com-wordpress:feed-additions:1">1198</post-id><enclosure url="http://sametmax.com/wp-content/uploads/2012/07/Clay-Enos-African-child.jpg" length="111681" type="image/jpg" />	</item>
	</channel>
</rss>
