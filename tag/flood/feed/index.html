<?xml version="1.0" encoding="UTF-8"?><rss version="2.0"
	xmlns:content="http://purl.org/rss/1.0/modules/content/"
	xmlns:wfw="http://wellformedweb.org/CommentAPI/"
	xmlns:dc="http://purl.org/dc/elements/1.1/"
	xmlns:atom="http://www.w3.org/2005/Atom"
	xmlns:sy="http://purl.org/rss/1.0/modules/syndication/"
	xmlns:slash="http://purl.org/rss/1.0/modules/slash/"
	xmlns:georss="http://www.georss.org/georss" xmlns:geo="http://www.w3.org/2003/01/geo/wgs84_pos#" >

<channel>
	<title>flood &#8211; Sam &amp; Max</title>
	<atom:link href="http://sametmax.com/tag/flood/feed/" rel="self" type="application/rss+xml" />
	<link>http://sametmax.com</link>
	<description>Du code, du cul</description>
	<lastBuildDate>Thu, 05 Sep 2019 08:22:03 +0000</lastBuildDate>
	<language>en-US</language>
	<sy:updatePeriod>hourly</sy:updatePeriod>
	<sy:updateFrequency>1</sy:updateFrequency>
	<generator>https://wordpress.org/?v=4.9.7</generator>
<site xmlns="com-wordpress:feed-additions:1">32490438</site>	<item>
		<title>Floodsport&#8230;</title>
		<link>http://sametmax.com/floodsport/</link>
		<comments>http://sametmax.com/floodsport/#comments</comments>
		<pubDate>Thu, 21 Nov 2013 07:50:13 +0000</pubDate>
		<dc:creator><![CDATA[01ivier]]></dc:creator>
				<category><![CDATA[Programmation]]></category>
		<category><![CDATA[flood]]></category>
		<category><![CDATA[mail]]></category>
		<category><![CDATA[python]]></category>

		<guid isPermaLink="false">http://sametmax.com/?p=7745</guid>
		<description><![CDATA[L'un des premiers "vrais" scripts  que j'ai écrit en Python avait pour fonction de <a href="http://fr.wiktionary.org/wiki/flooder">flooder</a> une boite mail...

Pas très sympathique à première vue, mais c'est sans compter le fait que j'ai pris ma carte au club des gentils depuis plusieurs années...

Je floode donc dans la joie et la bonne humeur.]]></description>
				<content:encoded><![CDATA[<p style="text-align: center;"><em><small>Ceci est un post invité de <a href="http://sametmax.com/author/01ivier/">01ivier</a> posté sous licence <a href="http://creativecommons.org/licenses/by/3.0/">creative common 3.0 unported</a>.</small></em></p>
<p>L&#8217;un des premiers &#8220;vrais&#8221; scripts  que j&#8217;ai écrit en Python avait pour fonction de <a href="http://fr.wiktionary.org/wiki/flooder">flooder</a> une boite mail&#8230;</p>
<p>Pas très sympathique à première vue, mais c&#8217;est sans compter le fait que j&#8217;ai pris ma carte au club des gentils depuis plusieurs années&#8230;</p>
<p>Je floode donc dans la joie et la bonne humeur.</p>
<p>Tout d&#8217;abord, il m&#8217;a fallu identifier un moyen pas trop compliqué d&#8217;envoyer un mail.<br />
J&#8217;ai donc récupéré un bout de code je ne sais où et j&#8217;ai viré tout ce qui dépassait :</p>
<pre lang="python">
# -*- coding: utf-8 -*-

import smtplib
from email.MIMEText import MIMEText

de_qui = 'ton@adresse.mail'
a_qui = 'son@adresse.mail' 
ton_server_smtp = 'smtp.ton.FAI'

message = MIMEText('Ceci est le corps du mail')      
message['Subject'] = 'Ceci est le titre du mail'                  
                                                        
server = smtplib.SMTP(ton_server_smtp)                 
server.sendmail(de_qui, a_qui, message.as_string())   
server.quit()
print ("Le message a été envoyé avec un succès phénoménal !")

</pre>
<p>On reconnaît tout de suite le style qui caractérise les champions: pas de fonction, tout en ligne droite !<br />
J&#8217;aimerai pouvoir vous dire ce qu&#8217;est MIMEText, mais ayant pu me débrouiller jusqu&#8217;ici sans le savoir&#8230; et bien je ne le sais pas. (Et ne comptez pas sur moi pour aller le chercher juste pour vous. J&#8217;ai une posture de mauvais élève à assumer.) </p>
<p>À ce niveau, sur ma Linux Mint, il me suffit de renseigner <em>de_qui</em>, <em>a_qui</em> et <em>ton_server_smtp</em> puis d&#8217;ouvrir un terminal là où se trouve mon script et de taper :</p>
<pre lang="bash">
python go.py
</pre>
<p>(Oui, j&#8217;appelle souvent mes fichiers go.py. Comme ça j&#8217;ai l&#8217;impression qu&#8217;ils vont partir plus vite. Essayez, vous verrez. On y croit vraiment. Il faut juste s&#8217;habituer à appuyer un peu plus fort que d&#8217;habitude sur &#8220;entrer&#8221; tout en hurlant &#8220;GO !&#8221;. Mais l&#8217;effet est garanti.)</p>
<p>Si le message a bien &#8220;été envoyé avec un succès phénoménal&#8221; alors, quelque part dans l&#8217;univers, une boite mail a reçu un petit courrier ayant pour titre &#8220;Ceci est le titre du mail&#8221; et pour contenu &#8220;Ceci est le corps du mail&#8221;.<br />
Je vous assure que je ne suis jamais aussi heureux de m&#8217;envoyer un mail que de cette façon.<br />
Parfois je change l&#8217;objet pour me faire une surprise et je suis content.<br />
Ça marche à chaque fois.</p>
<h2>C&#8217;est à ce moment que l&#8217;on parle de petits chiens.</h2>
<p>Maintenant que je savais envoyer un mail, il me fallait trouver un moyen de convertir la photo d&#8217;un petit chien en ASCII-art (rapport à la joie et la bonne humeur du flood, souvenez-vous).<br />
J&#8217;ai trouvé mon bonheur avec le <a href="http://aa-project.sourceforge.net/">projet AA</a>.</p>
<pre lang="bash">
sudo apt-get install python-aalib
</pre>
<p>Paf !</p>
<p>J&#8217;ai récupéré <a href="http://jwilk.net/software/python-aalib">ici</a> un bout de code dont j&#8217;ai compris juste l&#8217;essentiel (où changer l&#8217;image, la largeur et la hauteur) et mon style tout en finesse a fait le reste :</p>
<pre lang="python">
import aalib
import Image

pix = 'toutou.jpg'
nb_lettre_largeur = 80
nb_lettre_hauteur = 40

screen = aalib.AsciiScreen(width = nb_lettre_largeur, height = nb_lettre_hauteur)
image = Image.open(pix).convert('L').resize(screen.virtual_size)
screen.put_image((0, 0), image)
print (screen.render())
</pre>
<p>&#8220;GO ! GO !&#8221;</p>
<pre lang="bash">
python gogo.py
</pre>
<p><a href="http://sametmax.com/floodsport/pitichien/" rel="attachment wp-att-7801"><img src="http://sametmax.com/wp-content/uploads/2013/11/pitichien.jpg" class="grouped_elements" rel="tc-fancybox-group7745" alt="" title="pitichien" width="600" height="439" class="alignnone size-full wp-image-7801" /></a></p>
<p>Ici aussi, une joie authentique est au rendez vous à chaque tentative.<br />
C&#8217;est merveilleux.</p>
<h2>Où l&#8217;on mélange les torchons et les torchons&#8230;</h2>
<p>Je savais comment envoyer un mail.<br />
Je savais comment convertir une photo de petit chien en ASCII.</p>
<p>La suite découlait de source.<br />
Il me fallait désormais unifier le tout pour pouvoir envoyer des dizaines de mails à la même adresse de manière à ce que la photo du petit chien apparaissent dans le client de messagerie de mon destinataire grâce à l&#8217;empilement des titres des messages en partant du principe qu&#8217;il utiliserai une police à chasse fixe pour l&#8217;affichage.<br />
Tout ce qu&#8217;il y a de plus classique.</p>
<p>À l&#8217;époque, sur gMail, le thème &#8220;Terminal&#8221; proposait une police monospaced verte sur fond noir du plus bel effet.<br />
Mais ce n&#8217;est plus le cas.<br />
Heureusement, en plagiant l&#8217;interface de gMail, Yahoo a aussi plagié le thème &#8220;Terminal&#8221; avec la police qui nous intéresse.<br />
Voici donc le petit chien que je me suis envoyé sur un compte créé pour l&#8217;occasion.</p>
<p><a href="http://sametmax.com/floodsport/tootooyahoo/" rel="attachment wp-att-7876"><img src="http://sametmax.com/wp-content/uploads/2013/11/tootooyahoo.jpg" class="grouped_elements" rel="tc-fancybox-group7745" alt="Tootoo for yahoo" title="tootooyahoo" width="600" height="448" class="alignnone size-full wp-image-7876" /></a></p>
<p>Ne me dites pas que ça ne vous donne pas envie de chialer.</p>
<p>Voici le script auquel j&#8217;ai (empiriquement) fini par arriver pour obtenir ce résultat émouvant :</p>
<pre lang="python">
# -*- coding: utf-8 -*-
 
# la lib smtp qui nous permet de dialoguer avec un serveur de mail
import smtplib
 
# pour simuler une irrégularité dans l'envoi
from time import sleep
from random import random
 
# nécessaire pour l'ASCII-Art
import aalib
import Image
 
import sys
from email.MIMEText import MIMEText
 
de_qui = 'À RENSEIGNER'        
a_qui = 'À RENSEIGNER'         
serveur_smtp = 'À RENSEIGNER'  
 
 
i = j = 25  # nombre de mail a envoyer donc de ligne,
nb = 81     # nombre de caractères par ligne, correspond au nombre de caractères
            # affichés par Yahoo pour un titre avec le skin "terminal"  


###############
## FONCTIONS ##
###############
 
 
def gotoascii(pix):    
                                    
    screen = aalib.AsciiScreen(width = nb-1, height = j)
    image = Image.open(pix).convert('L').resize(screen.virtual_size)
    screen.put_image((0, 0), image)

    # les replace() concernent des caractères qui sont gérés différemment 
    # des autres quand ils sont utilisés dans le tite d'un mail.
    return (screen.render().replace(' ', '.').replace(',', '.').replace(';','.'))
 
def essai(pix):

    # permet éventuellement de tester le rendu de l'image avant de l'envoyer
    print (gotoascii(pix))
 
def ligne(num_l, pix):

    # Comme il y a 'nb' élément par ligne, on compte de 'nb' en 'nb'
    # en fonction du numéro de la ligne renseigné par 'num_l' 
    return (gotoascii(pix)[nb*num_l:nb*(num_l+1)])
 
def send(num, pix):

    email = MIMEText("Qu'est-ce qu'on s'amuse !")

    # L'objet du mail est la ligne donnée en premier argument
    # de l'image ASCII donnée en deuxième argument
    email['Subject'] = ligne(num, pix)
                                                   
    server = smtplib.SMTP(serveur_smtp)                 
    server.sendmail(de_qui, a_qui, email.as_string())   
    server.quit()                                       
 
 
#########################
## PROGRAMME PRINCIPAL ##
#########################


# Écoute le flag -test pour faire... des tests
# --> python go.py -test monImage.jpg
if sys.argv[1] == "-test": 
 
    essai(sys.argv[2])
 
else:
 
    while i > 0:
 
        # Augmente le délais et brise la régularité des envois de mail
        # afin d'éviter, peut-être, d'être black-listé par Yahoo :-p
        # Utilité purement hypothétique.
        sleep(20*random()+10)
        
        # Envoi le mail          
        send(i-1, sys.argv[1])                 
        if i == 1:
            print ("Mail n°{0} envoyé. Il n'en reste plus.".format(j+1-i))
        else:
            print ("Mail n°{0} envoyé. Il en reste encore {1}.".format(j+1-i, i-1))
        i -= 1
 
    print ("Bravo ! Cet envoi a été un succès !")
</pre>
<p>Pour l&#8217;utiliser, j&#8217;ai fait en sorte de pouvoir passer l&#8217;image à envoyer en argument.</p>
<pre lang="bash">
python go.py monImage.jpg
</pre>
<p>J&#8217;ai écrit ce script il y a un peu plus de 2 ans, et, même si <a href="http://sametmax.com/apprendre-le-python-en-10-ans/">je progresse lentement</a>, je me rends bien compte désormais, que je recalcule l&#8217;image à chaque mail .<br />
Mais je vous l&#8217;ai laissé en l&#8217;état, car c&#8217;est tout aussi attendrissant qu&#8217;un chiot, je trouve.<br />
Surtout qu&#8217;à part ça, le reste frôle la perfection (la gestion des arguments doit en laisser plus d&#8217;un rêveur, j&#8217;imagine).</p>
<p>Enfin, grâce à Sam &#038; Max, j&#8217;ai découvert qu&#8217;il était possible d&#8217;utiliser d&#8217;autres photos que celle du petit chien.<br />
Merci à eux.</p>
<p><a href="http://sametmax.com/floodsport/bubuste/" rel="attachment wp-att-7914"><img src="http://sametmax.com/wp-content/uploads/2013/11/bubuste.jpg" class="grouped_elements" rel="tc-fancybox-group7745" alt="" title="bubuste" width="600" height="434" class="alignnone size-full wp-image-7914" /></a></p>
]]></content:encoded>
			<wfw:commentRss>http://sametmax.com/floodsport/feed/</wfw:commentRss>
		<slash:comments>8</slash:comments>
	<post-id xmlns="com-wordpress:feed-additions:1">7745</post-id><enclosure url="http://sametmax.com/wp-content/uploads/2013/11/flood1.jpg" length="42550" type="image/jpg" />	</item>
	</channel>
</rss>
