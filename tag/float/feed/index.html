<?xml version="1.0" encoding="UTF-8"?><rss version="2.0"
	xmlns:content="http://purl.org/rss/1.0/modules/content/"
	xmlns:wfw="http://wellformedweb.org/CommentAPI/"
	xmlns:dc="http://purl.org/dc/elements/1.1/"
	xmlns:atom="http://www.w3.org/2005/Atom"
	xmlns:sy="http://purl.org/rss/1.0/modules/syndication/"
	xmlns:slash="http://purl.org/rss/1.0/modules/slash/"
	xmlns:georss="http://www.georss.org/georss" xmlns:geo="http://www.w3.org/2003/01/geo/wgs84_pos#" >

<channel>
	<title>float &#8211; Sam &amp; Max</title>
	<atom:link href="http://sametmax.com/tag/float/feed/" rel="self" type="application/rss+xml" />
	<link>http://sametmax.com</link>
	<description>Du code, du cul</description>
	<lastBuildDate>Thu, 05 Sep 2019 08:22:03 +0000</lastBuildDate>
	<language>en-US</language>
	<sy:updatePeriod>hourly</sy:updatePeriod>
	<sy:updateFrequency>1</sy:updateFrequency>
	<generator>https://wordpress.org/?v=4.9.7</generator>
<site xmlns="com-wordpress:feed-additions:1">32490438</site>	<item>
		<title>Les nombres en Python</title>
		<link>http://sametmax.com/les-nombres-en-python/</link>
		<comments>http://sametmax.com/les-nombres-en-python/#comments</comments>
		<pubDate>Mon, 24 Dec 2012 17:43:54 +0000</pubDate>
		<dc:creator><![CDATA[Sam]]></dc:creator>
				<category><![CDATA[Programmation]]></category>
		<category><![CDATA[calculs]]></category>
		<category><![CDATA[float]]></category>
		<category><![CDATA[int]]></category>
		<category><![CDATA[python]]></category>

		<guid isPermaLink="false">http://sametmax.com/?p=3851</guid>
		<description><![CDATA[Aller, un petit article pour débutant pour changer: la représentation des nombres en Python.]]></description>
				<content:encoded><![CDATA[<p>Aller, un petit article pour débutant pour changer: la représentation des nombres en Python.</p>
<h2>Les types de base</h2>
<p>Il y a plus de types et notations numériques de base que vous ne le pensez:</p>
<pre lang="python">>>> type(1)

>>> type(1.0)

>>> type(11111111111111111111)

>>> type(1j)

>>> type(1e10)</pre>
<p><code>1</code> est celui que tout le monde connaît le mieux. Il représente le type entier, c&#8217;est à dire sans virgule. C&#8217;est aussi celui qu&#8217;on utilise le plus puisqu&#8217;il sert aux indices, aux slicings, aux boucles, au compteurs, etc.</p>
<p>Il peut être négatif:</p>
<pre lang="python">>>> -2 + 1
-1</pre>
<p>Et permet la plupart des opérations mathématiques ordinaires:</p>
<pre lang="python">>>> 1 + 1 # addition
2
>>> 1 - 1 # soustraction
0
>>> 4 / 2 # division
2
>>> 2 * 3 # multiplication
6
>>> 2 ** 3 # puissance
8</pre>
<p>Ça va sans dire, mais ça va mieux en le disant, Python n&#8217;applique pas de transtypage automatique en dehors des types numériques. Comme disait ma maîtresse, on ne peut pas additionner des choux et des carottes, ni des <code>strings</code> et des <del>bas nylons</del> <code>int</code>:</p>
<pre lang="python">>>> 1 + 1
2
>>> 1 + "1"
Traceback (most recent call last):
  File "", line 1, in 
    1 + "1"
TypeError: unsupported operand type(s) for +: 'int' and 'str'

>>> 1 + int("1")
2
>>> str(1) + "1"
'11'</pre>
<p>Quand un entier est trop gros, il est transformé automatiquement en type <code>long</code>. Il n&#8217;y a rien à faire, Python gère ça tout seul. Un long, c&#8217;est juste un gros entier, un peu plus lent.</p>
<pre lang="python">>>> import sys
>>> sys.maxint # la limite de transformation d'un int en long
9223372036854775807
>>> type(9223372036854775807)

>>> type(9223372036854775807 + 1)</pre>
<p>Mais on peut en faire un soi-même si on se sent l&#8217;âme d&#8217;un créateur de <code>long</code>, même un tout petit. Il suffit de rajouter un <em>L</em>:</p>
<pre lang="python">>>> 1L
1L
>>> type(1L)</pre>
<p>Ce type n&#8217;existe plus en Python 3.</p>
<p>Les <code>int</code> et <code>long</code> sont limités à ce qui est entier. Pour tout ce qui a une virgule, on utilise les flottants, qui acceptent les mêmes opérations:</p>
<pre lang="python">>>> 0.1 - 2.3 * 4.5 ** 6.7 / 8.9
-6149.7096223012195
>>> type(-6149.7096223012195)</pre>
<p>Tout nombre qui contient un <code>.</code> est automatiquement un <code>float</code>.</p>
<p>D&#8217;ailleurs, si on fait une opération entre un <code>int</code> et un <code>float</code>, on se retrouve avec un résultat en flottant:</p>
<pre lang="python">>>> 1 + 1. # même pas besoin de chiffre après la virgule
2.0</pre>
<p>En fait, la plupart des opérations mathématiques un peu avancées retournent un <code>float</code>:</p>
<pre lang="python">>>> import math
>>> math.cos(math.pi)
1.0</pre>
<p>Les floats ont aussi une autre particularité: on peut les représenter en notation scientifique:</p>
<pre lang="python">>>> 6.02214078e23 # j'aimerais avoir une mole d'euros pour Noel
6.02214078e+23</pre>
<p>Je ne l&#8217;ai jamais utilisé, et je n&#8217;ai aucune idée de si c&#8217;est utile pour nos amis scientifiques (y en a des biens). En tout cas, c&#8217;est là.</p>
<p>D&#8217;ailleurs, puisqu&#8217;on parle science, on est pas limité aux réels avec Python. On peut taper dans les nombres imaginaires (la notation utilise &#8220;j&#8221; et non pas &#8220;i&#8221;) :</p>
<pre lang="python">>>> 1j + 1
(1+1j)
1
(1+1j)</pre>
<p>Et il y a même un module <a href="http://docs.python.org/2/library/math.html?highlight=math#math">math</a> dédié:</p>
<pre lang="python">>>> math.sqrt(-1) # racine carrée FAIL
Traceback (most recent call last):
  File "", line 1, in 
    math.sqrt(-1)
ValueError: math domain error
>>> import cmath # WIN
>>> cmath.sqrt(-1)
1j</pre>
<p>Et tout ce petit monde est compatible ensemble:</p>
<pre lang="python">>>> 0 + 1.0 + 9999999999999999999999999999 + 1j
(1e+28+1j)</pre>
<p>La seule chasse gardée des entiers, c&#8217;est l&#8217;indexing et le slicing:</p>
<pre lang="python">>>> l = range(10)
>>> l[1]
1
>>> l[1.0]
Traceback (most recent call last):
  File "", line 1, in 
    l[1.0]
TypeError: list indices must be integers, not float

>>> l[1j]
Traceback (most recent call last):
  File "", line 1, in 
    l[1j]
TypeError: list indices must be integers, not complex</pre>
<h2>L&#8217;éternel problème de la virgule qui part en couille</h2>
<p>Généralement, un débutant apprenant la programmation va commencer comme ça:</p>
<pre lang="python">>>> 4 / 2 # COOOL !
2
>>> 3 / 2 # WTF ?!!
1</pre>
<p>Donc là il va sur les forums, ne fait aucune recherche, et pose la même question que tous les débutants ont posé. Et une bonne âme répond patiemment que si il avait pris le temps de taper 3 secondes sur Google, espèce de connard d&#8217;étudiant fumeur de joint qui joue à League of Legend dans l&#8217;amphi, il aurait su que l&#8217;opération de division en Python 2.7 est une opération de division entière. Elle vire donc tout ce qu&#8217;il y a après la virgule.</p>
<p>Pour y remédier, il y a plusieurs possibilités.</p>
<p>1 &#8211; Utiliser des floats :</p>
<pre lang="python">>>> 3. / 2.
1.5</pre>
<p>2 &#8211; Utiliser <code>truediv</code> :</p>
<pre lang="python">>>> from operator import truediv
>>> truediv(3, 2)
1.5</pre>
<p>3 &#8211; utiliser le comportement de Python 3 :</p>
<pre lang="python">>>> from __future__ import division # c'est quand même la classe
>>> 3 / 2 # comportement naturel
1.5
>>> 3 // 2 # division entière
1</pre>
<p>Utilisez la solution 1 dans le shell pour faire vite fait, la 2 si vous modifiez un programme existant, et la 3 quand vous créer un nouveau programme.</p>
<p>Bien, revenons à notre connard de joint qui fume de l&#8217;amphi en cours de League of Legend. Il va maintenant vouloir se faire la main, et se lancer dans la création d&#8217;applications qui manquent comme des annuaires, des todo lists et des gestionnaires de budget. Sur ces derniers, il va bien entendu manipuler des sous, et les sous, il faut que ça soit précis. Alors quand il tombe là dessus:</p>
<pre lang="python">>>> 0.1 + 0.1 + 0.1 - 0.3 # ZERO !!!
5.551115123125783e-17
>>> print "O_o dah FUCK ?"
O_o dah FUCK ?</pre>
<p>Il retourne sur le forum où on l&#8217;avait si gentiment aidé, pour refaire exactement ce qu&#8217;on lui avait dit de pas faire. Et le bon con de service (le geek de niveau intermédiaire qui est pas encore lassé de répondre aux débutants car il l&#8217;était il y a encore pas si longtemps alors il comprend, lui, pas comme ces snobs élitistes agressifs qu&#8217;il jure ne jamais devenir ce qu&#8217;il deviendra bien entendu après 6 mois de hotline gratuite sur le forum de commentcamarche.com) va lui répondre que si il avait cherché sur Google&#8230;</p>
<p>Il aurait donc vu que les ordinateurs représentent tout en base 2, et que certains nombres à virgules ne peuvent être qu&#8217;approximés.</p>
<p>Stupeur, effroi, affolement. Comment calculer le budget litière de sa coloc dans son super programme ?</p>
<p>Dans un autre langage, on lui recommanderait de tout multiplier par 100000 puis de tout diviser par 100000, pour être bien sûr.</p>
<p>En Python, il y a un module pour ça<img src="https://s.w.org/images/core/emoji/2.4/72x72/2122.png" alt="™" class="wp-smiley" style="height: 1em; max-height: 1em;" /></p>
<h2>Décimaux et fractions</h2>
<pre lang="python">>>> from decimal import Decimal
>>> Decimal("0.1") + Decimal("0.1") + Decimal("0.1") - Decimal("0.3")
Decimal('0.0')</pre>
<p>Joie. Bonheur. Victoire de l&#8217;homme sur la machine et le boudin blanc.</p>
<p>On peut même définir jusqu&#8217;à quel point on veut être précis (en gros à partir de quand il arrondit) :</p>
<pre lang="python">>>> from decimal import getcontext
>>> getcontext().prec = 6 # largement suffisant si vous n'êtes pas Paypal ou le Fisc</pre>
<p>Pour les nostalgiques de Javascript ou de Buzz l&#8217;éclair, on peut même créer Not A Number et l&#8217;infini:</p>
<pre lang="python">>>> Decimal('NaN')
Decimal('NaN')
>>> Decimal('-Infinity')
Decimal('-Infinity')</pre>
<p>(<code>float()</code> le permet aussi, mais je vous le déconseille : le résultat est dépendant de l&#8217;implémentation)</p>
<p>Je vous invite à lire <a href="http://docs.python.org/2/library/decimal.html">la doc</a>, car il y a pas mal de choses à savoir si on veut éviter certains pièges.</p>
<p>Bref, le module <code>Decimal</code> permet de calculer avec le minimum d&#8217;approximation, évitant les erreurs d&#8217;arrondie et vous infusant de ce sentiment (fugace) que vous maîtrisez ce que vous faites. Vous pouvez manipuler des sous. Enfin presque. Car il y a évidement ensuite la douloureuse question des devises, mais la réponse à ce problème est un à <a href="http://pypi.python.org/pypi/python-money">pip install</a> de là et dépasse les considérations de cet article.</p>
<p>Donc, pour tout ce qui a beson d&#8217;être précis au poil de cul, vous allez utiliser <code>Decimal</code>. Ou pas.</p>
<p>Car <code>Decimal</code> est lent. 100 fois plus lent qu&#8217;un float environ. Alors, pour la compta, ça va. Pour le séquençage ADN d&#8217;une patate, qui je le rappelle, <a href="http://sametmax.com/a-imprimer-et-a-mettre-en-poster-dans-le-bureau-de-votre-boite/">a plus de chromosomes que nous</a>, la biatch, c&#8217;est moyen.</p>
<p>Et là, pour pallier ce genre de truc, il faut taper dans l&#8217;extension en C, donc <a href="http://sametmax.com/votre-python-aime-les-pip/">installer</a> un module comme <a href="http://www.bytereef.org/mpdecimal/index.html">cdecimal</a> (qui a la même API, il suffit ensuite de remplacer les imports) ou encore plus rapide, <a href="http://code.google.com/p/gmpy/">gmpy</a> (API différente).</p>
<p>Bon, j&#8217;en ai jamais eu besoin dans toute ma vie, <code>Decimal</code> me suffit largement. Il calcule toujours plus vite que moi sur <del>Excel</del> <del>OpenOffice</del> LibreOffice. Mais je suis sûr qu&#8217;il y a des biologistes qui ne peuvent pas faire sans, hein. Vu la communauté qu&#8217;il y a sur <a href="http://www.scipy.org/">scipy</a>, la lib de calculs scientifiques haute performance, je ne doute pas de la question.</p>
<p>Pour finir sur une note plus légère, sachez que Python permet aussi de manipuler des fractions.</p>
<pre lang="python">>>> from fractions import Fraction
>>> Fraction(3, 2)
Fraction(3, 2)
>>> int(Fraction(3, 2) + Fraction(1, 2))
2</pre>
<p>Si vous êtes dans un cas où vous manipulez beaucoup de &#8220;parts de&#8221;, c&#8217;est fort pratique.</p>
]]></content:encoded>
			<wfw:commentRss>http://sametmax.com/les-nombres-en-python/feed/</wfw:commentRss>
		<slash:comments>11</slash:comments>
	<post-id xmlns="com-wordpress:feed-additions:1">3851</post-id><enclosure url="http://sametmax.com/wp-content/uploads/2012/12/Cheese+Nan.jpg" length="14432" type="image/jpg" />	</item>
	</channel>
</rss>
