<!DOCTYPE html>
<!--[if IE 7]>
<html class="ie ie7" lang="en-US">
<![endif]-->
<!--[if IE 8]>
<html class="ie ie8" lang="en-US">
<![endif]-->
<!--[if !(IE 7) | !(IE 8)  ]><!-->
<html lang="en-US">                          
<!--<![endif]-->
					<head>
				    <meta charset="UTF-8" />
				    <meta http-equiv="X-UA-Compatible" content="IE=9; IE=8; IE=7; IE=EDGE" />
            				    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
				    <link rel="profile" href="http://gmpg.org/xfn/11" />
				    <link rel="pingback" href="http://sametmax.com/xmlrpc.php" />

				   <!-- Icons font support for IE6-7  -->
				    <!--[if lt IE 8]>
				      <script src="http://sametmax.com/wp-content/themes/customizr/inc/assets/css/fonts/lte-ie7.js"></script>
				    <![endif]-->
				    <style type="text/css" id="customizr-inline-fonts">@font-face{font-family:genericons;src:url('../wp-content/themes/customizr/inc/assets/css/fonts/fonts/genericons-regular-webfont.eot');src:url('../wp-content/themes/customizr/inc/assets/css/fonts/fonts/genericons-regular-webfont.eot%3F') format('embedded-opentype'),url('../wp-content/themes/customizr/inc/assets/css/fonts/fonts/genericons-regular-webfont.woff') format('woff'),url('../wp-content/themes/customizr/inc/assets/css/fonts/fonts/genericons-regular-webfont.ttf') format('truetype'),url('../wp-content/themes/customizr/inc/assets/css/fonts/fonts/genericons-regular-webfont.svg') format('svg')}@font-face{font-family:entypo;src:url('http://sametmax.com/wp-content/themes/customizr/inc/assets/css/fonts/fonts/entypo.eot);src:url(http://sametmax.com/wp-content/themes/customizr/inc/assets/css/fonts/fonts/entypo.eot?#iefix') format('embedded-opentype'),url('../wp-content/themes/customizr/inc/assets/css/fonts/fonts/entypo.woff') format('woff'),url('../wp-content/themes/customizr/inc/assets/css/fonts/fonts/entypo.ttf') format('truetype'),url('../wp-content/themes/customizr/inc/assets/css/fonts/fonts/entypo.svg') format('svg')}</style><title>Files de tâches et tâches récurrentes avec Celery &#8211; Sam &amp; Max</title>
<link rel='dns-prefetch' href='http://s0.wp.com/' />
<link rel='dns-prefetch' href='http://secure.gravatar.com/' />
<link rel='dns-prefetch' href='http://s.w.org/' />
<link rel="alternate" type="application/rss+xml" title="Sam &amp; Max &raquo; Feed" href="../feed.1" />
<link rel="alternate" type="application/rss+xml" title="Sam &amp; Max &raquo; Comments Feed" href="../comments/feed/index.html" />
<link rel="alternate" type="application/rss+xml" title="Sam &amp; Max &raquo; Files de tâches et tâches récurrentes avec Celery Comments Feed" href="feed/index.html" />
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2.4\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2.4\/svg\/","svgExt":".svg","source":{"concatemoji":"http:\/\/sametmax.com\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.9.7"}};
			!function(a,b,c){function d(a,b){var c=String.fromCharCode;l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,a),0,0);var d=k.toDataURL();l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,b),0,0);var e=k.toDataURL();return d===e}function e(a){var b;if(!l||!l.fillText)return!1;switch(l.textBaseline="top",l.font="600 32px Arial",a){case"flag":return!(b=d([55356,56826,55356,56819],[55356,56826,8203,55356,56819]))&&(b=d([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]),!b);case"emoji":return b=d([55357,56692,8205,9792,65039],[55357,56692,8203,9792,65039]),!b}return!1}function f(a){var c=b.createElement("script");c.src=a,c.defer=c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var g,h,i,j,k=b.createElement("canvas"),l=k.getContext&&k.getContext("2d");for(j=Array("flag","emoji"),c.supports={everything:!0,everythingExceptFlag:!0},i=0;i<j.length;i++)c.supports[j[i]]=e(j[i]),c.supports.everything=c.supports.everything&&c.supports[j[i]],"flag"!==j[i]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[j[i]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(h=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",h,!1),a.addEventListener("load",h,!1)):(a.attachEvent("onload",h),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),g=c.source||{},g.concatemoji?f(g.concatemoji):g.wpemoji&&g.twemoji&&(f(g.twemoji),f(g.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<link rel='stylesheet' id='contact-form-7-css'  href='../wp-content/plugins/contact-form-7/includes/css/styles.css%3Fver=5.0.2.css' type='text/css' media='all' />
<link rel='stylesheet' id='wp-polls-css'  href='../wp-content/plugins/wp-polls/polls-css.css%3Fver=2.73.8.css' type='text/css' media='all' />
<style id='wp-polls-inline-css' type='text/css'>
.wp-polls .pollbar {
	margin: 1px;
	font-size: 6px;
	line-height: 8px;
	height: 8px;
	background-image: url('../wp-content/plugins/wp-polls/images/default/pollbg.gif');
	border: 1px solid #c8c8c8;
}

</style>
<link rel='stylesheet' id='wp-syntax-css-css'  href='../wp-content/plugins/wp-syntax/css/wp-syntax.css%3Fver=1.1.css' type='text/css' media='all' />
<link rel='stylesheet' id='dashicons-css'  href='../wp-includes/css/dashicons.min.css%3Fver=4.9.7.css' type='text/css' media='all' />
<link rel='stylesheet' id='customizr-skin-css'  href='../wp-content/themes/customizr/inc/assets/css/black2.min.css%3Fver=3.2.10.css' type='text/css' media='all' />
<style id='customizr-skin-inline-css' type='text/css'>

.sticky-enabled .tc-shrink-on .site-logo img {
						height:30px!important;width:auto!important
					}

					.sticky-enabled .tc-shrink-on .brand .site-title {
						font-size:0.6em;opacity:0.8;line-height:1.2em
					}

.tc-rectangular-thumb {
            max-height: 250px;
            height :250px
          }

          .single .tc-rectangular-thumb {
            max-height: 250px;
            height :250px
          }


</style>
<link rel='stylesheet' id='customizr-style-css'  href='../wp-content/themes/customizr/style.css%3Fver=3.2.10.css' type='text/css' media='all' />
<link rel='stylesheet' id='fancyboxcss-css'  href='../wp-content/themes/customizr/inc/assets/js/fancybox/jquery.fancybox-1.3.4.min.css%3Fver=4.9.7.css' type='text/css' media='all' />
<link rel='stylesheet' id='jetpack-widget-social-icons-styles-css'  href='../wp-content/plugins/jetpack/modules/widgets/social-icons/social-icons.css%3Fver=20170506.css' type='text/css' media='all' />
<link rel='stylesheet' id='social-logos-css'  href='../wp-content/plugins/jetpack/_inc/social-logos/social-logos.min.css%3Fver=1.css' type='text/css' media='all' />
<link rel='stylesheet' id='jetpack_css-css'  href='../wp-content/plugins/jetpack/css/jetpack.css%3Fver=6.3.2.css' type='text/css' media='all' />
<script type='text/javascript' src='../wp-includes/js/jquery/jquery.js%3Fver=1.12.4'></script>
<script type='text/javascript' src='../wp-includes/js/jquery/jquery-migrate.min.js%3Fver=1.4.1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var TCParams = {"FancyBoxState":"1","FancyBoxAutoscale":"1","SliderName":"","SliderDelay":"","SliderHover":"1","SmoothScroll":"linear","ReorderBlocks":"1","CenterSlides":"1","HasComments":"","LeftSidebarClass":".span3.left.tc-sidebar","RightSidebarClass":".span3.right.tc-sidebar","LoadModernizr":"1","stickyCustomOffset":"0","stickyHeader":"1","dropdowntoViewport":"0","timerOnScrollAllBrowsers":"1"};
/* ]]> */
</script>
<script type='text/javascript' src='../wp-content/themes/customizr/inc/assets/js/tc-scripts.min.js%3Fver=3.2.10'></script>
<link rel='https://api.w.org/' href='../wp-json/index.html' />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://sametmax.com/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="../wp-includes/wlwmanifest.xml" /> 
<link rel='prev' title='Ouverture du coffre : la méthode simple, bourine, mais efficace' href='../ouverture-du-coffre-la-methode-simple-bourine-mais-efficace/index.html' />
<link rel='next' title='E-ink et confiseries' href='../e-ink-et-confiseries/index.html' />
<meta name="generator" content="WordPress 4.9.7" />
<link rel="canonical" href="index.html" />
<link rel='shortlink' href='https://wp.me/p2ckfk-1MY' />
<link rel="alternate" type="application/json+oembed" href="../wp-json/oembed/1.0/embed%3Furl=http:%252F%252Fsametmax.com%252Ffiles-de-taches-et-taches-recurrentes-avec-celery%252F" />
<link rel="alternate" type="text/xml+oembed" href="../wp-json/oembed/1.0/embed%3Furl=http:%252F%252Fsametmax.com%252Ffiles-de-taches-et-taches-recurrentes-avec-celery%252F&amp;format=xml" />

<link rel='dns-prefetch' href='http://v0.wordpress.com/'/>
<style type="text/css" media="all">
/* <![CDATA[ */
@import url("../wp-content/plugins/wp-table-reloaded/css/plugin.css%3Fver=1.9.4.css");
@import url("../wp-content/plugins/wp-table-reloaded/css/datatables.css%3Fver=1.9.4.css");
/* ]]> */
</style><link rel="shortcut icon" href="../wp-content/uploads/2015/06/favicon.png" type="image/png">
<!-- Jetpack Open Graph Tags -->
<meta property="og:type" content="article" />
<meta property="og:title" content="Files de tâches et tâches récurrentes avec Celery" />
<meta property="og:url" content="http://sametmax.com/files-de-taches-et-taches-recurrentes-avec-celery/" />
<meta property="og:description" content="Quand on a traiter des choses bloquantes, avec des dépendances, des flux complexes ou des actions répétitives, créer des files d&#8217;attente peut se révéler très judicieux." />
<meta property="article:published_time" content="2013-07-27T07:57:12+00:00" />
<meta property="article:modified_time" content="2017-11-08T14:43:31+00:00" />
<meta property="og:site_name" content="Sam &amp; Max" />
<meta property="og:image" content="http://sametmax.com/wp-content/uploads/2013/07/zdFRjr1.jpg" />
<meta property="og:image:width" content="640" />
<meta property="og:image:height" content="480" />
<meta property="og:locale" content="en_US" />
<meta name="twitter:text:title" content="Files de tâches et tâches récurrentes avec Celery" />
<meta name="twitter:image" content="http://sametmax.com/wp-content/uploads/2013/07/zdFRjr1.jpg?w=640" />
<meta name="twitter:card" content="summary_large_image" />

<!-- End Jetpack Open Graph Tags -->
			<link rel="stylesheet" type="text/css" id="wp-custom-css" href="../index.html%3Fcustom-css=3b3670f11a.css" />
						    <!--Icons size hack for IE8 and less -->
				    <!--[if lt IE 9]>
				      <link href="http://sametmax.com/wp-content/themes/customizr/inc/assets/css/fonts/ie8-hacks.css" rel="stylesheet" type="text/css"/>
				    <![endif]-->
				</head>
				
	<body class="post-template-default single single-post postid-6880 single-format-standard tc-fade-hover-links tc-sticky-header tc-transparent-on-scroll" itemscope itemtype="http://schema.org/WebPage">
		
		
	   	<header class="tc-header clearfix row-fluid tc-tagline-off tc-title-logo-on  tc-shrink-on tc-menu-on logo-left" role="banner">
			      <div class="brand span3 pull-left ">

        <h1><a class="site-title" href="../index.html" title="Sam &amp; Max | Du code, du cul">Sam &amp; Max</a></h1>
      </div> <!-- brand span3 pull-left -->
      <div class="container outside"><h2 class="site-description">Du code, du cul</h2></div>      	<div class="navbar-wrapper clearfix span9 tc-submenu-fade tc-submenu-move tc-open-on-hover left">
        	<div class="navbar resp">
          		<div class="navbar-inner" role="navigation">
            		<div class="row-fluid">
              		<div class="social-block span5" ><a class="social-icon icon-feed" href="../feed/rss/index.html" title="Subscribe to my rss feed"  ></a></div><h2 class="span7 inside site-description">Du code, du cul</h2><button type="button" class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse"><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><div class="nav-collapse collapse tc-hover-menu-wrapper"><div class="menu-top-menu-container"><ul id="menu-top-menu-2" class="nav tc-hover-menu"><li class="menu-item menu-item-type-taxonomy menu-item-object-category current-post-ancestor current-menu-parent current-post-parent menu-item-1702"><a href="../category/programmation/index.html">Prog</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-1703"><a href="../category/administration-system/index.html">Admin Sys</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-1704"><a href="../category/philo-et-culture/index.html">Philo &#038; culture</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-1706"><a href="../category/cul/index.html">Cul</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-3340"><a href="../cours-et-tutos/index.html">Cours &#038; tutos</a></li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-1707"><a title="Les meilleurs blogs du Web" href="http://multiboards.net/">Multiboards</a></li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-12415"><a href="../planet-python-fr/index.html">Veille Python Fr</a></li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-15634"><a href="http://indexerror.net">Questions Python</a></li>
</ul></div></div>          			</div>
          		</div><!-- /.navbar-inner -->
        	</div><!-- /.navbar resp -->
      	</div><!-- /.navbar-wrapper -->
    			</header>
		<div id="tc-reset-margin-top" class="container-fluid" style="margin-top:103px"></div><div id="main-wrapper" class="container">

        
    <div class="container" role="main">
        <div class="row column-content-wrapper">

                            
                <div id="content" class="span9 article-container">
                    
                    
                        
                                                                                    
                                                                    <article id="post-6880" class="row-fluid post-6880 post type-post status-publish format-standard has-post-thumbnail hentry category-programmation tag-celery tag-python tag-redis">
                                                <header class="entry-header">
          <h1 class="entry-title format-icon">Files de tâches et tâches récurrentes avec Celery</h1>            <div class="entry-meta">
                This entry was posted in <a class="btn btn-mini" href="../category/programmation/index.html" title="View all posts in Programmation"> Programmation </a> and tagged <a class="btn btn-mini btn-tag" href="../tag/celery/index.html" title="View all posts in celery"> celery </a><a class="btn btn-mini btn-tag" href="../tag/python/index.html" title="View all posts in python"> python </a><a class="btn btn-mini btn-tag" href="../tag/redis/index.html" title="View all posts in redis"> redis </a> on <a href="http://sametmax.com/2013/07/27/" title="07:57" rel="bookmark"><time class="entry-date updated" datetime="2013-07-27T07:57:12+00:00">27/07/2013</time></a> <span class="by-author">by <span class="author vcard"><a class="url fn n" href="../author/sam/index.html" title="View all posts by Sam" rel="author">Sam</a></span></span>             </div><!-- .entry-meta -->
            <hr class="featurette-divider __before_content">        </header>
            

          <section class="entry-content ">
              <p>Quand on a à traiter des choses bloquantes, avec des dépendances, des flux complexes ou des actions répétitives, créer des files d&#8217;attente peut se révéler très judicieux.</p>
<p>Par exemple lancer la génération d&#8217;un gros zip sur le clic d&#8217;un utilisateur, télécharger plein fichiers en parallèle pour son site de cul, lancer des calculs sur plusieurs machines et récupérer le résultat, encoder des videos en arrière plan, etc.</p>
<p>Le problème, c&#8217;est que fabriquer des files d&#8217;attente à la main, ça mène généralement à une grosse galère. La première boîte dans laquelle j&#8217;ai travaillé avait tout un système de queues à base de PHP + SQL fait à la main qui tapait dans du MySQL, c&#8217;était pas marrant du tout</p>
<p>Je fais une pause, et je note que le potentiel de jeux de mots sur cet article est fortement élevé. Mais je resterai fort.</p>
<p>Locking, priorité, dépendance, asynchronicité, concurrence, sérialisation, encoding, stockage, accessibilité, load balancing&#8230; Toutes ces problématiques sont bien vicieuses et chronophages. Il vaut mieux utiliser une lib solide et éprouvée.</p>
<p>Je resterai fort.</p>
<p><a href="https://pypi.python.org/pypi/kombu/2.2.0">Kombu</a> est une telle lib, mais elle est lourde et complexe à utiliser. J&#8217;avais fais le choix de la prendre pour un gros projet avec Max, je le regrette sur le long terme : c&#8217;est dur à maintenir et à faire évoluer. Le code est vraiment pas sympa.</p>
<p>Heureusement il existe une bibliothèque qui se met au dessus de Kombu pour et nous expose juste les fonctionnalités que l&#8217;on souhaite : <a href="http://www.celeryproject.org/">celery</a>.</p>
<p>Fort.</p>
<p>Celery est simple pour démarrer, mais très puissant si on rentre dans le détail, et croyez moi, le détail, on peut y rentrer très très profondément.</p>
<p>F&#8230;</p>
<h2>Installation</h2>
<p>Qui dit file d&#8217;attente, dit stockage. Il faut bien mettre les tâches quelque part et communiquer avec ce quelque part. En base de données ? Dans un gestionnaire de messages ? En mémoire ? Dans un cache ?</p>
<p>Celery résout le problème en proposant la même interface, quelque soit le support. Actuellement, on peut utiliser :</p>
<ul>
<li>RabbitMQ</li>
<li>Redis</li>
<li>MongoDB</li>
<li>Beanstalk CouchDB</li>
<li>SQLAlchemy ou l&#8217;ORM Django (et donc toutes les bases de données supportées comme Sqlite, MySQL, PostGres&#8230;)</li>
<li>Amazon SQS</li>
</ul>
<p>Dans notre exemple, nous allons le faire avec Redis car :</p>
<ul>
<li>Redis est très simple à installer et à configurer.</li>
<li>Nous on utilise déjà du Redis partout.</li>
<li>Aucun risque de locking.</li>
</ul>
<p>Pour ceux qui ont pas redis, c&#8217;est généralement dans les dépôts. Par exemple sur Ubuntu :</p>

<div class="wp_syntax" style="position:relative;"><table><tr><td class="code"><pre class="bash" style="font-family:monospace;"><span style="color: #c20cb9; font-weight: bold;">sudo</span> <span style="color: #c20cb9; font-weight: bold;">apt-get install</span> redis-server</pre></td></tr></table><p class="theCode" style="display:none;">sudo apt-get install redis-server</p></div>

<p>Il n&#8217;y a rien à faire de plus, ça tourne, c&#8217;est configuré avec des valeurs par défaut qui sont saines. Je vous l&#8217;ai dis, redis, c&#8217;est fantastiquement bien foutu.</p>
<p>Ensuite on install celery et la lib d&#8217;accès à redis en Python qui porte un nom très original :</p>

<div class="wp_syntax" style="position:relative;"><table><tr><td class="code"><pre class="bash" style="font-family:monospace;">pip <span style="color: #c20cb9; font-weight: bold;">install</span> celery redis</pre></td></tr></table><p class="theCode" style="display:none;">pip install celery redis</p></div>

<p>Ca devrait compiler un peu, et comme hab avec les extensions en C, assurez vous d&#8217;avoir un compilateur et les headers en place comme indiqué dans l&#8217;article sur <a href="http://sametmax.com/votre-python-aime-les-pip/">pip</a>.</p>
<p>Ensuite on peut créer ses tâches. Créez un module, par exemple <em>tasks.py</em> :</p>

<div class="wp_syntax" style="position:relative;"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">import</span> <span style="color: #dc143c;">urllib2</span>
&nbsp;
<span style="color: #ff7700;font-weight:bold;">from</span> <span style="color: #dc143c;">collections</span> <span style="color: #ff7700;font-weight:bold;">import</span> Counter
&nbsp;
<span style="color: #ff7700;font-weight:bold;">from</span> celery <span style="color: #ff7700;font-weight:bold;">import</span> Celery
&nbsp;
<span style="color: #808080; font-style: italic;"># Configuration de celery. Ceci peut aussi se faire dans un fichier de config.</span>
<span style="color: #808080; font-style: italic;"># Ici on dit à celery que pour le module 'tasks', on va utiliser redis</span>
<span style="color: #808080; font-style: italic;"># comme broker (passeur de massage) et comme result backend (stockage du</span>
<span style="color: #808080; font-style: italic;"># resultat des tâches).</span>
celery <span style="color: #66cc66;">=</span> Celery<span style="color: black;">&#40;</span><span style="color: #483d8b;">'tasks'</span><span style="color: #66cc66;">,</span> broker<span style="color: #66cc66;">=</span><span style="color: #483d8b;">'redis://localhost'</span><span style="color: #66cc66;">,</span> backend<span style="color: #66cc66;">=</span><span style="color: #483d8b;">'redis://localhost'</span><span style="color: black;">&#41;</span>
&nbsp;
&nbsp;
<span style="color: #808080; font-style: italic;"># Et voici notre première tâche. C'est une fonction Python normale, décorée</span>
<span style="color: #808080; font-style: italic;"># avec un decorateur de celery. Elle prend une URL, et calcule le nombre</span>
<span style="color: #808080; font-style: italic;"># de lettre &quot;e&quot; qu'il y a dans la page.</span>
<span style="color: #66cc66;">@</span>celery.<span style="color: black;">task</span>
<span style="color: #ff7700;font-weight:bold;">def</span> ecount<span style="color: black;">&#40;</span>url<span style="color: black;">&#41;</span>:
    <span style="color: #ff7700;font-weight:bold;">return</span> Counter<span style="color: black;">&#40;</span><span style="color: #dc143c;">urllib2</span>.<span style="color: black;">urlopen</span><span style="color: black;">&#40;</span>url<span style="color: black;">&#41;</span>.<span style="color: black;">read</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span><span style="color: black;">&#91;</span><span style="color: #483d8b;">'e'</span><span style="color: black;">&#93;</span></pre></td></tr></table><p class="theCode" style="display:none;">import urllib2

from collections import Counter

from celery import Celery

# Configuration de celery. Ceci peut aussi se faire dans un fichier de config.
# Ici on dit à celery que pour le module 'tasks', on va utiliser redis
# comme broker (passeur de massage) et comme result backend (stockage du
# resultat des tâches).
celery = Celery('tasks', broker='redis://localhost', backend='redis://localhost')


# Et voici notre première tâche. C'est une fonction Python normale, décorée
# avec un decorateur de celery. Elle prend une URL, et calcule le nombre
# de lettre &quot;e&quot; qu'il y a dans la page.
@celery.task
def ecount(url):
    return Counter(urllib2.urlopen(url).read())['e']</p></div>

<p>On lance ensuite le processus celery dans un terminal (en production, mettez ça dans supervisord ou systemd pour que ça démarre automatiquement) :</p>
<pre>
[test] sam ~/Bureau/celery_test $ celery -A tasks worker -B --loglevel=info

 -------------- celery@sam v3.0.21 (Chiastic Slide)
---- **** -----
--- * ***  * -- Linux-3.2.0-48-generic-x86_64-with-Ubuntu-12.04-precise
-- * - **** ---
- ** ---------- [config]
- ** ---------- .> broker:      redis://localhost:6379//
- ** ---------- .> app:         tasks:0x2a2fa50
- ** ---------- .> concurrency: 4 (processes)
- *** --- * --- .> events:      OFF (enable -E to monitor this worker)
-- ******* ----
--- ***** ----- [queues]
 -------------- .> celery:      exchange:celery(direct) binding:celery


[Tasks]
  . tasks.ecount

[2013-07-26 13:22:21,631: INFO/Beat] Celerybeat: Starting..
[2013-07-26 13:04:51,274: WARNING/MainProcess] celery@sam ready.
[2013-07-26 13:04:51,280: INFO/MainProcess] consumer: Connected to redis://localhost:6379//.
</pre>
<p><code>-A</code> précise le module à importer, <code>-B</code> démarre le beat (on verra ça plus tard), <code>worker</code> dit à celery que démarrer des processus de consommation de files d&#8217;attente (par défaut 4 qui travaillent en parallèle), et <code>--loglevel=info</code> va nous permettre d&#8217;avoir un affichage verbeux pour comprendre ce qui se passe.</p>
<p>Votre file d&#8217;attente est prête, et frétille d&#8217;impatience.</p>
<h2>Lancer une tâche</h2>
<p>A partir de là, vous pouvez envoyer des tâches dans la file d&#8217;attente, depuis n&#8217;importe où :</p>
<ul>
<li>Un script.</li>
<li>Un serveur Web (par exemple une vue Django).</li>
<li>Un programme sur un autre serveur (même si il faudrait alors configurer redis pour qu&#8217;il écoute sur les ports extérieurs, ce qui n&#8217;est pas le cas ici par simplicité).</li>
<li>etc</li>
</ul>
<p>Plusieurs programmes peuvent envoyer plein de tâches, en même temps, et elles vont se loger dans la file d&#8217;attente, sans bloquer le programme qui les a envoyé.</p>
<p>Par exemple, depuis le shell :</p>

<div class="wp_syntax" style="position:relative;"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #66cc66;">&gt;&gt;&gt;</span> <span style="color: #ff7700;font-weight:bold;">from</span> tasks <span style="color: #ff7700;font-weight:bold;">import</span> ecount
<span style="color: #66cc66;">&gt;&gt;&gt;</span> res <span style="color: #66cc66;">=</span> ecount.<span style="color: black;">delay</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'http://danstonchat.com'</span><span style="color: black;">&#41;</span></pre></td></tr></table><p class="theCode" style="display:none;">&gt;&gt;&gt; from tasks import ecount
&gt;&gt;&gt; res = ecount.delay('http://danstonchat.com')</p></div>

<p>Ceci ne bloque pas mon shell, la ligne s&#8217;exécute immédiatement. La fonction <code>ecount</code> n&#8217;est pas appelée depuis le shell, elle est dans la file d&#8217;attente et sera appelée par un des processus (les fameux &#8216;worker&#8217;) qui consomment la queue. Du côté de la file, on peut voir dans le log :</p>

<div class="wp_syntax" style="position:relative;"><table><tr><td class="code"><pre class="bash" style="font-family:monospace;"><span style="color: #7a0874; font-weight: bold;">&#91;</span><span style="color: #000000;">2013</span>-07-<span style="color: #000000;">26</span> <span style="color: #000000;">14</span>:<span style="color: #000000;">18</span>:08,<span style="color: #000000;">609</span>: INFO<span style="color: #000000; font-weight: bold;">/</span>MainProcess<span style="color: #7a0874; font-weight: bold;">&#93;</span> Got task from broker: tasks.ecount<span style="color: #7a0874; font-weight: bold;">&#91;</span>599a52ea-ef6b-<span style="color: #000000;">4499</span>-981d-cd17fab592df<span style="color: #7a0874; font-weight: bold;">&#93;</span>
<span style="color: #7a0874; font-weight: bold;">&#91;</span><span style="color: #000000;">2013</span>-07-<span style="color: #000000;">26</span> <span style="color: #000000;">14</span>:<span style="color: #000000;">18</span>:09,070: INFO<span style="color: #000000; font-weight: bold;">/</span>MainProcess<span style="color: #7a0874; font-weight: bold;">&#93;</span> Task tasks.ecount<span style="color: #7a0874; font-weight: bold;">&#91;</span>599a52ea-ef6b-<span style="color: #000000;">4499</span>-981d-cd17fab592df<span style="color: #7a0874; font-weight: bold;">&#93;</span> succeeded <span style="color: #000000; font-weight: bold;">in</span> 0.446974039078s: <span style="color: #000000;">1242</span></pre></td></tr></table><p class="theCode" style="display:none;">[2013-07-26 14:18:08,609: INFO/MainProcess] Got task from broker: tasks.ecount[599a52ea-ef6b-4499-981d-cd17fab592df]
[2013-07-26 14:18:09,070: INFO/MainProcess] Task tasks.ecount[599a52ea-ef6b-4499-981d-cd17fab592df] succeeded in 0.446974039078s: 1242</p></div>

<p>On a donc notre tâche qui a bien été traitée.</p>
<p>On peut récupérer le résultat dans le shell :</p>

<div class="wp_syntax" style="position:relative;"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #66cc66;">&gt;&gt;&gt;</span> res.<span style="color: black;">state</span>
<span style="color: #483d8b;">'PENDING'</span></pre></td></tr></table><p class="theCode" style="display:none;">&gt;&gt;&gt; res.state
'PENDING'</p></div>

<p>Ah&#8230; La tâche n&#8217;est pas encore terminée. Et un peu plus tard :</p>

<div class="wp_syntax" style="position:relative;"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #66cc66;">&gt;&gt;&gt;</span> res.<span style="color: black;">state</span>
<span style="color: #483d8b;">'SUCCESS'</span>
<span style="color: #66cc66;">&gt;&gt;&gt;</span> res.<span style="color: black;">result</span>
<span style="color: #ff4500;">1242</span></pre></td></tr></table><p class="theCode" style="display:none;">&gt;&gt;&gt; res.state
'SUCCESS'
&gt;&gt;&gt; res.result
1242</p></div>

<p>Lancer une tâche est bien entendu peu intéressant, les listes d&#8217;attente sont vraiment sympa quand on a plein de tâches à lancer, par plein de processus différents :</p>

<div class="wp_syntax" style="position:relative;"><table><tr><td class="code"><pre class="python" style="font-family:monospace;">results <span style="color: #66cc66;">=</span> <span style="color: black;">&#91;</span>ecount.<span style="color: black;">delay</span><span style="color: black;">&#40;</span>url<span style="color: black;">&#41;</span> <span style="color: #ff7700;font-weight:bold;">for</span> url <span style="color: #ff7700;font-weight:bold;">in</span> <span style="color: black;">&#40;</span><span style="color: #483d8b;">'http://google.com'</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'http://sametmax.com'</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'http://sebsauvage.com'</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'http://multiboards.com'</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'http://0bin.net'</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'http://danstonchat.com'</span><span style="color: black;">&#41;</span><span style="color: black;">&#93;</span></pre></td></tr></table><p class="theCode" style="display:none;">results = [ecount.delay(url) for url in ('http://google.com', 'http://sametmax.com', 'http://sebsauvage.com', 'http://multiboards.com', 'http://0bin.net', 'http://danstonchat.com')]</p></div>


<div class="wp_syntax" style="position:relative;"><table><tr><td class="code"><pre class="bash" style="font-family:monospace;"><span style="color: #7a0874; font-weight: bold;">&#91;</span><span style="color: #000000;">2013</span>-07-<span style="color: #000000;">26</span> <span style="color: #000000;">14</span>:<span style="color: #000000;">25</span>:<span style="color: #000000;">46</span>,<span style="color: #000000;">646</span>: INFO<span style="color: #000000; font-weight: bold;">/</span>MainProcess<span style="color: #7a0874; font-weight: bold;">&#93;</span> Got task from broker: tasks.ecount<span style="color: #7a0874; font-weight: bold;">&#91;</span>5d072a7b-29f8-4ea6-8d92-6a4c1740d724<span style="color: #7a0874; font-weight: bold;">&#93;</span>
<span style="color: #7a0874; font-weight: bold;">&#91;</span><span style="color: #000000;">2013</span>-07-<span style="color: #000000;">26</span> <span style="color: #000000;">14</span>:<span style="color: #000000;">25</span>:<span style="color: #000000;">46</span>,<span style="color: #000000;">649</span>: INFO<span style="color: #000000; font-weight: bold;">/</span>MainProcess<span style="color: #7a0874; font-weight: bold;">&#93;</span> Got task from broker: tasks.ecount<span style="color: #7a0874; font-weight: bold;">&#91;</span>402f6a4f-6b35-4f62-a786-9a5ba27707d2<span style="color: #7a0874; font-weight: bold;">&#93;</span>
<span style="color: #7a0874; font-weight: bold;">&#91;</span><span style="color: #000000;">2013</span>-07-<span style="color: #000000;">26</span> <span style="color: #000000;">14</span>:<span style="color: #000000;">25</span>:<span style="color: #000000;">46</span>,<span style="color: #000000;">650</span>: INFO<span style="color: #000000; font-weight: bold;">/</span>MainProcess<span style="color: #7a0874; font-weight: bold;">&#93;</span> Got task from broker: tasks.ecount<span style="color: #7a0874; font-weight: bold;">&#91;</span>bbe46b1b-<span style="color: #000000;">4719</span>-4c42-bd2f-21e4d72e613e<span style="color: #7a0874; font-weight: bold;">&#93;</span>
<span style="color: #7a0874; font-weight: bold;">&#91;</span><span style="color: #000000;">2013</span>-07-<span style="color: #000000;">26</span> <span style="color: #000000;">14</span>:<span style="color: #000000;">25</span>:<span style="color: #000000;">46</span>,<span style="color: #000000;">652</span>: INFO<span style="color: #000000; font-weight: bold;">/</span>MainProcess<span style="color: #7a0874; font-weight: bold;">&#93;</span> Got task from broker: tasks.ecount<span style="color: #7a0874; font-weight: bold;">&#91;</span>8fb35186-66e2-4eae-a40c-fc42e500ab9d<span style="color: #7a0874; font-weight: bold;">&#93;</span>
<span style="color: #7a0874; font-weight: bold;">&#91;</span><span style="color: #000000;">2013</span>-07-<span style="color: #000000;">26</span> <span style="color: #000000;">14</span>:<span style="color: #000000;">25</span>:<span style="color: #000000;">46</span>,<span style="color: #000000;">653</span>: INFO<span style="color: #000000; font-weight: bold;">/</span>MainProcess<span style="color: #7a0874; font-weight: bold;">&#93;</span> Got task from broker: tasks.ecount<span style="color: #7a0874; font-weight: bold;">&#91;</span>fc63f5db-8ade-<span style="color: #000000;">4383</span>-b719-c3d6390ca246<span style="color: #7a0874; font-weight: bold;">&#93;</span>
<span style="color: #7a0874; font-weight: bold;">&#91;</span><span style="color: #000000;">2013</span>-07-<span style="color: #000000;">26</span> <span style="color: #000000;">14</span>:<span style="color: #000000;">25</span>:<span style="color: #000000;">46</span>,<span style="color: #000000;">654</span>: INFO<span style="color: #000000; font-weight: bold;">/</span>MainProcess<span style="color: #7a0874; font-weight: bold;">&#93;</span> Got task from broker: tasks.ecount<span style="color: #7a0874; font-weight: bold;">&#91;</span>8434e21d-79ea-<span style="color: #000000;">4559</span>-a90e-92e2bc2b9dc7<span style="color: #7a0874; font-weight: bold;">&#93;</span>
<span style="color: #7a0874; font-weight: bold;">&#91;</span><span style="color: #000000;">2013</span>-07-<span style="color: #000000;">26</span> <span style="color: #000000;">14</span>:<span style="color: #000000;">25</span>:<span style="color: #000000;">47</span>,<span style="color: #000000;">144</span>: INFO<span style="color: #000000; font-weight: bold;">/</span>MainProcess<span style="color: #7a0874; font-weight: bold;">&#93;</span> Task tasks.ecount<span style="color: #7a0874; font-weight: bold;">&#91;</span>bbe46b1b-<span style="color: #000000;">4719</span>-4c42-bd2f-21e4d72e613e<span style="color: #7a0874; font-weight: bold;">&#93;</span> succeeded <span style="color: #000000; font-weight: bold;">in</span> 0.479865789413s: <span style="color: #000000;">27</span>
<span style="color: #7a0874; font-weight: bold;">&#91;</span><span style="color: #000000;">2013</span>-07-<span style="color: #000000;">26</span> <span style="color: #000000;">14</span>:<span style="color: #000000;">25</span>:<span style="color: #000000;">47</span>,<span style="color: #000000;">242</span>: INFO<span style="color: #000000; font-weight: bold;">/</span>MainProcess<span style="color: #7a0874; font-weight: bold;">&#93;</span> Task tasks.ecount<span style="color: #7a0874; font-weight: bold;">&#91;</span>5d072a7b-29f8-4ea6-8d92-6a4c1740d724<span style="color: #7a0874; font-weight: bold;">&#93;</span> succeeded <span style="color: #000000; font-weight: bold;">in</span> 0.578661203384s: <span style="color: #000000;">609</span>
<span style="color: #7a0874; font-weight: bold;">&#91;</span><span style="color: #000000;">2013</span>-07-<span style="color: #000000;">26</span> <span style="color: #000000;">14</span>:<span style="color: #000000;">25</span>:<span style="color: #000000;">47</span>,<span style="color: #000000;">501</span>: INFO<span style="color: #000000; font-weight: bold;">/</span>MainProcess<span style="color: #7a0874; font-weight: bold;">&#93;</span> Task tasks.ecount<span style="color: #7a0874; font-weight: bold;">&#91;</span>fc63f5db-8ade-<span style="color: #000000;">4383</span>-b719-c3d6390ca246<span style="color: #7a0874; font-weight: bold;">&#93;</span> succeeded <span style="color: #000000; font-weight: bold;">in</span> 0.35736989975s: <span style="color: #000000;">263</span>
<span style="color: #7a0874; font-weight: bold;">&#91;</span><span style="color: #000000;">2013</span>-07-<span style="color: #000000;">26</span> <span style="color: #000000;">14</span>:<span style="color: #000000;">25</span>:<span style="color: #000000;">47</span>,<span style="color: #000000;">645</span>: INFO<span style="color: #000000; font-weight: bold;">/</span>MainProcess<span style="color: #7a0874; font-weight: bold;">&#93;</span> Task tasks.ecount<span style="color: #7a0874; font-weight: bold;">&#91;</span>8434e21d-79ea-<span style="color: #000000;">4559</span>-a90e-92e2bc2b9dc7<span style="color: #7a0874; font-weight: bold;">&#93;</span> succeeded <span style="color: #000000; font-weight: bold;">in</span> 0.403187036514s: <span style="color: #000000;">1270</span>
<span style="color: #7a0874; font-weight: bold;">&#91;</span><span style="color: #000000;">2013</span>-07-<span style="color: #000000;">26</span> <span style="color: #000000;">14</span>:<span style="color: #000000;">25</span>:<span style="color: #000000;">47</span>,<span style="color: #000000;">815</span>: INFO<span style="color: #000000; font-weight: bold;">/</span>MainProcess<span style="color: #7a0874; font-weight: bold;">&#93;</span> Task tasks.ecount<span style="color: #7a0874; font-weight: bold;">&#91;</span>8fb35186-66e2-4eae-a40c-fc42e500ab9d<span style="color: #7a0874; font-weight: bold;">&#93;</span> succeeded <span style="color: #000000; font-weight: bold;">in</span> 1.14100408554s: <span style="color: #000000;">23</span>
<span style="color: #7a0874; font-weight: bold;">&#91;</span><span style="color: #000000;">2013</span>-07-<span style="color: #000000;">26</span> <span style="color: #000000;">14</span>:<span style="color: #000000;">25</span>:<span style="color: #000000;">49</span>,010: INFO<span style="color: #000000; font-weight: bold;">/</span>MainProcess<span style="color: #7a0874; font-weight: bold;">&#93;</span> Task tasks.ecount<span style="color: #7a0874; font-weight: bold;">&#91;</span>402f6a4f-6b35-4f62-a786-9a5ba27707d2<span style="color: #7a0874; font-weight: bold;">&#93;</span> succeeded <span style="color: #000000; font-weight: bold;">in</span> 2.34633708s: <span style="color: #000000;">3158</span></pre></td></tr></table><p class="theCode" style="display:none;">[2013-07-26 14:25:46,646: INFO/MainProcess] Got task from broker: tasks.ecount[5d072a7b-29f8-4ea6-8d92-6a4c1740d724]
[2013-07-26 14:25:46,649: INFO/MainProcess] Got task from broker: tasks.ecount[402f6a4f-6b35-4f62-a786-9a5ba27707d2]
[2013-07-26 14:25:46,650: INFO/MainProcess] Got task from broker: tasks.ecount[bbe46b1b-4719-4c42-bd2f-21e4d72e613e]
[2013-07-26 14:25:46,652: INFO/MainProcess] Got task from broker: tasks.ecount[8fb35186-66e2-4eae-a40c-fc42e500ab9d]
[2013-07-26 14:25:46,653: INFO/MainProcess] Got task from broker: tasks.ecount[fc63f5db-8ade-4383-b719-c3d6390ca246]
[2013-07-26 14:25:46,654: INFO/MainProcess] Got task from broker: tasks.ecount[8434e21d-79ea-4559-a90e-92e2bc2b9dc7]
[2013-07-26 14:25:47,144: INFO/MainProcess] Task tasks.ecount[bbe46b1b-4719-4c42-bd2f-21e4d72e613e] succeeded in 0.479865789413s: 27
[2013-07-26 14:25:47,242: INFO/MainProcess] Task tasks.ecount[5d072a7b-29f8-4ea6-8d92-6a4c1740d724] succeeded in 0.578661203384s: 609
[2013-07-26 14:25:47,501: INFO/MainProcess] Task tasks.ecount[fc63f5db-8ade-4383-b719-c3d6390ca246] succeeded in 0.35736989975s: 263
[2013-07-26 14:25:47,645: INFO/MainProcess] Task tasks.ecount[8434e21d-79ea-4559-a90e-92e2bc2b9dc7] succeeded in 0.403187036514s: 1270
[2013-07-26 14:25:47,815: INFO/MainProcess] Task tasks.ecount[8fb35186-66e2-4eae-a40c-fc42e500ab9d] succeeded in 1.14100408554s: 23
[2013-07-26 14:25:49,010: INFO/MainProcess] Task tasks.ecount[402f6a4f-6b35-4f62-a786-9a5ba27707d2] succeeded in 2.34633708s: 3158</p></div>

<p>Car du coup on sait que ces multiples tâches ne vont pas bloquer le processus en cour, mais qu&#8217;en plus la charge sera répartie sur le nombre de workers qu&#8217;on a décidé au départ, ni plus (surcharge du serveur), ni moins (traitement trop lent).</p>
<h2>Comment je sais quand une tâche est terminée ?</h2>
<p>On peut attendre que la tâche soit terminée :</p>

<div class="wp_syntax" style="position:relative;"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #66cc66;">&gt;&gt;&gt;</span> <span style="color: #ff7700;font-weight:bold;">print</span> res.<span style="color: black;">wait</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
<span style="color: #ff4500;">9999</span></pre></td></tr></table><p class="theCode" style="display:none;">&gt;&gt;&gt; print res.wait()
9999</p></div>

<p>Mais ce n&#8217;est pas vraiment le but. On cherche avant tout à ce que les tâches soient non bloquantes, et exécutées dans un processus à part voir potentiellement distribuées sur plusieurs serveurs. </p>
<p>Par ailleurs, Celery n&#8217;est pas un remplacement d&#8217;un système de traitement asynchrone comme Tornado ou NodeJS, il n&#8217;est pas fait pour envoyer des réponses asynchrones à l&#8217;utilisateur. Il est fait pour faire des tâches en background, répartir la charge et ordonner le traitement. Bien entendu, on peut faire communiquer un système asynchrone avec celery comme <a href="https://github.com/mher/tornado-celery">ici</a> ou <a href="http://cyberfart.blogspot.fr/2012/11/tornado-celery-integration.html">ici</a>, mais c&#8217;est une autre histoire.</p>
<p>Concentrons nous sur les tâches.</p>
<p>La question de &#8220;Comment je sais quand une tâche est terminée ?&#8221; est souvent traduisible par &#8220;comment je réagis à une tâche pour lancer du code quand elle s&#8217;est terminée sans erreur ?&#8221;.</p>
<p>Et là, il y une solution toute simple :</p>

<div class="wp_syntax" style="position:relative;"><table><tr><td class="code"><pre class="python" style="font-family:monospace;">res <span style="color: #66cc66;">=</span> tache1.<span style="color: black;">s</span><span style="color: black;">&#40;</span>arg1<span style="color: #66cc66;">,</span> arg2<span style="color: black;">&#41;</span> | tache2.<span style="color: black;">s</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span> | tache3.<span style="color: black;">s</span><span style="color: black;">&#40;</span>arg1<span style="color: black;">&#41;</span></pre></td></tr></table><p class="theCode" style="display:none;">res = tache1.s(arg1, arg2) | tache2.s() | tache3.s(arg1)</p></div>

<p>Ceci va créer une chaîne de tâches. Quand la première se termine, la deuxième se lance en recevant le résultat de la première en argument.</p>
<p><code>s()</code> fabrique une sous-tâche, c&#8217;est à dire une tâche à envoyer dans la file plus tard avec des arguments pré-enregistrés. Dans notre exemple, celery va lancer <code>tache1</code> avec deux arguments, puis si ça marche, va appeler <code>tache2</code> en lui passant le résultat de <code>tache1</code> comme argument, puis si ça marche, va appeler <code>tache3</code> avec le résultat de <code>tache2</code> en premier argument et <code>arg1</code> en second argument.</p>
<p>En fait, celery vient avec tout <a href="http://docs.celeryproject.org/en/latest/userguide/canvas.html?highlight=group">un tas d&#8217;outils</a> pour exécuter des tâches dépendantes les unes des autres : par groupes, par chaînes, par morceaux, etc. Mais de toute façon, vous pouvez appeler une tâche&#8230; à l&#8217;intérieur d&#8217;une autre tâche. Donc parti de là vous pouvez faire pas mal de choses.</p>
<h2>Comment je fais pour faire une tâche récurrente ?</h2>
<p>C&#8217;est là qu&#8217;intervient le &#8220;beat&#8221; dont j&#8217;ai parlé tout à l&#8217;heure. Avec cette option, celery va vérifier toutes les secondes si il n&#8217;y a pas une tâche répétitive à lancer, et la mettre dans une file d&#8217;attente, à la manière d&#8217;un cron.</p>
<p>Il suffit de définir une tâche comme <code>periodic_task</code> pour qu&#8217;elle soit lancée régulièrement.</p>

<div class="wp_syntax" style="position:relative;"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">import</span> <span style="color: #dc143c;">smtplib</span>
&nbsp;
<span style="color: #ff7700;font-weight:bold;">from</span> celery.<span style="color: black;">schedules</span> <span style="color: #ff7700;font-weight:bold;">import</span> crontab
<span style="color: #ff7700;font-weight:bold;">from</span> celery.<span style="color: black;">decorators</span> <span style="color: #ff7700;font-weight:bold;">import</span> periodic_task
&nbsp;
<span style="color: #808080; font-style: italic;"># va executer la tâche à 5h30, 13h30 et 23h30 tous les lundi</span>
<span style="color: #808080; font-style: italic;"># run_every accepte aussi un timedelta, pour par exemple dire &quot;toutes les 10m&quot;</span>
<span style="color: #66cc66;">@</span>periodic_task<span style="color: black;">&#40;</span>run_every<span style="color: #66cc66;">=</span>crontab<span style="color: black;">&#40;</span>hour<span style="color: #66cc66;">=</span><span style="color: #483d8b;">'5,13,23'</span><span style="color: #66cc66;">,</span> minute<span style="color: #66cc66;">=</span><span style="color: #ff4500;">30</span><span style="color: #66cc66;">,</span> day_of_week<span style="color: #66cc66;">=</span><span style="color: #483d8b;">'monday'</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span>
<span style="color: #ff7700;font-weight:bold;">def</span> is_alive<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>:
    <span style="color: #483d8b;">&quot;&quot;&quot;
        Vérifie que le blog est toujours en ligne, et si ce n'est pas le cas,
        envoie un mail en panique.
    &quot;&quot;&quot;</span>
    <span style="color: #ff7700;font-weight:bold;">if</span> <span style="color: #dc143c;">urllib2</span>.<span style="color: black;">urlopen</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'http://sametmax.com'</span><span style="color: black;">&#41;</span>.<span style="color: #dc143c;">code</span> <span style="color: #66cc66;">!=</span> <span style="color: #ff4500;">200</span>:
        mail <span style="color: #66cc66;">=</span> <span style="color: #483d8b;">'lesametlemax__AT__gmail.com'</span>.<span style="color: black;">replace</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'__AT__'</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'@'</span><span style="color: black;">&#41;</span>
        server <span style="color: #66cc66;">=</span> <span style="color: #dc143c;">smtplib</span>.<span style="color: black;">SMTP</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'smtp.gmail.com:587'</span><span style="color: black;">&#41;</span>
        server.<span style="color: black;">starttls</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
        server.<span style="color: black;">login</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'root'</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'admin123'</span><span style="color: black;">&#41;</span>
        server.<span style="color: black;">sendmail</span><span style="color: black;">&#40;</span>mail<span style="color: #66cc66;">,</span> mail<span style="color: #66cc66;">,</span> msg<span style="color: black;">&#41;</span>
        server.<span style="color: black;">quit</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span></pre></td></tr></table><p class="theCode" style="display:none;">import smtplib

from celery.schedules import crontab
from celery.decorators import periodic_task

# va executer la tâche à 5h30, 13h30 et 23h30 tous les lundi
# run_every accepte aussi un timedelta, pour par exemple dire &quot;toutes les 10m&quot;
@periodic_task(run_every=crontab(hour='5,13,23', minute=30, day_of_week='monday'))
def is_alive():
    &quot;&quot;&quot;
        Vérifie que le blog est toujours en ligne, et si ce n'est pas le cas,
        envoie un mail en panique.
    &quot;&quot;&quot;
    if urllib2.urlopen('http://sametmax.com').code != 200:
        mail = 'lesametlemax__AT__gmail.com'.replace('__AT__', '@')
        server = smtplib.SMTP('smtp.gmail.com:587')
        server.starttls()
        server.login('root', 'admin123')
        server.sendmail(mail, mail, msg)
        server.quit()</p></div>

<p>Il y a de <a href="http://docs.celeryproject.org/en/latest/userguide/periodic-tasks.html?highlight=cron">bons exemples</a> sur la syntaxe sur <code>crontab()</code> dans la doc.</p>
<p>D&#8217;une manière générale, <a href="http://docs.celeryproject.org/en/latest/getting-started/introduction.html">la doc de Celery est très très riche</a>, donc plongez vous dedans si cet article ne répond pas à vos besoins, car si ça peut être mis dans une file, ça peut être fait par Celery.</p>
<h2>Note de fin</h2>
<p>Celery n&#8217;autoreload pas le code, donc redémarrez les workers à chaque fois que vous modifiez vos tasks.</p>
<p>Attention aussi aux tâches récurrentes, la suivante peut se lancer avant que la précédente soit terminée. C&#8217;est à vous de faire des tâches <a href="https://fr.wikipedia.org/wiki/Idempotent">idempotentes</a>, ou alors de mettre en place <a href="http://docs.celeryproject.org/en/latest/tutorials/task-cookbook.html#cookbook-task-serial">un système de locking</a>.</p>
<div class="sharedaddy sd-sharing-enabled"><div class="robots-nocontent sd-block sd-social sd-social-official sd-sharing"><h3 class="sd-title">Partager:</h3><div class="sd-content"><ul><li class="share-twitter"><a href="https://twitter.com/share" class="twitter-share-button" data-url="http://sametmax.com/files-de-taches-et-taches-recurrentes-avec-celery/" data-text="Files de tâches et tâches récurrentes avec Celery"  >Tweet</a></li><li class="share-facebook"><div class="fb-share-button" data-href="http://sametmax.com/files-de-taches-et-taches-recurrentes-avec-celery/" data-layout="button_count"></div></li><li class="share-google-plus-1"><div class="googleplus1_button"><div class="g-plus" data-action="share" data-annotation="bubble" data-href="http://sametmax.com/files-de-taches-et-taches-recurrentes-avec-celery/"></div></div></li><li class="share-email"><a rel="nofollow" data-shared="" class="share-email sd-button" href="index.html%3Fshare=email.html" rel="noopener noreferrer" target="_blank" title="Click to email this to a friend"><span>Email</span></a></li><li><a href="index.html%3Fshare=email.html#" class="sharing-anchor sd-button share-more"><span>More</span></a></li><li class="share-end"></li></ul><div class="sharing-hidden"><div class="inner" style="display: none;"><ul><li class="share-reddit"><div class="reddit_button"><iframe src="http://www.reddit.com/static/button/button1.html?newwindow=true&width=120&amp;url=http%3A%2F%2Fsametmax.com%2Ffiles-de-taches-et-taches-recurrentes-avec-celery%2F&amp;title=Files%20de%20t%C3%A2ches%20et%20t%C3%A2ches%20r%C3%A9currentes%20avec%20Celery" height="22" width="120" scrolling="no" frameborder="0"></iframe></div></li><li class="share-pinterest"><div class="pinterest_button"><a href="https://www.pinterest.com/pin/create/button/?url=http%3A%2F%2Fsametmax.com%2Ffiles-de-taches-et-taches-recurrentes-avec-celery%2F&#038;media=http%3A%2F%2Fsametmax.com%2Fwp-content%2Fuploads%2F2013%2F07%2FzdFRjr1.jpg&#038;description=Files%20de%20t%C3%A2ches%20et%20t%C3%A2ches%20r%C3%A9currentes%20avec%20Celery" data-pin-do="buttonPin" data-pin-config="beside"><img src="http://assets.pinterest.com/images/pidgets/pinit_fg_en_rect_gray_20.png" /></a></div></li><li class="share-end"></li><li class="share-tumblr"><a target="_blank" href="https://www.tumblr.com/share/link/?url=http%3A%2F%2Fsametmax.com%2Ffiles-de-taches-et-taches-recurrentes-avec-celery%2F&name=Files%20de%20t%C3%A2ches%20et%20t%C3%A2ches%20r%C3%A9currentes%20avec%20Celery" title="Share on Tumblr" style="display:inline-block; text-indent:-9999px; overflow:hidden; width:62px; height:20px; background:url('https://platform.tumblr.com/v1/share_2.png') top left no-repeat transparent;">Share on Tumblr</a></li><li class="share-pocket"><div class="pocket_button"><a href="https://getpocket.com/save" class="pocket-btn" data-lang="en" data-save-url="http://sametmax.com/files-de-taches-et-taches-recurrentes-avec-celery/" data-pocket-count="horizontal" >Pocket</a></div></li><li class="share-end"></li><li class="share-end"></li></ul></div></div></div></div></div>                        </section><!-- .entry-content -->

        <footer class="entry-meta"><hr class="featurette-divider"><div class="author-info"><div class="row-fluid"><div class="comment-avatar author-avatar span2"><img alt='' src='http://2.gravatar.com/avatar/bf9ecde8f5e286de6ce5c80206cf9dd6?s=100&#038;d=retro&#038;r=x' srcset='http://2.gravatar.com/avatar/bf9ecde8f5e286de6ce5c80206cf9dd6?s=200&#038;d=retro&#038;r=x 2x' class='avatar avatar-100 photo' height='100' width='100' /></div> <div class="author-description span10"><h3>About Sam</h3><p>Waf !</p><div class="author-link"><a href="../author/sam/index.html" rel="author">View all posts by Sam <span class="meta-nav">&rarr;</span></a></div></div></div></div></footer>                                    </article>
                                
                            
                        
                    
<div id="comments" class="comments-area" >
	<h2 id="tc-comment-title" class="comments-title">29 thoughts on &ldquo;<span>Files de tâches et tâches récurrentes avec Celery</span>&rdquo;</h2>              <ul class="commentlist">
                        <li class="comment even thread-even depth-1" id="li-comment-11715">
          
            <article id="comment-11715" class="comment"><div class="row-fluid"><div class="comment-avatar span2"><img alt='' src='http://0.gravatar.com/avatar/fc32c6686686ecc595f05ad1885c2fb3?s=80&#038;d=retro&#038;r=x' srcset='http://0.gravatar.com/avatar/fc32c6686686ecc595f05ad1885c2fb3?s=160&#038;d=retro&#038;r=x 2x' class='avatar avatar-80 photo' height='80' width='80' /></div><div class="span10"> <header class="comment-meta comment-author vcard"><cite class="fn">roro  </cite> <a class="comment-date" href="index.html#comment-11715"><time datetime="2013-07-27T08:33:44+00:00">27/07/2013 at 08:33</time></a></header>  <section class="comment-content comment"><p>Il n&#8217;y a plus qu&#8217;a ajouter que le céleri est une plante hermaphrodite&#8230;cqfd</p>
</section></div></div></article>          <!-- #comment-## -->
        </li><!-- #comment-## -->
        <li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-11716">
          
            <article id="comment-11716" class="comment"><div class="row-fluid"><div class="comment-avatar span2"><img alt='' src='http://1.gravatar.com/avatar/aa90c4c03161ec318afbeb65b6927bb9?s=80&#038;d=retro&#038;r=x' srcset='http://1.gravatar.com/avatar/aa90c4c03161ec318afbeb65b6927bb9?s=160&#038;d=retro&#038;r=x 2x' class='avatar avatar-80 photo' height='80' width='80' /></div><div class="span10"> <header class="comment-meta comment-author vcard"><cite class="fn"><a href='http://kaos-idea.com/' rel='external nofollow' class='url'>Kaos Idea</a>  </cite> <a class="comment-date" href="index.html#comment-11716"><time datetime="2013-07-27T10:42:06+00:00">27/07/2013 at 10:42</time></a></header>  <section class="comment-content comment"><p>L&#8217;article que j&#8217;attendais depuis un moment. Merci pour votre retour sur l&#8217;utilisation de python.</p>
</section></div></div></article>          <!-- #comment-## -->
        </li><!-- #comment-## -->
        <li class="comment even thread-even depth-1" id="li-comment-11726">
          
            <article id="comment-11726" class="comment"><div class="row-fluid"><div class="comment-avatar span2"><img alt='' src='http://1.gravatar.com/avatar/a16497d1d99ae5ebcf3d8547a7dff9ed?s=80&#038;d=retro&#038;r=x' srcset='http://1.gravatar.com/avatar/a16497d1d99ae5ebcf3d8547a7dff9ed?s=160&#038;d=retro&#038;r=x 2x' class='avatar avatar-80 photo' height='80' width='80' /></div><div class="span10"> <header class="comment-meta comment-author vcard"><cite class="fn"><a href='http://www.benabi.net' rel='external nofollow' class='url'>Ali</a>  </cite> <a class="comment-date" href="index.html#comment-11726"><time datetime="2013-07-28T05:47:04+00:00">28/07/2013 at 05:47</time></a></header>  <section class="comment-content comment"><p>Merci, excellent article meme si je ne suis pas très fan de Python.</p>
</section></div></div></article>          <!-- #comment-## -->
        </li><!-- #comment-## -->
        <li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-11727">
          
            <article id="comment-11727" class="comment"><div class="row-fluid"><div class="comment-avatar span2"><img alt='' src='http://0.gravatar.com/avatar/f0be159c1cf58c64f5fb6b3dbfa12e9c?s=80&#038;d=retro&#038;r=x' srcset='http://0.gravatar.com/avatar/f0be159c1cf58c64f5fb6b3dbfa12e9c?s=160&#038;d=retro&#038;r=x 2x' class='avatar avatar-80 photo' height='80' width='80' /></div><div class="span10"> <header class="comment-meta comment-author vcard"><cite class="fn">Benjamin  </cite> <a class="comment-date" href="index.html#comment-11727"><time datetime="2013-07-28T08:04:08+00:00">28/07/2013 at 08:04</time></a></header>  <section class="comment-content comment"><p>Lien cassé: <a href="http://sametmax.com/files-de-taches-et-taches-recurrentes-avec-celery/tache1" rel="nofollow">http://sametmax.com/files-de-taches-et-taches-recurrentes-avec-celery/tache1</a></p>
<p>Bon article, mais ce qui reste obscure pour moi avec Celery, c&#8217;est à quoi servent le broker. Par exemple, j&#8217;utilise MongoDb et je vois les nouvelles collections <code>messages</code>, <code>messages.routing</code>, et <code>messages.broadcast</code>, mais je n&#8217;arrive toujours pas à comprendre leur fonction. Autre question, comment supprimer une tâche de la file d&#8217;attente?</p>
</section></div></div></article>          <!-- #comment-## -->
        </li><!-- #comment-## -->
        <li class="comment byuser comment-author-sam bypostauthor even thread-even depth-1" id="li-comment-11728">
          
            <article id="comment-11728" class="comment"><div class="row-fluid"><div class="comment-avatar span2"><img alt='' src='http://2.gravatar.com/avatar/bf9ecde8f5e286de6ce5c80206cf9dd6?s=80&#038;d=retro&#038;r=x' srcset='http://2.gravatar.com/avatar/bf9ecde8f5e286de6ce5c80206cf9dd6?s=160&#038;d=retro&#038;r=x 2x' class='avatar avatar-80 photo' height='80' width='80' /></div><div class="span10"> <header class="comment-meta comment-author vcard"><cite class="fn">Sam <span> Post author</span> </cite> <a class="comment-date" href="index.html#comment-11728"><time datetime="2013-07-28T08:43:30+00:00">28/07/2013 at 08:43</time></a></header>  <section class="comment-content comment"><p>Le broken est le système qui :</p>
<p>&#8211; stocke les files d&#8217;attentes<br />
&#8211; s&#8217;assure que la bonne tache est dans la bonne file d&#8217;attente<br />
&#8211; ordonne les taches dans les files d&#8217;attentes<br />
&#8211; permet de récupérer la prochaine tâche à effectuer dans la file d&#8217;attente donnée</p>
<p>Celery ne fait qu&#8217;appeler des fonctions du broker pour fonctionner.</p>
<p>Il faut bien comprendre que le broker doit pouvoir representer une file ordonnée, y accéder de manière concurrente depuis n&#8217;importe quel système connecté en local ou à distance, mettre des labels sur les files, etc.</p>
<p>Certains système, comme AMPQ, sont spécialisés là dedans, d&#8217;autre, comme les bases de données, sont détournées pour cela.</p>
<p>Par exemple, dans le cadre de MongoDB, il y a une collection messages qui va contenir toutes les tâches (à la base, un broker est un livreur de message, et par dessus on créer des files de tâches, mais on peut s&#8217;en servir pour plein d&#8217;autre choses).<br />
Ensuite il y a une collection routing qui contient les informations pour savoir dans quelle liste mettre quelle tâche. En effet, il peut y avoir des centaines de files, avec des labels, et une tâches peut être &#8220;routée&#8221; vers une file ou une autre selon le besoin (je ne l&#8217;ai pas montré dans l&#8217;article, car c&#8217;est un usage avancé). Enfin broadcast contient les informations qui spécifient à qui propager l&#8217;information une fois qu&#8217;un message, ici notre tâche, a été traité.</p>
<p>Par contre pour supprimer une tâche, t&#8217;as vraiment fais ta feignasse, ça m&#8217;a pris 3 secondes pour trouver ça sur un moteur de recherche :</p>

<div class="wp_syntax" style="position:relative;"><table><tr><td class="code"><pre class="python" style="font-family:monospace;">celery.<span style="color: black;">control</span>.<span style="color: black;">revoke</span><span style="color: black;">&#40;</span>uuid<span style="color: #66cc66;">,</span> terminate<span style="color: #66cc66;">=</span><span style="color: #008000;">True</span><span style="color: black;">&#41;</span></pre></td></tr></table><p class="theCode" style="display:none;">celery.control.revoke(uuid, terminate=True)</p></div>

<p>Merci pour le signalement du lien mort.</p>
</section></div></div></article>          <!-- #comment-## -->
        </li><!-- #comment-## -->
        <li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-11733">
          
            <article id="comment-11733" class="comment"><div class="row-fluid"><div class="comment-avatar span2"><img alt='' src='http://0.gravatar.com/avatar/fc32c6686686ecc595f05ad1885c2fb3?s=80&#038;d=retro&#038;r=x' srcset='http://0.gravatar.com/avatar/fc32c6686686ecc595f05ad1885c2fb3?s=160&#038;d=retro&#038;r=x 2x' class='avatar avatar-80 photo' height='80' width='80' /></div><div class="span10"> <header class="comment-meta comment-author vcard"><cite class="fn">roro  </cite> <a class="comment-date" href="index.html#comment-11733"><time datetime="2013-07-28T12:48:35+00:00">28/07/2013 at 12:48</time></a></header>  <section class="comment-content comment"><p>@Sam:&#8221;&#8230;et par dessus on créer&#8221; &#8211;&gt; on crée.<br />
Cela donne l&#8217;impression que ta pensée a été modifiée sur le parcours cerveau/main.<br />
Tu nous aurais pas choppé un trojan ?</p>
</section></div></div></article>          <!-- #comment-## -->
        </li><!-- #comment-## -->
        <li class="comment byuser comment-author-sam bypostauthor even thread-even depth-1" id="li-comment-11738">
          
            <article id="comment-11738" class="comment"><div class="row-fluid"><div class="comment-avatar span2"><img alt='' src='http://2.gravatar.com/avatar/bf9ecde8f5e286de6ce5c80206cf9dd6?s=80&#038;d=retro&#038;r=x' srcset='http://2.gravatar.com/avatar/bf9ecde8f5e286de6ce5c80206cf9dd6?s=160&#038;d=retro&#038;r=x 2x' class='avatar avatar-80 photo' height='80' width='80' /></div><div class="span10"> <header class="comment-meta comment-author vcard"><cite class="fn">Sam <span> Post author</span> </cite> <a class="comment-date" href="index.html#comment-11738"><time datetime="2013-07-28T15:28:57+00:00">28/07/2013 at 15:28</time></a></header>  <section class="comment-content comment"><p>Arf, je vais pas aller jusqu&#8217;à corriger les comments, sinon je suis parti pour l&#8217;asile.</p>
</section></div></div></article>          <!-- #comment-## -->
        </li><!-- #comment-## -->
        <li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-11743">
          
            <article id="comment-11743" class="comment"><div class="row-fluid"><div class="comment-avatar span2"><img alt='' src='http://2.gravatar.com/avatar/56a4d86cdd42d8d72cc78d821724c7f4?s=80&#038;d=retro&#038;r=x' srcset='http://2.gravatar.com/avatar/56a4d86cdd42d8d72cc78d821724c7f4?s=160&#038;d=retro&#038;r=x 2x' class='avatar avatar-80 photo' height='80' width='80' /></div><div class="span10"> <header class="comment-meta comment-author vcard"><cite class="fn">Kad  </cite> <a class="comment-date" href="index.html#comment-11743"><time datetime="2013-07-28T17:30:42+00:00">28/07/2013 at 17:30</time></a></header>  <section class="comment-content comment"><p>Il manque plus qu&#8217;un article sur supervisord et on pourra gérer un système rien qu&#8217;avec du python!!</p>
</section></div></div></article>          <!-- #comment-## -->
        </li><!-- #comment-## -->
        <li class="comment even thread-even depth-1" id="li-comment-11773">
          
            <article id="comment-11773" class="comment"><div class="row-fluid"><div class="comment-avatar span2"><img alt='' src='http://1.gravatar.com/avatar/4f42ed44f985c500a56a7a0b79dbfbf8?s=80&#038;d=retro&#038;r=x' srcset='http://1.gravatar.com/avatar/4f42ed44f985c500a56a7a0b79dbfbf8?s=160&#038;d=retro&#038;r=x 2x' class='avatar avatar-80 photo' height='80' width='80' /></div><div class="span10"> <header class="comment-meta comment-author vcard"><cite class="fn"><a href='http://ssimp.org' rel='external nofollow' class='url'>guatar</a>  </cite> <a class="comment-date" href="index.html#comment-11773"><time datetime="2013-07-29T07:22:50+00:00">29/07/2013 at 07:22</time></a></header>  <section class="comment-content comment"><p>En plus des files d&#8217;attentes tu peux aussi en faire de la <a href="http://www.marmiton.org/recettes/recette_celeri-remoulade_35874.aspx" rel="nofollow">remoulade de ton celeri</a> </p>
</section></div></div></article>          <!-- #comment-## -->
        </li><!-- #comment-## -->
        <li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-11801">
          
            <article id="comment-11801" class="comment"><div class="row-fluid"><div class="comment-avatar span2"><img alt='' src='http://1.gravatar.com/avatar/72487ae39590539b9e0c305458f61cca?s=80&#038;d=retro&#038;r=x' srcset='http://1.gravatar.com/avatar/72487ae39590539b9e0c305458f61cca?s=160&#038;d=retro&#038;r=x 2x' class='avatar avatar-80 photo' height='80' width='80' /></div><div class="span10"> <header class="comment-meta comment-author vcard"><cite class="fn">Fred  </cite> <a class="comment-date" href="index.html#comment-11801"><time datetime="2013-07-29T13:27:24+00:00">29/07/2013 at 13:27</time></a></header>  <section class="comment-content comment"><p>Merci :)<br />
Et +1 pour supervisord voire circus ! Perso j&#8217;utilise upstart pour lancer et manipuler mes démons (gunicorn notamment) mais je suis curieux de voir ce qui se fait à côté.</p>
</section></div></div></article>          <!-- #comment-## -->
        </li><!-- #comment-## -->
        <li class="comment even thread-even depth-1" id="li-comment-11813">
          
            <article id="comment-11813" class="comment"><div class="row-fluid"><div class="comment-avatar span2"><img alt='' src='http://0.gravatar.com/avatar/027a6afe88c7e6b2bcd56e2dd31e71bb?s=80&#038;d=retro&#038;r=x' srcset='http://0.gravatar.com/avatar/027a6afe88c7e6b2bcd56e2dd31e71bb?s=160&#038;d=retro&#038;r=x 2x' class='avatar avatar-80 photo' height='80' width='80' /></div><div class="span10"> <header class="comment-meta comment-author vcard"><cite class="fn">VonTenia  </cite> <a class="comment-date" href="index.html#comment-11813"><time datetime="2013-07-29T21:07:44+00:00">29/07/2013 at 21:07</time></a></header>  <section class="comment-content comment"><p>Marrant comme timing, je viens de passer le weekend a mettre en place un systeme anti-fraude sous celery et puis je decouvre votre article maintenant&#8230;<br />
Comme vous j&#8217;ai choisis d&#8217;utiliser un broker redis par simplicité. Quelqu&#8217;un avec de l&#8217;experience pourrait argumenter sur la superiorité de rabitMQ ? Parce que ca a l&#8217;air quand meme beaucoup plus complexe.<br />
Et je plussois ce qui est dit dans ce post a propos de la superiorite de celery comparé à vouloir faire son propre systeme de traitement asynchrone : on commence par se dire que celery, un broker et tout ca c&#8217;est un peu trop compliqué pour ce qu&#8217;on veut faire et au final on se retrouve a reinventer la roue en pensant faire plus simple&#8230; Bref meme pour un petit projet n&#8217;hesitez pas, utilisez celery. Perso je fais juste des verifications de coherences et un appel à une API sur les donnees envoyées et je ne voulais pas penaliser l&#8217;experience utilisateur avec ces verifications.</p>
</section></div></div></article>          <!-- #comment-## -->
        </li><!-- #comment-## -->
        <li class="comment byuser comment-author-sam bypostauthor odd alt thread-odd thread-alt depth-1" id="li-comment-11849">
          
            <article id="comment-11849" class="comment"><div class="row-fluid"><div class="comment-avatar span2"><img alt='' src='http://2.gravatar.com/avatar/bf9ecde8f5e286de6ce5c80206cf9dd6?s=80&#038;d=retro&#038;r=x' srcset='http://2.gravatar.com/avatar/bf9ecde8f5e286de6ce5c80206cf9dd6?s=160&#038;d=retro&#038;r=x 2x' class='avatar avatar-80 photo' height='80' width='80' /></div><div class="span10"> <header class="comment-meta comment-author vcard"><cite class="fn">Sam <span> Post author</span> </cite> <a class="comment-date" href="index.html#comment-11849"><time datetime="2013-07-30T11:11:44+00:00">30/07/2013 at 11:11</time></a></header>  <section class="comment-content comment"><p>RabbitMQ est avant tout un système de messagerie, et il est donc intéressant pour ce genre de chose. Par ailleurs, AMPQ est un protocole de PUSH, alors que sur des DB, on utilise du polling pour simuler le PUSH, du coup RabbitMQ est plus performant.</p>
<p>Pour la plupart des cas, on s&#8217;en branle.</p>
</section></div></div></article>          <!-- #comment-## -->
        </li><!-- #comment-## -->
        <li class="comment even thread-even depth-1" id="li-comment-11913">
          
            <article id="comment-11913" class="comment"><div class="row-fluid"><div class="comment-avatar span2"><img alt='' src='http://0.gravatar.com/avatar/f0a185474dc7c902e88efa53ea910cd9?s=80&#038;d=retro&#038;r=x' srcset='http://0.gravatar.com/avatar/f0a185474dc7c902e88efa53ea910cd9?s=160&#038;d=retro&#038;r=x 2x' class='avatar avatar-80 photo' height='80' width='80' /></div><div class="span10"> <header class="comment-meta comment-author vcard"><cite class="fn">Lhassa  </cite> <a class="comment-date" href="index.html#comment-11913"><time datetime="2013-07-30T22:49:48+00:00">30/07/2013 at 22:49</time></a></header>  <section class="comment-content comment"><p>m***** alors, je voulais vous demander comment vous gériez les files de tâches (pas les commentaires, hein&#8230;), et vous répondez avant que je questionne, trop fort.<br />
J&#8217;ai commencé à écrire mon propre truc, mais non seulement c&#8217;est évidement réinventer la roue (comme dit plus haut) parce que si j&#8217;y pense, d&#8217;autre aussi&#8230; mais en plus c&#8217;est nul.</p>
<p>MERCI à vous, ma prochaine bouteille de rouge vous sera dédiée, en attendant de perdre du temps avec plaisir au boulot, à enfin apprendre des trucs utile&#8230;</p>
</section></div></div></article>          <!-- #comment-## -->
        </li><!-- #comment-## -->
        <li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-18315">
          
            <article id="comment-18315" class="comment"><div class="row-fluid"><div class="comment-avatar span2"><img alt='' src='http://1.gravatar.com/avatar/aa3fbf033d64ff6d10f07d109eb4d521?s=80&#038;d=retro&#038;r=x' srcset='http://1.gravatar.com/avatar/aa3fbf033d64ff6d10f07d109eb4d521?s=160&#038;d=retro&#038;r=x 2x' class='avatar avatar-80 photo' height='80' width='80' /></div><div class="span10"> <header class="comment-meta comment-author vcard"><cite class="fn">Seb  </cite> <a class="comment-date" href="index.html#comment-18315"><time datetime="2014-01-14T20:55:10+00:00">14/01/2014 at 20:55</time></a></header>  <section class="comment-content comment"><p>Merci pour cet article mais j&#8217;ai juste une question&#8230; c&#8217;est quoi la différence avec APSheduler <a href="http://pythonhosted.org/APScheduler/" rel="nofollow">http://pythonhosted.org/APScheduler/</a> ?</p>
</section></div></div></article>          <!-- #comment-## -->
        </li><!-- #comment-## -->
        <li class="comment byuser comment-author-sam bypostauthor even thread-even depth-1" id="li-comment-18457">
          
            <article id="comment-18457" class="comment"><div class="row-fluid"><div class="comment-avatar span2"><img alt='' src='http://2.gravatar.com/avatar/bf9ecde8f5e286de6ce5c80206cf9dd6?s=80&#038;d=retro&#038;r=x' srcset='http://2.gravatar.com/avatar/bf9ecde8f5e286de6ce5c80206cf9dd6?s=160&#038;d=retro&#038;r=x 2x' class='avatar avatar-80 photo' height='80' width='80' /></div><div class="span10"> <header class="comment-meta comment-author vcard"><cite class="fn">Sam <span> Post author</span> </cite> <a class="comment-date" href="index.html#comment-18457"><time datetime="2014-01-15T14:45:09+00:00">15/01/2014 at 14:45</time></a></header>  <section class="comment-content comment"><p>C&#8217;est le même principe, mais celery support le routing, l&#8217;exécution sur plusieurs serveurs, plus de brokers, plus de support de stockages, le groupes de tâches, les tâches avec dépendances, et vient avec une grosse communauté (incluant les projets qui vont avec).</p>
<p>APScHeduler peut être intéressant pour un projet simple, et être vu comme comme bottle peut être comparé à Django.</p>
</section></div></div></article>          <!-- #comment-## -->
        </li><!-- #comment-## -->
        <li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-18951">
          
            <article id="comment-18951" class="comment"><div class="row-fluid"><div class="comment-avatar span2"><img alt='' src='http://0.gravatar.com/avatar/9f3c22452987f3195187c70300ae85d6?s=80&#038;d=retro&#038;r=x' srcset='http://0.gravatar.com/avatar/9f3c22452987f3195187c70300ae85d6?s=160&#038;d=retro&#038;r=x 2x' class='avatar avatar-80 photo' height='80' width='80' /></div><div class="span10"> <header class="comment-meta comment-author vcard"><cite class="fn">groug  </cite> <a class="comment-date" href="index.html#comment-18951"><time datetime="2014-01-25T16:06:46+00:00">25/01/2014 at 16:06</time></a></header>  <section class="comment-content comment"><p>J&#8217;adore Sam &amp; Max. J&#8217;ai un problème de tâche bloquante, je cherche un peu sur le net, je galère, je tombe finalement sur Celery sur SO, je fais ma désormais classique recherche &#8220;site:sametmax.com celery&#8221;, et là, bah oui, ils en avaient déjà parlé.<br />
Plus que le tag cloud, faudrait peut-être une page avec la liste exhaustive des tags utilisés dans les articles, ça permettrait peut-être de plus facilement chercher ce qu&#8217;on ne sait pas chercher !</p>
<p>En voyant les tags, complètement hors-sujet : c&#8217;est déjà arrivé que quelqu&#8217;un tombe sur le site en cherchant poo en anglais ? Genre &#8220;poo sex&#8221;. Ce serait géant.</p>
</section></div></div></article>          <!-- #comment-## -->
        <ul class="children">
        <li class="comment byuser comment-author-max even depth-2" id="li-comment-18954">
          
            <article id="comment-18954" class="comment"><div class="row-fluid"><div class="comment-avatar span2"><img alt='' src='http://2.gravatar.com/avatar/eb8e400eec222e2b09bd901aba2cb2dc?s=80&#038;d=retro&#038;r=x' srcset='http://2.gravatar.com/avatar/eb8e400eec222e2b09bd901aba2cb2dc?s=160&#038;d=retro&#038;r=x 2x' class='avatar avatar-80 photo' height='80' width='80' /></div><div class="span10"> <header class="comment-meta comment-author vcard"><cite class="fn">Max  </cite> <a class="comment-date" href="index.html#comment-18954"><time datetime="2014-01-25T17:46:54+00:00">25/01/2014 at 17:46</time></a></header>  <section class="comment-content comment"><p>genre ça ? <a href="../les-tags/index.html" rel="nofollow">http://sametmax.com/les-tags/</a></p>
</section></div></div></article>          <!-- #comment-## -->
        </li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
        <li class="comment byuser comment-author-sam bypostauthor odd alt thread-even depth-1" id="li-comment-18952">
          
            <article id="comment-18952" class="comment"><div class="row-fluid"><div class="comment-avatar span2"><img alt='' src='http://2.gravatar.com/avatar/bf9ecde8f5e286de6ce5c80206cf9dd6?s=80&#038;d=retro&#038;r=x' srcset='http://2.gravatar.com/avatar/bf9ecde8f5e286de6ce5c80206cf9dd6?s=160&#038;d=retro&#038;r=x 2x' class='avatar avatar-80 photo' height='80' width='80' /></div><div class="span10"> <header class="comment-meta comment-author vcard"><cite class="fn">Sam <span> Post author</span> </cite> <a class="comment-date" href="index.html#comment-18952"><time datetime="2014-01-25T16:15:13+00:00">25/01/2014 at 16:15</time></a></header>  <section class="comment-content comment"><p>Si il y a un plugin wordpress qui fait ça automatiquement, file moi le lien.</p>
<p>Pour la recherche, tu n&#8217;imagines pas les termes qui arrivent sur notre site. C&#8217;est ubuesque.</p>
</section></div></div></article>          <!-- #comment-## -->
        </li><!-- #comment-## -->
        <li class="comment even thread-odd thread-alt depth-1" id="li-comment-18958">
          
            <article id="comment-18958" class="comment"><div class="row-fluid"><div class="comment-avatar span2"><img alt='' src='http://0.gravatar.com/avatar/9f3c22452987f3195187c70300ae85d6?s=80&#038;d=retro&#038;r=x' srcset='http://0.gravatar.com/avatar/9f3c22452987f3195187c70300ae85d6?s=160&#038;d=retro&#038;r=x 2x' class='avatar avatar-80 photo' height='80' width='80' /></div><div class="span10"> <header class="comment-meta comment-author vcard"><cite class="fn">groug  </cite> <a class="comment-date" href="index.html#comment-18958"><time datetime="2014-01-25T19:34:54+00:00">25/01/2014 at 19:34</time></a></header>  <section class="comment-content comment"><p>Genre ça, oui !<br />
Faudrait peut-être aussi me filer une petite dizaine de bitcoins&#8230;</p>
</section></div></div></article>          <!-- #comment-## -->
        </li><!-- #comment-## -->
        <li class="comment byuser comment-author-sam bypostauthor odd alt thread-even depth-1" id="li-comment-18963">
          
            <article id="comment-18963" class="comment"><div class="row-fluid"><div class="comment-avatar span2"><img alt='' src='http://2.gravatar.com/avatar/bf9ecde8f5e286de6ce5c80206cf9dd6?s=80&#038;d=retro&#038;r=x' srcset='http://2.gravatar.com/avatar/bf9ecde8f5e286de6ce5c80206cf9dd6?s=160&#038;d=retro&#038;r=x 2x' class='avatar avatar-80 photo' height='80' width='80' /></div><div class="span10"> <header class="comment-meta comment-author vcard"><cite class="fn">Sam <span> Post author</span> </cite> <a class="comment-date" href="index.html#comment-18963"><time datetime="2014-01-25T21:46:55+00:00">25/01/2014 at 21:46</time></a></header>  <section class="comment-content comment"><p>Pas problème, donne moi les codes d&#8217;accès de ton compte de banque en ligne, et je t&#8217;envoies autant de bitcoins que tu veux.</p>
</section></div></div></article>          <!-- #comment-## -->
        </li><!-- #comment-## -->
        <li class="comment even thread-odd thread-alt depth-1" id="li-comment-49388">
          
            <article id="comment-49388" class="comment"><div class="row-fluid"><div class="comment-avatar span2"><img alt='' src='http://0.gravatar.com/avatar/02750b4cc6dd3cf5450573623a020105?s=80&#038;d=retro&#038;r=x' srcset='http://0.gravatar.com/avatar/02750b4cc6dd3cf5450573623a020105?s=160&#038;d=retro&#038;r=x 2x' class='avatar avatar-80 photo' height='80' width='80' /></div><div class="span10"> <header class="comment-meta comment-author vcard"><cite class="fn">mdupuy  </cite> <a class="comment-date" href="index.html#comment-49388"><time datetime="2014-06-11T16:01:24+00:00">11/06/2014 at 16:01</time></a></header>  <section class="comment-content comment"><p>On apprend que le broker est un &#8220;passeur de massage&#8221;. On sent que la Thaïlande a eu une certaine influence sur le contenu de l&#8217;article.</p>
</section></div></div></article>          <!-- #comment-## -->
        </li><!-- #comment-## -->
        <li class="comment byuser comment-author-sam bypostauthor odd alt thread-even depth-1" id="li-comment-49412">
          
            <article id="comment-49412" class="comment"><div class="row-fluid"><div class="comment-avatar span2"><img alt='' src='http://2.gravatar.com/avatar/bf9ecde8f5e286de6ce5c80206cf9dd6?s=80&#038;d=retro&#038;r=x' srcset='http://2.gravatar.com/avatar/bf9ecde8f5e286de6ce5c80206cf9dd6?s=160&#038;d=retro&#038;r=x 2x' class='avatar avatar-80 photo' height='80' width='80' /></div><div class="span10"> <header class="comment-meta comment-author vcard"><cite class="fn">Sam <span> Post author</span> </cite> <a class="comment-date" href="index.html#comment-49412"><time datetime="2014-06-11T16:29:51+00:00">11/06/2014 at 16:29</time></a></header>  <section class="comment-content comment"><p>^^ </p>
<p>Tu ne crois pas si bien dire, on s&#8217;est tous les deux inscrit à l&#8217;école de massage thai pour une 30aine d&#8217;heures de cours. On va devenir experts en passage de massage \o/</p>
</section></div></div></article>          <!-- #comment-## -->
        </li><!-- #comment-## -->
        <li class="comment even thread-odd thread-alt depth-1" id="li-comment-160286">
          
            <article id="comment-160286" class="comment"><div class="row-fluid"><div class="comment-avatar span2"><img alt='' src='http://1.gravatar.com/avatar/18ae1344bc09c51fde4b7c3ae1bf7c9a?s=80&#038;d=retro&#038;r=x' srcset='http://1.gravatar.com/avatar/18ae1344bc09c51fde4b7c3ae1bf7c9a?s=160&#038;d=retro&#038;r=x 2x' class='avatar avatar-80 photo' height='80' width='80' /></div><div class="span10"> <header class="comment-meta comment-author vcard"><cite class="fn">francoisgfx  </cite> <a class="comment-date" href="index.html#comment-160286"><time datetime="2015-05-05T15:51:57+00:00">05/05/2015 at 15:51</time></a></header>  <section class="comment-content comment"><p>Hello,</p>
<p>J&#8217;aimerai créer une tache qui soit exécuté par plusieurs workers ayant différente app. Est ce que c&#8217;est possible ?</p>
<p>j&#8217;ai une tache périodique qui poll des events d&#8217;un service. Je voudrais stocker chaque event dans une queue par type d&#8217;event.</p>
<p>Ensuite que chaque worker se bind a une queue d&#8217;un type d&#8217;event qui l’intéresse et execute son code en fonction.</p>
<p>Vue que la fonction/app a exécuter est dans le message, je ne vois pas comment je peux faire ça.</p>
<p>Si vous avez une idée, je suis preneur.</p>
<p>Merci</p>
<p>F.</p>
</section></div></div></article>          <!-- #comment-## -->
        </li><!-- #comment-## -->
        <li class="comment byuser comment-author-sam bypostauthor odd alt thread-even depth-1" id="li-comment-160300">
          
            <article id="comment-160300" class="comment"><div class="row-fluid"><div class="comment-avatar span2"><img alt='' src='http://2.gravatar.com/avatar/bf9ecde8f5e286de6ce5c80206cf9dd6?s=80&#038;d=retro&#038;r=x' srcset='http://2.gravatar.com/avatar/bf9ecde8f5e286de6ce5c80206cf9dd6?s=160&#038;d=retro&#038;r=x 2x' class='avatar avatar-80 photo' height='80' width='80' /></div><div class="span10"> <header class="comment-meta comment-author vcard"><cite class="fn">Sam <span> Post author</span> </cite> <a class="comment-date" href="index.html#comment-160300"><time datetime="2015-05-05T22:30:10+00:00">05/05/2015 at 22:30</time></a></header>  <section class="comment-content comment"><p>Pose la question sur indexerror.net, ce sera mieux adapté que les comments du blog.</p>
</section></div></div></article>          <!-- #comment-## -->
        </li><!-- #comment-## -->
        <li class="comment even thread-odd thread-alt depth-1" id="li-comment-178129">
          
            <article id="comment-178129" class="comment"><div class="row-fluid"><div class="comment-avatar span2"><img alt='' src='http://0.gravatar.com/avatar/6cc18560ae7398f2436dd1bc7ab51baa?s=80&#038;d=retro&#038;r=x' srcset='http://0.gravatar.com/avatar/6cc18560ae7398f2436dd1bc7ab51baa?s=160&#038;d=retro&#038;r=x 2x' class='avatar avatar-80 photo' height='80' width='80' /></div><div class="span10"> <header class="comment-meta comment-author vcard"><cite class="fn">Nevenoe  </cite> <a class="comment-date" href="index.html#comment-178129"><time datetime="2016-05-11T11:52:48+00:00">11/05/2016 at 11:52</time></a></header>  <section class="comment-content comment"><p>Une alternative à Celery pourrait être Django-Crontab: <a href="https://pypi.python.org/pypi/django-crontab" rel="nofollow">https://pypi.python.org/pypi/django-crontab</a></p>
<p>Je laisse ça la&#8230; Pour le partage.</p>
</section></div></div></article>          <!-- #comment-## -->
        </li><!-- #comment-## -->
        <li class="comment odd alt thread-even depth-1" id="li-comment-186852">
          
            <article id="comment-186852" class="comment"><div class="row-fluid"><div class="comment-avatar span2"><img alt='' src='http://0.gravatar.com/avatar/fe64ffcb6ec159f37bb67877d90dbd53?s=80&#038;d=retro&#038;r=x' srcset='http://0.gravatar.com/avatar/fe64ffcb6ec159f37bb67877d90dbd53?s=160&#038;d=retro&#038;r=x 2x' class='avatar avatar-80 photo' height='80' width='80' /></div><div class="span10"> <header class="comment-meta comment-author vcard"><cite class="fn"><a href='http://acoeuro.com' rel='external nofollow' class='url'>Siltaar</a>  </cite> <a class="comment-date" href="index.html#comment-186852"><time datetime="2017-04-19T21:17:27+00:00">19/04/2017 at 21:17</time></a></header>  <section class="comment-content comment"><p>« Heureusement il existe une bibliothèque qui se met au dessus de Kombu pour et nous expose juste les fonctionnalités que l’on souhaite »</p>
<p>&#8211;&gt; <strike>pour</strike></p>
<p>Après, la vie privée des libs, qui se mets au dessus, qui expose quoi… cela ne nous, regarde pas ;-)</p>
</section></div></div></article>          <!-- #comment-## -->
        </li><!-- #comment-## -->
        <li class="comment even thread-odd thread-alt depth-1" id="li-comment-187497">
          
            <article id="comment-187497" class="comment"><div class="row-fluid"><div class="comment-avatar span2"><img alt='' src='http://0.gravatar.com/avatar/0b0e08a6304201849ed020620112e9e4?s=80&#038;d=retro&#038;r=x' srcset='http://0.gravatar.com/avatar/0b0e08a6304201849ed020620112e9e4?s=160&#038;d=retro&#038;r=x 2x' class='avatar avatar-80 photo' height='80' width='80' /></div><div class="span10"> <header class="comment-meta comment-author vcard"><cite class="fn"><a href='https://studiomzk.com' rel='external nofollow' class='url'>mzk</a>  </cite> <a class="comment-date" href="index.html#comment-187497"><time datetime="2017-06-01T10:22:17+00:00">01/06/2017 at 10:22</time></a></header>  <section class="comment-content comment"><p>J&#8217;arrive un peu tard, pour ramener ma fraise&#8230; J&#8217;ai mis du temps à comprendre tout ce jargon sur le multiprocessing, threading, parallélisme vs. concurrence, etc. Mais le tutoriel ici est assez fascinant et finalement très accessible ! Merci.</p>
<p>Juste pour les <em>noobs</em> comme moi, et qui utilisent abondement Python 3.6 &#8211; comme fourni <em>out-of-the-box</em> par Arch Linux, voici une légère ré-écriture du script <em>tasks.py</em> :</p>
<pre>
<code>
import urllib.request

from collections import Counter

from celery import Celery

celery = Celery('tasks', broker='redis://localhost', backend='redis://localhost')

@celery.task
def ecount(url):
&nbsp;&nbsp;&nbsp;&nbsp;with urllib.request.urlopen(url) as res:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;html = res.read()
&nbsp;&nbsp;&nbsp;&nbsp;html = html.decode('utf-8')
&nbsp;&nbsp;&nbsp;&nbsp;return Counter(html)['e']
</code>
</pre>
<p>Voilà. Je sais pas si c&#8217;est très utile, mais si ça peut aider les <em>bleus</em> comme moi&#8230;</p>
</section></div></div></article>          <!-- #comment-## -->
        </li><!-- #comment-## -->
        <li class="comment odd alt thread-even depth-1" id="li-comment-190605">
          
            <article id="comment-190605" class="comment"><div class="row-fluid"><div class="comment-avatar span2"><img alt='' src='http://1.gravatar.com/avatar/a7367ef933698f9bcf497ba4c8681dbd?s=80&#038;d=retro&#038;r=x' srcset='http://1.gravatar.com/avatar/a7367ef933698f9bcf497ba4c8681dbd?s=160&#038;d=retro&#038;r=x 2x' class='avatar avatar-80 photo' height='80' width='80' /></div><div class="span10"> <header class="comment-meta comment-author vcard"><cite class="fn"><a href='https://spidermind.be' rel='external nofollow' class='url'>AnOnyme77</a>  </cite> <a class="comment-date" href="index.html#comment-190605"><time datetime="2017-11-06T16:40:47+00:00">06/11/2017 at 16:40</time></a></header>  <section class="comment-content comment"><p>Super article. J&#8217;apprends toujours des trucs super intéressants avec vous !</p>
<p>Une petite erreur dans un code par contre je pense :</p>
<p><code>@periodic_task(run_every=crontab(hour='5,13,23', minute=30, day_of_week='monday')</code></p>
<p>Je vois ici deux parenthèses ouvrantes et une fermante :'(.</p>
</section></div></div></article>          <!-- #comment-## -->
        </li><!-- #comment-## -->
        <li class="comment byuser comment-author-sam bypostauthor even thread-odd thread-alt depth-1" id="li-comment-190636">
          
            <article id="comment-190636" class="comment"><div class="row-fluid"><div class="comment-avatar span2"><img alt='' src='http://2.gravatar.com/avatar/bf9ecde8f5e286de6ce5c80206cf9dd6?s=80&#038;d=retro&#038;r=x' srcset='http://2.gravatar.com/avatar/bf9ecde8f5e286de6ce5c80206cf9dd6?s=160&#038;d=retro&#038;r=x 2x' class='avatar avatar-80 photo' height='80' width='80' /></div><div class="span10"> <header class="comment-meta comment-author vcard"><cite class="fn">Sam <span> Post author</span> </cite> <a class="comment-date" href="index.html#comment-190636"><time datetime="2017-11-08T14:43:34+00:00">08/11/2017 at 14:43</time></a></header>  <section class="comment-content comment"><p>Bien vu!</p>
</section></div></div></article>          <!-- #comment-## -->
        </li><!-- #comment-## -->
              </ul><!-- .commentlist -->
            <p class="nocomments">Comments are closed.</p></div><!-- #comments .comments-area -->


<div class="ie-comment">
Des questions Python sans rapport avec l'article ? Posez-les sur <a href="http://indexerror.net">IndexError</a>.

</div>
        
          <hr class="featurette-divider __after_loop">
          <nav id="nav-below" class="navigation" role="navigation">

              <h3 class="assistive-text">
                Post navigation              </h3>

              <ul class="pager">
                                  <li class="previous">
                    <span class="nav-previous">
                      <a href="../ouverture-du-coffre-la-methode-simple-bourine-mais-efficace/index.html" rel="prev"><span class="meta-nav">&larr;</span> Ouverture du coffre : la méthode simple, bourine, mais efficace</a>                    </span>
                  </li>
                                                  <li class="next">
                    <span class="nav-next">
                        <a href="../e-ink-et-confiseries/index.html" rel="next">E-ink et confiseries <span class="meta-nav">&rarr;</span></a>                    </span>
                  </li>
                              </ul>

          </nav><!-- #nav-below .navigation -->

        
        
                </div><!--.article-container -->

                    
        <div class="span3 right tc-sidebar">
           <div id="right" class="widget-area" role="complementary">
                                                      <aside id="text-9" class="widget widget_text">			<div class="textwidget"><p style="font-size:1.3em"><a href="../mais-ou-je-suis-tombee-la/index.html">Mais où je suis tombé(e) là ?</a></p></div>
		</aside><aside id="text-7" class="widget widget_text">			<div class="textwidget"><img src="http://www.adobe.com/images/pdficon_small.png" width="16" height="16"/> <a href="http://pdfcrowd.com/url_to_pdf/">Télécharger cette page en PDF</a> </div>
		</aside><aside id="text-4" class="widget widget_text">			<div class="textwidget"><br><br><a href="../appel-a-contributeurs-impertinents/index.html"><img src="../wp-content/uploads/2012/07/contributeur.png" width="288px" style="vertical-align: middle;margin-top:-40px;margin-bottom:10px;"></a> </div>
		</aside><aside id="blog_subscription-4" class="widget jetpack_subscription_widget"><h3 class="widget-title">Souscrire à nos conneries</h3>
			<form action="index.html%3Fshare=email.html#" method="post" accept-charset="utf-8" id="subscribe-blog-blog_subscription-4">
				<div id="subscribe-text"><p>Entrez votre adresse mail et vous recevrez une notification à chaque nouvel article.</p>
</div><p>Join 1,492 other subscribers</p>
					<p id="subscribe-email">
						<label id="jetpack-subscribe-label" for="subscribe-field-blog_subscription-4">
							Email Address						</label>
						<input type="email" name="email" required="required" class="required" value="" id="subscribe-field-blog_subscription-4" placeholder="Email Address" />
					</p>

					<p id="subscribe-submit">
						<input type="hidden" name="action" value="subscribe" />
						<input type="hidden" name="source" value="http://sametmax.com/files-de-taches-et-taches-recurrentes-avec-celery/?shared=email&#038;msg=fail" />
						<input type="hidden" name="sub-type" value="widget" />
						<input type="hidden" name="redirect_fragment" value="blog_subscription-4" />
												<input type="submit" value="J&#039;adhère, bon dieu !" name="jetpack_subscriptions_widget" />
					</p>
							</form>

			<script>
			/*
			Custom functionality for safari and IE
			 */
			(function( d ) {
				// In case the placeholder functionality is available we remove labels
				if ( ( 'placeholder' in d.createElement( 'input' ) ) ) {
					var label = d.querySelector( 'label[for=subscribe-field-blog_subscription-4]' );
						label.style.clip 	 = 'rect(1px, 1px, 1px, 1px)';
						label.style.position = 'absolute';
						label.style.height   = '1px';
						label.style.width    = '1px';
						label.style.overflow = 'hidden';
				}

				// Make sure the email value is filled in before allowing submit
				var form = d.getElementById('subscribe-blog-blog_subscription-4'),
					input = d.getElementById('subscribe-field-blog_subscription-4'),
					handler = function( event ) {
						if ( '' === input.value ) {
							input.focus();

							if ( event.preventDefault ){
								event.preventDefault();
							}

							return false;
						}
					};

				if ( window.addEventListener ) {
					form.addEventListener( 'submit', handler, false );
				} else {
					form.attachEvent( 'onsubmit', handler );
				}
			})( document );
			</script>
				
</aside><aside id="tag_cloud-3" class="widget widget_tag_cloud"><h3 class="widget-title">TagCloud</h3><div class="tagcloud"><a href="../tag/0bin/index.html" class="tag-cloud-link tag-link-148 tag-link-position-1" style="font-size: 9.04pt;" aria-label="0bin (11 items)">0bin</a>
<a href="../tag/angularjs/index.html" class="tag-cloud-link tag-link-443 tag-link-position-2" style="font-size: 8.4pt;" aria-label="angularjs (9 items)">angularjs</a>
<a href="../tag/asyncio/index.html" class="tag-cloud-link tag-link-922 tag-link-position-3" style="font-size: 9.04pt;" aria-label="asyncio (11 items)">asyncio</a>
<a href="../tag/autobahn/index.html" class="tag-cloud-link tag-link-979 tag-link-position-4" style="font-size: 8.4pt;" aria-label="autobahn (9 items)">autobahn</a>
<a href="../tag/bash/index.html" class="tag-cloud-link tag-link-14 tag-link-position-5" style="font-size: 10.8pt;" aria-label="bash (19 items)">bash</a>
<a href="../tag/bitcoin/index.html" class="tag-cloud-link tag-link-320 tag-link-position-6" style="font-size: 8.4pt;" aria-label="bitcoin (9 items)">bitcoin</a>
<a href="../tag/blog/index.html" class="tag-cloud-link tag-link-107 tag-link-position-7" style="font-size: 11.84pt;" aria-label="blog (26 items)">blog</a>
<a href="../tag/cache/index.html" class="tag-cloud-link tag-link-333 tag-link-position-8" style="font-size: 8.72pt;" aria-label="cache (10 items)">cache</a>
<a href="../tag/comprehension-lists/index.html" class="tag-cloud-link tag-link-20 tag-link-position-9" style="font-size: 8pt;" aria-label="comprehension-lists (8 items)">comprehension-lists</a>
<a href="../tag/crossbar/index.html" class="tag-cloud-link tag-link-1046 tag-link-position-10" style="font-size: 8.4pt;" aria-label="crossbar (9 items)">crossbar</a>
<a href="../tag/css/index.html" class="tag-cloud-link tag-link-188 tag-link-position-11" style="font-size: 8.4pt;" aria-label="css (9 items)">css</a>
<a href="../tag/cul-2/index.html" class="tag-cloud-link tag-link-33 tag-link-position-12" style="font-size: 9.28pt;" aria-label="cul (12 items)">cul</a>
<a href="../tag/dict/index.html" class="tag-cloud-link tag-link-435 tag-link-position-13" style="font-size: 8pt;" aria-label="dict (8 items)">dict</a>
<a href="../tag/django/index.html" class="tag-cloud-link tag-link-28 tag-link-position-14" style="font-size: 16pt;" aria-label="django (89 items)">django</a>
<a href="../tag/don/index.html" class="tag-cloud-link tag-link-1210 tag-link-position-15" style="font-size: 10.48pt;" aria-label="don (17 items)">don</a>
<a href="../tag/encoding/index.html" class="tag-cloud-link tag-link-54 tag-link-position-16" style="font-size: 8.72pt;" aria-label="encoding (10 items)">encoding</a>
<a href="../tag/git/index.html" class="tag-cloud-link tag-link-18 tag-link-position-17" style="font-size: 12.88pt;" aria-label="git (35 items)">git</a>
<a href="../tag/http/index.html" class="tag-cloud-link tag-link-204 tag-link-position-18" style="font-size: 9.6pt;" aria-label="http (13 items)">http</a>
<a href="../tag/import/index.html" class="tag-cloud-link tag-link-215 tag-link-position-19" style="font-size: 8.4pt;" aria-label="import (9 items)">import</a>
<a href="../tag/ipython/index.html" class="tag-cloud-link tag-link-164 tag-link-position-20" style="font-size: 8.72pt;" aria-label="ipython (10 items)">ipython</a>
<a href="../tag/iterable/index.html" class="tag-cloud-link tag-link-217 tag-link-position-21" style="font-size: 9.84pt;" aria-label="iterable (14 items)">iterable</a>
<a href="../tag/javascript/index.html" class="tag-cloud-link tag-link-96 tag-link-position-22" style="font-size: 14.08pt;" aria-label="javascript (50 items)">javascript</a>
<a href="../tag/jquery/index.html" class="tag-cloud-link tag-link-112 tag-link-position-23" style="font-size: 8pt;" aria-label="jquery (8 items)">jquery</a>
<a href="../tag/linux/index.html" class="tag-cloud-link tag-link-238 tag-link-position-24" style="font-size: 9.04pt;" aria-label="linux (11 items)">linux</a>
<a href="../tag/meta/index.html" class="tag-cloud-link tag-link-102 tag-link-position-25" style="font-size: 17.52pt;" aria-label="meta (138 items)">meta</a>
<a href="../tag/mysql/index.html" class="tag-cloud-link tag-link-82 tag-link-position-26" style="font-size: 8pt;" aria-label="mysql (8 items)">mysql</a>
<a href="../tag/nginx/index.html" class="tag-cloud-link tag-link-183 tag-link-position-27" style="font-size: 9.84pt;" aria-label="nginx (14 items)">nginx</a>
<a href="../tag/nsfw/index.html" class="tag-cloud-link tag-link-319 tag-link-position-28" style="font-size: 9.84pt;" aria-label="nsfw (14 items)">nsfw</a>
<a href="../tag/pep8/index.html" class="tag-cloud-link tag-link-552 tag-link-position-29" style="font-size: 8pt;" aria-label="pep8 (8 items)">pep8</a>
<a href="../tag/pip/index.html" class="tag-cloud-link tag-link-344 tag-link-position-30" style="font-size: 8.72pt;" aria-label="pip (10 items)">pip</a>
<a href="../tag/poo/index.html" class="tag-cloud-link tag-link-549 tag-link-position-31" style="font-size: 10pt;" aria-label="poo (15 items)">poo</a>
<a href="../tag/python/index.html" class="tag-cloud-link tag-link-4 tag-link-position-32" style="font-size: 22pt;" aria-label="python (496 items)">python</a>
<a href="../tag/python-3/index.html" class="tag-cloud-link tag-link-365 tag-link-position-33" style="font-size: 8.4pt;" aria-label="python 3 (9 items)">python 3</a>
<a href="../tag/redis/index.html" class="tag-cloud-link tag-link-196 tag-link-position-34" style="font-size: 8.72pt;" aria-label="redis (10 items)">redis</a>
<a href="../tag/ruby/index.html" class="tag-cloud-link tag-link-325 tag-link-position-35" style="font-size: 8pt;" aria-label="ruby (8 items)">ruby</a>
<a href="../tag/shell/index.html" class="tag-cloud-link tag-link-202 tag-link-position-36" style="font-size: 8.72pt;" aria-label="shell (10 items)">shell</a>
<a href="../tag/sublime-text/index.html" class="tag-cloud-link tag-link-76 tag-link-position-37" style="font-size: 8.4pt;" aria-label="sublime text (9 items)">sublime text</a>
<a href="../tag/ubuntu/index.html" class="tag-cloud-link tag-link-255 tag-link-position-38" style="font-size: 10.24pt;" aria-label="ubuntu (16 items)">ubuntu</a>
<a href="../tag/unicode/index.html" class="tag-cloud-link tag-link-53 tag-link-position-39" style="font-size: 8.4pt;" aria-label="unicode (9 items)">unicode</a>
<a href="../tag/unit-tests/index.html" class="tag-cloud-link tag-link-302 tag-link-position-40" style="font-size: 8.72pt;" aria-label="unit tests (10 items)">unit tests</a>
<a href="../tag/unpacking/index.html" class="tag-cloud-link tag-link-180 tag-link-position-41" style="font-size: 8pt;" aria-label="unpacking (8 items)">unpacking</a>
<a href="../tag/virtualenv/index.html" class="tag-cloud-link tag-link-259 tag-link-position-42" style="font-size: 9.04pt;" aria-label="virtualenv (11 items)">virtualenv</a>
<a href="../tag/wamp/index.html" class="tag-cloud-link tag-link-1039 tag-link-position-43" style="font-size: 10pt;" aria-label="wamp (15 items)">wamp</a>
<a href="../tag/web-2/index.html" class="tag-cloud-link tag-link-758 tag-link-position-44" style="font-size: 8pt;" aria-label="web (8 items)">web</a>
<a href="../tag/yield/index.html" class="tag-cloud-link tag-link-287 tag-link-position-45" style="font-size: 8.4pt;" aria-label="yield (9 items)">yield</a></div>
</aside><aside id="text-5" class="widget widget_text"><h3 class="widget-title"> Envoyez des sioux</h3>			<div class="textwidget"><p><img src="../wp-content/uploads/2013/07/bitcoin.png" width="16" height="16"/> On adooooore les bitcoins :</p>

<p>

<a href="bitcoin:19zAHPPuce4BAhsdy9KaFwVLurEJXMhMAn?amount=1X8&label=SamEtMax">19zAHPPuce4BAhsdy9KaFwVLurEJXMhMAn</a>

</p></div>
		</aside><aside id="nav_menu-3" class="widget widget_nav_menu"><h3 class="widget-title">Nos projets</h3><div class="menu-nos-projets-container"><ul id="menu-nos-projets" class="menu"><li id="menu-item-15841" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-15841"><a href="http://multiboards.net/">Multiboards &#8211; l&#8217;actu geek fr en une page</a></li>
<li id="menu-item-15837" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-15837"><a href="http://0bin.net">0bin &#8211; le pastebin chiffré</a></li>
<li id="menu-item-15838" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-15838"><a href="http://allthatcounts.net">All that counts &#8211; compteur pour jeux</a></li>
<li id="menu-item-15839" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-15839"><a href="https://github.com/sametmax/django-quicky">Django quicky &#8211; quick views for Django</a></li>
<li id="menu-item-15840" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-15840"><a href="https://github.com/sametmax/VizHash.js">VizHash.js &#8211; Hash visuels</a></li>
<li id="menu-item-15842" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-15842"><a href="https://github.com/sametmax/codes-des-articles">Code des articles du blog</a></li>
</ul></div></aside><aside id="text-11" class="widget widget_text"><h3 class="widget-title"> </h3>			<div class="textwidget"> </div>
		</aside><aside id="meta-3" class="widget widget_meta"><h3 class="widget-title">Meta</h3>			<ul>
						<li><a href="../wp-login.php.html">Log in</a></li>
			<li><a href="../feed.1">Entries <abbr title="Really Simple Syndication">RSS</abbr></a></li>
			<li><a href="../comments/feed/index.html">Comments <abbr title="Really Simple Syndication">RSS</abbr></a></li>
			<li><a href="https://wordpress.org/" title="Powered by WordPress, state-of-the-art semantic personal publishing platform.">WordPress.org</a></li>			</ul>
			</aside>                                              </div><!-- #left or #right-->
        </div><!--.tc-sidebar -->

        
        </div><!--.row -->
    </div><!-- .container role: main -->

    
</div><!--#main-wrapper"-->

		<!-- FOOTER -->
		<footer id="footer" class="">
		 					<div class="container footer-widgets ">
					<div class="row widget-area" role="complementary">
												
							<div id="footer_one" class="span4">
																
										<aside id="nav_menu-2" class="widget widget_nav_menu"><h3 class="widget-title">Hors du blog</h3><div class="menu-bottom-menu-container"><ul id="menu-bottom-menu" class="menu"><li id="menu-item-2391" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2391"><a href="../contactez-nous/index.html">Page de contact</a></li>
<li id="menu-item-12230" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-12230"><a href="http://twitter.com/sam_et_max">@sam_et_max sur twitter</a></li>
<li id="menu-item-12285" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-12285"><a href="http://bridge.suumitsu.eu/?action=display&#038;bridge=TwitterBridge&#038;u=sam_et_max&#038;format=AtomFormat">Nos tweets en RSS</a></li>
<li id="menu-item-12231" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-12231"><a href="https://github.com/sametmax/">Fork me, I&#8217;m famous (github)</a></li>
</ul></div></aside>
																							</div><!-- .{$key}_widget_class -->

						
							<div id="footer_two" class="span4">
																
										<aside id="text-8" class="widget widget_text">			<div class="textwidget">Tous les textes de ce blog, sauf signalement contraire, sont sous licence <a href="http://creativecommons.org/licenses/by/3.0/">creative common 3.0 unported</a>.</div>
		</aside>
																							</div><!-- .{$key}_widget_class -->

						
							<div id="footer_three" class="span4">
																
										<aside id="archives-2" class="widget widget_archive"><h3 class="widget-title">Toi aussi, trouve un article obsolète sur notre blog</h3>		<ul>
			<li><a href='../2019/09/index.html'>September 2019</a>&nbsp;(1)</li>
	<li><a href='../2019/06/index.html'>June 2019</a>&nbsp;(1)</li>
	<li><a href='../2019/02/index.html'>February 2019</a>&nbsp;(1)</li>
	<li><a href='../2019/01/index.html'>January 2019</a>&nbsp;(3)</li>
	<li><a href='../2018/12/index.html'>December 2018</a>&nbsp;(1)</li>
	<li><a href='../2018/09/index.html'>September 2018</a>&nbsp;(2)</li>
	<li><a href='../2018/08/index.html'>August 2018</a>&nbsp;(1)</li>
	<li><a href='../2018/07/index.html'>July 2018</a>&nbsp;(3)</li>
	<li><a href='../2018/06/index.html'>June 2018</a>&nbsp;(4)</li>
	<li><a href='../2018/05/index.html'>May 2018</a>&nbsp;(2)</li>
	<li><a href='../2018/03/index.html'>March 2018</a>&nbsp;(2)</li>
	<li><a href='../2018/02/index.html'>February 2018</a>&nbsp;(1)</li>
	<li><a href='../2017/12/index.html'>December 2017</a>&nbsp;(4)</li>
	<li><a href='../2017/11/index.html'>November 2017</a>&nbsp;(5)</li>
	<li><a href='../2017/10/index.html'>October 2017</a>&nbsp;(2)</li>
	<li><a href='../2017/09/index.html'>September 2017</a>&nbsp;(1)</li>
	<li><a href='../2017/07/index.html'>July 2017</a>&nbsp;(5)</li>
	<li><a href='../2017/06/index.html'>June 2017</a>&nbsp;(3)</li>
	<li><a href='../2017/05/index.html'>May 2017</a>&nbsp;(3)</li>
	<li><a href='../2017/04/index.html'>April 2017</a>&nbsp;(2)</li>
	<li><a href='../2017/03/index.html'>March 2017</a>&nbsp;(3)</li>
	<li><a href='../2017/02/index.html'>February 2017</a>&nbsp;(5)</li>
	<li><a href='../2017/01/index.html'>January 2017</a>&nbsp;(5)</li>
	<li><a href='../2016/10/index.html'>October 2016</a>&nbsp;(2)</li>
	<li><a href='../2016/09/index.html'>September 2016</a>&nbsp;(5)</li>
	<li><a href='../2016/08/index.html'>August 2016</a>&nbsp;(2)</li>
	<li><a href='../2016/03/index.html'>March 2016</a>&nbsp;(8)</li>
	<li><a href='../2016/02/index.html'>February 2016</a>&nbsp;(9)</li>
	<li><a href='../2016/01/index.html'>January 2016</a>&nbsp;(16)</li>
	<li><a href='../2015/12/index.html'>December 2015</a>&nbsp;(6)</li>
	<li><a href='../2015/11/index.html'>November 2015</a>&nbsp;(7)</li>
	<li><a href='../2015/10/index.html'>October 2015</a>&nbsp;(2)</li>
	<li><a href='../2015/09/index.html'>September 2015</a>&nbsp;(6)</li>
	<li><a href='../2015/08/index.html'>August 2015</a>&nbsp;(10)</li>
	<li><a href='../2015/07/index.html'>July 2015</a>&nbsp;(18)</li>
	<li><a href='../2015/06/index.html'>June 2015</a>&nbsp;(13)</li>
	<li><a href='../2015/05/index.html'>May 2015</a>&nbsp;(12)</li>
	<li><a href='../2015/04/index.html'>April 2015</a>&nbsp;(13)</li>
	<li><a href='../2015/03/index.html'>March 2015</a>&nbsp;(8)</li>
	<li><a href='../2015/02/index.html'>February 2015</a>&nbsp;(4)</li>
	<li><a href='../2015/01/index.html'>January 2015</a>&nbsp;(21)</li>
	<li><a href='../2014/12/index.html'>December 2014</a>&nbsp;(24)</li>
	<li><a href='../2014/11/index.html'>November 2014</a>&nbsp;(6)</li>
	<li><a href='../2014/10/index.html'>October 2014</a>&nbsp;(18)</li>
	<li><a href='../2014/09/index.html'>September 2014</a>&nbsp;(10)</li>
	<li><a href='../2014/08/index.html'>August 2014</a>&nbsp;(5)</li>
	<li><a href='../2014/07/index.html'>July 2014</a>&nbsp;(11)</li>
	<li><a href='../2014/06/index.html'>June 2014</a>&nbsp;(25)</li>
	<li><a href='../2014/05/index.html'>May 2014</a>&nbsp;(14)</li>
	<li><a href='../2014/04/index.html'>April 2014</a>&nbsp;(10)</li>
	<li><a href='../2014/03/index.html'>March 2014</a>&nbsp;(23)</li>
	<li><a href='../2014/02/index.html'>February 2014</a>&nbsp;(27)</li>
	<li><a href='../2014/01/index.html'>January 2014</a>&nbsp;(17)</li>
	<li><a href='../2013/12/index.html'>December 2013</a>&nbsp;(27)</li>
	<li><a href='../2013/11/index.html'>November 2013</a>&nbsp;(25)</li>
	<li><a href='../2013/10/index.html'>October 2013</a>&nbsp;(27)</li>
	<li><a href='../2013/09/index.html'>September 2013</a>&nbsp;(1)</li>
	<li><a href='../2013/08/index.html'>August 2013</a>&nbsp;(31)</li>
	<li><a href='../2013/07/index.html'>July 2013</a>&nbsp;(32)</li>
	<li><a href='../2013/06/index.html'>June 2013</a>&nbsp;(24)</li>
	<li><a href='../2013/05/index.html'>May 2013</a>&nbsp;(30)</li>
	<li><a href='../2013/04/index.html'>April 2013</a>&nbsp;(31)</li>
	<li><a href='../2013/03/index.html'>March 2013</a>&nbsp;(33)</li>
	<li><a href='../2013/02/index.html'>February 2013</a>&nbsp;(29)</li>
	<li><a href='../2013/01/index.html'>January 2013</a>&nbsp;(34)</li>
	<li><a href='../2012/12/index.html'>December 2012</a>&nbsp;(32)</li>
	<li><a href='../2012/11/index.html'>November 2012</a>&nbsp;(36)</li>
	<li><a href='../2012/10/index.html'>October 2012</a>&nbsp;(35)</li>
	<li><a href='../2012/09/index.html'>September 2012</a>&nbsp;(36)</li>
	<li><a href='../2012/08/index.html'>August 2012</a>&nbsp;(37)</li>
	<li><a href='../2012/07/index.html'>July 2012</a>&nbsp;(33)</li>
	<li><a href='../2012/06/index.html'>June 2012</a>&nbsp;(24)</li>
	<li><a href='../2012/05/index.html'>May 2012</a>&nbsp;(31)</li>
	<li><a href='../2012/04/index.html'>April 2012</a>&nbsp;(20)</li>
	<li><a href='../2012/03/index.html'>March 2012</a>&nbsp;(10)</li>
	<li><a href='../2012/02/index.html'>February 2012</a>&nbsp;(14)</li>
		</ul>
		</aside>
																							</div><!-- .{$key}_widget_class -->

																	</div><!-- .row.widget-area -->
				</div><!--.footer-widgets -->
				    				 <div class="colophon">
			 	<div class="container">
			 		<div class="row-fluid">
					    <div class="span4 social-block pull-left"><span class="tc-footer-social-links-wrapper" ><a class="social-icon icon-feed" href="../feed/rss/index.html" title="Subscribe to my rss feed"  ></a></span></div><div class="span4 credits"><p>&middot; &copy; 2019 <a href="../index.html" title="Sam &amp; Max" rel="bookmark">Sam &amp; Max</a> &middot; Designed by <a href="http://themesandco.com/">Themes &amp; Co</a> &middot;</p></div><div class="span4 backtop"><p class="pull-right"><a class="back-to-top" href="index.html%3Fshare=email.html#">Back to top</a></p></div>	      			</div><!-- .row-fluid -->
	      		</div><!-- .container -->
	      	</div><!-- .colophon -->
	    			</footer>
			<div style="display:none">
	<div class="grofile-hash-map-bf9ecde8f5e286de6ce5c80206cf9dd6">
	</div>
	<div class="grofile-hash-map-fc32c6686686ecc595f05ad1885c2fb3">
	</div>
	<div class="grofile-hash-map-aa90c4c03161ec318afbeb65b6927bb9">
	</div>
	<div class="grofile-hash-map-a16497d1d99ae5ebcf3d8547a7dff9ed">
	</div>
	<div class="grofile-hash-map-f0be159c1cf58c64f5fb6b3dbfa12e9c">
	</div>
	<div class="grofile-hash-map-bf9ecde8f5e286de6ce5c80206cf9dd6">
	</div>
	<div class="grofile-hash-map-56a4d86cdd42d8d72cc78d821724c7f4">
	</div>
	<div class="grofile-hash-map-4f42ed44f985c500a56a7a0b79dbfbf8">
	</div>
	<div class="grofile-hash-map-72487ae39590539b9e0c305458f61cca">
	</div>
	<div class="grofile-hash-map-027a6afe88c7e6b2bcd56e2dd31e71bb">
	</div>
	<div class="grofile-hash-map-f0a185474dc7c902e88efa53ea910cd9">
	</div>
	<div class="grofile-hash-map-aa3fbf033d64ff6d10f07d109eb4d521">
	</div>
	<div class="grofile-hash-map-9f3c22452987f3195187c70300ae85d6">
	</div>
	<div class="grofile-hash-map-eb8e400eec222e2b09bd901aba2cb2dc">
	</div>
	<div class="grofile-hash-map-02750b4cc6dd3cf5450573623a020105">
	</div>
	<div class="grofile-hash-map-18ae1344bc09c51fde4b7c3ae1bf7c9a">
	</div>
	<div class="grofile-hash-map-6cc18560ae7398f2436dd1bc7ab51baa">
	</div>
	<div class="grofile-hash-map-fe64ffcb6ec159f37bb67877d90dbd53">
	</div>
	<div class="grofile-hash-map-0b0e08a6304201849ed020620112e9e4">
	</div>
	<div class="grofile-hash-map-a7367ef933698f9bcf497ba4c8681dbd">
	</div>
	</div>

	<script type="text/javascript">
		window.WPCOM_sharing_counts = {"http:\/\/sametmax.com\/files-de-taches-et-taches-recurrentes-avec-celery\/":6880};
	</script>
			<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
			<div id="fb-root"></div>
			<script>(function(d, s, id) { var js, fjs = d.getElementsByTagName(s)[0]; if (d.getElementById(id)) return; js = d.createElement(s); js.id = id; js.src = 'https://connect.facebook.net/en_US/sdk.js#xfbml=1&appId=249643311490&version=v2.3'; fjs.parentNode.insertBefore(js, fjs); }(document, 'script', 'facebook-jssdk'));</script>
			<script>
			jQuery( document.body ).on( 'post-load', function() {
				if ( 'undefined' !== typeof FB ) {
					FB.XFBML.parse();
				}
			} );
			</script>
						<script>
			function renderGooglePlus1() {
				if ( 'undefined' === typeof gapi ) {
					return;
				}

				jQuery( '.g-plus' ).each(function() {
					var $button = jQuery( this );

					if ( ! $button.data( 'gplus-rendered' ) ) {
						gapi.plusone.render( this, {
							href: $button.attr( 'data-href' ),
							size: $button.attr( 'data-size' ),
							annotation: $button.attr( 'data-annotation' )
						});

						$button.data( 'gplus-rendered', true );
					}
				});
			}

			(function() {
				var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
				po.src = 'https://apis.google.com/js/platform.js';
				po.innerHTML = '{"parsetags": "explicit"}';
				po.onload = renderGooglePlus1;
				var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
			})();

			jQuery( document.body ).on( 'post-load', renderGooglePlus1 );
			</script>
				<div id="sharing_email" style="display: none;">
		<form action="index.html%3Fshare=email.html" method="post">
			<label for="target_email">Send to Email Address</label>
			<input type="email" name="target_email" id="target_email" value="" />

			
				<label for="source_name">Your Name</label>
				<input type="text" name="source_name" id="source_name" value="" />

				<label for="source_email">Your Email Address</label>
				<input type="email" name="source_email" id="source_email" value="" />

						<input type="text" id="jetpack-source_f_name" name="source_f_name" class="input" value="" size="25" autocomplete="off" title="This field is for validation and should not be changed" />
			
			<img style="float: right; display: none" class="loading" src="../wp-content/plugins/jetpack/modules/sharedaddy/images/loading.gif" alt="loading" width="16" height="16" />
			<input type="submit" value="Send Email" class="sharing_send" />
			<a rel="nofollow" href="index.html%3Fshare=email.html#cancel" class="sharing_cancel">Cancel</a>

			<div class="errors errors-1" style="display: none;">
				Post was not sent - check your email addresses!			</div>

			<div class="errors errors-2" style="display: none;">
				Email check failed, please try again			</div>

			<div class="errors errors-3" style="display: none;">
				Sorry, your blog cannot share posts by email.			</div>
		</form>
	</div>
					<script type="text/javascript">
				// Pinterest shared resources
				var s = document.createElement("script");
				s.type = "text/javascript";
				s.async = true;
				s.setAttribute('data-pin-hover', true);				s.src = window.location.protocol + "//assets.pinterest.com/js/pinit.js";
				var x = document.getElementsByTagName("script")[0];
				x.parentNode.insertBefore(s, x);
				// if 'Pin it' button has 'counts' make container wider
				jQuery(window).load( function(){ jQuery( 'li.share-pinterest a span:visible' ).closest( '.share-pinterest' ).width( '80px' ); } );
			</script>
		<script type="text/javascript" src="https://platform.tumblr.com/v1/share.js"></script>		<script>
		// Don't use Pocket's default JS as it we need to force init new Pocket share buttons loaded via JS.
		function jetpack_sharing_pocket_init() {
			jQuery.getScript( 'https://widgets.getpocket.com/v1/j/btn.js?v=1' );
		}
		jQuery( document ).ready( jetpack_sharing_pocket_init );
		jQuery( document.body ).on( 'post-load', jetpack_sharing_pocket_init );
		</script>
		<script type='text/javascript'>
/* <![CDATA[ */
var wpcf7 = {"apiSettings":{"root":"http:\/\/sametmax.com\/wp-json\/contact-form-7\/v1","namespace":"contact-form-7\/v1"},"recaptcha":{"messages":{"empty":"Please verify that you are not a robot."}}};
/* ]]> */
</script>
<script type='text/javascript' src='../wp-content/plugins/contact-form-7/includes/js/scripts.js%3Fver=5.0.2'></script>
<script type='text/javascript' src='https://s0.wp.com/wp-content/js/devicepx-jetpack.js?ver=201936'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var pollsL10n = {"ajax_url":"http:\/\/sametmax.com\/wp-admin\/admin-ajax.php","text_wait":"Your last request is still being processed. Please wait a while ...","text_valid":"Please choose a valid poll answer.","text_multiple":"Maximum number of choices allowed: ","show_loading":"1","show_fading":"1"};
/* ]]> */
</script>
<script type='text/javascript' src='../wp-content/plugins/wp-polls/polls-js.js%3Fver=2.73.8'></script>
<script type='text/javascript' src='../wp-content/plugins/wp-syntax/js/wp-syntax.js%3Fver=1.1'></script>
<script type='text/javascript' src='https://secure.gravatar.com/js/gprofiles.js?ver=2019Sepaa'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var WPGroHo = {"my_hash":""};
/* ]]> */
</script>
<script type='text/javascript' src='../wp-content/plugins/jetpack/modules/wpgroho.js%3Fver=4.9.7'></script>
<script type='text/javascript' src='../wp-includes/js/comment-reply.min.js%3Fver=4.9.7'></script>
<script type='text/javascript' src='../wp-includes/js/jquery/ui/core.min.js%3Fver=1.11.4'></script>
<script type='text/javascript' src='../wp-content/themes/customizr/inc/assets/js/modernizr.min.js%3Fver=3.2.10'></script>
<script type='text/javascript' src='../wp-content/themes/customizr/inc/assets/js/retina.min.js%3Fver=3.2.10'></script>
<script type='text/javascript' src='../wp-includes/js/wp-embed.min.js%3Fver=4.9.7'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var sharing_js_options = {"lang":"en","counts":"1"};
/* ]]> */
</script>
<script type='text/javascript' src='../wp-content/plugins/jetpack/_inc/build/sharedaddy/sharing.min.js%3Fver=6.3.2'></script>
<script type='text/javascript'>
var windowOpen;
			jQuery( document.body ).on( 'click', 'a.share-facebook', function() {
				// If there's another sharing window open, close it.
				if ( 'undefined' !== typeof windowOpen ) {
					windowOpen.close();
				}
				windowOpen = window.open( jQuery( this ).attr( 'href' ), 'wpcomfacebook', 'menubar=1,resizable=1,width=600,height=400' );
				return false;
			});
</script>
<script type='text/javascript' src='https://stats.wp.com/e-201936.js' async='async' defer='defer'></script>
<script type='text/javascript'>
	_stq = window._stq || [];
	_stq.push([ 'view', {v:'ext',j:'1:6.3.2',blog:'32490438',post:'6880',tz:'0',srv:'sametmax.com'} ]);
	_stq.push([ 'clickTrackerInit', '32490438', '6880' ]);
</script>
<div class="tc-btt-wrapper"><i class="btt-arrow" style="color:#394143"></i></div>	</body>
	</html>