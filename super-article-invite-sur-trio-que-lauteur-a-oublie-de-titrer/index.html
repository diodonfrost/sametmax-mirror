<!DOCTYPE html>
<!--[if IE 7]>
<html class="ie ie7" lang="en-US">
<![endif]-->
<!--[if IE 8]>
<html class="ie ie8" lang="en-US">
<![endif]-->
<!--[if !(IE 7) | !(IE 8)  ]><!-->
<html lang="en-US">                          
<!--<![endif]-->
					<head>
				    <meta charset="UTF-8" />
				    <meta http-equiv="X-UA-Compatible" content="IE=9; IE=8; IE=7; IE=EDGE" />
            				    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
				    <link rel="profile" href="http://gmpg.org/xfn/11" />
				    <link rel="pingback" href="http://sametmax.com/xmlrpc.php" />

				   <!-- Icons font support for IE6-7  -->
				    <!--[if lt IE 8]>
				      <script src="http://sametmax.com/wp-content/themes/customizr/inc/assets/css/fonts/lte-ie7.js"></script>
				    <![endif]-->
				    <style type="text/css" id="customizr-inline-fonts">@font-face{font-family:genericons;src:url('../wp-content/themes/customizr/inc/assets/css/fonts/fonts/genericons-regular-webfont.eot');src:url('../wp-content/themes/customizr/inc/assets/css/fonts/fonts/genericons-regular-webfont.eot%3F') format('embedded-opentype'),url('../wp-content/themes/customizr/inc/assets/css/fonts/fonts/genericons-regular-webfont.woff') format('woff'),url('../wp-content/themes/customizr/inc/assets/css/fonts/fonts/genericons-regular-webfont.ttf') format('truetype'),url('../wp-content/themes/customizr/inc/assets/css/fonts/fonts/genericons-regular-webfont.svg') format('svg')}@font-face{font-family:entypo;src:url('http://sametmax.com/wp-content/themes/customizr/inc/assets/css/fonts/fonts/entypo.eot);src:url(http://sametmax.com/wp-content/themes/customizr/inc/assets/css/fonts/fonts/entypo.eot?#iefix') format('embedded-opentype'),url('../wp-content/themes/customizr/inc/assets/css/fonts/fonts/entypo.woff') format('woff'),url('../wp-content/themes/customizr/inc/assets/css/fonts/fonts/entypo.ttf') format('truetype'),url('../wp-content/themes/customizr/inc/assets/css/fonts/fonts/entypo.svg') format('svg')}</style><title>Super article invité sur Trio que l&#8217;auteur a oublié de titrer &#8211; Sam &amp; Max</title>
<link rel='dns-prefetch' href='http://s0.wp.com/' />
<link rel='dns-prefetch' href='http://secure.gravatar.com/' />
<link rel='dns-prefetch' href='http://s.w.org/' />
<link rel="alternate" type="application/rss+xml" title="Sam &amp; Max &raquo; Feed" href="../feed.1" />
<link rel="alternate" type="application/rss+xml" title="Sam &amp; Max &raquo; Comments Feed" href="../comments/feed/index.html" />
<link rel="alternate" type="application/rss+xml" title="Sam &amp; Max &raquo; Super article invité sur Trio que l&#8217;auteur a oublié de titrer Comments Feed" href="feed/index.html" />
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2.4\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2.4\/svg\/","svgExt":".svg","source":{"concatemoji":"http:\/\/sametmax.com\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.9.7"}};
			!function(a,b,c){function d(a,b){var c=String.fromCharCode;l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,a),0,0);var d=k.toDataURL();l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,b),0,0);var e=k.toDataURL();return d===e}function e(a){var b;if(!l||!l.fillText)return!1;switch(l.textBaseline="top",l.font="600 32px Arial",a){case"flag":return!(b=d([55356,56826,55356,56819],[55356,56826,8203,55356,56819]))&&(b=d([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]),!b);case"emoji":return b=d([55357,56692,8205,9792,65039],[55357,56692,8203,9792,65039]),!b}return!1}function f(a){var c=b.createElement("script");c.src=a,c.defer=c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var g,h,i,j,k=b.createElement("canvas"),l=k.getContext&&k.getContext("2d");for(j=Array("flag","emoji"),c.supports={everything:!0,everythingExceptFlag:!0},i=0;i<j.length;i++)c.supports[j[i]]=e(j[i]),c.supports.everything=c.supports.everything&&c.supports[j[i]],"flag"!==j[i]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[j[i]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(h=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",h,!1),a.addEventListener("load",h,!1)):(a.attachEvent("onload",h),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),g=c.source||{},g.concatemoji?f(g.concatemoji):g.wpemoji&&g.twemoji&&(f(g.twemoji),f(g.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<link rel='stylesheet' id='contact-form-7-css'  href='../wp-content/plugins/contact-form-7/includes/css/styles.css%3Fver=5.0.2.css' type='text/css' media='all' />
<link rel='stylesheet' id='wp-polls-css'  href='../wp-content/plugins/wp-polls/polls-css.css%3Fver=2.73.8.css' type='text/css' media='all' />
<style id='wp-polls-inline-css' type='text/css'>
.wp-polls .pollbar {
	margin: 1px;
	font-size: 6px;
	line-height: 8px;
	height: 8px;
	background-image: url('../wp-content/plugins/wp-polls/images/default/pollbg.gif');
	border: 1px solid #c8c8c8;
}

</style>
<link rel='stylesheet' id='wp-syntax-css-css'  href='../wp-content/plugins/wp-syntax/css/wp-syntax.css%3Fver=1.1.css' type='text/css' media='all' />
<link rel='stylesheet' id='dashicons-css'  href='../wp-includes/css/dashicons.min.css%3Fver=4.9.7.css' type='text/css' media='all' />
<link rel='stylesheet' id='customizr-skin-css'  href='../wp-content/themes/customizr/inc/assets/css/black2.min.css%3Fver=3.2.10.css' type='text/css' media='all' />
<style id='customizr-skin-inline-css' type='text/css'>

.sticky-enabled .tc-shrink-on .site-logo img {
						height:30px!important;width:auto!important
					}

					.sticky-enabled .tc-shrink-on .brand .site-title {
						font-size:0.6em;opacity:0.8;line-height:1.2em
					}

.tc-rectangular-thumb {
            max-height: 250px;
            height :250px
          }

          .single .tc-rectangular-thumb {
            max-height: 250px;
            height :250px
          }


</style>
<link rel='stylesheet' id='customizr-style-css'  href='../wp-content/themes/customizr/style.css%3Fver=3.2.10.css' type='text/css' media='all' />
<link rel='stylesheet' id='fancyboxcss-css'  href='../wp-content/themes/customizr/inc/assets/js/fancybox/jquery.fancybox-1.3.4.min.css%3Fver=4.9.7.css' type='text/css' media='all' />
<link rel='stylesheet' id='jetpack-widget-social-icons-styles-css'  href='../wp-content/plugins/jetpack/modules/widgets/social-icons/social-icons.css%3Fver=20170506.css' type='text/css' media='all' />
<link rel='stylesheet' id='social-logos-css'  href='../wp-content/plugins/jetpack/_inc/social-logos/social-logos.min.css%3Fver=1.css' type='text/css' media='all' />
<link rel='stylesheet' id='jetpack_css-css'  href='../wp-content/plugins/jetpack/css/jetpack.css%3Fver=6.3.2.css' type='text/css' media='all' />
<script type='text/javascript' src='../wp-includes/js/jquery/jquery.js%3Fver=1.12.4'></script>
<script type='text/javascript' src='../wp-includes/js/jquery/jquery-migrate.min.js%3Fver=1.4.1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var TCParams = {"FancyBoxState":"1","FancyBoxAutoscale":"1","SliderName":"","SliderDelay":"","SliderHover":"1","SmoothScroll":"linear","ReorderBlocks":"1","CenterSlides":"1","HasComments":"","LeftSidebarClass":".span3.left.tc-sidebar","RightSidebarClass":".span3.right.tc-sidebar","LoadModernizr":"1","stickyCustomOffset":"0","stickyHeader":"1","dropdowntoViewport":"0","timerOnScrollAllBrowsers":"1"};
/* ]]> */
</script>
<script type='text/javascript' src='../wp-content/themes/customizr/inc/assets/js/tc-scripts.min.js%3Fver=3.2.10'></script>
<link rel='https://api.w.org/' href='../wp-json/index.html' />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://sametmax.com/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="../wp-includes/wlwmanifest.xml" /> 
<link rel='prev' title='Go to (in asyncio) considered harmful' href='../go-to-in-asyncio-considered-harmful/index.html' />
<link rel='next' title='Python 3.7 sort de sa coquille' href='../python-3-7-sort-de-sa-coquille/index.html' />
<meta name="generator" content="WordPress 4.9.7" />
<link rel="canonical" href="index.html" />
<link rel='shortlink' href='https://wp.me/p2ckfk-6oR' />
<link rel="alternate" type="application/json+oembed" href="../wp-json/oembed/1.0/embed%3Furl=http:%252F%252Fsametmax.com%252Fsuper-article-invite-sur-trio-que-lauteur-a-oublie-de-titrer%252F" />
<link rel="alternate" type="text/xml+oembed" href="../wp-json/oembed/1.0/embed%3Furl=http:%252F%252Fsametmax.com%252Fsuper-article-invite-sur-trio-que-lauteur-a-oublie-de-titrer%252F&amp;format=xml" />

<link rel='dns-prefetch' href='http://v0.wordpress.com/'/>
<style type="text/css" media="all">
/* <![CDATA[ */
@import url("../wp-content/plugins/wp-table-reloaded/css/plugin.css%3Fver=1.9.4.css");
@import url("../wp-content/plugins/wp-table-reloaded/css/datatables.css%3Fver=1.9.4.css");
/* ]]> */
</style><link rel="shortcut icon" href="../wp-content/uploads/2015/06/favicon.png" type="image/png">
<!-- Jetpack Open Graph Tags -->
<meta property="og:type" content="article" />
<meta property="og:title" content="Super article invité sur Trio que l&#8217;auteur a oublié de titrer" />
<meta property="og:url" content="http://sametmax.com/super-article-invite-sur-trio-que-lauteur-a-oublie-de-titrer/" />
<meta property="og:description" content="C&#8217;est bon vous avez cédé à la hype ?" />
<meta property="article:published_time" content="2018-06-14T07:39:52+00:00" />
<meta property="article:modified_time" content="2018-08-05T14:41:56+00:00" />
<meta property="og:site_name" content="Sam &amp; Max" />
<meta property="og:image" content="http://sametmax.com/wp-content/uploads/2018/06/0ivzB23.jpg" />
<meta property="og:image:width" content="480" />
<meta property="og:image:height" content="453" />
<meta property="og:locale" content="en_US" />
<meta name="twitter:text:title" content="Super article invité sur Trio que l&#8217;auteur a oublié de titrer" />
<meta name="twitter:image" content="http://sametmax.com/wp-content/uploads/2018/06/0ivzB23.jpg?w=640" />
<meta name="twitter:card" content="summary_large_image" />

<!-- End Jetpack Open Graph Tags -->
			<link rel="stylesheet" type="text/css" id="wp-custom-css" href="../index.html%3Fcustom-css=3b3670f11a.css" />
						    <!--Icons size hack for IE8 and less -->
				    <!--[if lt IE 9]>
				      <link href="http://sametmax.com/wp-content/themes/customizr/inc/assets/css/fonts/ie8-hacks.css" rel="stylesheet" type="text/css"/>
				    <![endif]-->
				</head>
				
	<body class="post-template-default single single-post postid-24605 single-format-standard tc-fade-hover-links tc-sticky-header tc-transparent-on-scroll" itemscope itemtype="http://schema.org/WebPage">
		
		
	   	<header class="tc-header clearfix row-fluid tc-tagline-off tc-title-logo-on  tc-shrink-on tc-menu-on logo-left" role="banner">
			      <div class="brand span3 pull-left ">

        <h1><a class="site-title" href="../index.html" title="Sam &amp; Max | Du code, du cul">Sam &amp; Max</a></h1>
      </div> <!-- brand span3 pull-left -->
      <div class="container outside"><h2 class="site-description">Du code, du cul</h2></div>      	<div class="navbar-wrapper clearfix span9 tc-submenu-fade tc-submenu-move tc-open-on-hover left">
        	<div class="navbar resp">
          		<div class="navbar-inner" role="navigation">
            		<div class="row-fluid">
              		<div class="social-block span5" ><a class="social-icon icon-feed" href="../feed/rss/index.html" title="Subscribe to my rss feed"  ></a></div><h2 class="span7 inside site-description">Du code, du cul</h2><button type="button" class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse"><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><div class="nav-collapse collapse tc-hover-menu-wrapper"><div class="menu-top-menu-container"><ul id="menu-top-menu-2" class="nav tc-hover-menu"><li class="menu-item menu-item-type-taxonomy menu-item-object-category current-post-ancestor current-menu-parent current-post-parent menu-item-1702"><a href="../category/programmation/index.html">Prog</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-1703"><a href="../category/administration-system/index.html">Admin Sys</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-1704"><a href="../category/philo-et-culture/index.html">Philo &#038; culture</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-1706"><a href="../category/cul/index.html">Cul</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-3340"><a href="../cours-et-tutos/index.html">Cours &#038; tutos</a></li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-1707"><a title="Les meilleurs blogs du Web" href="http://multiboards.net/">Multiboards</a></li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-12415"><a href="../planet-python-fr/index.html">Veille Python Fr</a></li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-15634"><a href="http://indexerror.net">Questions Python</a></li>
</ul></div></div>          			</div>
          		</div><!-- /.navbar-inner -->
        	</div><!-- /.navbar resp -->
      	</div><!-- /.navbar-wrapper -->
    			</header>
		<div id="tc-reset-margin-top" class="container-fluid" style="margin-top:103px"></div><div id="main-wrapper" class="container">

        
    <div class="container" role="main">
        <div class="row column-content-wrapper">

                            
                <div id="content" class="span9 article-container">
                    
                    
                        
                                                                                    
                                                                    <article id="post-24605" class="row-fluid post-24605 post type-post status-publish format-standard has-post-thumbnail hentry category-programmation tag-async tag-asyncio tag-await tag-python tag-trio">
                                                <header class="entry-header">
          <h1 class="entry-title format-icon">Super article invité sur Trio que l&#8217;auteur a oublié de titrer</h1>            <div class="entry-meta">
                This entry was posted in <a class="btn btn-mini" href="../category/programmation/index.html" title="View all posts in Programmation"> Programmation </a> and tagged <a class="btn btn-mini btn-tag" href="../tag/async/index.html" title="View all posts in async"> async </a><a class="btn btn-mini btn-tag" href="../tag/asyncio/index.html" title="View all posts in asyncio"> asyncio </a><a class="btn btn-mini btn-tag" href="../tag/await/index.html" title="View all posts in await"> await </a><a class="btn btn-mini btn-tag" href="../tag/python/index.html" title="View all posts in python"> python </a><a class="btn btn-mini btn-tag" href="../tag/trio/index.html" title="View all posts in trio"> trio </a> on <a href="../2018/06/14/index.html" title="07:39" rel="bookmark"><time class="entry-date updated" datetime="2018-06-14T07:39:52+00:00">14/06/2018</time></a> <span class="by-author">by <span class="author vcard"><a class="url fn n" href="../author/touilleman/index.html" title="View all posts by touilleMan" rel="author">touilleMan</a></span></span>             </div><!-- .entry-meta -->
            <hr class="featurette-divider __before_content">        </header>
            

          <section class="entry-content ">
              <p style="text-align: center;"><em><small>Ceci est un post invité de <a href="../author/touilleMan.html">touilleMan</a> posté sous licence <a href="http://creativecommons.org/licenses/by/3.0/">creative common 3.0 unported</a>.</small></em></p>
<p>C&#8217;est bon vous avez cédé à la hype ?</p>
<p>Après un n-ème talk sur asyncio vous avez été convaincu que tout vos sites webs doivent être recodé dans cette techno ? Oui, surtout celui de la mairie de Gaudriole-sur-Gironde avec ses 50 visiteurs/jour, Django ça scalera pas et vous aurez sûrement besoin de websockets à l&#8217;avenir.</p>
<p>Et puis là pan ! En commençant à utiliser asyncio on se rend compte que ça va pas être aussi marrant que ce que vous a vendu l&#8217;enfoiré de hipster dans son talk avec son exemple de crawler web en 20 lignes :</p>
<ul>
<li>la doc de asyncio fait 50 putain de pages, <a href="http://lucumr.pocoo.org/2016/10/30/i-dont-understand-asyncio/">même les plus grands déclarent ne rien y comprendre</a></li>
<li>pdb est aux fraises, un step-over sur un <code>await</code> vous envoi à perpet&#8217; dans l&#8217;event loop</li>
<li>il faut passer l&#8217;event loop en tant qu&#8217;argument à chaque fonction, évidemment vous n&#8217;allez pas le faire et utiliser <code>get_event_loop()</code> à la place. Et ça va merder sévère à un moment (typiquement quand vous ajouterez des tests non triviaux), et vous allez devoir corriger tout votre code.</li>
<li>régulièrement une stacktrace d&#8217;une coroutine ayant crashé dégueule de stdout sans que le programme ne bronche, autant de je m&#8217;en foutisme on se croirait revenu en PHP !</li>
<li>parlons-en de la stacktrace ! Impossible de savoir d&#8217;où vient la coroutine, encore une fois on nous renvoi dans les méandres de l&#8217;event loop.</li>
<li>Et pour initialiser/finaliser proprement votre système alors là c&#8217;est la fête totale</li>
</ul>
<p>Je ne parle même pas des soucis ceinture-noir-2ème-dan du genre high-water mark qui vous tomberons dessus une fois l&#8217;appli en prod.</p>
<p>Lourd est le parpaing de la réalité sur la tartelette aux fraises de nos illusions&#8230;</p>
<h2>1 &#8211; Pourquoi c&#8217;est (de) la merde ?</h2>
<p>Pour faire simple asyncio a été pensé à la base comme une tentative de standardisation de l&#8217;écosystème asynchrone Python où chaque framework (Twisted et Tornado principalement) était incompatible avec les autres et devait re-créer son écosystème de zéro.</p>
<p>C&#8217;était la bonne chose à faire à l&#8217;époque, ça a eu beaucoup de succès (Twisted et Tornado sont maintenant compatible asyncio), ça a donné une killer-feature pour faire taire les rageux au sujet de Python 3 et ça a créé une émulsion formidable concernant la programmation asynchrone en Python.<br />
Mais dans le même temps ça a obligé cette nouvelle lib à hériter des choix historiques des anciennes libs : les callbacks.</p>
<p>Pour faire simple un framework asynchrone c&#8217;est deux choses :</p>
<ul>
<li>une grosse boucle infinie (la fameuse « event loop ») qui a configuré les appels d&#8217;IO au kernel en mode non-bloquant et qui poll ceux-ci en continu</li>
<li>un mécanisme pour garder trace de quel bout de code exécuter quand une IO donnée aura été terminée</li>
</ul>
<p>Concernant le 2ème point, cela veut dire que si on a une fonction synchrone comme ceci :</p>

<div class="wp_syntax" style="position:relative;"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">def</span> listen_and_answer<span style="color: black;">&#40;</span>sock<span style="color: black;">&#41;</span>:
    <span style="color: #ff7700;font-weight:bold;">print</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'start'</span><span style="color: black;">&#41;</span>
    data <span style="color: #66cc66;">=</span> sock.<span style="color: black;">read</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
    <span style="color: #ff7700;font-weight:bold;">print</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'working with %s'</span> % data<span style="color: black;">&#41;</span>
    sock.<span style="color: black;">write</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'ok'</span><span style="color: black;">&#41;</span>
    <span style="color: #ff7700;font-weight:bold;">print</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'done'</span><span style="color: black;">&#41;</span></pre></td></tr></table><p class="theCode" style="display:none;">def listen_and_answer(sock):
    print('start')
    data = sock.read()
    print('working with %s' % data)
    sock.write('ok')
    print('done')</p></div>

<p>Il faut trouver un moyen pour la découper en une série de morceaux de codes et d&#8217;IO.</p>
<p>Il y la façon « javascript », où on découpe à la main comme un compilo déroulerai une boucle :</p>

<div class="wp_syntax" style="position:relative;"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">def</span> listen_and_answer<span style="color: black;">&#40;</span>sock<span style="color: black;">&#41;</span>:
    <span style="color: #ff7700;font-weight:bold;">print</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'start'</span><span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> on_listen<span style="color: black;">&#40;</span>data<span style="color: black;">&#41;</span>:
        <span style="color: #ff7700;font-weight:bold;">print</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'working with %s'</span> % data<span style="color: black;">&#41;</span>
&nbsp;
        <span style="color: #ff7700;font-weight:bold;">def</span> on_write<span style="color: black;">&#40;</span>ret<span style="color: black;">&#41;</span>:
            <span style="color: #ff7700;font-weight:bold;">print</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'done'</span><span style="color: black;">&#41;</span>
&nbsp;
        sock.<span style="color: black;">write</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'ok'</span><span style="color: #66cc66;">,</span> on_write<span style="color: black;">&#41;</span>
&nbsp;
    sock.<span style="color: black;">read</span><span style="color: black;">&#40;</span>on_listen<span style="color: black;">&#41;</span></pre></td></tr></table><p class="theCode" style="display:none;">def listen_and_answer(sock):
    print('start')

    def on_listen(data):
        print('working with %s' % data)

        def on_write(ret):
            print('done')

        sock.write('ok', on_write)

    sock.read(on_listen)</p></div>

<p>Et là j&#8217;ai fait la version simple sans chercher à gérer les exceptions et autres joyeusetés. Autant dire que quand un vieux dev Twisted vous dit le regard vide et la voix chevrotante qu&#8217;il a connu l&#8217;enfer, ne prenez pas ses déclarations à la légère.</p>
<p>Sinon la façon async/await si chère à asyncio :</p>

<div class="wp_syntax" style="position:relative;"><table><tr><td class="code"><pre class="python" style="font-family:monospace;">async <span style="color: #ff7700;font-weight:bold;">def</span> listen_and_answer<span style="color: black;">&#40;</span>sock<span style="color: black;">&#41;</span>:
    <span style="color: #ff7700;font-weight:bold;">print</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'start'</span><span style="color: black;">&#41;</span>
    data <span style="color: #66cc66;">=</span> await sock.<span style="color: black;">read</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
    <span style="color: #ff7700;font-weight:bold;">print</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'working with %s'</span> % data<span style="color: black;">&#41;</span>
    await sock.<span style="color: black;">write</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'ok'</span><span style="color: black;">&#41;</span>
    <span style="color: #ff7700;font-weight:bold;">print</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'done'</span><span style="color: black;">&#41;</span></pre></td></tr></table><p class="theCode" style="display:none;">async def listen_and_answer(sock):
    print('start')
    data = await sock.read()
    print('working with %s' % data)
    await sock.write('ok')
    print('done')</p></div>

<p>C&#8217;est clair, c&#8217;est propre, la gestion des exceptions est totalement naturelle, bref c&#8217;est du Python dans toute sa splendeur.<br />
Sauf que non, tout ça n&#8217;est qu&#8217;un putain d&#8217;écran de fumée : pour être compatible avec Twisted&amp;co sous le capot asyncio fonctionne avec des callbacks.</p>
<p>Vous vous souvenez de cette sensation de détresse mêlée d’hilarité devant une stacktrace d&#8217;un projet Javascript lambda d&#8217;où vous ne reconnaissez que la première ligne ? C&#8217;est ça les callbacks, et c&#8217;est ça que vous avez dans asyncio.</p>
<p>Concrètement le soucis vient du fait qu&#8217;une callback n&#8217;est rien d&#8217;autre qu&#8217;une fonction passée telle qu&#8217;elle sans aucune information quant à d&#8217;où elle vient. De fait impossible pour l&#8217;event loop asynchrone de reconstruire une callstack complète à partir de cela.<br />
Heureusement async/await permettent à python de conserver ces informations de fonction appelante ce qui limite un peu le problème avec asyncio.<br />
Toutefois en remontant suffisamment haut on finira toujours avec une callback quelque part. Et vous savez qui a l&#8217;habitude de remonter aussi haut que nécessaire ? Les exceptions.</p>

<div class="wp_syntax" style="position:relative;"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">import</span> asyncio
<span style="color: #ff7700;font-weight:bold;">import</span> <span style="color: #dc143c;">random</span>
&nbsp;
async <span style="color: #ff7700;font-weight:bold;">def</span> succeed<span style="color: black;">&#40;</span>client_writer<span style="color: black;">&#41;</span>:
    <span style="color: #ff7700;font-weight:bold;">print</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'Lucky guy...'</span><span style="color: black;">&#41;</span>
    <span style="color: #808080; font-style: italic;"># Googlez &quot;ayncio high water mark&quot; pour comprender pourquoi c'est</span>
    <span style="color: #808080; font-style: italic;"># une idée à la con de ne pas avoir cette methode asynchrone</span>
    client_writer.<span style="color: black;">write</span><span style="color: black;">&#40;</span>b<span style="color: #483d8b;">'Lucky guy...'</span><span style="color: black;">&#41;</span>
&nbsp;
async <span style="color: #ff7700;font-weight:bold;">def</span> fail<span style="color: black;">&#40;</span>client_writer<span style="color: black;">&#41;</span>:
    <span style="color: #ff7700;font-weight:bold;">raise</span> <span style="color: #008000;">RuntimeError</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'Tough shit...'</span><span style="color: black;">&#41;</span>
&nbsp;
async <span style="color: #ff7700;font-weight:bold;">def</span> handle_request_russian_roulette_style<span style="color: black;">&#40;</span>client_reader<span style="color: #66cc66;">,</span> client_writer<span style="color: black;">&#41;</span>:
    handlers <span style="color: #66cc66;">=</span> <span style="color: black;">&#40;</span>
        succeed<span style="color: #66cc66;">,</span>
        succeed<span style="color: #66cc66;">,</span>
        succeed<span style="color: #66cc66;">,</span>
        fail<span style="color: #66cc66;">,</span>
    <span style="color: black;">&#41;</span>
    await handlers<span style="color: black;">&#91;</span><span style="color: #dc143c;">random</span>.<span style="color: black;">randint</span><span style="color: black;">&#40;</span><span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">3</span><span style="color: black;">&#41;</span><span style="color: black;">&#93;</span><span style="color: black;">&#40;</span>client_writer<span style="color: black;">&#41;</span>
    client_writer.<span style="color: black;">close</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
&nbsp;
async <span style="color: #ff7700;font-weight:bold;">def</span> start_server<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>:
    server <span style="color: #66cc66;">=</span> await asyncio.<span style="color: black;">start_server</span><span style="color: black;">&#40;</span>
        handle_request_russian_roulette_style<span style="color: #66cc66;">,</span>
        host<span style="color: #66cc66;">=</span><span style="color: #483d8b;">'localhost'</span><span style="color: #66cc66;">,</span> port<span style="color: #66cc66;">=</span><span style="color: #ff4500;">8080</span><span style="color: black;">&#41;</span>
    await server.<span style="color: black;">wait_closed</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
&nbsp;
asyncio.<span style="color: black;">get_event_loop</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>.<span style="color: black;">run_until_complete</span><span style="color: black;">&#40;</span>start_server<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span></pre></td></tr></table><p class="theCode" style="display:none;">import asyncio
import random

async def succeed(client_writer):
    print('Lucky guy...')
    # Googlez &quot;ayncio high water mark&quot; pour comprender pourquoi c'est
    # une idée à la con de ne pas avoir cette methode asynchrone
    client_writer.write(b'Lucky guy...')

async def fail(client_writer):
    raise RuntimeError('Tough shit...')

async def handle_request_russian_roulette_style(client_reader, client_writer):
    handlers = (
        succeed,
        succeed,
        succeed,
        fail,
    )
    await handlers[random.randint(0, 3)](client_writer)
    client_writer.close()

async def start_server():
    server = await asyncio.start_server(
        handle_request_russian_roulette_style,
        host='localhost', port=8080)
    await server.wait_closed()

asyncio.get_event_loop().run_until_complete(start_server())</p></div>

<p>Maintenant si on lance tout ça et qu&#8217;on envoie des <code>curl localhost:8080</code> on va finir avec:</p>

<div class="wp_syntax" style="position:relative;"><table><tr><td class="code"><pre class="bash" style="font-family:monospace;">$ python3 russian_roulette_server.py
Lucky guy...
Lucky guy...
Task exception was never retrieved
future:  <span style="color: #007800;">exception</span>=RuntimeError<span style="color: #7a0874; font-weight: bold;">&#40;</span><span style="color: #ff0000;">'Tough shit...'</span>,<span style="color: #7a0874; font-weight: bold;">&#41;</span><span style="color: #000000; font-weight: bold;">&amp;</span>gt;
Traceback <span style="color: #7a0874; font-weight: bold;">&#40;</span>most recent call <span style="color: #c20cb9; font-weight: bold;">last</span><span style="color: #7a0874; font-weight: bold;">&#41;</span>:
  File <span style="color: #ff0000;">&quot;ex.py&quot;</span>, line <span style="color: #000000;">18</span>, <span style="color: #000000; font-weight: bold;">in</span> handle_request_russian_roulette_style
    await handlers<span style="color: #7a0874; font-weight: bold;">&#91;</span>random.randint<span style="color: #7a0874; font-weight: bold;">&#40;</span><span style="color: #000000;">0</span>, <span style="color: #000000;">3</span><span style="color: #7a0874; font-weight: bold;">&#41;</span><span style="color: #7a0874; font-weight: bold;">&#93;</span><span style="color: #7a0874; font-weight: bold;">&#40;</span>client_writer<span style="color: #7a0874; font-weight: bold;">&#41;</span>
  File <span style="color: #ff0000;">&quot;ex.py&quot;</span>, line <span style="color: #000000;">9</span>, <span style="color: #000000; font-weight: bold;">in</span> fail
    raise RuntimeError<span style="color: #7a0874; font-weight: bold;">&#40;</span><span style="color: #ff0000;">'Tough shit...'</span><span style="color: #7a0874; font-weight: bold;">&#41;</span>
RuntimeError: Tough shit...
Lucky guy...
Task exception was never retrieved
future:  <span style="color: #007800;">exception</span>=RuntimeError<span style="color: #7a0874; font-weight: bold;">&#40;</span><span style="color: #ff0000;">'Tough shit...'</span>,<span style="color: #7a0874; font-weight: bold;">&#41;</span><span style="color: #000000; font-weight: bold;">&amp;</span>gt;
Traceback <span style="color: #7a0874; font-weight: bold;">&#40;</span>most recent call <span style="color: #c20cb9; font-weight: bold;">last</span><span style="color: #7a0874; font-weight: bold;">&#41;</span>:
  File <span style="color: #ff0000;">&quot;ex.py&quot;</span>, line <span style="color: #000000;">18</span>, <span style="color: #000000; font-weight: bold;">in</span> handle_request_russian_roulette_style
    await handlers<span style="color: #7a0874; font-weight: bold;">&#91;</span>random.randint<span style="color: #7a0874; font-weight: bold;">&#40;</span><span style="color: #000000;">0</span>, <span style="color: #000000;">3</span><span style="color: #7a0874; font-weight: bold;">&#41;</span><span style="color: #7a0874; font-weight: bold;">&#93;</span><span style="color: #7a0874; font-weight: bold;">&#40;</span>client_writer<span style="color: #7a0874; font-weight: bold;">&#41;</span>
  File <span style="color: #ff0000;">&quot;ex.py&quot;</span>, line <span style="color: #000000;">9</span>, <span style="color: #000000; font-weight: bold;">in</span> fail
    raise RuntimeError<span style="color: #7a0874; font-weight: bold;">&#40;</span><span style="color: #ff0000;">'Tough shit...'</span><span style="color: #7a0874; font-weight: bold;">&#41;</span>
RuntimeError: Tough shit...</pre></td></tr></table><p class="theCode" style="display:none;">$ python3 russian_roulette_server.py
Lucky guy...
Lucky guy...
Task exception was never retrieved
future:  exception=RuntimeError('Tough shit...',)&amp;gt;
Traceback (most recent call last):
  File &quot;ex.py&quot;, line 18, in handle_request_russian_roulette_style
    await handlers[random.randint(0, 3)](client_writer)
  File &quot;ex.py&quot;, line 9, in fail
    raise RuntimeError('Tough shit...')
RuntimeError: Tough shit...
Lucky guy...
Task exception was never retrieved
future:  exception=RuntimeError('Tough shit...',)&amp;gt;
Traceback (most recent call last):
  File &quot;ex.py&quot;, line 18, in handle_request_russian_roulette_style
    await handlers[random.randint(0, 3)](client_writer)
  File &quot;ex.py&quot;, line 9, in fail
    raise RuntimeError('Tough shit...')
RuntimeError: Tough shit...</p></div>

<p>Le problème saute aux yeux: <code>asyncio.start_server</code> gère sa tambouille avec des callbacks et se retrouve bien embêté quand notre code remonte une exception. Du coup il fait au mieux en affichant la stacktrace et en faisant comme si de rien n&#8217;était. C&#8217;est peut-être le comportement qu&#8217;on attend d&#8217;un serveur web (encore que&#8230; si aviez configuré logging pour envoyer dans un fichier vous êtes bien baïzay) mais il existe des tonnes de usecases pour lesquels ça pose problème (et de toute façon on n&#8217;a vu que la partie émergée de l&#8217;iceberg d&#8217;emmerdes qu&#8217;est la programmation asynchrone).</p>
<p>Bref, si vous voulez en savoir plus, allez lire <a href="https://vorpus.org/blog/some-thoughts-on-asynchronous-api-design-in-a-post-asyncawait-world/">ce post</a>, d&#8217;ailleurs allez lire tous les posts du blog, ce mec est un génie.</p>
<h2>2 &#8211; Trio, une façon de faire de l&#8217;asynchrone</h2>
<p>Ce mec en question, c&#8217;est Nathaniel J. Smith et il a eu la très cool idée de créer sa propre lib asynchrone pour Python: <a href="https://trio.readthedocs.io/">Trio</a></p>
<p>L&#8217;objectif est simple: rendre la programmation asynchrone (presque) aussi simple que celle synchrone en s&#8217;appuyant sur les nouvelles fonctionnalités offertes par les dernières versions de Python ainsi qu&#8217;un paradigme de concurrence innovant. Cette phrase est digne d&#8217;un marketeux, vous avez le droit de me cracher à la gueule.</p>
<p>Concrètement ce que ça donne:</p>

<div class="wp_syntax" style="position:relative;"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #808080; font-style: italic;"># pip install trio asks beautifulsoup4</span>
<span style="color: #ff7700;font-weight:bold;">import</span> trio
<span style="color: #ff7700;font-weight:bold;">import</span> asks
<span style="color: #ff7700;font-weight:bold;">import</span> bs4
<span style="color: #ff7700;font-weight:bold;">import</span> <span style="color: #dc143c;">re</span>
&nbsp;
&nbsp;
<span style="color: #808080; font-style: italic;"># Asks est un grosso modo requests en asynchrone, vu qu'il supporte trio et curio</span>
<span style="color: #808080; font-style: italic;"># (une autre lib asynchrone dans le même style), il faut donc lui dire lequel utiliser</span>
asks.<span style="color: black;">init</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'trio'</span><span style="color: black;">&#41;</span>
&nbsp;
&nbsp;
async <span style="color: #ff7700;font-weight:bold;">def</span> recursive_find<span style="color: black;">&#40;</span>url<span style="color: #66cc66;">,</span> on_found<span style="color: #66cc66;">,</span> depth<span style="color: #66cc66;">=</span><span style="color: #ff4500;">0</span><span style="color: black;">&#41;</span>:
    <span style="color: #808080; font-style: italic;"># On fait notre requête HTTP en asynchrone</span>
    rep <span style="color: #66cc66;">=</span> await asks.<span style="color: black;">get</span><span style="color: black;">&#40;</span>url<span style="color: black;">&#41;</span>
    <span style="color: #ff7700;font-weight:bold;">print</span><span style="color: black;">&#40;</span>f<span style="color: #483d8b;">'depth {depth}, try {url}...'</span><span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># On retrouve le corps de l'article grace à beautiful soup</span>
    soup <span style="color: #66cc66;">=</span> bs4.<span style="color: black;">BeautifulSoup</span><span style="color: black;">&#40;</span>rep.<span style="color: black;">text</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'html.parser'</span><span style="color: black;">&#41;</span>
    body <span style="color: #66cc66;">=</span> soup.<span style="color: black;">find</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'div'</span><span style="color: #66cc66;">,</span> attrs<span style="color: #66cc66;">=</span><span style="color: black;">&#123;</span><span style="color: #483d8b;">&quot;id&quot;</span>: <span style="color: #483d8b;">'mw-content-text'</span><span style="color: black;">&#125;</span><span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># On cherche notre point Godwin</span>
    <span style="color: #ff7700;font-weight:bold;">if</span> <span style="color: #dc143c;">re</span>.<span style="color: black;">search</span><span style="color: black;">&#40;</span>r<span style="color: #483d8b;">'(?i)hitler|nazi|adolf'</span><span style="color: #66cc66;">,</span> body.<span style="color: black;">text</span><span style="color: black;">&#41;</span>:
        on_found<span style="color: black;">&#40;</span>url<span style="color: #66cc66;">,</span> depth<span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">else</span>:
        async <span style="color: #ff7700;font-weight:bold;">with</span> trio.<span style="color: black;">open_nursery</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span> <span style="color: #ff7700;font-weight:bold;">as</span> nursery:
            <span style="color: #808080; font-style: italic;"># On retrouve tous les liens de l'article et relance le recherche</span>
            <span style="color: #808080; font-style: italic;"># de manière récursive</span>
            <span style="color: #ff7700;font-weight:bold;">for</span> tag <span style="color: #ff7700;font-weight:bold;">in</span> body.<span style="color: black;">find_all</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'a'</span><span style="color: black;">&#41;</span>:
                <span style="color: #ff7700;font-weight:bold;">if</span> tag.<span style="color: black;">has_attr</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'href'</span><span style="color: black;">&#41;</span> <span style="color: #ff7700;font-weight:bold;">and</span> tag.<span style="color: black;">attrs</span><span style="color: black;">&#91;</span><span style="color: #483d8b;">'href'</span><span style="color: black;">&#93;</span>.<span style="color: black;">startswith</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'/wiki/'</span><span style="color: black;">&#41;</span>:
                    child_link <span style="color: #66cc66;">=</span> <span style="color: #483d8b;">'https://en.wikipedia.org'</span> + tag.<span style="color: black;">attrs</span><span style="color: black;">&#91;</span><span style="color: #483d8b;">'href'</span><span style="color: black;">&#93;</span>
                    <span style="color: #808080; font-style: italic;"># On créé une nouvelle coroutine par lien à crawler</span>
                    nursery.<span style="color: black;">start_soon</span><span style="color: black;">&#40;</span>recursive_find<span style="color: #66cc66;">,</span> child_link<span style="color: #66cc66;">,</span> on_found<span style="color: #66cc66;">,</span> depth+<span style="color: #ff4500;">1</span><span style="color: black;">&#41;</span>
&nbsp;
&nbsp;
async <span style="color: #ff7700;font-weight:bold;">def</span> godwin_find<span style="color: black;">&#40;</span>url<span style="color: black;">&#41;</span>:
    results <span style="color: #66cc66;">=</span> <span style="color: black;">&#91;</span><span style="color: black;">&#93;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">with</span> trio.<span style="color: black;">move_on_after</span><span style="color: black;">&#40;</span><span style="color: #ff4500;">10</span><span style="color: black;">&#41;</span> <span style="color: #ff7700;font-weight:bold;">as</span> cancel_scope:
        <span style="color: #ff7700;font-weight:bold;">def</span> on_found<span style="color: black;">&#40;</span>found_url<span style="color: #66cc66;">,</span> depth<span style="color: black;">&#41;</span>:
            results.<span style="color: black;">append</span><span style="color: black;">&#40;</span><span style="color: black;">&#40;</span>found_url<span style="color: #66cc66;">,</span> depth<span style="color: black;">&#41;</span><span style="color: black;">&#41;</span>
            cancel_scope.<span style="color: black;">cancel</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
&nbsp;
        await recursive_find<span style="color: black;">&#40;</span>url<span style="color: #66cc66;">,</span> on_found<span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">if</span> results:
        found_url<span style="color: #66cc66;">,</span> depth <span style="color: #66cc66;">=</span> results<span style="color: black;">&#91;</span><span style="color: #ff4500;">0</span><span style="color: black;">&#93;</span>
        <span style="color: #ff7700;font-weight:bold;">print</span><span style="color: black;">&#40;</span>f<span style="color: #483d8b;">'Found Godwin point in {found_url} (depth: {depth})'</span><span style="color: black;">&#41;</span>
    <span style="color: #ff7700;font-weight:bold;">else</span>:
        <span style="color: #ff7700;font-weight:bold;">print</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'No point for this article'</span><span style="color: black;">&#41;</span>
&nbsp;
&nbsp;
trio.<span style="color: black;">run</span><span style="color: black;">&#40;</span>godwin_find<span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'https://en.wikipedia.org/wiki/My_Little_Pony'</span><span style="color: black;">&#41;</span></pre></td></tr></table><p class="theCode" style="display:none;"># pip install trio asks beautifulsoup4
import trio
import asks
import bs4
import re


# Asks est un grosso modo requests en asynchrone, vu qu'il supporte trio et curio
# (une autre lib asynchrone dans le même style), il faut donc lui dire lequel utiliser
asks.init('trio')


async def recursive_find(url, on_found, depth=0):
    # On fait notre requête HTTP en asynchrone
    rep = await asks.get(url)
    print(f'depth {depth}, try {url}...')

    # On retrouve le corps de l'article grace à beautiful soup
    soup = bs4.BeautifulSoup(rep.text, 'html.parser')
    body = soup.find('div', attrs={&quot;id&quot;: 'mw-content-text'})

    # On cherche notre point Godwin
    if re.search(r'(?i)hitler|nazi|adolf', body.text):
        on_found(url, depth)

    else:
        async with trio.open_nursery() as nursery:
            # On retrouve tous les liens de l'article et relance le recherche
            # de manière récursive
            for tag in body.find_all('a'):
                if tag.has_attr('href') and tag.attrs['href'].startswith('/wiki/'):
                    child_link = 'https://en.wikipedia.org' + tag.attrs['href']
                    # On créé une nouvelle coroutine par lien à crawler
                    nursery.start_soon(recursive_find, child_link, on_found, depth+1)


async def godwin_find(url):
    results = []

    with trio.move_on_after(10) as cancel_scope:
        def on_found(found_url, depth):
            results.append((found_url, depth))
            cancel_scope.cancel()

        await recursive_find(url, on_found)

    if results:
        found_url, depth = results[0]
        print(f'Found Godwin point in {found_url} (depth: {depth})')
    else:
        print('No point for this article')


trio.run(godwin_find, 'https://en.wikipedia.org/wiki/My_Little_Pony')</p></div>

<p>L&#8217;idée de ce code est, partant d&#8217;un article wikipedia, de crawler ses liens récursivement jusqu&#8217;à ce qu&#8217;on trouve un article contenant des mots clés.</p>
<p>Au niveau des trucs intéressants:</p>

<div class="wp_syntax" style="position:relative;"><table><tr><td class="code"><pre class="python" style="font-family:monospace;">async <span style="color: #ff7700;font-weight:bold;">with</span> trio.<span style="color: black;">open_nursery</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span> <span style="color: #ff7700;font-weight:bold;">as</span> nursery:
    <span style="color: #ff7700;font-weight:bold;">for</span> tag <span style="color: #ff7700;font-weight:bold;">in</span> body.<span style="color: black;">find_all</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'a'</span><span style="color: black;">&#41;</span>:
        <span style="color: #ff7700;font-weight:bold;">if</span> tag.<span style="color: black;">has_attr</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'href'</span><span style="color: black;">&#41;</span> <span style="color: #ff7700;font-weight:bold;">and</span> tag.<span style="color: black;">attrs</span><span style="color: black;">&#91;</span><span style="color: #483d8b;">'href'</span><span style="color: black;">&#93;</span>.<span style="color: black;">startswith</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'/wiki/'</span><span style="color: black;">&#41;</span>:
            child_link <span style="color: #66cc66;">=</span> <span style="color: #483d8b;">'https://en.wikipedia.org'</span> + tag.<span style="color: black;">attrs</span><span style="color: black;">&#91;</span><span style="color: #483d8b;">'href'</span><span style="color: black;">&#93;</span>
            nursery.<span style="color: black;">start_soon</span><span style="color: black;">&#40;</span>recursive_find<span style="color: #66cc66;">,</span> child_link<span style="color: #66cc66;">,</span> on_found<span style="color: #66cc66;">,</span> depth+<span style="color: #ff4500;">1</span><span style="color: black;">&#41;</span></pre></td></tr></table><p class="theCode" style="display:none;">async with trio.open_nursery() as nursery:
    for tag in body.find_all('a'):
        if tag.has_attr('href') and tag.attrs['href'].startswith('/wiki/'):
            child_link = 'https://en.wikipedia.org' + tag.attrs['href']
            nursery.start_soon(recursive_find, child_link, on_found, depth+1)</p></div>

<p>En trio, une coroutine doit forcément être connectée à une nurserie. Cela permet deux choses:</p>
<ul>
<li>Rattacher la coroutine à sa coroutine parente, de cette façon (et vu que trio est implémenté intégralement en utilisant async/await au lieu de callbacks), on a donc une stacktrace claire et une exception sera toujours propagée jusqu&#8217;à la racine du programme si il le faut.</li>
<li>Borner la durée de vie de la coroutine. La nurserie est un context manager asynchrone, une fois qu&#8217;on arrive à la fin du <code>async with</code>, la nursery bloque tant que toutes les coroutines qu&#8217;elle gère n&#8217;ont pas terminé. Si une coroutine raise une exception, la nursery va pouvoir cancel les autres coroutines avant de re-raise l&#8217;exception en question (cf. le point précédent)</li>
</ul>
<p>Quel intérêt à borner la durée de vie des coroutines ? Si on avait voulu écrire un truc équivalent en asyncio on aurait sans doute utilisé <code>asyncio.gather</code>:</p>

<div class="wp_syntax" style="position:relative;"><table><tr><td class="code"><pre class="python" style="font-family:monospace;">coroutines <span style="color: #66cc66;">=</span> <span style="color: black;">&#91;</span>recursive_find<span style="color: black;">&#40;</span>link<span style="color: black;">&#41;</span> <span style="color: #ff7700;font-weight:bold;">for</span> link <span style="color: #ff7700;font-weight:bold;">in</span> links<span style="color: black;">&#93;</span>
await asyncio.<span style="color: black;">gather</span><span style="color: black;">&#40;</span>coroutines<span style="color: black;">&#41;</span></pre></td></tr></table><p class="theCode" style="display:none;">coroutines = [recursive_find(link) for link in links]
await asyncio.gather(coroutines)</p></div>

<p>Maintenant on fait tourner ce code avec une connection internet un peu faiblarde (au hasard sur la box Orange de Sam ces temps ci&#8230;) les ennuis auraient commencé dès qu&#8217;une requête http aurait timeout.<br />
L&#8217;exception de timeout aurait été récupérée par <code>asyncio.gather</code> qui l&#8217;aurait relancé sans pour autant fermer les autres coroutines qui auraient continué à crawler wikipedia en créant des centaines de coroutines (oui <code>recursive_find</code> est un peu bourrin).<br />
De fait si on se place dans le cas d&#8217;un code tournant longtemps (typiquement on a un serveur web qui a lancé notre code dans le cadre du traitement d&#8217;une requête entrante) on va avoir bien du mal à retrouver l&#8217;état ayant mené à ce bordel.</p>
<p>Du coup en trio la seule solution pour avoir une coroutine qui survit à son parent c&#8217;est de lui passer une nursery en paramètre:</p>

<div class="wp_syntax" style="position:relative;"><table><tr><td class="code"><pre class="python" style="font-family:monospace;">async <span style="color: #ff7700;font-weight:bold;">def</span> work<span style="color: black;">&#40;</span>sleep_time<span style="color: #66cc66;">,</span> nursery<span style="color: black;">&#41;</span>:
    await trio.<span style="color: black;">sleep</span><span style="color: black;">&#40;</span>sleep_time<span style="color: black;">&#41;</span>
    <span style="color: #ff7700;font-weight:bold;">print</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'work done !'</span><span style="color: black;">&#41;</span>
    <span style="color: #808080; font-style: italic;"># Je vous ai dit qu'une nurserie contient automatiquement un cancel scope ?</span>
    nursery.<span style="color: black;">cancel_scope</span>.<span style="color: black;">cancel</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
&nbsp;
async <span style="color: #ff7700;font-weight:bold;">def</span> work_generator<span style="color: black;">&#40;</span>nursery<span style="color: black;">&#41;</span>:
    <span style="color: #ff7700;font-weight:bold;">print</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'bootstrapping...'</span><span style="color: black;">&#41;</span>
    await trio.<span style="color: black;">sleep</span><span style="color: black;">&#40;</span><span style="color: #ff4500;">1</span><span style="color: black;">&#41;</span>
    <span style="color: #ff7700;font-weight:bold;">for</span> sleep_time <span style="color: #ff7700;font-weight:bold;">in</span> <span style="color: #008000;">range</span><span style="color: black;">&#40;</span><span style="color: #ff4500;">10</span><span style="color: black;">&#41;</span>:
        nursery.<span style="color: black;">start_soon</span><span style="color: black;">&#40;</span>work<span style="color: #66cc66;">,</span> sleep_time<span style="color: #66cc66;">,</span> nursery<span style="color: black;">&#41;</span>
&nbsp;
async <span style="color: #ff7700;font-weight:bold;">def</span> stop_a_first_work_done<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>:
    async <span style="color: #ff7700;font-weight:bold;">with</span> trio.<span style="color: black;">open_nursery</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span> <span style="color: #ff7700;font-weight:bold;">as</span> nursery:
        await work_generator<span style="color: black;">&#40;</span>nursery<span style="color: black;">&#41;</span>
        <span style="color: #ff7700;font-weight:bold;">print</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'Waiting for a work to finish...'</span><span style="color: black;">&#41;</span></pre></td></tr></table><p class="theCode" style="display:none;">async def work(sleep_time, nursery):
    await trio.sleep(sleep_time)
    print('work done !')
    # Je vous ai dit qu'une nurserie contient automatiquement un cancel scope ?
    nursery.cancel_scope.cancel()

async def work_generator(nursery):
    print('bootstrapping...')
    await trio.sleep(1)
    for sleep_time in range(10):
        nursery.start_soon(work, sleep_time, nursery)

async def stop_a_first_work_done():
    async with trio.open_nursery() as nursery:
        await work_generator(nursery)
        print('Waiting for a work to finish...')</p></div>

<p>Un autre truc cool:</p>

<div class="wp_syntax" style="position:relative;"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">with</span> trio.<span style="color: black;">move_on_after</span><span style="color: black;">&#40;</span><span style="color: #ff4500;">10</span><span style="color: black;">&#41;</span> <span style="color: #ff7700;font-weight:bold;">as</span> cancel_scope:
    <span style="color: #ff7700;font-weight:bold;">def</span> on_found<span style="color: black;">&#40;</span>found_url<span style="color: #66cc66;">,</span> depth<span style="color: black;">&#41;</span>:
        results.<span style="color: black;">append</span><span style="color: black;">&#40;</span><span style="color: black;">&#40;</span>found_url<span style="color: #66cc66;">,</span> depth<span style="color: black;">&#41;</span><span style="color: black;">&#41;</span>
        cancel_scope.<span style="color: black;">cancel</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
&nbsp;
    await recursive_find<span style="color: black;">&#40;</span>url<span style="color: #66cc66;">,</span> on_found<span style="color: black;">&#41;</span></pre></td></tr></table><p class="theCode" style="display:none;">with trio.move_on_after(10) as cancel_scope:
    def on_found(found_url, depth):
        results.append((found_url, depth))
        cancel_scope.cancel()

    await recursive_find(url, on_found)</p></div>

<p>Vu qu&#8217;en trio on se retrouve avec un arbre de coroutines, il est très facile d&#8217;appliquer des conditions sur un sous-ensemble de l&#8217;arbre. C&#8217;est le rôle des cancel scope.<br />
Comme pour les nursery, les cancel scope sont des contexts managers (mais synchrone ceux-ci). On peut les configurer avec un timeout, une deadline, ou bien tout simplement les annuler manuellement via <code>cancel_scope.cancel()</code>.</p>
<p>Dans notre exemple, on définit un scope dont on sortira obligatoirement au bout de 10s. Pour éviter d&#8217;attendre pour rien, on annule le scope explicitement dans la closure appelée quand un résultat est trouvé.<br />
Vu que les nurseries définies à chaque appel de <code>recursive_find</code> se trouvent englobées par notre cancel scope, elles seront automatiquement détruites (et toutes les coroutines qu&#8217;elles gèrent avec).</p>
<p>Pour faire la même chose avec asyncio bonne chance:</p>
<ul>
<li>soit on passe un argument de timeout à notre appel pour récupérer la requête HTTP, mais dans ce cas pour peu que chaque requête soit individuellement plus courte que le timeout on ne s&#8217;arrêtera jamais</li>
<li>soit on gère à la mano le temps à coup de <code>time.monotonic()</code> en passant le temps restant autorisé aux coroutines filles. Bonjour la gueule du code.</li>
</ul>
<p>En plus <a href="https://vorpus.org/blog/timeouts-and-cancellation-for-humans/">comme en parlait un mec</a> (décidemment !), la gestion du timeout dans une socket tcp est foireuse, il suffit de recevoir un paquet (et une requête entière peut contenir beaucoup de paquets !) pour que le timeout soit remis à zéro. Donc encore une fois pas de garanties fortes quant à quand le code s&#8217;arrêtera.</p>
<h2>3 &#8211; <strong>Eeeeet c&#8217;est tout !</strong></h2>
<p>Au final la doc de l&#8217;api de trio pourrait tenir sur l&#8217;étiquette de mon slip: pas de promise, de futurs, de tasks, de pattern Protocol/Transport legacy. On se retrouve juste avec la sainte trinité (j&#8217;imagine que c&#8217;est de là que vient le nom) async/await, nursery, cancel scope.</p>
<p>Et évidemment maintenant, l&#8217;enfoiré de hipster qui vous vend une techno à coup de whao effect avec un crawler asynchrone de 20 lignes c&#8217;est moi&#8230;</p>
<p>Remarquez si vous préférez la version longue je vous conseil <a href="https://vorpus.org/blog/notes-on-structured-concurrency-or-go-statement-considered-harmful/">cet excellent article</a> de Nathaniel (je vous ai dit que ce mec était un génie ?).</p>
<h2>4 &#8211; L&#8217;écosystème</h2>
<p>C&#8217;est là où on se rend compte que asyncio est malgré ses lacunes une super idée: il a suffit d&#8217;écrire une <a href="https://github.com/python-trio/trio-asyncio">implémentation de l&#8217;event loop asyncio en trio</a> pour pouvoir utiliser tout l&#8217;écosystème asyncio (ce qui inclus donc Twisted et Tornado, snif c&#8217;est beau !).</p>
<p>Allez pour le plasir un exemple d&#8217;utilisation de asyncpg depuis trio:</p>

<div class="wp_syntax" style="position:relative;"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">import</span> trio_asyncio
<span style="color: #ff7700;font-weight:bold;">import</span> asyncpg
&nbsp;
&nbsp;
<span style="color: #ff7700;font-weight:bold;">class</span> TrioConnProxy:
    <span style="color: #808080; font-style: italic;"># Le décorateur permet de marquer la frontière entre trio et asyncio</span>
    <span style="color: #66cc66;">@</span>trio_asyncio.<span style="color: black;">trio2aio</span>
    async <span style="color: #ff7700;font-weight:bold;">def</span> init<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> url<span style="color: black;">&#41;</span>:
        <span style="color: #808080; font-style: italic;"># Ici on est donc dans asyncio</span>
        <span style="color: #008000;">self</span>.<span style="color: black;">conn</span> <span style="color: #66cc66;">=</span> await asyncpg.<span style="color: black;">connect</span><span style="color: black;">&#40;</span>url<span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #66cc66;">@</span>trio_asyncio.<span style="color: black;">trio2aio</span>
    async <span style="color: #ff7700;font-weight:bold;">def</span> execute<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> *args<span style="color: black;">&#41;</span>:
        <span style="color: #ff7700;font-weight:bold;">return</span> await <span style="color: #008000;">self</span>.<span style="color: black;">conn</span>.<span style="color: black;">execute</span><span style="color: black;">&#40;</span>*args<span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #66cc66;">@</span>trio_asyncio.<span style="color: black;">trio2aio</span>
    async <span style="color: #ff7700;font-weight:bold;">def</span> fetch<span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: #66cc66;">,</span> *args<span style="color: black;">&#41;</span>:
        <span style="color: #ff7700;font-weight:bold;">return</span> await <span style="color: #008000;">self</span>.<span style="color: black;">conn</span>.<span style="color: black;">fetch</span><span style="color: black;">&#40;</span>*args<span style="color: black;">&#41;</span>
&nbsp;
&nbsp;
async <span style="color: #ff7700;font-weight:bold;">def</span> main<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>:
    <span style="color: #808080; font-style: italic;"># Ici on est dans trio, c'est la fête</span>
&nbsp;
    conn <span style="color: #66cc66;">=</span> TrioConnProxy<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
    await conn.<span style="color: black;">init</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'postgresql:///'</span><span style="color: black;">&#41;</span>
&nbsp;
    await conn.<span style="color: black;">execute</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'CREATE TABLE IF NOT EXISTS users(name text primary key)'</span><span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">for</span> name <span style="color: #ff7700;font-weight:bold;">in</span> <span style="color: black;">&#40;</span><span style="color: #483d8b;">'Riri'</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'Fifi'</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'Loulou'</span><span style="color: black;">&#41;</span>:
        await conn.<span style="color: black;">execute</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'INSERT INTO users(name) VALUES ($1)'</span><span style="color: #66cc66;">,</span> name<span style="color: black;">&#41;</span>
&nbsp;
    users <span style="color: #66cc66;">=</span> await conn.<span style="color: black;">fetch</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'SELECT * FROM users'</span><span style="color: black;">&#41;</span>
    <span style="color: #ff7700;font-weight:bold;">print</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'users:'</span><span style="color: #66cc66;">,</span> <span style="color: black;">&#91;</span><span style="color: #dc143c;">user</span><span style="color: black;">&#91;</span><span style="color: #ff4500;">0</span><span style="color: black;">&#93;</span> <span style="color: #ff7700;font-weight:bold;">for</span> <span style="color: #dc143c;">user</span> <span style="color: #ff7700;font-weight:bold;">in</span> users<span style="color: black;">&#93;</span><span style="color: black;">&#41;</span>
&nbsp;
&nbsp;
<span style="color: #808080; font-style: italic;"># trio_asyncio s'occupe de configurer l'event loop par défaut de asyncio</span>
<span style="color: #808080; font-style: italic;"># puis lance le &lt;code&gt;trio.run&lt;/code&gt; classique trio_asyncio.run(main)</span></pre></td></tr></table><p class="theCode" style="display:none;">import trio_asyncio
import asyncpg


class TrioConnProxy:
    # Le décorateur permet de marquer la frontière entre trio et asyncio
    @trio_asyncio.trio2aio
    async def init(self, url):
        # Ici on est donc dans asyncio
        self.conn = await asyncpg.connect(url)

    @trio_asyncio.trio2aio
    async def execute(self, *args):
        return await self.conn.execute(*args)

    @trio_asyncio.trio2aio
    async def fetch(self, *args):
        return await self.conn.fetch(*args)


async def main():
    # Ici on est dans trio, c'est la fête

    conn = TrioConnProxy()
    await conn.init('postgresql:///')

    await conn.execute('CREATE TABLE IF NOT EXISTS users(name text primary key)')

    for name in ('Riri', 'Fifi', 'Loulou'):
        await conn.execute('INSERT INTO users(name) VALUES ($1)', name)

    users = await conn.fetch('SELECT * FROM users')
    print('users:', [user[0] for user in users])


# trio_asyncio s'occupe de configurer l'event loop par défaut de asyncio
# puis lance le &lt;code&gt;trio.run&lt;/code&gt; classique trio_asyncio.run(main)</p></div>

<p>En plus de ça trio vient avec son module pytest (avec gestion des fixtures asynchrones s&#8217;il vous plait) et Keneith Reitz a promis que la prochain version de requests supporterait async/await et <a href="https://gist.github.com/kennethreitz/fab0f200f47cfa7926607043aed2b483">trio nativement</a>, elle est pas belle la vie !</p>
<div class="sharedaddy sd-sharing-enabled"><div class="robots-nocontent sd-block sd-social sd-social-official sd-sharing"><h3 class="sd-title">Partager:</h3><div class="sd-content"><ul><li class="share-twitter"><a href="https://twitter.com/share" class="twitter-share-button" data-url="http://sametmax.com/super-article-invite-sur-trio-que-lauteur-a-oublie-de-titrer/" data-text="Super article invité sur Trio que l&#039;auteur a oublié de titrer"  >Tweet</a></li><li class="share-facebook"><div class="fb-share-button" data-href="http://sametmax.com/super-article-invite-sur-trio-que-lauteur-a-oublie-de-titrer/" data-layout="button_count"></div></li><li class="share-google-plus-1"><div class="googleplus1_button"><div class="g-plus" data-action="share" data-annotation="bubble" data-href="http://sametmax.com/super-article-invite-sur-trio-que-lauteur-a-oublie-de-titrer/"></div></div></li><li class="share-email"><a rel="nofollow" data-shared="" class="share-email sd-button" href="index.html%3Fshare=email.html" rel="noopener noreferrer" target="_blank" title="Click to email this to a friend"><span>Email</span></a></li><li><a href="index.html#" class="sharing-anchor sd-button share-more"><span>More</span></a></li><li class="share-end"></li></ul><div class="sharing-hidden"><div class="inner" style="display: none;"><ul><li class="share-reddit"><div class="reddit_button"><iframe src="http://www.reddit.com/static/button/button1.html?newwindow=true&width=120&amp;url=http%3A%2F%2Fsametmax.com%2Fsuper-article-invite-sur-trio-que-lauteur-a-oublie-de-titrer%2F&amp;title=Super%20article%20invit%C3%A9%20sur%20Trio%20que%20l%27auteur%20a%20oubli%C3%A9%20de%20titrer" height="22" width="120" scrolling="no" frameborder="0"></iframe></div></li><li class="share-pinterest"><div class="pinterest_button"><a href="https://www.pinterest.com/pin/create/button/?url=http%3A%2F%2Fsametmax.com%2Fsuper-article-invite-sur-trio-que-lauteur-a-oublie-de-titrer%2F&#038;media=http%3A%2F%2Fsametmax.com%2Fwp-content%2Fuploads%2F2018%2F06%2F0ivzB23.jpg&#038;description=Super%20article%20invit%C3%A9%20sur%20Trio%20que%20l%27auteur%20a%20oubli%C3%A9%20de%20titrer" data-pin-do="buttonPin" data-pin-config="beside"><img src="http://assets.pinterest.com/images/pidgets/pinit_fg_en_rect_gray_20.png" /></a></div></li><li class="share-end"></li><li class="share-tumblr"><a target="_blank" href="https://www.tumblr.com/share/link/?url=http%3A%2F%2Fsametmax.com%2Fsuper-article-invite-sur-trio-que-lauteur-a-oublie-de-titrer%2F&name=Super%20article%20invit%C3%A9%20sur%20Trio%20que%20l%27auteur%20a%20oubli%C3%A9%20de%20titrer" title="Share on Tumblr" style="display:inline-block; text-indent:-9999px; overflow:hidden; width:62px; height:20px; background:url('https://platform.tumblr.com/v1/share_2.png') top left no-repeat transparent;">Share on Tumblr</a></li><li class="share-pocket"><div class="pocket_button"><a href="https://getpocket.com/save" class="pocket-btn" data-lang="en" data-save-url="http://sametmax.com/super-article-invite-sur-trio-que-lauteur-a-oublie-de-titrer/" data-pocket-count="horizontal" >Pocket</a></div></li><li class="share-end"></li><li class="share-end"></li></ul></div></div></div></div></div>                        </section><!-- .entry-content -->

                                            </article>
                                
                            
                        
                    
<div id="comments" class="comments-area" >
	<h2 id="tc-comment-title" class="comments-title">11 thoughts on &ldquo;<span>Super article invité sur Trio que l&#8217;auteur a oublié de titrer</span>&rdquo;</h2>              <ul class="commentlist">
                        <li class="comment even thread-even depth-1" id="li-comment-195780">
          
            <article id="comment-195780" class="comment"><div class="row-fluid"><div class="comment-avatar span2"><img alt='' src='http://0.gravatar.com/avatar/669b36098fdff336c106e1c9ec7144eb?s=80&#038;d=retro&#038;r=x' srcset='http://0.gravatar.com/avatar/669b36098fdff336c106e1c9ec7144eb?s=160&#038;d=retro&#038;r=x 2x' class='avatar avatar-80 photo' height='80' width='80' /></div><div class="span10"> <header class="comment-meta comment-author vcard"><cite class="fn">Sieira  </cite> <a class="comment-date" href="index.html#comment-195780"><time datetime="2018-06-14T09:46:37+00:00">14/06/2018 at 09:46</time></a></header>  <section class="comment-content comment"><p>Il manque l&#8217;arg limit dans la fonction recursive_find du crawler</p>
</section></div></div></article>          <!-- #comment-## -->
        </li><!-- #comment-## -->
        <li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-195781">
          
            <article id="comment-195781" class="comment"><div class="row-fluid"><div class="comment-avatar span2"><img alt='' src='http://1.gravatar.com/avatar/71c8468ff89b252f8a01aa2ce4c53053?s=80&#038;d=retro&#038;r=x' srcset='http://1.gravatar.com/avatar/71c8468ff89b252f8a01aa2ce4c53053?s=160&#038;d=retro&#038;r=x 2x' class='avatar avatar-80 photo' height='80' width='80' /></div><div class="span10"> <header class="comment-meta comment-author vcard"><cite class="fn">YvesD  </cite> <a class="comment-date" href="index.html#comment-195781"><time datetime="2018-06-14T09:57:31+00:00">14/06/2018 at 09:57</time></a></header>  <section class="comment-content comment"><p>Hé, merci pour Asks &#8230; Depuis Lundi, je cherchais une async lib pour Trio.</p>
<p>Super article !!</p>
<p>Sinon dans le  &#8216;work_generator&#8217;; ca ne serait pas &#8216;work&#8217; au lieu du premier &#8216;nursery&#8217; dans le start_soon</p>
<p>nursery.start_soon(work, sleep_time, nursery) # &#8212; au lieu de nursery.start_soon(nursery, sleep_time, nursery)</p>
</section></div></div></article>          <!-- #comment-## -->
        </li><!-- #comment-## -->
        <li class="comment even thread-even depth-1" id="li-comment-195782">
          
            <article id="comment-195782" class="comment"><div class="row-fluid"><div class="comment-avatar span2"><img alt='' src='http://2.gravatar.com/avatar/efca4fc75d514818d08f08413f9f15c9?s=80&#038;d=retro&#038;r=x' srcset='http://2.gravatar.com/avatar/efca4fc75d514818d08f08413f9f15c9?s=160&#038;d=retro&#038;r=x 2x' class='avatar avatar-80 photo' height='80' width='80' /></div><div class="span10"> <header class="comment-meta comment-author vcard"><cite class="fn">Morgotth  </cite> <a class="comment-date" href="index.html#comment-195782"><time datetime="2018-06-14T10:42:38+00:00">14/06/2018 at 10:42</time></a></header>  <section class="comment-content comment"><p>C&#8217;est étonnant que la communauté JS n&#8217;ai pas eu l&#8217;idée avant et réécrit toutes les libs existantes pour prendre en compte cette idée #troll</p>
</section></div></div></article>          <!-- #comment-## -->
        </li><!-- #comment-## -->
        <li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-195783">
          
            <article id="comment-195783" class="comment"><div class="row-fluid"><div class="comment-avatar span2"><img alt='' src='http://0.gravatar.com/avatar/f3d0f53751577b1dc62fa00b58a9e63b?s=80&#038;d=retro&#038;r=x' srcset='http://0.gravatar.com/avatar/f3d0f53751577b1dc62fa00b58a9e63b?s=160&#038;d=retro&#038;r=x 2x' class='avatar avatar-80 photo' height='80' width='80' /></div><div class="span10"> <header class="comment-meta comment-author vcard"><cite class="fn">Ronan Delacroix  </cite> <a class="comment-date" href="index.html#comment-195783"><time datetime="2018-06-14T12:34:16+00:00">14/06/2018 at 12:34</time></a></header>  <section class="comment-content comment"><p>Lourd est le parpaing de la réalité sur la tartelette aux fraises de nos illusions :) &#8211; :love: Boulet</p>
<p>Ahah je suis bien d&#8217;accord avec le début de l&#8217;article&#8230; La plupart des développeurs ne comprenne déjà pas bien les threads ou les process, les signaux, les queues, etc. Comment bien gérer asyncio si on n&#8217;a pas une grosse expérience sur tout ça avant? Parce que ça a beau être emballé différemment, c&#8217;est les mêmes techniques, les mêmes outils utilisés derrière, et donc les mêmes problèmes qui se posent au final. Au final je ne pense pas que ces libs simplifient vraiment la vie par rapport à du multiprocessing. Bon c&#8217;est pas le point je sais je m&#8217;égare.</p>
<p>Mais putain, pourquoi vouloir se taper du code spaghetti quand 99% du temps en plus il y a pas vraiment besoin d&#8217;async&#8230;</p>
</section></div></div></article>          <!-- #comment-## -->
        </li><!-- #comment-## -->
        <li class="comment byuser comment-author-touilleman bypostauthor even thread-even depth-1" id="li-comment-195784">
          
            <article id="comment-195784" class="comment"><div class="row-fluid"><div class="comment-avatar span2"><img alt='' src='http://0.gravatar.com/avatar/969c58822a3243c5b51e61eaa4745807?s=80&#038;d=retro&#038;r=x' srcset='http://0.gravatar.com/avatar/969c58822a3243c5b51e61eaa4745807?s=160&#038;d=retro&#038;r=x 2x' class='avatar avatar-80 photo' height='80' width='80' /></div><div class="span10"> <header class="comment-meta comment-author vcard"><cite class="fn">touilleMan <span> Post author</span> </cite> <a class="comment-date" href="index.html#comment-195784"><time datetime="2018-06-14T12:36:17+00:00">14/06/2018 at 12:36</time></a></header>  <section class="comment-content comment"><p>@Sieira merci, au début j&#8217;avais voulu utiliser CapacityLimiter (qui permet de limiter simplement le nombre de coroutine pouvant être tourner en parallèle grace à an contexte manager asynchrone), mais ça complexifiait plus le code qu&#8217;autre chose. Du coup j&#8217;ai tout viré là ;-)</p>
<p>@YvesD bien vu !</p>
<p>@Morgotth le problème de javascript c&#8217;est que l&#8217;event loop est totalement intégré à la runtime, donc impossible de faire ce que fait trio sans avoir à écrire une nouvelle spec super impactante (et jamais implémenter proprement sans doute) pour tous les navigateurs. Sans compter toutes les api fonctionnant avec des callbacks (ou promise ce qui revient au même) qui deviendrait obsolète, soit quasiment tout l&#8217;écosystème javascript (à la différence de python qui reste majoritairement synchrone)&#8230;</p>
</section></div></div></article>          <!-- #comment-## -->
        </li><!-- #comment-## -->
        <li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-195825">
          
            <article id="comment-195825" class="comment"><div class="row-fluid"><div class="comment-avatar span2"><img alt='' src='http://2.gravatar.com/avatar/5db6430547954bbfaa2b80d85ecd3a5e?s=80&#038;d=retro&#038;r=x' srcset='http://2.gravatar.com/avatar/5db6430547954bbfaa2b80d85ecd3a5e?s=160&#038;d=retro&#038;r=x 2x' class='avatar avatar-80 photo' height='80' width='80' /></div><div class="span10"> <header class="comment-meta comment-author vcard"><cite class="fn">Pouet  </cite> <a class="comment-date" href="index.html#comment-195825"><time datetime="2018-06-16T15:50:48+00:00">16/06/2018 at 15:50</time></a></header>  <section class="comment-content comment"><p>Oui, par contre je ne suis pas d&#8217;accord quand tu dis que la stacktrace de trio est claire. Tu y trouves les informations que tu cherches, certes, mais par contre chaque stacktrace est aussi longue que la constitution de la 5e république.</p>
<p>Je sais, <a href="https://github.com/python-trio/trio/issues/56" rel="nofollow">c&#8217;est en train d&#8217;être fixé</a>, mais du coup je poste ça surtout pour rajouter un truc dont tu n&#8217;as pas parlé dans l&#8217;article : trio n&#8217;est pas encore production-ready, attendez encore un peu avant de lancer vos fusées avec. C&#8217;est super prometteur, ça marche déjà carrément bien pour beaucoup de choses, la doc est géniale (sérieusement, ça faisait longtemps que j&#8217;avais pas vu une doc aussi bien faite, limpide, un bonheur à lire), mais y&#8217;a encore beaucoup de discussions en cours sur le design, quelques changements d&#8217;api à prévoir, des angles très anguleux à arrondir&#8230;</p>
</section></div></div></article>          <!-- #comment-## -->
        </li><!-- #comment-## -->
        <li class="comment even thread-even depth-1" id="li-comment-196135">
          
            <article id="comment-196135" class="comment"><div class="row-fluid"><div class="comment-avatar span2"><img alt='' src='http://2.gravatar.com/avatar/b5e968dfef95d370632be97cd9d74b4a?s=80&#038;d=retro&#038;r=x' srcset='http://2.gravatar.com/avatar/b5e968dfef95d370632be97cd9d74b4a?s=160&#038;d=retro&#038;r=x 2x' class='avatar avatar-80 photo' height='80' width='80' /></div><div class="span10"> <header class="comment-meta comment-author vcard"><cite class="fn">rikardo  </cite> <a class="comment-date" href="index.html#comment-196135"><time datetime="2018-06-28T12:00:26+00:00">28/06/2018 at 12:00</time></a></header>  <section class="comment-content comment"><p>Par contre, moi, avec toutes ces nouveautés, je trouve que le code Python est de plus en plus dégueulasse à lire : entre les indications de type, await&#8230;je trouve que ça dégueulasse le code&#8230;</p>
</section></div></div></article>          <!-- #comment-## -->
        </li><!-- #comment-## -->
        <li class="comment byuser comment-author-sam odd alt thread-odd thread-alt depth-1" id="li-comment-196142">
          
            <article id="comment-196142" class="comment"><div class="row-fluid"><div class="comment-avatar span2"><img alt='' src='http://2.gravatar.com/avatar/bf9ecde8f5e286de6ce5c80206cf9dd6?s=80&#038;d=retro&#038;r=x' srcset='http://2.gravatar.com/avatar/bf9ecde8f5e286de6ce5c80206cf9dd6?s=160&#038;d=retro&#038;r=x 2x' class='avatar avatar-80 photo' height='80' width='80' /></div><div class="span10"> <header class="comment-meta comment-author vcard"><cite class="fn">Sam  </cite> <a class="comment-date" href="index.html#comment-196142"><time datetime="2018-06-28T17:33:10+00:00">28/06/2018 at 17:33</time></a></header>  <section class="comment-content comment"><p>Les indications de types sont facultatives, et n&#8217;ont même pas besoin d&#8217;être dans le même fichier.</p>
<p>Par ailleurs, await n&#8217;est utile que pour le cas les projets asynchrones, ce qui est 0.1% du code. L&#8217;alternative c&#8217;est les callbacks, ce qui est bien plus dégueu.</p>
</section></div></div></article>          <!-- #comment-## -->
        </li><!-- #comment-## -->
        <li class="comment even thread-even depth-1" id="li-comment-196966">
          
            <article id="comment-196966" class="comment"><div class="row-fluid"><div class="comment-avatar span2"><img alt='' src='http://0.gravatar.com/avatar/02750b4cc6dd3cf5450573623a020105?s=80&#038;d=retro&#038;r=x' srcset='http://0.gravatar.com/avatar/02750b4cc6dd3cf5450573623a020105?s=160&#038;d=retro&#038;r=x 2x' class='avatar avatar-80 photo' height='80' width='80' /></div><div class="span10"> <header class="comment-meta comment-author vcard"><cite class="fn">mdupuy  </cite> <a class="comment-date" href="index.html#comment-196966"><time datetime="2018-07-27T11:04:50+00:00">27/07/2018 at 11:04</time></a></header>  <section class="comment-content comment"><p><em> doivent être <strong>recordé </strong>dans cette techno</em><br />
je pense que c&#8217;est &#8220;<strong>recodé</strong>&#8221; :)</p>
</section></div></div></article>          <!-- #comment-## -->
        </li><!-- #comment-## -->
        <li class="comment byuser comment-author-touilleman bypostauthor odd alt thread-odd thread-alt depth-1" id="li-comment-197138">
          
            <article id="comment-197138" class="comment"><div class="row-fluid"><div class="comment-avatar span2"><img alt='' src='http://0.gravatar.com/avatar/969c58822a3243c5b51e61eaa4745807?s=80&#038;d=retro&#038;r=x' srcset='http://0.gravatar.com/avatar/969c58822a3243c5b51e61eaa4745807?s=160&#038;d=retro&#038;r=x 2x' class='avatar avatar-80 photo' height='80' width='80' /></div><div class="span10"> <header class="comment-meta comment-author vcard"><cite class="fn">touilleMan <span> Post author</span> </cite> <a class="comment-date" href="index.html#comment-197138"><time datetime="2018-08-05T14:42:35+00:00">05/08/2018 at 14:42</time></a></header>  <section class="comment-content comment"><p>@mdupuy corrigé, merci ;-)</p>
</section></div></div></article>          <!-- #comment-## -->
        </li><!-- #comment-## -->
        <li class="comment byuser comment-author-touilleman bypostauthor even thread-even depth-1" id="li-comment-197733">
          
            <article id="comment-197733" class="comment"><div class="row-fluid"><div class="comment-avatar span2"><img alt='' src='http://0.gravatar.com/avatar/969c58822a3243c5b51e61eaa4745807?s=80&#038;d=retro&#038;r=x' srcset='http://0.gravatar.com/avatar/969c58822a3243c5b51e61eaa4745807?s=160&#038;d=retro&#038;r=x 2x' class='avatar avatar-80 photo' height='80' width='80' /></div><div class="span10"> <header class="comment-meta comment-author vcard"><cite class="fn">touilleMan <span> Post author</span> </cite> <a class="comment-date" href="index.html#comment-197733"><time datetime="2018-09-14T15:56:03+00:00">14/09/2018 at 15:56</time></a></header>  <section class="comment-content comment"><p>@Pouet tes prières à satan ont fini par être entendu: la dernière version de trio (0.7.0) apporte une grosse amélioration sur la clarté des stacktraces<br />
Pour les détails ==> <a href="https://vorpus.org/blog/beautiful-tracebacks-in-trio-v070/" rel="nofollow">https://vorpus.org/blog/beautiful-tracebacks-in-trio-v070/</a></p>
</section></div></div></article>          <!-- #comment-## -->
        </li><!-- #comment-## -->
              </ul><!-- .commentlist -->
            <p class="nocomments">Comments are closed.</p></div><!-- #comments .comments-area -->


<div class="ie-comment">
Des questions Python sans rapport avec l'article ? Posez-les sur <a href="http://indexerror.net">IndexError</a>.

</div>
        
          <hr class="featurette-divider __after_loop">
          <nav id="nav-below" class="navigation" role="navigation">

              <h3 class="assistive-text">
                Post navigation              </h3>

              <ul class="pager">
                                  <li class="previous">
                    <span class="nav-previous">
                      <a href="../go-to-in-asyncio-considered-harmful/index.html" rel="prev"><span class="meta-nav">&larr;</span> Go to (in asyncio) considered harmful</a>                    </span>
                  </li>
                                                  <li class="next">
                    <span class="nav-next">
                        <a href="../python-3-7-sort-de-sa-coquille/index.html" rel="next">Python 3.7 sort de sa coquille <span class="meta-nav">&rarr;</span></a>                    </span>
                  </li>
                              </ul>

          </nav><!-- #nav-below .navigation -->

        
        
                </div><!--.article-container -->

                    
        <div class="span3 right tc-sidebar">
           <div id="right" class="widget-area" role="complementary">
                                                      <aside id="text-9" class="widget widget_text">			<div class="textwidget"><p style="font-size:1.3em"><a href="../mais-ou-je-suis-tombee-la/index.html">Mais où je suis tombé(e) là ?</a></p></div>
		</aside><aside id="text-7" class="widget widget_text">			<div class="textwidget"><img src="http://www.adobe.com/images/pdficon_small.png" width="16" height="16"/> <a href="http://pdfcrowd.com/url_to_pdf/">Télécharger cette page en PDF</a> </div>
		</aside><aside id="text-4" class="widget widget_text">			<div class="textwidget"><br><br><a href="../appel-a-contributeurs-impertinents/index.html"><img src="../wp-content/uploads/2012/07/contributeur.png" width="288px" style="vertical-align: middle;margin-top:-40px;margin-bottom:10px;"></a> </div>
		</aside><aside id="blog_subscription-4" class="widget jetpack_subscription_widget"><h3 class="widget-title">Souscrire à nos conneries</h3>
			<form action="index.html#" method="post" accept-charset="utf-8" id="subscribe-blog-blog_subscription-4">
				<div id="subscribe-text"><p>Entrez votre adresse mail et vous recevrez une notification à chaque nouvel article.</p>
</div><p>Join 1,492 other subscribers</p>
					<p id="subscribe-email">
						<label id="jetpack-subscribe-label" for="subscribe-field-blog_subscription-4">
							Email Address						</label>
						<input type="email" name="email" required="required" class="required" value="" id="subscribe-field-blog_subscription-4" placeholder="Email Address" />
					</p>

					<p id="subscribe-submit">
						<input type="hidden" name="action" value="subscribe" />
						<input type="hidden" name="source" value="http://sametmax.com/super-article-invite-sur-trio-que-lauteur-a-oublie-de-titrer/" />
						<input type="hidden" name="sub-type" value="widget" />
						<input type="hidden" name="redirect_fragment" value="blog_subscription-4" />
												<input type="submit" value="J&#039;adhère, bon dieu !" name="jetpack_subscriptions_widget" />
					</p>
							</form>

			<script>
			/*
			Custom functionality for safari and IE
			 */
			(function( d ) {
				// In case the placeholder functionality is available we remove labels
				if ( ( 'placeholder' in d.createElement( 'input' ) ) ) {
					var label = d.querySelector( 'label[for=subscribe-field-blog_subscription-4]' );
						label.style.clip 	 = 'rect(1px, 1px, 1px, 1px)';
						label.style.position = 'absolute';
						label.style.height   = '1px';
						label.style.width    = '1px';
						label.style.overflow = 'hidden';
				}

				// Make sure the email value is filled in before allowing submit
				var form = d.getElementById('subscribe-blog-blog_subscription-4'),
					input = d.getElementById('subscribe-field-blog_subscription-4'),
					handler = function( event ) {
						if ( '' === input.value ) {
							input.focus();

							if ( event.preventDefault ){
								event.preventDefault();
							}

							return false;
						}
					};

				if ( window.addEventListener ) {
					form.addEventListener( 'submit', handler, false );
				} else {
					form.attachEvent( 'onsubmit', handler );
				}
			})( document );
			</script>
				
</aside><aside id="tag_cloud-3" class="widget widget_tag_cloud"><h3 class="widget-title">TagCloud</h3><div class="tagcloud"><a href="../tag/0bin/index.html" class="tag-cloud-link tag-link-148 tag-link-position-1" style="font-size: 9.04pt;" aria-label="0bin (11 items)">0bin</a>
<a href="../tag/angularjs/index.html" class="tag-cloud-link tag-link-443 tag-link-position-2" style="font-size: 8.4pt;" aria-label="angularjs (9 items)">angularjs</a>
<a href="../tag/asyncio/index.html" class="tag-cloud-link tag-link-922 tag-link-position-3" style="font-size: 9.04pt;" aria-label="asyncio (11 items)">asyncio</a>
<a href="../tag/autobahn/index.html" class="tag-cloud-link tag-link-979 tag-link-position-4" style="font-size: 8.4pt;" aria-label="autobahn (9 items)">autobahn</a>
<a href="../tag/bash/index.html" class="tag-cloud-link tag-link-14 tag-link-position-5" style="font-size: 10.8pt;" aria-label="bash (19 items)">bash</a>
<a href="../tag/bitcoin/index.html" class="tag-cloud-link tag-link-320 tag-link-position-6" style="font-size: 8.4pt;" aria-label="bitcoin (9 items)">bitcoin</a>
<a href="../tag/blog/index.html" class="tag-cloud-link tag-link-107 tag-link-position-7" style="font-size: 11.84pt;" aria-label="blog (26 items)">blog</a>
<a href="../tag/cache/index.html" class="tag-cloud-link tag-link-333 tag-link-position-8" style="font-size: 8.72pt;" aria-label="cache (10 items)">cache</a>
<a href="../tag/comprehension-lists/index.html" class="tag-cloud-link tag-link-20 tag-link-position-9" style="font-size: 8pt;" aria-label="comprehension-lists (8 items)">comprehension-lists</a>
<a href="../tag/crossbar/index.html" class="tag-cloud-link tag-link-1046 tag-link-position-10" style="font-size: 8.4pt;" aria-label="crossbar (9 items)">crossbar</a>
<a href="../tag/css/index.html" class="tag-cloud-link tag-link-188 tag-link-position-11" style="font-size: 8.4pt;" aria-label="css (9 items)">css</a>
<a href="../tag/cul-2/index.html" class="tag-cloud-link tag-link-33 tag-link-position-12" style="font-size: 9.28pt;" aria-label="cul (12 items)">cul</a>
<a href="../tag/dict/index.html" class="tag-cloud-link tag-link-435 tag-link-position-13" style="font-size: 8pt;" aria-label="dict (8 items)">dict</a>
<a href="../tag/django/index.html" class="tag-cloud-link tag-link-28 tag-link-position-14" style="font-size: 16pt;" aria-label="django (89 items)">django</a>
<a href="../tag/don/index.html" class="tag-cloud-link tag-link-1210 tag-link-position-15" style="font-size: 10.48pt;" aria-label="don (17 items)">don</a>
<a href="../tag/encoding/index.html" class="tag-cloud-link tag-link-54 tag-link-position-16" style="font-size: 8.72pt;" aria-label="encoding (10 items)">encoding</a>
<a href="../tag/git/index.html" class="tag-cloud-link tag-link-18 tag-link-position-17" style="font-size: 12.88pt;" aria-label="git (35 items)">git</a>
<a href="../tag/http/index.html" class="tag-cloud-link tag-link-204 tag-link-position-18" style="font-size: 9.6pt;" aria-label="http (13 items)">http</a>
<a href="../tag/import/index.html" class="tag-cloud-link tag-link-215 tag-link-position-19" style="font-size: 8.4pt;" aria-label="import (9 items)">import</a>
<a href="../tag/ipython/index.html" class="tag-cloud-link tag-link-164 tag-link-position-20" style="font-size: 8.72pt;" aria-label="ipython (10 items)">ipython</a>
<a href="../tag/iterable/index.html" class="tag-cloud-link tag-link-217 tag-link-position-21" style="font-size: 9.84pt;" aria-label="iterable (14 items)">iterable</a>
<a href="../tag/javascript/index.html" class="tag-cloud-link tag-link-96 tag-link-position-22" style="font-size: 14.08pt;" aria-label="javascript (50 items)">javascript</a>
<a href="../tag/jquery/index.html" class="tag-cloud-link tag-link-112 tag-link-position-23" style="font-size: 8pt;" aria-label="jquery (8 items)">jquery</a>
<a href="../tag/linux/index.html" class="tag-cloud-link tag-link-238 tag-link-position-24" style="font-size: 9.04pt;" aria-label="linux (11 items)">linux</a>
<a href="../tag/meta/index.html" class="tag-cloud-link tag-link-102 tag-link-position-25" style="font-size: 17.52pt;" aria-label="meta (138 items)">meta</a>
<a href="../tag/mysql/index.html" class="tag-cloud-link tag-link-82 tag-link-position-26" style="font-size: 8pt;" aria-label="mysql (8 items)">mysql</a>
<a href="../tag/nginx/index.html" class="tag-cloud-link tag-link-183 tag-link-position-27" style="font-size: 9.84pt;" aria-label="nginx (14 items)">nginx</a>
<a href="../tag/nsfw/index.html" class="tag-cloud-link tag-link-319 tag-link-position-28" style="font-size: 9.84pt;" aria-label="nsfw (14 items)">nsfw</a>
<a href="../tag/pep8/index.html" class="tag-cloud-link tag-link-552 tag-link-position-29" style="font-size: 8pt;" aria-label="pep8 (8 items)">pep8</a>
<a href="../tag/pip/index.html" class="tag-cloud-link tag-link-344 tag-link-position-30" style="font-size: 8.72pt;" aria-label="pip (10 items)">pip</a>
<a href="../tag/poo/index.html" class="tag-cloud-link tag-link-549 tag-link-position-31" style="font-size: 10pt;" aria-label="poo (15 items)">poo</a>
<a href="../tag/python/index.html" class="tag-cloud-link tag-link-4 tag-link-position-32" style="font-size: 22pt;" aria-label="python (496 items)">python</a>
<a href="../tag/python-3/index.html" class="tag-cloud-link tag-link-365 tag-link-position-33" style="font-size: 8.4pt;" aria-label="python 3 (9 items)">python 3</a>
<a href="../tag/redis/index.html" class="tag-cloud-link tag-link-196 tag-link-position-34" style="font-size: 8.72pt;" aria-label="redis (10 items)">redis</a>
<a href="../tag/ruby/index.html" class="tag-cloud-link tag-link-325 tag-link-position-35" style="font-size: 8pt;" aria-label="ruby (8 items)">ruby</a>
<a href="../tag/shell/index.html" class="tag-cloud-link tag-link-202 tag-link-position-36" style="font-size: 8.72pt;" aria-label="shell (10 items)">shell</a>
<a href="../tag/sublime-text/index.html" class="tag-cloud-link tag-link-76 tag-link-position-37" style="font-size: 8.4pt;" aria-label="sublime text (9 items)">sublime text</a>
<a href="../tag/ubuntu/index.html" class="tag-cloud-link tag-link-255 tag-link-position-38" style="font-size: 10.24pt;" aria-label="ubuntu (16 items)">ubuntu</a>
<a href="../tag/unicode/index.html" class="tag-cloud-link tag-link-53 tag-link-position-39" style="font-size: 8.4pt;" aria-label="unicode (9 items)">unicode</a>
<a href="../tag/unit-tests/index.html" class="tag-cloud-link tag-link-302 tag-link-position-40" style="font-size: 8.72pt;" aria-label="unit tests (10 items)">unit tests</a>
<a href="../tag/unpacking/index.html" class="tag-cloud-link tag-link-180 tag-link-position-41" style="font-size: 8pt;" aria-label="unpacking (8 items)">unpacking</a>
<a href="../tag/virtualenv/index.html" class="tag-cloud-link tag-link-259 tag-link-position-42" style="font-size: 9.04pt;" aria-label="virtualenv (11 items)">virtualenv</a>
<a href="../tag/wamp/index.html" class="tag-cloud-link tag-link-1039 tag-link-position-43" style="font-size: 10pt;" aria-label="wamp (15 items)">wamp</a>
<a href="../tag/web-2/index.html" class="tag-cloud-link tag-link-758 tag-link-position-44" style="font-size: 8pt;" aria-label="web (8 items)">web</a>
<a href="../tag/yield/index.html" class="tag-cloud-link tag-link-287 tag-link-position-45" style="font-size: 8.4pt;" aria-label="yield (9 items)">yield</a></div>
</aside><aside id="text-5" class="widget widget_text"><h3 class="widget-title"> Envoyez des sioux</h3>			<div class="textwidget"><p><img src="../wp-content/uploads/2013/07/bitcoin.png" width="16" height="16"/> On adooooore les bitcoins :</p>

<p>

<a href="bitcoin:19zAHPPuce4BAhsdy9KaFwVLurEJXMhMAn?amount=1X8&label=SamEtMax">19zAHPPuce4BAhsdy9KaFwVLurEJXMhMAn</a>

</p></div>
		</aside><aside id="nav_menu-3" class="widget widget_nav_menu"><h3 class="widget-title">Nos projets</h3><div class="menu-nos-projets-container"><ul id="menu-nos-projets" class="menu"><li id="menu-item-15841" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-15841"><a href="http://multiboards.net/">Multiboards &#8211; l&#8217;actu geek fr en une page</a></li>
<li id="menu-item-15837" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-15837"><a href="http://0bin.net">0bin &#8211; le pastebin chiffré</a></li>
<li id="menu-item-15838" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-15838"><a href="http://allthatcounts.net">All that counts &#8211; compteur pour jeux</a></li>
<li id="menu-item-15839" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-15839"><a href="https://github.com/sametmax/django-quicky">Django quicky &#8211; quick views for Django</a></li>
<li id="menu-item-15840" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-15840"><a href="https://github.com/sametmax/VizHash.js">VizHash.js &#8211; Hash visuels</a></li>
<li id="menu-item-15842" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-15842"><a href="https://github.com/sametmax/codes-des-articles">Code des articles du blog</a></li>
</ul></div></aside><aside id="text-11" class="widget widget_text"><h3 class="widget-title"> </h3>			<div class="textwidget"> </div>
		</aside><aside id="meta-3" class="widget widget_meta"><h3 class="widget-title">Meta</h3>			<ul>
						<li><a href="../wp-login.php.html">Log in</a></li>
			<li><a href="../feed.1">Entries <abbr title="Really Simple Syndication">RSS</abbr></a></li>
			<li><a href="../comments/feed/index.html">Comments <abbr title="Really Simple Syndication">RSS</abbr></a></li>
			<li><a href="https://wordpress.org/" title="Powered by WordPress, state-of-the-art semantic personal publishing platform.">WordPress.org</a></li>			</ul>
			</aside>                                              </div><!-- #left or #right-->
        </div><!--.tc-sidebar -->

        
        </div><!--.row -->
    </div><!-- .container role: main -->

    
</div><!--#main-wrapper"-->

		<!-- FOOTER -->
		<footer id="footer" class="">
		 					<div class="container footer-widgets ">
					<div class="row widget-area" role="complementary">
												
							<div id="footer_one" class="span4">
																
										<aside id="nav_menu-2" class="widget widget_nav_menu"><h3 class="widget-title">Hors du blog</h3><div class="menu-bottom-menu-container"><ul id="menu-bottom-menu" class="menu"><li id="menu-item-2391" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2391"><a href="../contactez-nous/index.html">Page de contact</a></li>
<li id="menu-item-12230" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-12230"><a href="http://twitter.com/sam_et_max">@sam_et_max sur twitter</a></li>
<li id="menu-item-12285" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-12285"><a href="http://bridge.suumitsu.eu/?action=display&#038;bridge=TwitterBridge&#038;u=sam_et_max&#038;format=AtomFormat">Nos tweets en RSS</a></li>
<li id="menu-item-12231" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-12231"><a href="https://github.com/sametmax/">Fork me, I&#8217;m famous (github)</a></li>
</ul></div></aside>
																							</div><!-- .{$key}_widget_class -->

						
							<div id="footer_two" class="span4">
																
										<aside id="text-8" class="widget widget_text">			<div class="textwidget">Tous les textes de ce blog, sauf signalement contraire, sont sous licence <a href="http://creativecommons.org/licenses/by/3.0/">creative common 3.0 unported</a>.</div>
		</aside>
																							</div><!-- .{$key}_widget_class -->

						
							<div id="footer_three" class="span4">
																
										<aside id="archives-2" class="widget widget_archive"><h3 class="widget-title">Toi aussi, trouve un article obsolète sur notre blog</h3>		<ul>
			<li><a href='../2019/09/index.html'>September 2019</a>&nbsp;(1)</li>
	<li><a href='../2019/06/index.html'>June 2019</a>&nbsp;(1)</li>
	<li><a href='../2019/02/index.html'>February 2019</a>&nbsp;(1)</li>
	<li><a href='../2019/01/index.html'>January 2019</a>&nbsp;(3)</li>
	<li><a href='../2018/12/index.html'>December 2018</a>&nbsp;(1)</li>
	<li><a href='../2018/09/index.html'>September 2018</a>&nbsp;(2)</li>
	<li><a href='../2018/08/index.html'>August 2018</a>&nbsp;(1)</li>
	<li><a href='../2018/07/index.html'>July 2018</a>&nbsp;(3)</li>
	<li><a href='../2018/06/index.html'>June 2018</a>&nbsp;(4)</li>
	<li><a href='../2018/05/index.html'>May 2018</a>&nbsp;(2)</li>
	<li><a href='../2018/03/index.html'>March 2018</a>&nbsp;(2)</li>
	<li><a href='../2018/02/index.html'>February 2018</a>&nbsp;(1)</li>
	<li><a href='../2017/12/index.html'>December 2017</a>&nbsp;(4)</li>
	<li><a href='../2017/11/index.html'>November 2017</a>&nbsp;(5)</li>
	<li><a href='../2017/10/index.html'>October 2017</a>&nbsp;(2)</li>
	<li><a href='../2017/09/index.html'>September 2017</a>&nbsp;(1)</li>
	<li><a href='../2017/07/index.html'>July 2017</a>&nbsp;(5)</li>
	<li><a href='../2017/06/index.html'>June 2017</a>&nbsp;(3)</li>
	<li><a href='../2017/05/index.html'>May 2017</a>&nbsp;(3)</li>
	<li><a href='../2017/04/index.html'>April 2017</a>&nbsp;(2)</li>
	<li><a href='../2017/03/index.html'>March 2017</a>&nbsp;(3)</li>
	<li><a href='../2017/02/index.html'>February 2017</a>&nbsp;(5)</li>
	<li><a href='../2017/01/index.html'>January 2017</a>&nbsp;(5)</li>
	<li><a href='../2016/10/index.html'>October 2016</a>&nbsp;(2)</li>
	<li><a href='../2016/09/index.html'>September 2016</a>&nbsp;(5)</li>
	<li><a href='../2016/08/index.html'>August 2016</a>&nbsp;(2)</li>
	<li><a href='../2016/03/index.html'>March 2016</a>&nbsp;(8)</li>
	<li><a href='../2016/02/index.html'>February 2016</a>&nbsp;(9)</li>
	<li><a href='../2016/01/index.html'>January 2016</a>&nbsp;(16)</li>
	<li><a href='../2015/12/index.html'>December 2015</a>&nbsp;(6)</li>
	<li><a href='../2015/11/index.html'>November 2015</a>&nbsp;(7)</li>
	<li><a href='../2015/10/index.html'>October 2015</a>&nbsp;(2)</li>
	<li><a href='../2015/09/index.html'>September 2015</a>&nbsp;(6)</li>
	<li><a href='../2015/08/index.html'>August 2015</a>&nbsp;(10)</li>
	<li><a href='../2015/07/index.html'>July 2015</a>&nbsp;(18)</li>
	<li><a href='../2015/06/index.html'>June 2015</a>&nbsp;(13)</li>
	<li><a href='../2015/05/index.html'>May 2015</a>&nbsp;(12)</li>
	<li><a href='../2015/04/index.html'>April 2015</a>&nbsp;(13)</li>
	<li><a href='../2015/03/index.html'>March 2015</a>&nbsp;(8)</li>
	<li><a href='../2015/02/index.html'>February 2015</a>&nbsp;(4)</li>
	<li><a href='../2015/01/index.html'>January 2015</a>&nbsp;(21)</li>
	<li><a href='../2014/12/index.html'>December 2014</a>&nbsp;(24)</li>
	<li><a href='../2014/11/index.html'>November 2014</a>&nbsp;(6)</li>
	<li><a href='../2014/10/index.html'>October 2014</a>&nbsp;(18)</li>
	<li><a href='../2014/09/index.html'>September 2014</a>&nbsp;(10)</li>
	<li><a href='../2014/08/index.html'>August 2014</a>&nbsp;(5)</li>
	<li><a href='../2014/07/index.html'>July 2014</a>&nbsp;(11)</li>
	<li><a href='../2014/06/index.html'>June 2014</a>&nbsp;(25)</li>
	<li><a href='../2014/05/index.html'>May 2014</a>&nbsp;(14)</li>
	<li><a href='../2014/04/index.html'>April 2014</a>&nbsp;(10)</li>
	<li><a href='../2014/03/index.html'>March 2014</a>&nbsp;(23)</li>
	<li><a href='../2014/02/index.html'>February 2014</a>&nbsp;(27)</li>
	<li><a href='../2014/01/index.html'>January 2014</a>&nbsp;(17)</li>
	<li><a href='../2013/12/index.html'>December 2013</a>&nbsp;(27)</li>
	<li><a href='../2013/11/index.html'>November 2013</a>&nbsp;(25)</li>
	<li><a href='../2013/10/index.html'>October 2013</a>&nbsp;(27)</li>
	<li><a href='../2013/09/index.html'>September 2013</a>&nbsp;(1)</li>
	<li><a href='../2013/08/index.html'>August 2013</a>&nbsp;(31)</li>
	<li><a href='../2013/07/index.html'>July 2013</a>&nbsp;(32)</li>
	<li><a href='../2013/06/index.html'>June 2013</a>&nbsp;(24)</li>
	<li><a href='../2013/05/index.html'>May 2013</a>&nbsp;(30)</li>
	<li><a href='../2013/04/index.html'>April 2013</a>&nbsp;(31)</li>
	<li><a href='../2013/03/index.html'>March 2013</a>&nbsp;(33)</li>
	<li><a href='../2013/02/index.html'>February 2013</a>&nbsp;(29)</li>
	<li><a href='../2013/01/index.html'>January 2013</a>&nbsp;(34)</li>
	<li><a href='../2012/12/index.html'>December 2012</a>&nbsp;(32)</li>
	<li><a href='../2012/11/index.html'>November 2012</a>&nbsp;(36)</li>
	<li><a href='../2012/10/index.html'>October 2012</a>&nbsp;(35)</li>
	<li><a href='../2012/09/index.html'>September 2012</a>&nbsp;(36)</li>
	<li><a href='../2012/08/index.html'>August 2012</a>&nbsp;(37)</li>
	<li><a href='../2012/07/index.html'>July 2012</a>&nbsp;(33)</li>
	<li><a href='../2012/06/index.html'>June 2012</a>&nbsp;(24)</li>
	<li><a href='../2012/05/index.html'>May 2012</a>&nbsp;(31)</li>
	<li><a href='../2012/04/index.html'>April 2012</a>&nbsp;(20)</li>
	<li><a href='../2012/03/index.html'>March 2012</a>&nbsp;(10)</li>
	<li><a href='../2012/02/index.html'>February 2012</a>&nbsp;(14)</li>
		</ul>
		</aside>
																							</div><!-- .{$key}_widget_class -->

																	</div><!-- .row.widget-area -->
				</div><!--.footer-widgets -->
				    				 <div class="colophon">
			 	<div class="container">
			 		<div class="row-fluid">
					    <div class="span4 social-block pull-left"><span class="tc-footer-social-links-wrapper" ><a class="social-icon icon-feed" href="../feed/rss/index.html" title="Subscribe to my rss feed"  ></a></span></div><div class="span4 credits"><p>&middot; &copy; 2019 <a href="../index.html" title="Sam &amp; Max" rel="bookmark">Sam &amp; Max</a> &middot; Designed by <a href="http://themesandco.com/">Themes &amp; Co</a> &middot;</p></div><div class="span4 backtop"><p class="pull-right"><a class="back-to-top" href="index.html#">Back to top</a></p></div>	      			</div><!-- .row-fluid -->
	      		</div><!-- .container -->
	      	</div><!-- .colophon -->
	    			</footer>
			<div style="display:none">
	<div class="grofile-hash-map-669b36098fdff336c106e1c9ec7144eb">
	</div>
	<div class="grofile-hash-map-71c8468ff89b252f8a01aa2ce4c53053">
	</div>
	<div class="grofile-hash-map-efca4fc75d514818d08f08413f9f15c9">
	</div>
	<div class="grofile-hash-map-f3d0f53751577b1dc62fa00b58a9e63b">
	</div>
	<div class="grofile-hash-map-969c58822a3243c5b51e61eaa4745807">
	</div>
	<div class="grofile-hash-map-5db6430547954bbfaa2b80d85ecd3a5e">
	</div>
	<div class="grofile-hash-map-b5e968dfef95d370632be97cd9d74b4a">
	</div>
	<div class="grofile-hash-map-bf9ecde8f5e286de6ce5c80206cf9dd6">
	</div>
	<div class="grofile-hash-map-02750b4cc6dd3cf5450573623a020105">
	</div>
	</div>

	<script type="text/javascript">
		window.WPCOM_sharing_counts = {"http:\/\/sametmax.com\/super-article-invite-sur-trio-que-lauteur-a-oublie-de-titrer\/":24605};
	</script>
			<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
			<div id="fb-root"></div>
			<script>(function(d, s, id) { var js, fjs = d.getElementsByTagName(s)[0]; if (d.getElementById(id)) return; js = d.createElement(s); js.id = id; js.src = 'https://connect.facebook.net/en_US/sdk.js#xfbml=1&appId=249643311490&version=v2.3'; fjs.parentNode.insertBefore(js, fjs); }(document, 'script', 'facebook-jssdk'));</script>
			<script>
			jQuery( document.body ).on( 'post-load', function() {
				if ( 'undefined' !== typeof FB ) {
					FB.XFBML.parse();
				}
			} );
			</script>
						<script>
			function renderGooglePlus1() {
				if ( 'undefined' === typeof gapi ) {
					return;
				}

				jQuery( '.g-plus' ).each(function() {
					var $button = jQuery( this );

					if ( ! $button.data( 'gplus-rendered' ) ) {
						gapi.plusone.render( this, {
							href: $button.attr( 'data-href' ),
							size: $button.attr( 'data-size' ),
							annotation: $button.attr( 'data-annotation' )
						});

						$button.data( 'gplus-rendered', true );
					}
				});
			}

			(function() {
				var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
				po.src = 'https://apis.google.com/js/platform.js';
				po.innerHTML = '{"parsetags": "explicit"}';
				po.onload = renderGooglePlus1;
				var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
			})();

			jQuery( document.body ).on( 'post-load', renderGooglePlus1 );
			</script>
				<div id="sharing_email" style="display: none;">
		<form action="index.html" method="post">
			<label for="target_email">Send to Email Address</label>
			<input type="email" name="target_email" id="target_email" value="" />

			
				<label for="source_name">Your Name</label>
				<input type="text" name="source_name" id="source_name" value="" />

				<label for="source_email">Your Email Address</label>
				<input type="email" name="source_email" id="source_email" value="" />

						<input type="text" id="jetpack-source_f_name" name="source_f_name" class="input" value="" size="25" autocomplete="off" title="This field is for validation and should not be changed" />
			
			<img style="float: right; display: none" class="loading" src="../wp-content/plugins/jetpack/modules/sharedaddy/images/loading.gif" alt="loading" width="16" height="16" />
			<input type="submit" value="Send Email" class="sharing_send" />
			<a rel="nofollow" href="index.html#cancel" class="sharing_cancel">Cancel</a>

			<div class="errors errors-1" style="display: none;">
				Post was not sent - check your email addresses!			</div>

			<div class="errors errors-2" style="display: none;">
				Email check failed, please try again			</div>

			<div class="errors errors-3" style="display: none;">
				Sorry, your blog cannot share posts by email.			</div>
		</form>
	</div>
					<script type="text/javascript">
				// Pinterest shared resources
				var s = document.createElement("script");
				s.type = "text/javascript";
				s.async = true;
				s.setAttribute('data-pin-hover', true);				s.src = window.location.protocol + "//assets.pinterest.com/js/pinit.js";
				var x = document.getElementsByTagName("script")[0];
				x.parentNode.insertBefore(s, x);
				// if 'Pin it' button has 'counts' make container wider
				jQuery(window).load( function(){ jQuery( 'li.share-pinterest a span:visible' ).closest( '.share-pinterest' ).width( '80px' ); } );
			</script>
		<script type="text/javascript" src="https://platform.tumblr.com/v1/share.js"></script>		<script>
		// Don't use Pocket's default JS as it we need to force init new Pocket share buttons loaded via JS.
		function jetpack_sharing_pocket_init() {
			jQuery.getScript( 'https://widgets.getpocket.com/v1/j/btn.js?v=1' );
		}
		jQuery( document ).ready( jetpack_sharing_pocket_init );
		jQuery( document.body ).on( 'post-load', jetpack_sharing_pocket_init );
		</script>
		<script type='text/javascript'>
/* <![CDATA[ */
var wpcf7 = {"apiSettings":{"root":"http:\/\/sametmax.com\/wp-json\/contact-form-7\/v1","namespace":"contact-form-7\/v1"},"recaptcha":{"messages":{"empty":"Please verify that you are not a robot."}}};
/* ]]> */
</script>
<script type='text/javascript' src='../wp-content/plugins/contact-form-7/includes/js/scripts.js%3Fver=5.0.2'></script>
<script type='text/javascript' src='https://s0.wp.com/wp-content/js/devicepx-jetpack.js?ver=201936'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var pollsL10n = {"ajax_url":"http:\/\/sametmax.com\/wp-admin\/admin-ajax.php","text_wait":"Your last request is still being processed. Please wait a while ...","text_valid":"Please choose a valid poll answer.","text_multiple":"Maximum number of choices allowed: ","show_loading":"1","show_fading":"1"};
/* ]]> */
</script>
<script type='text/javascript' src='../wp-content/plugins/wp-polls/polls-js.js%3Fver=2.73.8'></script>
<script type='text/javascript' src='../wp-content/plugins/wp-syntax/js/wp-syntax.js%3Fver=1.1'></script>
<script type='text/javascript' src='https://secure.gravatar.com/js/gprofiles.js?ver=2019Sepaa'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var WPGroHo = {"my_hash":""};
/* ]]> */
</script>
<script type='text/javascript' src='../wp-content/plugins/jetpack/modules/wpgroho.js%3Fver=4.9.7'></script>
<script type='text/javascript' src='../wp-includes/js/comment-reply.min.js%3Fver=4.9.7'></script>
<script type='text/javascript' src='../wp-includes/js/jquery/ui/core.min.js%3Fver=1.11.4'></script>
<script type='text/javascript' src='../wp-content/themes/customizr/inc/assets/js/modernizr.min.js%3Fver=3.2.10'></script>
<script type='text/javascript' src='../wp-content/themes/customizr/inc/assets/js/retina.min.js%3Fver=3.2.10'></script>
<script type='text/javascript' src='../wp-includes/js/wp-embed.min.js%3Fver=4.9.7'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var sharing_js_options = {"lang":"en","counts":"1"};
/* ]]> */
</script>
<script type='text/javascript' src='../wp-content/plugins/jetpack/_inc/build/sharedaddy/sharing.min.js%3Fver=6.3.2'></script>
<script type='text/javascript'>
var windowOpen;
			jQuery( document.body ).on( 'click', 'a.share-facebook', function() {
				// If there's another sharing window open, close it.
				if ( 'undefined' !== typeof windowOpen ) {
					windowOpen.close();
				}
				windowOpen = window.open( jQuery( this ).attr( 'href' ), 'wpcomfacebook', 'menubar=1,resizable=1,width=600,height=400' );
				return false;
			});
</script>
<script type='text/javascript' src='https://stats.wp.com/e-201936.js' async='async' defer='defer'></script>
<script type='text/javascript'>
	_stq = window._stq || [];
	_stq.push([ 'view', {v:'ext',j:'1:6.3.2',blog:'32490438',post:'24605',tz:'0',srv:'sametmax.com'} ]);
	_stq.push([ 'clickTrackerInit', '32490438', '24605' ]);
</script>
<div class="tc-btt-wrapper"><i class="btt-arrow" style="color:#394143"></i></div>	</body>
	</html>