<!DOCTYPE html>
<!--[if IE 7]>
<html class="ie ie7" lang="en-US">
<![endif]-->
<!--[if IE 8]>
<html class="ie ie8" lang="en-US">
<![endif]-->
<!--[if !(IE 7) | !(IE 8)  ]><!-->
<html lang="en-US">                          
<!--<![endif]-->
					<head>
				    <meta charset="UTF-8" />
				    <meta http-equiv="X-UA-Compatible" content="IE=9; IE=8; IE=7; IE=EDGE" />
            				    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
				    <link rel="profile" href="http://gmpg.org/xfn/11" />
				    <link rel="pingback" href="http://sametmax.com/xmlrpc.php" />

				   <!-- Icons font support for IE6-7  -->
				    <!--[if lt IE 8]>
				      <script src="http://sametmax.com/wp-content/themes/customizr/inc/assets/css/fonts/lte-ie7.js"></script>
				    <![endif]-->
				    <style type="text/css" id="customizr-inline-fonts">@font-face{font-family:genericons;src:url('../wp-content/themes/customizr/inc/assets/css/fonts/fonts/genericons-regular-webfont.eot');src:url('../wp-content/themes/customizr/inc/assets/css/fonts/fonts/genericons-regular-webfont.eot%3F') format('embedded-opentype'),url('../wp-content/themes/customizr/inc/assets/css/fonts/fonts/genericons-regular-webfont.woff') format('woff'),url('../wp-content/themes/customizr/inc/assets/css/fonts/fonts/genericons-regular-webfont.ttf') format('truetype'),url('../wp-content/themes/customizr/inc/assets/css/fonts/fonts/genericons-regular-webfont.svg') format('svg')}@font-face{font-family:entypo;src:url('http://sametmax.com/wp-content/themes/customizr/inc/assets/css/fonts/fonts/entypo.eot);src:url(http://sametmax.com/wp-content/themes/customizr/inc/assets/css/fonts/fonts/entypo.eot?#iefix') format('embedded-opentype'),url('../wp-content/themes/customizr/inc/assets/css/fonts/fonts/entypo.woff') format('woff'),url('../wp-content/themes/customizr/inc/assets/css/fonts/fonts/entypo.ttf') format('truetype'),url('../wp-content/themes/customizr/inc/assets/css/fonts/fonts/entypo.svg') format('svg')}</style><title>Un petit dashboard de monitoring avec Django et WAMP &#8211; Sam &amp; Max</title>
<link rel='dns-prefetch' href='http://s0.wp.com/' />
<link rel='dns-prefetch' href='http://secure.gravatar.com/' />
<link rel='dns-prefetch' href='http://s.w.org/' />
<link rel="alternate" type="application/rss+xml" title="Sam &amp; Max &raquo; Feed" href="../feed.1" />
<link rel="alternate" type="application/rss+xml" title="Sam &amp; Max &raquo; Comments Feed" href="../comments/feed/index.html" />
<link rel="alternate" type="application/rss+xml" title="Sam &amp; Max &raquo; Un petit dashboard de monitoring avec Django et WAMP Comments Feed" href="feed/index.html" />
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2.4\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2.4\/svg\/","svgExt":".svg","source":{"concatemoji":"http:\/\/sametmax.com\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.9.7"}};
			!function(a,b,c){function d(a,b){var c=String.fromCharCode;l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,a),0,0);var d=k.toDataURL();l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,b),0,0);var e=k.toDataURL();return d===e}function e(a){var b;if(!l||!l.fillText)return!1;switch(l.textBaseline="top",l.font="600 32px Arial",a){case"flag":return!(b=d([55356,56826,55356,56819],[55356,56826,8203,55356,56819]))&&(b=d([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]),!b);case"emoji":return b=d([55357,56692,8205,9792,65039],[55357,56692,8203,9792,65039]),!b}return!1}function f(a){var c=b.createElement("script");c.src=a,c.defer=c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var g,h,i,j,k=b.createElement("canvas"),l=k.getContext&&k.getContext("2d");for(j=Array("flag","emoji"),c.supports={everything:!0,everythingExceptFlag:!0},i=0;i<j.length;i++)c.supports[j[i]]=e(j[i]),c.supports.everything=c.supports.everything&&c.supports[j[i]],"flag"!==j[i]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[j[i]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(h=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",h,!1),a.addEventListener("load",h,!1)):(a.attachEvent("onload",h),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),g=c.source||{},g.concatemoji?f(g.concatemoji):g.wpemoji&&g.twemoji&&(f(g.twemoji),f(g.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<link rel='stylesheet' id='contact-form-7-css'  href='../wp-content/plugins/contact-form-7/includes/css/styles.css%3Fver=5.0.2.css' type='text/css' media='all' />
<link rel='stylesheet' id='wp-polls-css'  href='../wp-content/plugins/wp-polls/polls-css.css%3Fver=2.73.8.css' type='text/css' media='all' />
<style id='wp-polls-inline-css' type='text/css'>
.wp-polls .pollbar {
	margin: 1px;
	font-size: 6px;
	line-height: 8px;
	height: 8px;
	background-image: url('../wp-content/plugins/wp-polls/images/default/pollbg.gif');
	border: 1px solid #c8c8c8;
}

</style>
<link rel='stylesheet' id='wp-syntax-css-css'  href='../wp-content/plugins/wp-syntax/css/wp-syntax.css%3Fver=1.1.css' type='text/css' media='all' />
<link rel='stylesheet' id='dashicons-css'  href='../wp-includes/css/dashicons.min.css%3Fver=4.9.7.css' type='text/css' media='all' />
<link rel='stylesheet' id='customizr-skin-css'  href='../wp-content/themes/customizr/inc/assets/css/black2.min.css%3Fver=3.2.10.css' type='text/css' media='all' />
<style id='customizr-skin-inline-css' type='text/css'>

.sticky-enabled .tc-shrink-on .site-logo img {
						height:30px!important;width:auto!important
					}

					.sticky-enabled .tc-shrink-on .brand .site-title {
						font-size:0.6em;opacity:0.8;line-height:1.2em
					}

.tc-rectangular-thumb {
            max-height: 250px;
            height :250px
          }

          .single .tc-rectangular-thumb {
            max-height: 250px;
            height :250px
          }


</style>
<link rel='stylesheet' id='customizr-style-css'  href='../wp-content/themes/customizr/style.css%3Fver=3.2.10.css' type='text/css' media='all' />
<link rel='stylesheet' id='fancyboxcss-css'  href='../wp-content/themes/customizr/inc/assets/js/fancybox/jquery.fancybox-1.3.4.min.css%3Fver=4.9.7.css' type='text/css' media='all' />
<link rel='stylesheet' id='jetpack-widget-social-icons-styles-css'  href='../wp-content/plugins/jetpack/modules/widgets/social-icons/social-icons.css%3Fver=20170506.css' type='text/css' media='all' />
<link rel='stylesheet' id='social-logos-css'  href='../wp-content/plugins/jetpack/_inc/social-logos/social-logos.min.css%3Fver=1.css' type='text/css' media='all' />
<link rel='stylesheet' id='jetpack_css-css'  href='../wp-content/plugins/jetpack/css/jetpack.css%3Fver=6.3.2.css' type='text/css' media='all' />
<script type='text/javascript' src='../wp-includes/js/jquery/jquery.js%3Fver=1.12.4'></script>
<script type='text/javascript' src='../wp-includes/js/jquery/jquery-migrate.min.js%3Fver=1.4.1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var TCParams = {"FancyBoxState":"1","FancyBoxAutoscale":"1","SliderName":"","SliderDelay":"","SliderHover":"1","SmoothScroll":"linear","ReorderBlocks":"1","CenterSlides":"1","HasComments":"","LeftSidebarClass":".span3.left.tc-sidebar","RightSidebarClass":".span3.right.tc-sidebar","LoadModernizr":"1","stickyCustomOffset":"0","stickyHeader":"1","dropdowntoViewport":"0","timerOnScrollAllBrowsers":"1"};
/* ]]> */
</script>
<script type='text/javascript' src='../wp-content/themes/customizr/inc/assets/js/tc-scripts.min.js%3Fver=3.2.10'></script>
<link rel='https://api.w.org/' href='../wp-json/index.html' />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://sametmax.com/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="../wp-includes/wlwmanifest.xml" /> 
<link rel='prev' title='Recentrer les efforts dans l&#8217;open source' href='http://sametmax.com/recentrer-les-efforts-dans-lopen-source/' />
<link rel='next' title='Et Ã§a repart' href='http://sametmax.com/et-ca-repart/' />
<meta name="generator" content="WordPress 4.9.7" />
<link rel="canonical" href="index.html" />
<link rel='shortlink' href='https://wp.me/p2ckfk-480' />
<link rel="alternate" type="application/json+oembed" href="../wp-json/oembed/1.0/embed%3Furl=http:%252F%252Fsametmax.com%252Fun-petit-dashboard-de-monitoring-avec-django-et-wamp%252F" />
<link rel="alternate" type="text/xml+oembed" href="../wp-json/oembed/1.0/embed%3Furl=http:%252F%252Fsametmax.com%252Fun-petit-dashboard-de-monitoring-avec-django-et-wamp%252F&amp;format=xml" />

<link rel='dns-prefetch' href='http://v0.wordpress.com/'/>
<style type="text/css" media="all">
/* <![CDATA[ */
@import url("../wp-content/plugins/wp-table-reloaded/css/plugin.css%3Fver=1.9.4.css");
@import url("../wp-content/plugins/wp-table-reloaded/css/datatables.css%3Fver=1.9.4.css");
/* ]]> */
</style><link rel="shortcut icon" href="../wp-content/uploads/2015/06/favicon.png" type="image/png">
<!-- Jetpack Open Graph Tags -->
<meta property="og:type" content="article" />
<meta property="og:title" content="Un petit dashboard de monitoring avec Django et WAMP" />
<meta property="og:url" content="http://sametmax.com/un-petit-dashboard-de-monitoring-avec-django-et-wamp/" />
<meta property="og:description" content="Crossbar.io vient avec un service &#8220;HTTP Pusher&#8221; qui permet d&#8217;envoyer une requÃªte POST qui va se transformer en vÃ©ritable publish WAMP.

Histoire d&#8217;illustrer tout Ã§a, je vaâ¦" />
<meta property="article:published_time" content="2015-02-07T10:58:43+00:00" />
<meta property="article:modified_time" content="2015-02-08T23:03:17+00:00" />
<meta property="og:site_name" content="Sam &amp; Max" />
<meta property="og:image" content="http://sametmax.com/wp-content/uploads/2015/02/eded53891380c2bb5fd43858688b0554.jpg" />
<meta property="og:image:width" content="796" />
<meta property="og:image:height" content="505" />
<meta property="og:locale" content="en_US" />
<meta name="twitter:text:title" content="Un petit dashboard de monitoring avec Django et WAMP" />
<meta name="twitter:image" content="http://sametmax.com/wp-content/uploads/2015/02/eded53891380c2bb5fd43858688b0554.jpg?w=640" />
<meta name="twitter:card" content="summary_large_image" />

<!-- End Jetpack Open Graph Tags -->
			<link rel="stylesheet" type="text/css" id="wp-custom-css" href="../index.html%3Fcustom-css=3b3670f11a.css" />
						    <!--Icons size hack for IE8 and less -->
				    <!--[if lt IE 9]>
				      <link href="http://sametmax.com/wp-content/themes/customizr/inc/assets/css/fonts/ie8-hacks.css" rel="stylesheet" type="text/css"/>
				    <![endif]-->
				</head>
				
	<body class="post-template-default single single-post postid-15872 single-format-standard tc-fade-hover-links tc-sticky-header tc-transparent-on-scroll" itemscope itemtype="http://schema.org/WebPage">
		
		
	   	<header class="tc-header clearfix row-fluid tc-tagline-off tc-title-logo-on  tc-shrink-on tc-menu-on logo-left" role="banner">
			      <div class="brand span3 pull-left ">

        <h1><a class="site-title" href="../index.html" title="Sam &amp; Max | Du code, du cul">Sam &amp; Max</a></h1>
      </div> <!-- brand span3 pull-left -->
      <div class="container outside"><h2 class="site-description">Du code, du cul</h2></div>      	<div class="navbar-wrapper clearfix span9 tc-submenu-fade tc-submenu-move tc-open-on-hover left">
        	<div class="navbar resp">
          		<div class="navbar-inner" role="navigation">
            		<div class="row-fluid">
              		<div class="social-block span5" ><a class="social-icon icon-feed" href="../feed/rss/index.html" title="Subscribe to my rss feed"  ></a></div><h2 class="span7 inside site-description">Du code, du cul</h2><button type="button" class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse"><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><div class="nav-collapse collapse tc-hover-menu-wrapper"><div class="menu-top-menu-container"><ul id="menu-top-menu-2" class="nav tc-hover-menu"><li class="menu-item menu-item-type-taxonomy menu-item-object-category current-post-ancestor current-menu-parent current-post-parent menu-item-1702"><a href="../category/programmation/index.html">Prog</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-1703"><a href="../category/administration-system/index.html">Admin Sys</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-1704"><a href="../category/philo-et-culture/index.html">Philo &#038; culture</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-1706"><a href="../category/cul/index.html">Cul</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-3340"><a href="../cours-et-tutos/index.html">Cours &#038; tutos</a></li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-1707"><a title="Les meilleurs blogs du Web" href="http://multiboards.net/">Multiboards</a></li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-12415"><a href="../planet-python-fr/index.html">Veille Python Fr</a></li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-15634"><a href="http://indexerror.net">Questions Python</a></li>
</ul></div></div>          			</div>
          		</div><!-- /.navbar-inner -->
        	</div><!-- /.navbar resp -->
      	</div><!-- /.navbar-wrapper -->
    			</header>
		<div id="tc-reset-margin-top" class="container-fluid" style="margin-top:103px"></div><div id="main-wrapper" class="container">

        
    <div class="container" role="main">
        <div class="row column-content-wrapper">

                            
                <div id="content" class="span9 article-container">
                    
                    
                        
                                                                                    
                                                                    <article id="post-15872" class="row-fluid post-15872 post type-post status-publish format-standard has-post-thumbnail hentry category-programmation tag-autobahn tag-crossbar-io tag-django tag-python tag-wamp">
                                                <header class="entry-header">
          <h1 class="entry-title format-icon">Un petit dashboard de monitoring avec Django et WAMP</h1>            <div class="entry-meta">
                This entry was posted in <a class="btn btn-mini" href="../category/programmation/index.html" title="View all posts in Programmation"> Programmation </a> and tagged <a class="btn btn-mini btn-tag" href="../tag/autobahn/index.html" title="View all posts in autobahn"> autobahn </a><a class="btn btn-mini btn-tag" href="../tag/crossbar-io/index.html" title="View all posts in crossbar.io"> crossbar.io </a><a class="btn btn-mini btn-tag" href="../tag/django/index.html" title="View all posts in django"> django </a><a class="btn btn-mini btn-tag" href="../tag/python/index.html" title="View all posts in python"> python </a><a class="btn btn-mini btn-tag" href="../tag/wamp/index.html" title="View all posts in wamp"> wamp </a> on <a href="../2015/02/07/index.html" title="10:58" rel="bookmark"><time class="entry-date updated" datetime="2015-02-07T10:58:43+00:00">07/02/2015</time></a> <span class="by-author">by <span class="author vcard"><a class="url fn n" href="../author/sam/index.html" title="View all posts by Sam" rel="author">Sam</a></span></span>             </div><!-- .entry-meta -->
            <hr class="featurette-divider __before_content">        </header>
            

          <section class="entry-content ">
              <p><em>Cet article est Ã©crit dans le cadre de ma <a href="../full-disclosure/index.html">collaboration</a> avec Tavendo.</em></p>
<p>On a dÃ©jÃ  vu que <a href="../crossbar-le-futur-des-applications-web-python/index.html">WAMP c&#8217;est cool</a>, mais c&#8217;est asynchrone et nos frameworks Web chÃ©ris WSGI <a href="../wamp-et-les-outils-de-dev-web-python-existants/index.html">sont synchrones</a>.</p>
<p>J&#8217;ai donnÃ© une solution de contournement avec la lib <a href="../les-managers-le-detestent-faites-tourner-wamp-dans-django-avec-cette-astuce-insolite/index.html">crochet</a> qui permet de faire tourner du twisted de maniÃ¨re synchrone dans son projet.</p>
<p>NÃ©anmoins, beaucoup sont, j&#8217;en suis certain, Ã  la recherche d&#8217;un truc plus simple. En effet, le bÃ©nÃ©fice le plus immÃ©diat de WAMP sont les notifications en temps rÃ©el. Et pour Ã§a, crossbar vient avec le <a href="https://github.com/crossbario/crossbar/wiki/HTTP%20Pusher%20Service">HTTP PUSHER service</a> : quelques lignes de JSON dans le fichier de config de crossbar et zou, on peut publier sur un topic WAMP avec une simple requÃªte POST :</p>

<div class="wp_syntax" style="position:relative;"><table><tr><td class="code"><pre class="javascript" style="font-family:monospace;"> <span style="color: #3366CC;">&quot;transports&quot;</span><span style="color: #339933;">:</span> <span style="color: #009900;">&#91;</span>
    <span style="color: #009900;">&#123;</span>
       <span style="color: #3366CC;">&quot;type&quot;</span><span style="color: #339933;">:</span> <span style="color: #3366CC;">&quot;web&quot;</span><span style="color: #339933;">,</span>
       <span style="color: #3366CC;">&quot;endpoint&quot;</span><span style="color: #339933;">:</span> <span style="color: #009900;">&#123;</span>
          <span style="color: #3366CC;">&quot;type&quot;</span><span style="color: #339933;">:</span> <span style="color: #3366CC;">&quot;tcp&quot;</span><span style="color: #339933;">,</span>
          <span style="color: #3366CC;">&quot;port&quot;</span><span style="color: #339933;">:</span> <span style="color: #CC0000;">8080</span>
       <span style="color: #009900;">&#125;</span><span style="color: #339933;">,</span>
       <span style="color: #3366CC;">&quot;paths&quot;</span><span style="color: #339933;">:</span> <span style="color: #009900;">&#123;</span>
          ...
          <span style="color: #3366CC;">&quot;notify&quot;</span><span style="color: #339933;">:</span> <span style="color: #009900;">&#123;</span>
             <span style="color: #3366CC;">&quot;type&quot;</span><span style="color: #339933;">:</span> <span style="color: #3366CC;">&quot;pusher&quot;</span><span style="color: #339933;">,</span>
             <span style="color: #3366CC;">&quot;realm&quot;</span><span style="color: #339933;">:</span> <span style="color: #3366CC;">&quot;realm1&quot;</span><span style="color: #339933;">,</span>
             <span style="color: #3366CC;">&quot;role&quot;</span><span style="color: #339933;">:</span> <span style="color: #3366CC;">&quot;anonymous&quot;</span>
          <span style="color: #009900;">&#125;</span>
       <span style="color: #009900;">&#125;</span>
    <span style="color: #009900;">&#125;</span>
 <span style="color: #009900;">&#93;</span></pre></td></tr></table><p class="theCode" style="display:none;"> &quot;transports&quot;: [
    {
       &quot;type&quot;: &quot;web&quot;,
       &quot;endpoint&quot;: {
          &quot;type&quot;: &quot;tcp&quot;,
          &quot;port&quot;: 8080
       },
       &quot;paths&quot;: {
          ...
          &quot;notify&quot;: {
             &quot;type&quot;: &quot;pusher&quot;,
             &quot;realm&quot;: &quot;realm1&quot;,
             &quot;role&quot;: &quot;anonymous&quot;
          }
       }
    }
 ]</p></div>

<p>Et derriÃ¨re, pour publier un event sur le sujet &#8220;super_sujet&#8221;, on peut faire :</p>

<div class="wp_syntax" style="position:relative;"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">import</span> requets
requests.<span style="color: black;">post</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">&quot;http://ip_du_router/pusher&quot;</span><span style="color: #66cc66;">,</span>
                  json<span style="color: #66cc66;">=</span><span style="color: black;">&#123;</span>
                      <span style="color: #483d8b;">'topic'</span>: <span style="color: #483d8b;">'super_sujet'</span>
                      <span style="color: #483d8b;">'args'</span>: <span style="color: black;">&#91;</span>queques<span style="color: #66cc66;">,</span> params<span style="color: #66cc66;">,</span> a<span style="color: #66cc66;">,</span> passer<span style="color: #66cc66;">,</span> si<span style="color: #66cc66;">,</span> on veut<span style="color: black;">&#93;</span>
                  <span style="color: black;">&#125;</span><span style="color: black;">&#41;</span></pre></td></tr></table><p class="theCode" style="display:none;">import requets
requests.post(&quot;http://ip_du_router/pusher&quot;,
                  json={
                      'topic': 'super_sujet'
                      'args': [queques, params, a, passer, si, on veut]
                  })</p></div>

<p>Ceci va envoyer une requÃªte POST Ã  un service de crossbar qui va transformer Ã§a en vÃ©ritable publish WAMP.</p>
<p>Histoire d&#8217;illustrer tout Ã§a, je vais vous montrer comment construire un petit service de monitoring avec Crossbar.io et Django. Pour suivre le tuto vous aurez besoin :</p>
<ul>
<li>De connaissances de base en JS.</li>
<li>De connaÃ®tre le principe de WAMP.</li>
<li>De savoir installer des bibliothÃ¨ques Python avec extensions sur votre machine. <a href="https://duckduckgo.com/l/?kh=-1&#038;uddg=http%3A%2F%2Fsametmax.com%2Fvotre-python-aime-les-pip%2F">pip</a> et <a href="../les-environnement-virtuels-python-virtualenv-et-virtualenvwrapper.1.html">virtualenv</a> sont vos amis.</li>
<li>De connaÃ®tre Django. MÃªme si le concept peut s&#8217;appliquer Ã  Flask, Pyramid, ou autre.</li>
</ul>
<p><span class="embed-youtube" style="text-align:center; display: block;"><iframe class='youtube-player' type='text/html' width='1170' height='689' src='http://www.youtube.com/embed/e9Xtl22x5Sg?version=3&#038;rel=1&#038;fs=1&#038;autohide=2&#038;showsearch=0&#038;showinfo=1&#038;iv_load_policy=1&#038;wmode=transparent' allowfullscreen='true' style='border:0;'></iframe></span></p>
<h2>Premiers pas</h2>
<p>Le but du jeu est d&#8217;avoir un petit client WAMP qu&#8217;on lance sur chaque machine qu&#8217;on veut monitorer. Celui-ci va, toutes les x secondes, rÃ©cupÃ©rer l&#8217;usage CPU, RAM et disque et faire un publish WAMP.</p>
<div id="attachment_15876" style="width: 600px" class="wp-caption aligncenter"><a href="../wp-content/uploads/2015/02/architecture.png" class="grouped_elements" rel="tc-fancybox-group15872"><img src="../wp-content/uploads/2015/02/architecture.png" alt="Chaque machine possÃ¨de un client WAMP" width="590" height="654" class="size-full wp-image-15876" /></a><p class="wp-caption-text">Chaque machine possÃ¨de un client WAMP</p></div>
<p>A l&#8217;autre bout, on a un site Django qui a un modÃ¨le pour chaque machine monitorÃ©e, avec des valeurs pour dire si on est intÃ©ressÃ© par le CPU, la RAM ou le disque et la valeur de x.</p>
<p>Une page affiche en temps rÃ©el tous les relevÃ©s pour toutes les machines. Si dans l&#8217;admin de Django on change un modÃ¨le, la page reflÃ¨te ce changement.</p>
<div id="attachment_15877" style="width: 710px" class="wp-caption aligncenter"><a href="../wp-content/uploads/2015/02/dashboard.gif" class="grouped_elements" rel="tc-fancybox-group15872"><img src="../wp-content/uploads/2015/02/dashboard.gif" alt="Si je dÃ©clique &quot;CPU&quot; dans l&#039;admin Django, les CPUs ne sont plus affichÃ©s" width="700" height="650" class="size-full wp-image-15877" /></a><p class="wp-caption-text">Si je dÃ©clique &#8220;CPU&#8221; dans l&#8217;admin Django, les CPUs ne sont plus affichÃ©s</p></div>
<p> On aura donc besoin de django (<code>pip install Django</code>, Ã§a c&#8217;est pas trop dur), requests (<code>pip install requests</code>, jusqu&#8217;ici tout va bien), et <a href="http://sametmax.com/un-petit-dashboard-de-monitoring-avec-django-et-wamp/pythonhosted.org/psutil/">psutil</a>.</p>
<p>psutil est la lib Python qui va nous permettre de rÃ©cupÃ©rer toutes le valeurs pour la RAM, le disque et le CPU. Elle utilise des extensions en C, il faut donc un compilateur et les headers Python. Sous Ubuntu, il faut donc faire :</p>

<div class="wp_syntax" style="position:relative;"><table><tr><td class="code"><pre class="bash" style="font-family:monospace;"><span style="color: #c20cb9; font-weight: bold;">sudo</span> <span style="color: #c20cb9; font-weight: bold;">apt-get install</span> <span style="color: #c20cb9; font-weight: bold;">gcc</span> python-dev</pre></td></tr></table><p class="theCode" style="display:none;">sudo apt-get install gcc python-dev</p></div>

<p>Sous CentOS Ã§a donne :</p>

<div class="wp_syntax" style="position:relative;"><table><tr><td class="code"><pre class="bash" style="font-family:monospace;"><span style="color: #c20cb9; font-weight: bold;">yum groupinstall</span> <span style="color: #ff0000;">&quot;Development tools&quot;</span>
<span style="color: #c20cb9; font-weight: bold;">yum install</span> python-devel</pre></td></tr></table><p class="theCode" style="display:none;">yum groupinstall &quot;Development tools&quot;
yum install python-devel</p></div>

<p>Sous Mac, les headers Python devraient Ãªtre inclus, mais il vous faut aussi GCC. Si vous avez xcode, vous avez dÃ©jÃ  un compilateur, sinon, il existe un installeur <a href="https://github.com/kennethreitz/osx-gcc-installer#readme">plus lÃ©ger</a>.</p>
<p>Sous windows, c&#8217;est un wheel donc rien Ã  faire normalement.</p>
<p>Et reste plus qu&#8217;Ã  <code>pip install psutil</code>.</p>
<p>Enfin il nous faudra, logique, <a href="http://crossbar.io/docs/Local-Installation/">installer crossbar</a>. <code>pip install crossbar</code>, sachant que <a href="http://crossbar.io/docs/Installation-on-Windows/">sous Windows</a> vous aurez besoin de <a href="http://sourceforge.net/projects/pywin32/files/pywin32/Build%20219/">PyWin32</a> et comme toujours, d&#8217;avoir les dossiers <code>C:\Python27\</code> and <code>C:\Python27\Scripts</code> dans votre <a href="../ajouter-un-chemin-a-la-variable-denvironnement-path-sous-windows/index.html">PATH</a>.</p>
<h2>Le HTML</h2>
<p>On a besoin que d&#8217;une page. Afin de rendre le tuto agnostique, je l&#8217;ai fait en pur JS, pas de jQuery, pas d&#8217;Angular. Donc c&#8217;est verbeux :)</p>

<div class="wp_syntax" style="position:relative;"><table><tr><td class="code"><pre class="html" style="font-family:monospace;">&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;meta charset=&quot;utf-8&quot; /&gt;
&nbsp;
    &lt;!-- De quoi cacher un bloc facilement --&gt;
    &lt;style type=&quot;text/css&quot;&gt;
        .hide {display:none;}
    &lt;/style&gt;
&nbsp;
    &lt;!--
        La lib JS qui permet de parler WAMP .
&nbsp;
        Ici je suppose qu'on utilise un navigateur qui support websocket.
        Il est possible de faire du fallback sur flash ou long poll, mais
        ce sont des dÃ©pendances en plus.
    --&gt;
    &lt;script src=&quot;https://autobahn.s3.amazonaws.com/autobahnjs/latest/autobahn.min.jgz&quot;
           type=&quot;text/javascript&quot;&gt;&lt;/script&gt;
&nbsp;
&nbsp;
    &lt;!-- Tout notre code client, inline pour faciliter votre lecture --&gt;
    &lt;script type=&quot;text/javascript&quot;&gt;
&nbsp;
      /* Connexion Ã  notre serveur WAMP */
      window.addEventListener(&quot;load&quot;, function(){
        var connection = new autobahn.Connection({
           url: 'ws://127.0.0.1:8080/ws',
           realm: 'realm1'
        });
&nbsp;
        /* Quand la connexion est ouverte, exÃ©cuter ce code */
        connection.onopen = function(session) {
&nbsp;
          var clients = document.getElementById(&quot;clients&quot;);
&nbsp;
          /* Quand on reÃ§oit l'Ã©vÃ©nement clientstats, lancer cette fonction */
          session.subscribe('clientstats', function(args){
            var stats = args[0];
            var serverNode = document.getElementById(stats.ip);
&nbsp;
            /*
                 CrÃ©er un li contenant un h2 et un dl pour ce client si
                 il n'est pas encore dans la page.
            */
            if (!serverNode){
                serverNode = document.createElement(&quot;li&quot;);
                serverNode.id = stats.ip;
                serverNode.appendChild(document.createElement(&quot;h2&quot;));
                serverNode.appendChild(document.createElement(&quot;dl&quot;));
                serverNode.firstChild.innerHTML = stats.name + &quot; (&quot; + stats.ip + &quot;)&quot;;
                clients.appendChild(serverNode);
&nbsp;
                // Cacher les infos du serveur si il est dÃ©sactivÃ©.
                session.subscribe('clientconfig.' + stats.ip, function(args){
                    var config = args[0];
                    if (config.disabled){
                        var serverNode = document.getElementById(config.ip);
                        serverNode.className = &quot;hide&quot;;
                    }
                });
&nbsp;
            }
&nbsp;
            // Remettre Ã  zÃ©ro le contenu du li du serveur.
            serverNode.className = &quot;&quot;;
            var dl = serverNode.lastChild;
            while (dl.hasChildNodes()) {
                dl.removeChild(dl.lastChild);
            }
&nbsp;
            // Si on a des infos sur le CPU, les afficher
            if (stats.cpus){
                var cpus = document.createElement(&quot;dt&quot;);
                cpus.innerHTML = &quot;CPUs:&quot;;
                dl.appendChild(cpus);
                for (var i = 0; i &lt; stats.cpus.length; i++) {
                    var cpu = document.createElement(&quot;dd&quot;);
                    cpu.innerHTML = stats.cpus[i];
                    dl.appendChild(cpu);
                };
            }
&nbsp;
            // Si on a des infos sur l'espace disque, les afficher
            if (stats.disks){
                var disks = document.createElement(&quot;dt&quot;);
                disks.innerHTML = &quot;Disk usage:&quot;;
                dl.appendChild(disks);
                for (key in stats.disks) {
                    var disk = document.createElement(&quot;dd&quot;);
                    disk.innerHTML = &quot;&lt;strong&gt;&quot; + key + &quot;&lt;/strong&gt;: &quot; + stats.disks[key];
                    dl.appendChild(disk);
                };
            }
&nbsp;
            // Si on a des infos sur l'usage mÃ©moire, les afficher.
            if (stats.memory){
                var memory = document.createElement(&quot;dt&quot;);
                memory.innerHTML = &quot;Memory:&quot;;
                dl.appendChild(memory);
                var memVal = document.createElement(&quot;dd&quot;);
                memVal.innerHTML = stats.memory;
                dl.appendChild(memVal);
            }
&nbsp;
          });
&nbsp;
        };
&nbsp;
        // Ouvrir la connexion avec le routeur WAMP.
        connection.open();
&nbsp;
      });
    &lt;/script&gt;
&nbsp;
    &lt;title&gt; Monitoring&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;h1&gt; Monitoring &lt;/h1&gt;
    &lt;ul id=&quot;clients&quot;&gt;&lt;/ul&gt;
&lt;/body&gt;
&nbsp;
&lt;/html&gt;</pre></td></tr></table><p class="theCode" style="display:none;">&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;meta charset=&quot;utf-8&quot; /&gt;

    &lt;!-- De quoi cacher un bloc facilement --&gt;
    &lt;style type=&quot;text/css&quot;&gt;
        .hide {display:none;}
    &lt;/style&gt;

    &lt;!--
        La lib JS qui permet de parler WAMP .

        Ici je suppose qu'on utilise un navigateur qui support websocket.
        Il est possible de faire du fallback sur flash ou long poll, mais
        ce sont des dÃ©pendances en plus.
    --&gt;
    &lt;script src=&quot;https://autobahn.s3.amazonaws.com/autobahnjs/latest/autobahn.min.jgz&quot;
           type=&quot;text/javascript&quot;&gt;&lt;/script&gt;


    &lt;!-- Tout notre code client, inline pour faciliter votre lecture --&gt;
    &lt;script type=&quot;text/javascript&quot;&gt;

      /* Connexion Ã  notre serveur WAMP */
      window.addEventListener(&quot;load&quot;, function(){
        var connection = new autobahn.Connection({
           url: 'ws://127.0.0.1:8080/ws',
           realm: 'realm1'
        });

        /* Quand la connexion est ouverte, exÃ©cuter ce code */
        connection.onopen = function(session) {

          var clients = document.getElementById(&quot;clients&quot;);

          /* Quand on reÃ§oit l'Ã©vÃ©nement clientstats, lancer cette fonction */
          session.subscribe('clientstats', function(args){
            var stats = args[0];
            var serverNode = document.getElementById(stats.ip);

            /*
                 CrÃ©er un li contenant un h2 et un dl pour ce client si
                 il n'est pas encore dans la page.
            */
            if (!serverNode){
                serverNode = document.createElement(&quot;li&quot;);
                serverNode.id = stats.ip;
                serverNode.appendChild(document.createElement(&quot;h2&quot;));
                serverNode.appendChild(document.createElement(&quot;dl&quot;));
                serverNode.firstChild.innerHTML = stats.name + &quot; (&quot; + stats.ip + &quot;)&quot;;
                clients.appendChild(serverNode);

                // Cacher les infos du serveur si il est dÃ©sactivÃ©.
                session.subscribe('clientconfig.' + stats.ip, function(args){
                    var config = args[0];
                    if (config.disabled){
                        var serverNode = document.getElementById(config.ip);
                        serverNode.className = &quot;hide&quot;;
                    }
                });

            }

            // Remettre Ã  zÃ©ro le contenu du li du serveur.
            serverNode.className = &quot;&quot;;
            var dl = serverNode.lastChild;
            while (dl.hasChildNodes()) {
                dl.removeChild(dl.lastChild);
            }

            // Si on a des infos sur le CPU, les afficher
            if (stats.cpus){
                var cpus = document.createElement(&quot;dt&quot;);
                cpus.innerHTML = &quot;CPUs:&quot;;
                dl.appendChild(cpus);
                for (var i = 0; i &lt; stats.cpus.length; i++) {
                    var cpu = document.createElement(&quot;dd&quot;);
                    cpu.innerHTML = stats.cpus[i];
                    dl.appendChild(cpu);
                };
            }

            // Si on a des infos sur l'espace disque, les afficher
            if (stats.disks){
                var disks = document.createElement(&quot;dt&quot;);
                disks.innerHTML = &quot;Disk usage:&quot;;
                dl.appendChild(disks);
                for (key in stats.disks) {
                    var disk = document.createElement(&quot;dd&quot;);
                    disk.innerHTML = &quot;&lt;strong&gt;&quot; + key + &quot;&lt;/strong&gt;: &quot; + stats.disks[key];
                    dl.appendChild(disk);
                };
            }

            // Si on a des infos sur l'usage mÃ©moire, les afficher.
            if (stats.memory){
                var memory = document.createElement(&quot;dt&quot;);
                memory.innerHTML = &quot;Memory:&quot;;
                dl.appendChild(memory);
                var memVal = document.createElement(&quot;dd&quot;);
                memVal.innerHTML = stats.memory;
                dl.appendChild(memVal);
            }

          });

        };

        // Ouvrir la connexion avec le routeur WAMP.
        connection.open();

      });
    &lt;/script&gt;

    &lt;title&gt; Monitoring&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;h1&gt; Monitoring &lt;/h1&gt;
    &lt;ul id=&quot;clients&quot;&gt;&lt;/ul&gt;
&lt;/body&gt;

&lt;/html&gt;</p></div>

<p>Comme vous pouvez le voir, c&#8217;est beaucoup de JS ordinaire et du DOM. Les seules parties spÃ©cifiques Ã  WAMP sont :</p>

<div class="wp_syntax" style="position:relative;"><table><tr><td class="code"><pre class="javascript" style="font-family:monospace;"><span style="color: #000066; font-weight: bold;">var</span> connection <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">new</span> autobahn.<span style="color: #660066;">Connection</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#123;</span>
           url<span style="color: #339933;">:</span> <span style="color: #3366CC;">'ws://127.0.0.1:8080/ws'</span><span style="color: #339933;">,</span>
           realm<span style="color: #339933;">:</span> <span style="color: #3366CC;">'realm1'</span>
        <span style="color: #009900;">&#125;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
connection.<span style="color: #660066;">onopen</span> <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span>session<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
...
<span style="color: #009900;">&#125;</span>
connection.<span style="color: #660066;">open</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></td></tr></table><p class="theCode" style="display:none;">var connection = new autobahn.Connection({
           url: 'ws://127.0.0.1:8080/ws',
           realm: 'realm1'
        });
connection.onopen = function(session) {
...
}
connection.open();</p></div>

<p>Pour se connecter au serveur.</p>
<p>Et :</p>

<div class="wp_syntax" style="position:relative;"><table><tr><td class="code"><pre class="javascript" style="font-family:monospace;">session.<span style="color: #660066;">subscribe</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">'nom_du_sujet'</span><span style="color: #339933;">,</span> <span style="color: #000066; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span>args<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
...
<span style="color: #009900;">&#125;</span></pre></td></tr></table><p class="theCode" style="display:none;">session.subscribe('nom_du_sujet', function(args){
...
}</p></div>

<p>Pour rÃ©agir Ã  la publication d&#8217;un sujet WAMP.</p>
<h2>Le client de monitoring</h2>
<p>C&#8217;est la partie qui va aller sur chaque machine qu&#8217;on veut surveiller.</p>

<div class="wp_syntax" style="position:relative;"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #808080; font-style: italic;"># -*- coding: utf-8 -*-</span>
&nbsp;
<span style="color: #ff7700;font-weight:bold;">from</span> <span style="color: #dc143c;">__future__</span> <span style="color: #ff7700;font-weight:bold;">import</span> division
&nbsp;
<span style="color: #ff7700;font-weight:bold;">import</span> <span style="color: #dc143c;">socket</span>
&nbsp;
<span style="color: #ff7700;font-weight:bold;">import</span> requests
<span style="color: #ff7700;font-weight:bold;">import</span> psutil
&nbsp;
<span style="color: #ff7700;font-weight:bold;">from</span> autobahn.<span style="color: black;">twisted</span>.<span style="color: black;">wamp</span> <span style="color: #ff7700;font-weight:bold;">import</span> Application
<span style="color: #ff7700;font-weight:bold;">from</span> autobahn.<span style="color: black;">twisted</span>.<span style="color: black;">util</span> <span style="color: #ff7700;font-weight:bold;">import</span> sleep
&nbsp;
<span style="color: #ff7700;font-weight:bold;">from</span> twisted.<span style="color: black;">internet</span>.<span style="color: black;">defer</span> <span style="color: #ff7700;font-weight:bold;">import</span> inlineCallbacks
&nbsp;
<span style="color: #ff7700;font-weight:bold;">def</span> to_gib<span style="color: black;">&#40;</span><span style="color: #dc143c;">bytes</span><span style="color: #66cc66;">,</span> factor<span style="color: #66cc66;">=</span><span style="color: #ff4500;">2</span>**<span style="color: #ff4500;">30</span><span style="color: #66cc66;">,</span> suffix<span style="color: #66cc66;">=</span><span style="color: #483d8b;">&quot;GiB&quot;</span><span style="color: black;">&#41;</span>:
    <span style="color: #483d8b;">&quot;&quot;&quot; Converti un nombre d'octets en gibioctets.
&nbsp;
        Ex : 1073741824 octets = 1073741824/2**30 = 1GiO
    &quot;&quot;&quot;</span>
    <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #483d8b;">&quot;%0.2f%s&quot;</span> % <span style="color: black;">&#40;</span><span style="color: #dc143c;">bytes</span> / factor<span style="color: #66cc66;">,</span> suffix<span style="color: black;">&#41;</span>
&nbsp;
<span style="color: #ff7700;font-weight:bold;">def</span> get_infos<span style="color: black;">&#40;</span>filters<span style="color: #66cc66;">=</span><span style="color: black;">&#123;</span><span style="color: black;">&#125;</span><span style="color: black;">&#41;</span>:
    <span style="color: #483d8b;">&quot;&quot;&quot; Retourne la valeur actuelle de l'usage CPU, mÃ©moire et disque.
&nbsp;
        Ces valeurs sont retournÃ©es sous la forme d'un dictionnaire :
&nbsp;
            {
                'cpus': ['x%', 'y%', etc],
                'memory': &quot;z%&quot;,
                'disk':{
                    '/partition/1': 'x/y (z%)',
                    '/partition/2': 'x/y (z%)',
                    etc
                }
            }
&nbsp;
        Le paramÃ¨tre filter est un dico de la forme :
&nbsp;
            {'cpus': bool, 'memory':bool, 'disk':bool}
&nbsp;
        Il est utilisÃ© pour dÃ©cider d'inclure ou non les rÃ©sultats des mesures
        pour les 3 types de ressource.
&nbsp;
    &quot;&quot;&quot;</span>
&nbsp;
    results <span style="color: #66cc66;">=</span> <span style="color: black;">&#123;</span><span style="color: black;">&#125;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">if</span> <span style="color: black;">&#40;</span>filters.<span style="color: black;">get</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'show_cpus'</span><span style="color: #66cc66;">,</span> <span style="color: #008000;">True</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span>:
        results<span style="color: black;">&#91;</span><span style="color: #483d8b;">'cpus'</span><span style="color: black;">&#93;</span> <span style="color: #66cc66;">=</span> <span style="color: #008000;">tuple</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">&quot;%s%%&quot;</span> % x <span style="color: #ff7700;font-weight:bold;">for</span> x <span style="color: #ff7700;font-weight:bold;">in</span> psutil.<span style="color: black;">cpu_percent</span><span style="color: black;">&#40;</span>percpu<span style="color: #66cc66;">=</span><span style="color: #008000;">True</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">if</span> <span style="color: black;">&#40;</span>filters.<span style="color: black;">get</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'show_memory'</span><span style="color: #66cc66;">,</span> <span style="color: #008000;">True</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span>:
        memory <span style="color: #66cc66;">=</span> psutil.<span style="color: black;">phymem_usage</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
        results<span style="color: black;">&#91;</span><span style="color: #483d8b;">'memory'</span><span style="color: black;">&#93;</span> <span style="color: #66cc66;">=</span> <span style="color: #483d8b;">'{used}/{total} ({percent}%)'</span>.<span style="color: black;">format</span><span style="color: black;">&#40;</span>
            used<span style="color: #66cc66;">=</span>to_gib<span style="color: black;">&#40;</span>memory.<span style="color: black;">active</span><span style="color: black;">&#41;</span><span style="color: #66cc66;">,</span>
            total<span style="color: #66cc66;">=</span>to_gib<span style="color: black;">&#40;</span>memory.<span style="color: black;">total</span><span style="color: black;">&#41;</span><span style="color: #66cc66;">,</span>
            percent<span style="color: #66cc66;">=</span>memory.<span style="color: black;">percent</span>
        <span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">if</span> <span style="color: black;">&#40;</span>filters.<span style="color: black;">get</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'show_disk'</span><span style="color: #66cc66;">,</span> <span style="color: #008000;">True</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span>:
        disks <span style="color: #66cc66;">=</span> <span style="color: black;">&#123;</span><span style="color: black;">&#125;</span>
        <span style="color: #ff7700;font-weight:bold;">for</span> device <span style="color: #ff7700;font-weight:bold;">in</span> psutil.<span style="color: black;">disk_partitions</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>:
            usage <span style="color: #66cc66;">=</span> psutil.<span style="color: black;">disk_usage</span><span style="color: black;">&#40;</span>device.<span style="color: black;">mountpoint</span><span style="color: black;">&#41;</span>
            disks<span style="color: black;">&#91;</span>device.<span style="color: black;">mountpoint</span><span style="color: black;">&#93;</span> <span style="color: #66cc66;">=</span> <span style="color: #483d8b;">'{used}/{total} ({percent}%)'</span>.<span style="color: black;">format</span><span style="color: black;">&#40;</span>
                used<span style="color: #66cc66;">=</span>to_gib<span style="color: black;">&#40;</span>usage.<span style="color: black;">used</span><span style="color: black;">&#41;</span><span style="color: #66cc66;">,</span>
                total<span style="color: #66cc66;">=</span>to_gib<span style="color: black;">&#40;</span>usage.<span style="color: black;">total</span><span style="color: black;">&#41;</span><span style="color: #66cc66;">,</span>
                percent<span style="color: #66cc66;">=</span>usage.<span style="color: black;">percent</span>
            <span style="color: black;">&#41;</span>
        results<span style="color: black;">&#91;</span><span style="color: #483d8b;">'disks'</span><span style="color: black;">&#93;</span> <span style="color: #66cc66;">=</span> disks
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">return</span> results
&nbsp;
<span style="color: #808080; font-style: italic;"># On crÃ©Ã© le client WAMP.</span>
app <span style="color: #66cc66;">=</span> Application<span style="color: black;">&#40;</span><span style="color: #483d8b;">'monitoring'</span><span style="color: black;">&#41;</span>
&nbsp;
<span style="color: #808080; font-style: italic;"># Ceci est l'IP publique de ma machine puisque</span>
<span style="color: #808080; font-style: italic;"># ce client doit pouvoir accÃ©der Ã  mon serveur</span>
<span style="color: #808080; font-style: italic;"># depuis l'extÃ©rieur.</span>
SERVER <span style="color: #66cc66;">=</span> <span style="color: #483d8b;">'172.17.42.1'</span>
&nbsp;
<span style="color: #808080; font-style: italic;"># D'abord on utilise une astuce pour connaÃ®tre l'IP publique de cette</span>
<span style="color: #808080; font-style: italic;"># machine.</span>
s <span style="color: #66cc66;">=</span> <span style="color: #dc143c;">socket</span>.<span style="color: #dc143c;">socket</span><span style="color: black;">&#40;</span><span style="color: #dc143c;">socket</span>.<span style="color: black;">AF_INET</span><span style="color: #66cc66;">,</span> <span style="color: #dc143c;">socket</span>.<span style="color: black;">SOCK_DGRAM</span><span style="color: black;">&#41;</span>
s.<span style="color: black;">connect</span><span style="color: black;">&#40;</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">&quot;8.8.8.8&quot;</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">80</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span>
<span style="color: #808080; font-style: italic;"># On attache un dictionnaire Ã  l'app, ainsi</span>
<span style="color: #808080; font-style: italic;"># sa rÃ©fÃ©rence sera accessible partout.</span>
app._params <span style="color: #66cc66;">=</span> <span style="color: black;">&#123;</span><span style="color: #483d8b;">'name'</span>: <span style="color: #dc143c;">socket</span>.<span style="color: black;">gethostname</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'ip'</span>: s.<span style="color: black;">getsockname</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: black;">&#91;</span><span style="color: #ff4500;">0</span><span style="color: black;">&#93;</span><span style="color: black;">&#125;</span>
s.<span style="color: black;">close</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
&nbsp;
<span style="color: #66cc66;">@</span>app.<span style="color: #dc143c;">signal</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'onjoined'</span><span style="color: black;">&#41;</span>
<span style="color: #66cc66;">@</span>inlineCallbacks
<span style="color: #ff7700;font-weight:bold;">def</span> called_on_joinded<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>:
    <span style="color: #483d8b;">&quot;&quot;&quot; Boucle envoyant l'Ã©tat de cette machine avec WAMP toutes les x secondes.
&nbsp;
        Cette fonction est exÃ©cutÃ©e quand le client &quot;joins&quot; le router, c'est
        Ã  dire qu'il est connectÃ© et authentifiÃ©, prÃªt Ã  envoyer des messages
        WAMP.
    &quot;&quot;&quot;</span>
    <span style="color: #808080; font-style: italic;"># Ensuite on fait une requÃªte post au serveur pour dire qu'on est</span>
    <span style="color: #808080; font-style: italic;"># actif et rÃ©cupÃ©rer les valeurs de configuration de notre client.</span>
    app._params.<span style="color: black;">update</span><span style="color: black;">&#40;</span>requests.<span style="color: black;">post</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'http://'</span> + SERVER + <span style="color: #483d8b;">':8080/clients/'</span><span style="color: #66cc66;">,</span>
                                    data<span style="color: #66cc66;">=</span><span style="color: black;">&#123;</span><span style="color: #483d8b;">'ip'</span>: app._params<span style="color: black;">&#91;</span><span style="color: #483d8b;">'ip'</span><span style="color: black;">&#93;</span><span style="color: black;">&#125;</span><span style="color: black;">&#41;</span>.<span style="color: black;">json</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span>
&nbsp;
&nbsp;
    <span style="color: #808080; font-style: italic;"># Puis on boucle indÃ©finiment</span>
    <span style="color: #ff7700;font-weight:bold;">while</span> <span style="color: #008000;">True</span>:
        <span style="color: #808080; font-style: italic;"># Chaque tour de boucle, on rÃ©cupÃ¨re les infos de notre machine</span>
        infos <span style="color: #66cc66;">=</span> <span style="color: black;">&#123;</span><span style="color: #483d8b;">'ip'</span>: app._params<span style="color: black;">&#91;</span><span style="color: #483d8b;">'ip'</span><span style="color: black;">&#93;</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'name'</span>: app._params<span style="color: black;">&#91;</span><span style="color: #483d8b;">'name'</span><span style="color: black;">&#93;</span><span style="color: black;">&#125;</span>
        infos.<span style="color: black;">update</span><span style="color: black;">&#40;</span>get_infos<span style="color: black;">&#40;</span>app._params<span style="color: black;">&#41;</span><span style="color: black;">&#41;</span>
&nbsp;
        <span style="color: #808080; font-style: italic;"># Si les stats sont a envoyer, on fait une publication WAMP.</span>
        <span style="color: #ff7700;font-weight:bold;">if</span> <span style="color: #ff7700;font-weight:bold;">not</span> app._params<span style="color: black;">&#91;</span><span style="color: #483d8b;">'disabled'</span><span style="color: black;">&#93;</span>:
            app.<span style="color: black;">session</span>.<span style="color: black;">publish</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'clientstats'</span><span style="color: #66cc66;">,</span> infos<span style="color: black;">&#41;</span>
&nbsp;
        <span style="color: #808080; font-style: italic;"># Et on attend. GrÃ¢ce Ã  @inlineCallbacks, utiliser yield indique</span>
        <span style="color: #808080; font-style: italic;"># qu'on ne bloque pas ici, donc pendant ce temps notre client</span>
        <span style="color: #808080; font-style: italic;"># peut Ã©couter les Ã©vÃ©nements WAMP et y rÃ©agir.</span>
        <span style="color: #ff7700;font-weight:bold;">yield</span> sleep<span style="color: black;">&#40;</span>app._params<span style="color: black;">&#91;</span><span style="color: #483d8b;">'frequency'</span><span style="color: black;">&#93;</span><span style="color: black;">&#41;</span>
&nbsp;
&nbsp;
<span style="color: #808080; font-style: italic;"># On dit qu'on est intÃ©ressÃ© par les Ã©vÃ©nements concernant clientconfig</span>
<span style="color: #66cc66;">@</span>app.<span style="color: black;">subscribe</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'clientconfig.'</span> + app._params<span style="color: black;">&#91;</span><span style="color: #483d8b;">'ip'</span><span style="color: black;">&#93;</span><span style="color: black;">&#41;</span>
<span style="color: #ff7700;font-weight:bold;">def</span> update_configuration<span style="color: black;">&#40;</span>args<span style="color: black;">&#41;</span>:
    <span style="color: #483d8b;">&quot;&quot;&quot; Met Ã  jour la configuration du client quand Django nous le demande. &quot;&quot;&quot;</span>
    app._params.<span style="color: black;">update</span><span style="color: black;">&#40;</span>args<span style="color: black;">&#41;</span>
&nbsp;
<span style="color: #808080; font-style: italic;"># On dÃ©marre notre client.</span>
<span style="color: #ff7700;font-weight:bold;">if</span> __name__ <span style="color: #66cc66;">==</span> <span style="color: #483d8b;">'__main__'</span>:
    app.<span style="color: black;">run</span><span style="color: black;">&#40;</span>url<span style="color: #66cc66;">=</span><span style="color: #483d8b;">&quot;ws://%s:8080/ws&quot;</span> % SERVER<span style="color: black;">&#41;</span></pre></td></tr></table><p class="theCode" style="display:none;"># -*- coding: utf-8 -*-

from __future__ import division

import socket

import requests
import psutil

from autobahn.twisted.wamp import Application
from autobahn.twisted.util import sleep

from twisted.internet.defer import inlineCallbacks

def to_gib(bytes, factor=2**30, suffix=&quot;GiB&quot;):
    &quot;&quot;&quot; Converti un nombre d'octets en gibioctets.

        Ex : 1073741824 octets = 1073741824/2**30 = 1GiO
    &quot;&quot;&quot;
    return &quot;%0.2f%s&quot; % (bytes / factor, suffix)

def get_infos(filters={}):
    &quot;&quot;&quot; Retourne la valeur actuelle de l'usage CPU, mÃ©moire et disque.

        Ces valeurs sont retournÃ©es sous la forme d'un dictionnaire :

            {
                'cpus': ['x%', 'y%', etc],
                'memory': &quot;z%&quot;,
                'disk':{
                    '/partition/1': 'x/y (z%)',
                    '/partition/2': 'x/y (z%)',
                    etc
                }
            }

        Le paramÃ¨tre filter est un dico de la forme :

            {'cpus': bool, 'memory':bool, 'disk':bool}

        Il est utilisÃ© pour dÃ©cider d'inclure ou non les rÃ©sultats des mesures
        pour les 3 types de ressource.

    &quot;&quot;&quot;

    results = {}

    if (filters.get('show_cpus', True)):
        results['cpus'] = tuple(&quot;%s%%&quot; % x for x in psutil.cpu_percent(percpu=True))

    if (filters.get('show_memory', True)):
        memory = psutil.phymem_usage()
        results['memory'] = '{used}/{total} ({percent}%)'.format(
            used=to_gib(memory.active),
            total=to_gib(memory.total),
            percent=memory.percent
        )

    if (filters.get('show_disk', True)):
        disks = {}
        for device in psutil.disk_partitions():
            usage = psutil.disk_usage(device.mountpoint)
            disks[device.mountpoint] = '{used}/{total} ({percent}%)'.format(
                used=to_gib(usage.used),
                total=to_gib(usage.total),
                percent=usage.percent
            )
        results['disks'] = disks

    return results

# On crÃ©Ã© le client WAMP.
app = Application('monitoring')

# Ceci est l'IP publique de ma machine puisque
# ce client doit pouvoir accÃ©der Ã  mon serveur
# depuis l'extÃ©rieur.
SERVER = '172.17.42.1'

# D'abord on utilise une astuce pour connaÃ®tre l'IP publique de cette
# machine.
s = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)
s.connect((&quot;8.8.8.8&quot;, 80))
# On attache un dictionnaire Ã  l'app, ainsi
# sa rÃ©fÃ©rence sera accessible partout.
app._params = {'name': socket.gethostname(), 'ip': s.getsockname()[0]}
s.close()

@app.signal('onjoined')
@inlineCallbacks
def called_on_joinded():
    &quot;&quot;&quot; Boucle envoyant l'Ã©tat de cette machine avec WAMP toutes les x secondes.

        Cette fonction est exÃ©cutÃ©e quand le client &quot;joins&quot; le router, c'est
        Ã  dire qu'il est connectÃ© et authentifiÃ©, prÃªt Ã  envoyer des messages
        WAMP.
    &quot;&quot;&quot;
    # Ensuite on fait une requÃªte post au serveur pour dire qu'on est
    # actif et rÃ©cupÃ©rer les valeurs de configuration de notre client.
    app._params.update(requests.post('http://' + SERVER + ':8080/clients/',
                                    data={'ip': app._params['ip']}).json())


    # Puis on boucle indÃ©finiment
    while True:
        # Chaque tour de boucle, on rÃ©cupÃ¨re les infos de notre machine
        infos = {'ip': app._params['ip'], 'name': app._params['name']}
        infos.update(get_infos(app._params))

        # Si les stats sont a envoyer, on fait une publication WAMP.
        if not app._params['disabled']:
            app.session.publish('clientstats', infos)

        # Et on attend. GrÃ¢ce Ã  @inlineCallbacks, utiliser yield indique
        # qu'on ne bloque pas ici, donc pendant ce temps notre client
        # peut Ã©couter les Ã©vÃ©nements WAMP et y rÃ©agir.
        yield sleep(app._params['frequency'])


# On dit qu'on est intÃ©ressÃ© par les Ã©vÃ©nements concernant clientconfig
@app.subscribe('clientconfig.' + app._params['ip'])
def update_configuration(args):
    &quot;&quot;&quot; Met Ã  jour la configuration du client quand Django nous le demande. &quot;&quot;&quot;
    app._params.update(args)

# On dÃ©marre notre client.
if __name__ == '__main__':
    app.run(url=&quot;ws://%s:8080/ws&quot; % SERVER)</p></div>

<p>Le plus gros du code est <code>get_infos()</code> qui n&#8217;a rien Ã  voir avec WAMP. C&#8217;est nous, manipulant <code>psutil</code> pour obtenir les relevÃ©s de cette machine. Je ne recommande bien Ã©videment pas de faire Ã§a en prod : une grosse fonction monolithique qui prend un dico en param. Mais c&#8217;est pour une dÃ©mo, et Ã§a me permet de grouper les instructions qui vont ensemble pour faciliter votre comprÃ©hension.</p>
<p>La partie qui concerne WAMP :</p>

<div class="wp_syntax" style="position:relative;"><table><tr><td class="code"><pre class="python" style="font-family:monospace;">app <span style="color: #66cc66;">=</span> Application<span style="color: black;">&#40;</span><span style="color: #483d8b;">'monitoring'</span><span style="color: black;">&#41;</span>
&nbsp;
<span style="color: #66cc66;">@</span>app.<span style="color: #dc143c;">signal</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'onjoined'</span><span style="color: black;">&#41;</span>
<span style="color: #66cc66;">@</span>inlineCallbacks
<span style="color: #ff7700;font-weight:bold;">def</span> called_on_joinded<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>:
    ...
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">while</span> <span style="color: #008000;">True</span>:
&nbsp;
        ...
        <span style="color: black;">app</span>.<span style="color: black;">session</span>.<span style="color: black;">publish</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'clientstats'</span><span style="color: #66cc66;">,</span> infos<span style="color: black;">&#41;</span>
        ...
        <span style="color: #ff7700;font-weight:bold;">yield</span> sleep<span style="color: black;">&#40;</span>app._params<span style="color: black;">&#91;</span><span style="color: #483d8b;">'frequency'</span><span style="color: black;">&#93;</span><span style="color: black;">&#41;</span></pre></td></tr></table><p class="theCode" style="display:none;">app = Application('monitoring')

@app.signal('onjoined')
@inlineCallbacks
def called_on_joinded():
    ...

    while True:

        ...
        app.session.publish('clientstats', infos)
        ...
        yield sleep(app._params['frequency'])</p></div>

<p><code>app = Application('monitoring')</code> crÃ©Ã© un client WAMP, et <code>@app.signal('onjoined')</code> nous dit de lancer la fonction quand notre client est connectÃ© et prÃªt Ã  envoyer des Ã©vÃ©nements. <code>@inlineCallbacks</code> est une spÃ©cificitÃ© de Twisted qui nous permet d&#8217;Ã©crire du code asynchrone sans avoir Ã  mettre des callback partout : Ã  la place on met des <code>yield.</code></p>
<p>Tout le boulot de notre client a lieu dans la boucle : <code>app.session.publish('clientstats', infos)</code> publie les nouvelles mesures de CPU/RAM/Disque via WAMP, puis attend un certain temps (<code>yield sleep(app._params['frequency'])</code>) avant de le faire Ã  nouveau. L&#8217;attente n&#8217;est pas bloquante car elle se fait avec le <code>sleep</code> de Twisted.</p>
<p>N&#8217;oublions pas :</p>

<div class="wp_syntax" style="position:relative;"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #66cc66;">@</span>app.<span style="color: black;">subscribe</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'clientconfig.'</span> + app._params<span style="color: black;">&#91;</span><span style="color: #483d8b;">'ip'</span><span style="color: black;">&#93;</span><span style="color: black;">&#41;</span>
<span style="color: #ff7700;font-weight:bold;">def</span> update_configuration<span style="color: black;">&#40;</span>args<span style="color: black;">&#41;</span>:
    app._params.<span style="color: black;">update</span><span style="color: black;">&#40;</span>args<span style="color: black;">&#41;</span></pre></td></tr></table><p class="theCode" style="display:none;">@app.subscribe('clientconfig.' + app._params['ip'])
def update_configuration(args):
    app._params.update(args)</p></div>

<p>La fonction <code>update_configuration()</code> sera appelÃ©e Ã  chaque fois qu&#8217;une publication WAMP sera faite sur le sujet <code>clientconfig.&lt;ip_du_client&gt;</code>. Notre fonction ne fait que mettre Ã  jour la configuration du client, qui est un dico de la forme :</p>

<div class="wp_syntax" style="position:relative;"><table><tr><td class="code"><pre class="python" style="font-family:monospace;">    <span style="color: black;">&#123;</span><span style="color: #483d8b;">'cpus'</span>: <span style="color: #008000;">True</span><span style="color: #66cc66;">,</span>
    <span style="color: #483d8b;">'memory'</span>: <span style="color: #008000;">False</span><span style="color: #66cc66;">,</span>
    <span style="color: #483d8b;">'disk'</span>: <span style="color: #008000;">True</span><span style="color: #66cc66;">,</span>
    <span style="color: #483d8b;">'disabled'</span>: <span style="color: #008000;">False</span><span style="color: #66cc66;">,</span>
    <span style="color: #483d8b;">'frequency'</span>: <span style="color: #ff4500;">1</span><span style="color: black;">&#125;</span></pre></td></tr></table><p class="theCode" style="display:none;">    {'cpus': True,
    'memory': False,
    'disk': True,
    'disabled': False,
    'frequency': 1}</p></div>

<p>C&#8217;est ce dico qui est utilisÃ© par <code>get_infos()</code> pour choisir quelles mesures rÃ©cupÃ©rer, et aussi par <code>sleep()</code> pour savoir combien de secondes attendre avant la prochaine mesure.</p>
<p>La valeur initiale de ce dico est rÃ©cupÃ©rÃ©e au lancement du client, en faisant :</p>

<div class="wp_syntax" style="position:relative;"><table><tr><td class="code"><pre class="python" style="font-family:monospace;">app._params.<span style="color: black;">update</span><span style="color: black;">&#40;</span>requests.<span style="color: black;">post</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'http://'</span> + SERVER + <span style="color: #483d8b;">':8080/clients/'</span><span style="color: #66cc66;">,</span>
                                    data<span style="color: #66cc66;">=</span><span style="color: black;">&#123;</span><span style="color: #483d8b;">'ip'</span>: app._params<span style="color: black;">&#91;</span><span style="color: #483d8b;">'ip'</span><span style="color: black;">&#93;</span><span style="color: black;">&#125;</span><span style="color: black;">&#41;</span>.<span style="color: black;">json</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span></pre></td></tr></table><p class="theCode" style="display:none;">app._params.update(requests.post('http://' + SERVER + ':8080/clients/',
                                    data={'ip': app._params['ip']}).json())</p></div>

<p><code>requests.post(url_du_serveur, data={'ip': app._params['ip']}).json()</code> fait en effet une requÃªte POST vers une URL de django qui nous allons voir plus loin, et qui retourne la configuration du client portant cette IP sous forme de JSON.</p>
<p>On utilise donc une fois HTTP pour obtenir les valeurs de dÃ©parts, et ensuite WAMP pour les mises Ã  jours des futures valeurs. WAMP et HTTP ne s&#8217;excluent pas : ils sont complÃ©mentaires.</p>
<p>Petite parenthÃ¨se sur :</p>

<div class="wp_syntax" style="position:relative;"><table><tr><td class="code"><pre class="python" style="font-family:monospace;">SERVER <span style="color: #66cc66;">=</span> <span style="color: #483d8b;">'172.17.42.1'</span>
&nbsp;
s <span style="color: #66cc66;">=</span> <span style="color: #dc143c;">socket</span>.<span style="color: #dc143c;">socket</span><span style="color: black;">&#40;</span><span style="color: #dc143c;">socket</span>.<span style="color: black;">AF_INET</span><span style="color: #66cc66;">,</span> <span style="color: #dc143c;">socket</span>.<span style="color: black;">SOCK_DGRAM</span><span style="color: black;">&#41;</span>
s.<span style="color: black;">connect</span><span style="color: black;">&#40;</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">&quot;8.8.8.8&quot;</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">80</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span>
app._params <span style="color: #66cc66;">=</span> <span style="color: black;">&#123;</span><span style="color: #483d8b;">'name'</span>: <span style="color: #dc143c;">socket</span>.<span style="color: black;">gethostname</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'ip'</span>: s.<span style="color: black;">getsockname</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: black;">&#91;</span><span style="color: #ff4500;">0</span><span style="color: black;">&#93;</span><span style="color: black;">&#125;</span>
s.<span style="color: black;">close</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span></pre></td></tr></table><p class="theCode" style="display:none;">SERVER = '172.17.42.1'

s = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)
s.connect((&quot;8.8.8.8&quot;, 80))
app._params = {'name': socket.gethostname(), 'ip': s.getsockname()[0]}
s.close()</p></div>

<p>D&#8217;une part, j&#8217;ai mis l&#8217;IP du serveur qui va contenir Crossbar.io et Django en dur car je suis, je pense que maintenant vous le savez, une grosse feignasse. Mais en prod, vous me faites un paramÃ¨tre, on est d&#8217;accord ? Ensuite, il faut que j&#8217;identifie mon client, ce que je fais avec l&#8217;adresse IP. Il me faut donc son adresse IP externe, et je l&#8217;obtiens avec une astuce consistant Ã  me connecter Ã  l&#8217;IP 8.8.8.8 (les DNS google \o/) et en fermant la connexion juste derriÃ¨re. Ce me permet de voir comment les autres machines me voit depuis lâextÃ©rieur.</p>
<h2>Le site Django</h2>
<p>Puisque le prÃ©requis de l&#8217;article et de connaÃ®tre Django, Ã§a va pas Ãªtre trop dur.</p>
<p>On crÃ©Ã© son projet et son app :</p>

<div class="wp_syntax" style="position:relative;"><table><tr><td class="code"><pre class="bash" style="font-family:monospace;">django-admin startproject django_project
.<span style="color: #000000; font-weight: bold;">/</span>manage.py startapp django_app</pre></td></tr></table><p class="theCode" style="display:none;">django-admin startproject django_project
./manage.py startapp django_app</p></div>

<p>On se rajoute un petit modÃ¨le qui contient la configuration de chaque client (vous vous souvenez, le fameux dico) :</p>

<div class="wp_syntax" style="position:relative;"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #808080; font-style: italic;"># -*- coding: utf-8 -*-</span>
&nbsp;
<span style="color: #ff7700;font-weight:bold;">import</span> requests
&nbsp;
<span style="color: #ff7700;font-weight:bold;">from</span> django.<span style="color: black;">db</span> <span style="color: #ff7700;font-weight:bold;">import</span> models
<span style="color: #ff7700;font-weight:bold;">from</span> django.<span style="color: black;">db</span>.<span style="color: black;">models</span>.<span style="color: black;">signals</span> <span style="color: #ff7700;font-weight:bold;">import</span> post_save
<span style="color: #ff7700;font-weight:bold;">from</span> django.<span style="color: black;">dispatch</span> <span style="color: #ff7700;font-weight:bold;">import</span> receiver
<span style="color: #ff7700;font-weight:bold;">from</span> django.<span style="color: black;">forms</span>.<span style="color: black;">models</span> <span style="color: #ff7700;font-weight:bold;">import</span> model_to_dict
&nbsp;
&nbsp;
<span style="color: #ff7700;font-weight:bold;">class</span> Client<span style="color: black;">&#40;</span>models.<span style="color: black;">Model</span><span style="color: black;">&#41;</span>:
    <span style="color: #483d8b;">&quot;&quot;&quot; Configuration de notre client. &quot;&quot;&quot;</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># Pour l'identifier.</span>
    ip <span style="color: #66cc66;">=</span> models.<span style="color: black;">GenericIPAddressField</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># Quelles donnÃ©es envoyer Ã  notre dashboard</span>
    show_cpus <span style="color: #66cc66;">=</span> models.<span style="color: black;">BooleanField</span><span style="color: black;">&#40;</span>default<span style="color: #66cc66;">=</span><span style="color: #008000;">True</span><span style="color: black;">&#41;</span>
    show_memory <span style="color: #66cc66;">=</span> models.<span style="color: black;">BooleanField</span><span style="color: black;">&#40;</span>default<span style="color: #66cc66;">=</span><span style="color: #008000;">True</span><span style="color: black;">&#41;</span>
    show_disk <span style="color: #66cc66;">=</span> models.<span style="color: black;">BooleanField</span><span style="color: black;">&#40;</span>default<span style="color: #66cc66;">=</span><span style="color: #008000;">True</span><span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># ArrÃªter d'envoyer les donnÃ©es</span>
    disabled <span style="color: #66cc66;">=</span> models.<span style="color: black;">BooleanField</span><span style="color: black;">&#40;</span>default<span style="color: #66cc66;">=</span><span style="color: #008000;">False</span><span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #808080; font-style: italic;"># FrÃ©quence de rafraÃ®chissement des donnÃ©es</span>
    frequency <span style="color: #66cc66;">=</span> models.<span style="color: black;">IntegerField</span><span style="color: black;">&#40;</span>default<span style="color: #66cc66;">=</span><span style="color: #ff4500;">1</span><span style="color: black;">&#41;</span>
&nbsp;
    <span style="color: #ff7700;font-weight:bold;">def</span> <span style="color: #0000cd;">__unicode__</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span><span style="color: black;">&#41;</span>:
        <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #008000;">self</span>.<span style="color: black;">ip</span>
&nbsp;
&nbsp;
<span style="color: #66cc66;">@</span>receiver<span style="color: black;">&#40;</span>post_save<span style="color: #66cc66;">,</span> sender<span style="color: #66cc66;">=</span>Client<span style="color: #66cc66;">,</span> dispatch_uid<span style="color: #66cc66;">=</span><span style="color: #483d8b;">&quot;server_post_save&quot;</span><span style="color: black;">&#41;</span>
<span style="color: #ff7700;font-weight:bold;">def</span> notify_server_config_changed<span style="color: black;">&#40;</span>sender<span style="color: #66cc66;">,</span> instance<span style="color: #66cc66;">,</span> **kwargs<span style="color: black;">&#41;</span>:
    <span style="color: #483d8b;">&quot;&quot;&quot; Notifie un client que sa configuration a changÃ©.
&nbsp;
        Cette fonction est lancÃ©e quand on sauvegarde un modÃ¨le Client,
        et fait une requÃªte POST sur le bridge WAMP-HTTP, nous permettant
        de faire un publish depuis Django.
    &quot;&quot;&quot;</span>
    requests.<span style="color: black;">post</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">&quot;http://127.0.0.1:8080/notify&quot;</span><span style="color: #66cc66;">,</span>
                  json<span style="color: #66cc66;">=</span><span style="color: black;">&#123;</span>
                      <span style="color: #483d8b;">'topic'</span>: <span style="color: #483d8b;">'clientconfig.'</span> + instance.<span style="color: black;">ip</span><span style="color: #66cc66;">,</span>
                      <span style="color: #483d8b;">'args'</span>: <span style="color: black;">&#91;</span>model_to_dict<span style="color: black;">&#40;</span>instance<span style="color: black;">&#41;</span><span style="color: black;">&#93;</span>
                  <span style="color: black;">&#125;</span><span style="color: black;">&#41;</span></pre></td></tr></table><p class="theCode" style="display:none;"># -*- coding: utf-8 -*-

import requests

from django.db import models
from django.db.models.signals import post_save
from django.dispatch import receiver
from django.forms.models import model_to_dict


class Client(models.Model):
    &quot;&quot;&quot; Configuration de notre client. &quot;&quot;&quot;

    # Pour l'identifier.
    ip = models.GenericIPAddressField()

    # Quelles donnÃ©es envoyer Ã  notre dashboard
    show_cpus = models.BooleanField(default=True)
    show_memory = models.BooleanField(default=True)
    show_disk = models.BooleanField(default=True)

    # ArrÃªter d'envoyer les donnÃ©es
    disabled = models.BooleanField(default=False)

    # FrÃ©quence de rafraÃ®chissement des donnÃ©es
    frequency = models.IntegerField(default=1)

    def __unicode__(self):
        return self.ip


@receiver(post_save, sender=Client, dispatch_uid=&quot;server_post_save&quot;)
def notify_server_config_changed(sender, instance, **kwargs):
    &quot;&quot;&quot; Notifie un client que sa configuration a changÃ©.

        Cette fonction est lancÃ©e quand on sauvegarde un modÃ¨le Client,
        et fait une requÃªte POST sur le bridge WAMP-HTTP, nous permettant
        de faire un publish depuis Django.
    &quot;&quot;&quot;
    requests.post(&quot;http://127.0.0.1:8080/notify&quot;,
                  json={
                      'topic': 'clientconfig.' + instance.ip,
                      'args': [model_to_dict(instance)]
                  })</p></div>

<p>La partie modÃ¨le est connue. L&#8217;astuce est dans :</p>

<div class="wp_syntax" style="position:relative;"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #66cc66;">@</span>receiver<span style="color: black;">&#40;</span>post_save<span style="color: #66cc66;">,</span> sender<span style="color: #66cc66;">=</span>Client<span style="color: #66cc66;">,</span> dispatch_uid<span style="color: #66cc66;">=</span><span style="color: #483d8b;">&quot;server_post_save&quot;</span><span style="color: black;">&#41;</span>
<span style="color: #ff7700;font-weight:bold;">def</span> notify_server_config_changed<span style="color: black;">&#40;</span>sender<span style="color: #66cc66;">,</span> instance<span style="color: #66cc66;">,</span> **kwargs<span style="color: black;">&#41;</span>:
    requests.<span style="color: black;">post</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">&quot;http://127.0.0.1:8080/notify&quot;</span><span style="color: #66cc66;">,</span>
                  json<span style="color: #66cc66;">=</span><span style="color: black;">&#123;</span>
                      <span style="color: #483d8b;">'topic'</span>: <span style="color: #483d8b;">'clientconfig.'</span> + instance.<span style="color: black;">ip</span><span style="color: #66cc66;">,</span>
                      <span style="color: #483d8b;">'args'</span>: <span style="color: black;">&#91;</span>model_to_dict<span style="color: black;">&#40;</span>instance<span style="color: black;">&#41;</span><span style="color: black;">&#93;</span>
                  <span style="color: black;">&#125;</span><span style="color: black;">&#41;</span></pre></td></tr></table><p class="theCode" style="display:none;">@receiver(post_save, sender=Client, dispatch_uid=&quot;server_post_save&quot;)
def notify_server_config_changed(sender, instance, **kwargs):
    requests.post(&quot;http://127.0.0.1:8080/notify&quot;,
                  json={
                      'topic': 'clientconfig.' + instance.ip,
                      'args': [model_to_dict(instance)]
                  })</p></div>

<p>On utilise ici les signaux Django, une fonctionnalitÃ© du framework qui nous permet de lancer une fonction quand quelque chose se passe. Ici on dit &#8220;lance cette fonction quand le modÃ¨le <code>Client</code> est modifiÃ©&#8221;.</p>
<p>Donc <code>notify_server_config_changed</code> va se lancer quand la config d&#8217;un client est modifiÃ©e, par exemple dans l&#8217;admin, et recevoir l&#8217;objet modifiÃ© via son paramÃ¨tre <code>instance</code>.</p>
<p>On fait alors une petite requÃªte POST sur <code>http://127.0.0.1:8080/notify</code>, l&#8217;URL sur laquelle on configurera plus loin notre service de push. En faisant une requÃªte dessus, on va demander Ã  Crossbar.io de transformer la requÃªte HTTP en message publish WAMP, ici sur le sujet &#8216;clientconfig.&lt;ip_du_client&gt;&#8217;. On publie donc un message WAMP, depuis Django.</p>
<p>Ca marche depuis n&#8217;importe oÃ¹, pas juste Django. Depuis le shell, depuis Flask, n&#8217;importe oÃ¹ on peut faire une requÃªte HTTP vers le service de push de crossbar.</p>
<p>Ce message va Ãªtre rÃ©cupÃ©rÃ© par notre client, oÃ¹ qu&#8217;il soit, puisqu&#8217;il est aussi connectÃ© au routeur WAMP. Comme, je vous le rappelle, notre client fait Ã§a :</p>

<div class="wp_syntax" style="position:relative;"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #66cc66;">@</span>app.<span style="color: black;">subscribe</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'clientconfig.'</span> + app._params<span style="color: black;">&#91;</span><span style="color: #483d8b;">'ip'</span><span style="color: black;">&#93;</span><span style="color: black;">&#41;</span>
<span style="color: #ff7700;font-weight:bold;">def</span> update_configuration<span style="color: black;">&#40;</span>args<span style="color: black;">&#41;</span>:
    app._params.<span style="color: black;">update</span><span style="color: black;">&#40;</span>args<span style="color: black;">&#41;</span></pre></td></tr></table><p class="theCode" style="display:none;">@app.subscribe('clientconfig.' + app._params['ip'])
def update_configuration(args):
    app._params.update(args)</p></div>

<p>Il va recevoir ce message, et donc le contenu de <code>'args': [model_to_dict(instance)]</code>, c&#8217;est Ã  dire la nouvelle configuration qu&#8217;on a changÃ© en base de donnÃ©e. Il se met ainsi Ã  jour immÃ©diatement. La boucle est bouclÃ©e.</p>
<p>Comme on veut profiter de notre boucle toute bouclÃ©e, on rajoute le modÃ¨le dans l&#8217;admin :</p>

<div class="wp_syntax" style="position:relative;"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">from</span> django.<span style="color: black;">contrib</span> <span style="color: #ff7700;font-weight:bold;">import</span> admin
&nbsp;
<span style="color: #808080; font-style: italic;"># Register your models here.</span>
&nbsp;
<span style="color: #ff7700;font-weight:bold;">from</span> django_app.<span style="color: black;">models</span> <span style="color: #ff7700;font-weight:bold;">import</span> Client
&nbsp;
admin.<span style="color: #dc143c;">site</span>.<span style="color: black;">register</span><span style="color: black;">&#40;</span>Client<span style="color: black;">&#41;</span></pre></td></tr></table><p class="theCode" style="display:none;">from django.contrib import admin

# Register your models here.

from django_app.models import Client

admin.site.register(Client)</p></div>

<p>Ainsi, les configs des clients seront Ã©ditables dans l&#8217;admin, et quand on cliquera sur &#8220;save&#8221;, Ã§a va lancer notre publish WAMP qui mettra Ã  jour le bon client.</p>
<p>Le reste, c&#8217;est du fignolage. Une petite vue pour crÃ©er ou rÃ©cupÃ©rer notre configuration de client au dÃ©marrage :</p>

<div class="wp_syntax" style="position:relative;"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #808080; font-style: italic;"># -*- coding: utf-8 -*-</span>
&nbsp;
<span style="color: #ff7700;font-weight:bold;">import</span> json
&nbsp;
<span style="color: #ff7700;font-weight:bold;">from</span> django.<span style="color: black;">http</span> <span style="color: #ff7700;font-weight:bold;">import</span> HttpResponse
<span style="color: #ff7700;font-weight:bold;">from</span> django_app.<span style="color: black;">models</span> <span style="color: #ff7700;font-weight:bold;">import</span> Client
<span style="color: #ff7700;font-weight:bold;">from</span> django.<span style="color: black;">views</span>.<span style="color: black;">decorators</span>.<span style="color: black;">csrf</span> <span style="color: #ff7700;font-weight:bold;">import</span> csrf_exempt
<span style="color: #ff7700;font-weight:bold;">from</span> django.<span style="color: black;">forms</span>.<span style="color: black;">models</span> <span style="color: #ff7700;font-weight:bold;">import</span> model_to_dict
&nbsp;
&nbsp;
<span style="color: #66cc66;">@</span>csrf_exempt
<span style="color: #ff7700;font-weight:bold;">def</span> clients<span style="color: black;">&#40;</span>request<span style="color: black;">&#41;</span>:
    <span style="color: #483d8b;">&quot;&quot;&quot; RÃ©cupÃ¨re la config d'un client en base de donnÃ©e et lui envoie.&quot;&quot;&quot;</span>
    client<span style="color: #66cc66;">,</span> created <span style="color: #66cc66;">=</span> Client.<span style="color: black;">objects</span>.<span style="color: black;">get_or_create</span><span style="color: black;">&#40;</span>ip<span style="color: #66cc66;">=</span>request.<span style="color: black;">POST</span><span style="color: black;">&#91;</span><span style="color: #483d8b;">'ip'</span><span style="color: black;">&#93;</span><span style="color: black;">&#41;</span>
    <span style="color: #ff7700;font-weight:bold;">return</span> HttpResponse<span style="color: black;">&#40;</span>json.<span style="color: black;">dumps</span><span style="color: black;">&#40;</span>model_to_dict<span style="color: black;">&#40;</span>client<span style="color: black;">&#41;</span><span style="color: black;">&#41;</span><span style="color: #66cc66;">,</span> content_type<span style="color: #66cc66;">=</span><span style="color: #483d8b;">'application/json'</span><span style="color: black;">&#41;</span></pre></td></tr></table><p class="theCode" style="display:none;"># -*- coding: utf-8 -*-

import json

from django.http import HttpResponse
from django_app.models import Client
from django.views.decorators.csrf import csrf_exempt
from django.forms.models import model_to_dict


@csrf_exempt
def clients(request):
    &quot;&quot;&quot; RÃ©cupÃ¨re la config d'un client en base de donnÃ©e et lui envoie.&quot;&quot;&quot;
    client, created = Client.objects.get_or_create(ip=request.POST['ip'])
    return HttpResponse(json.dumps(model_to_dict(client)), content_type='application/json')</p></div>

<p>On dÃ©sactive la protection CSRF pour la dÃ©mo, mais encore une fois, en prod, faites Ã§a proprement, avec une jolie authentification pour protÃ©ger la vue, et tout, et tout.</p>
<p>Donc, cette vue rÃ©cupÃ¨re la configuration d&#8217;un client avec cette IP (la crÃ©ant au besoin), et la retourne en JSON. Souvenez-vous, cela permet Ã  notre client de faire :</p>

<div class="wp_syntax" style="position:relative;"><table><tr><td class="code"><pre class="python" style="font-family:monospace;">    app._params.<span style="color: black;">update</span><span style="color: black;">&#40;</span>requests.<span style="color: black;">post</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'http://'</span> + SERVER + <span style="color: #483d8b;">':8080/clients/'</span><span style="color: #66cc66;">,</span>
                                    data<span style="color: #66cc66;">=</span><span style="color: black;">&#123;</span><span style="color: #483d8b;">'ip'</span>: app._params<span style="color: black;">&#91;</span><span style="color: #483d8b;">'ip'</span><span style="color: black;">&#93;</span><span style="color: black;">&#125;</span><span style="color: black;">&#41;</span>.<span style="color: black;">json</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span></pre></td></tr></table><p class="theCode" style="display:none;">    app._params.update(requests.post('http://' + SERVER + ':8080/clients/',
                                    data={'ip': app._params['ip']}).json())</p></div>

<p>Au dÃ©marrage et se dÃ©clarer dans la base de donnÃ©es, tout en rÃ©cupÃ©rant sa config.</p>
<p>On branche tout Ã§a via <code>urls.py</code> :</p>

<div class="wp_syntax" style="position:relative;"><table><tr><td class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">from</span> django.<span style="color: black;">conf</span>.<span style="color: black;">urls</span> <span style="color: #ff7700;font-weight:bold;">import</span> patterns<span style="color: #66cc66;">,</span> include<span style="color: #66cc66;">,</span> url
<span style="color: #ff7700;font-weight:bold;">from</span> django.<span style="color: black;">contrib</span> <span style="color: #ff7700;font-weight:bold;">import</span> admin
<span style="color: #ff7700;font-weight:bold;">from</span> django.<span style="color: black;">views</span>.<span style="color: black;">generic</span> <span style="color: #ff7700;font-weight:bold;">import</span> TemplateView
&nbsp;
urlpatterns <span style="color: #66cc66;">=</span> patterns<span style="color: black;">&#40;</span><span style="color: #483d8b;">''</span><span style="color: #66cc66;">,</span>
    url<span style="color: black;">&#40;</span>r<span style="color: #483d8b;">'^admin/'</span><span style="color: #66cc66;">,</span> include<span style="color: black;">&#40;</span>admin.<span style="color: #dc143c;">site</span>.<span style="color: black;">urls</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span><span style="color: #66cc66;">,</span>
    url<span style="color: black;">&#40;</span>r<span style="color: #483d8b;">'^clients/'</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'django_app.views.clients'</span><span style="color: black;">&#41;</span><span style="color: #66cc66;">,</span>
    url<span style="color: black;">&#40;</span>r<span style="color: #483d8b;">'^$'</span><span style="color: #66cc66;">,</span> TemplateView.<span style="color: black;">as_view</span><span style="color: black;">&#40;</span>template_name<span style="color: #66cc66;">=</span><span style="color: #483d8b;">'dashboard.html'</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span><span style="color: #66cc66;">,</span>
<span style="color: black;">&#41;</span></pre></td></tr></table><p class="theCode" style="display:none;">from django.conf.urls import patterns, include, url
from django.contrib import admin
from django.views.generic import TemplateView

urlpatterns = patterns('',
    url(r'^admin/', include(admin.site.urls)),
    url(r'^clients/', 'django_app.views.clients'),
    url(r'^$', TemplateView.as_view(template_name='dashboard.html')),
)</p></div>

<p>L&#8217;admin, notre vue toute fraiche, et de quoi servir le HTML du dÃ©but de l&#8217;article.</p>
<p>Y plus qu&#8217;Ã  :</p>

<div class="wp_syntax" style="position:relative;"><table><tr><td class="code"><pre class="bash" style="font-family:monospace;">.<span style="color: #000000; font-weight: bold;">/</span>manage.py syncdb</pre></td></tr></table><p class="theCode" style="display:none;">./manage.py syncdb</p></div>

<h2>Crossbar.io</h2>
<p>Finalement, tout ce qu&#8217;il reste, c&#8217;est notre bon crossbar :</p>

<div class="wp_syntax" style="position:relative;"><table><tr><td class="code"><pre class="bash" style="font-family:monospace;">crossbar init</pre></td></tr></table><p class="theCode" style="display:none;">crossbar init</p></div>

<p>Ceci nous pond le dossier <code>.crossbar</code> dans lequel on a le fichier <code>config.json</code> qu&#8217;on Ã©dite pour qu&#8217;il ressemble Ã  Ã§a :</p>

<div class="wp_syntax" style="position:relative;"><table><tr><td class="code"><pre class="javascript" style="font-family:monospace;"><span style="color: #009900;">&#123;</span>
   <span style="color: #3366CC;">&quot;workers&quot;</span><span style="color: #339933;">:</span> <span style="color: #009900;">&#91;</span>
      <span style="color: #009900;">&#123;</span>
         <span style="color: #3366CC;">&quot;type&quot;</span><span style="color: #339933;">:</span> <span style="color: #3366CC;">&quot;router&quot;</span><span style="color: #339933;">,</span>
         <span style="color: #3366CC;">&quot;realms&quot;</span><span style="color: #339933;">:</span> <span style="color: #009900;">&#91;</span>
            <span style="color: #009900;">&#123;</span>
               <span style="color: #3366CC;">&quot;name&quot;</span><span style="color: #339933;">:</span> <span style="color: #3366CC;">&quot;realm1&quot;</span><span style="color: #339933;">,</span>
               <span style="color: #3366CC;">&quot;roles&quot;</span><span style="color: #339933;">:</span> <span style="color: #009900;">&#91;</span>
                  <span style="color: #009900;">&#123;</span>
                     <span style="color: #3366CC;">&quot;name&quot;</span><span style="color: #339933;">:</span> <span style="color: #3366CC;">&quot;anonymous&quot;</span><span style="color: #339933;">,</span>
                     <span style="color: #3366CC;">&quot;permissions&quot;</span><span style="color: #339933;">:</span> <span style="color: #009900;">&#91;</span>
                        <span style="color: #009900;">&#123;</span>
                           <span style="color: #3366CC;">&quot;uri&quot;</span><span style="color: #339933;">:</span> <span style="color: #3366CC;">&quot;*&quot;</span><span style="color: #339933;">,</span>
                           <span style="color: #3366CC;">&quot;publish&quot;</span><span style="color: #339933;">:</span> <span style="color: #003366; font-weight: bold;">true</span><span style="color: #339933;">,</span>
                           <span style="color: #3366CC;">&quot;subscribe&quot;</span><span style="color: #339933;">:</span> <span style="color: #003366; font-weight: bold;">true</span><span style="color: #339933;">,</span>
                           <span style="color: #3366CC;">&quot;call&quot;</span><span style="color: #339933;">:</span> <span style="color: #003366; font-weight: bold;">true</span><span style="color: #339933;">,</span>
                           <span style="color: #3366CC;">&quot;register&quot;</span><span style="color: #339933;">:</span> <span style="color: #003366; font-weight: bold;">true</span>
                        <span style="color: #009900;">&#125;</span>
                     <span style="color: #009900;">&#93;</span>
                  <span style="color: #009900;">&#125;</span>
               <span style="color: #009900;">&#93;</span>
            <span style="color: #009900;">&#125;</span>
         <span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span>
         <span style="color: #3366CC;">&quot;transports&quot;</span><span style="color: #339933;">:</span> <span style="color: #009900;">&#91;</span>
            <span style="color: #009900;">&#123;</span>
               <span style="color: #3366CC;">&quot;type&quot;</span><span style="color: #339933;">:</span> <span style="color: #3366CC;">&quot;web&quot;</span><span style="color: #339933;">,</span>
               <span style="color: #3366CC;">&quot;endpoint&quot;</span><span style="color: #339933;">:</span> <span style="color: #009900;">&#123;</span>
                  <span style="color: #3366CC;">&quot;type&quot;</span><span style="color: #339933;">:</span> <span style="color: #3366CC;">&quot;tcp&quot;</span><span style="color: #339933;">,</span>
                  <span style="color: #3366CC;">&quot;port&quot;</span><span style="color: #339933;">:</span> <span style="color: #CC0000;">8080</span>
               <span style="color: #009900;">&#125;</span><span style="color: #339933;">,</span>
               <span style="color: #3366CC;">&quot;paths&quot;</span><span style="color: #339933;">:</span> <span style="color: #009900;">&#123;</span>
                  <span style="color: #3366CC;">&quot;/&quot;</span><span style="color: #339933;">:</span> <span style="color: #009900;">&#123;</span>
                     <span style="color: #3366CC;">&quot;type&quot;</span><span style="color: #339933;">:</span> <span style="color: #3366CC;">&quot;wsgi&quot;</span><span style="color: #339933;">,</span>
                     <span style="color: #3366CC;">&quot;module&quot;</span><span style="color: #339933;">:</span> <span style="color: #3366CC;">&quot;django_project.wsgi&quot;</span><span style="color: #339933;">,</span>
                     <span style="color: #3366CC;">&quot;object&quot;</span><span style="color: #339933;">:</span> <span style="color: #3366CC;">&quot;application&quot;</span>
                  <span style="color: #009900;">&#125;</span><span style="color: #339933;">,</span>
                  <span style="color: #3366CC;">&quot;ws&quot;</span><span style="color: #339933;">:</span> <span style="color: #009900;">&#123;</span>
                     <span style="color: #3366CC;">&quot;type&quot;</span><span style="color: #339933;">:</span> <span style="color: #3366CC;">&quot;websocket&quot;</span>
                  <span style="color: #009900;">&#125;</span><span style="color: #339933;">,</span>
                  <span style="color: #3366CC;">&quot;notify&quot;</span><span style="color: #339933;">:</span> <span style="color: #009900;">&#123;</span>
                     <span style="color: #3366CC;">&quot;type&quot;</span><span style="color: #339933;">:</span> <span style="color: #3366CC;">&quot;pusher&quot;</span><span style="color: #339933;">,</span>
                     <span style="color: #3366CC;">&quot;realm&quot;</span><span style="color: #339933;">:</span> <span style="color: #3366CC;">&quot;realm1&quot;</span><span style="color: #339933;">,</span>
                     <span style="color: #3366CC;">&quot;role&quot;</span><span style="color: #339933;">:</span> <span style="color: #3366CC;">&quot;anonymous&quot;</span>
                  <span style="color: #009900;">&#125;</span><span style="color: #339933;">,</span>
                  <span style="color: #3366CC;">&quot;static&quot;</span><span style="color: #339933;">:</span> <span style="color: #009900;">&#123;</span>
                     <span style="color: #3366CC;">&quot;type&quot;</span><span style="color: #339933;">:</span> <span style="color: #3366CC;">&quot;static&quot;</span><span style="color: #339933;">,</span>
                     <span style="color: #3366CC;">&quot;directory&quot;</span><span style="color: #339933;">:</span> <span style="color: #3366CC;">&quot;../static&quot;</span>
                  <span style="color: #009900;">&#125;</span>
               <span style="color: #009900;">&#125;</span>
            <span style="color: #009900;">&#125;</span>
         <span style="color: #009900;">&#93;</span>
      <span style="color: #009900;">&#125;</span>
   <span style="color: #009900;">&#93;</span>
<span style="color: #009900;">&#125;</span></pre></td></tr></table><p class="theCode" style="display:none;">{
   &quot;workers&quot;: [
      {
         &quot;type&quot;: &quot;router&quot;,
         &quot;realms&quot;: [
            {
               &quot;name&quot;: &quot;realm1&quot;,
               &quot;roles&quot;: [
                  {
                     &quot;name&quot;: &quot;anonymous&quot;,
                     &quot;permissions&quot;: [
                        {
                           &quot;uri&quot;: &quot;*&quot;,
                           &quot;publish&quot;: true,
                           &quot;subscribe&quot;: true,
                           &quot;call&quot;: true,
                           &quot;register&quot;: true
                        }
                     ]
                  }
               ]
            }
         ],
         &quot;transports&quot;: [
            {
               &quot;type&quot;: &quot;web&quot;,
               &quot;endpoint&quot;: {
                  &quot;type&quot;: &quot;tcp&quot;,
                  &quot;port&quot;: 8080
               },
               &quot;paths&quot;: {
                  &quot;/&quot;: {
                     &quot;type&quot;: &quot;wsgi&quot;,
                     &quot;module&quot;: &quot;django_project.wsgi&quot;,
                     &quot;object&quot;: &quot;application&quot;
                  },
                  &quot;ws&quot;: {
                     &quot;type&quot;: &quot;websocket&quot;
                  },
                  &quot;notify&quot;: {
                     &quot;type&quot;: &quot;pusher&quot;,
                     &quot;realm&quot;: &quot;realm1&quot;,
                     &quot;role&quot;: &quot;anonymous&quot;
                  },
                  &quot;static&quot;: {
                     &quot;type&quot;: &quot;static&quot;,
                     &quot;directory&quot;: &quot;../static&quot;
                  }
               }
            }
         ]
      }
   ]
}</p></div>

<p>La partie du haut c&#8217;est un peu l&#8217;Ã©quivalent du <code>chmod 777</code> de crossbar :</p>

<div class="wp_syntax" style="position:relative;"><table><tr><td class="code"><pre class="javascript" style="font-family:monospace;">         <span style="color: #3366CC;">&quot;type&quot;</span><span style="color: #339933;">:</span> <span style="color: #3366CC;">&quot;router&quot;</span><span style="color: #339933;">,</span>
         <span style="color: #3366CC;">&quot;realms&quot;</span><span style="color: #339933;">:</span> <span style="color: #009900;">&#91;</span>
            <span style="color: #009900;">&#123;</span>
               <span style="color: #3366CC;">&quot;name&quot;</span><span style="color: #339933;">:</span> <span style="color: #3366CC;">&quot;realm1&quot;</span><span style="color: #339933;">,</span>
               <span style="color: #3366CC;">&quot;roles&quot;</span><span style="color: #339933;">:</span> <span style="color: #009900;">&#91;</span>
                  <span style="color: #009900;">&#123;</span>
                     <span style="color: #3366CC;">&quot;name&quot;</span><span style="color: #339933;">:</span> <span style="color: #3366CC;">&quot;anonymous&quot;</span><span style="color: #339933;">,</span>
                     <span style="color: #3366CC;">&quot;permissions&quot;</span><span style="color: #339933;">:</span> <span style="color: #009900;">&#91;</span>
                        <span style="color: #009900;">&#123;</span>
                           <span style="color: #3366CC;">&quot;uri&quot;</span><span style="color: #339933;">:</span> <span style="color: #3366CC;">&quot;*&quot;</span><span style="color: #339933;">,</span>
                           <span style="color: #3366CC;">&quot;publish&quot;</span><span style="color: #339933;">:</span> <span style="color: #003366; font-weight: bold;">true</span><span style="color: #339933;">,</span>
                           <span style="color: #3366CC;">&quot;subscribe&quot;</span><span style="color: #339933;">:</span> <span style="color: #003366; font-weight: bold;">true</span><span style="color: #339933;">,</span>
                           <span style="color: #3366CC;">&quot;call&quot;</span><span style="color: #339933;">:</span> <span style="color: #003366; font-weight: bold;">true</span><span style="color: #339933;">,</span>
                           <span style="color: #3366CC;">&quot;register&quot;</span><span style="color: #339933;">:</span> <span style="color: #003366; font-weight: bold;">true</span>
                        <span style="color: #009900;">&#125;</span>
                     <span style="color: #009900;">&#93;</span>
                  <span style="color: #009900;">&#125;</span>
               <span style="color: #009900;">&#93;</span>
            <span style="color: #009900;">&#125;</span>
         <span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span></pre></td></tr></table><p class="theCode" style="display:none;">         &quot;type&quot;: &quot;router&quot;,
         &quot;realms&quot;: [
            {
               &quot;name&quot;: &quot;realm1&quot;,
               &quot;roles&quot;: [
                  {
                     &quot;name&quot;: &quot;anonymous&quot;,
                     &quot;permissions&quot;: [
                        {
                           &quot;uri&quot;: &quot;*&quot;,
                           &quot;publish&quot;: true,
                           &quot;subscribe&quot;: true,
                           &quot;call&quot;: true,
                           &quot;register&quot;: true
                        }
                     ]
                  }
               ]
            }
         ],</p></div>

<p>&#8220;Met moi en place un router avec un accÃ¨s nommÃ© realm1 qui autorise Ã  tous les anonymes de tout faire&#8221;. Un realm est une notion de sÃ©curitÃ© dans Crossbar.io qui permet de cloisonner les clients connectÃ©s, nous on va tout mettre sur le mÃªme realm, c&#8217;est pour une dÃ©mo je vous dis.</p>
<p>Ensuite on rajoute les transports pour chaque techno qui nous intÃ©resse. On va tout regrouper sur le port 8080 car Twisted peut Ã©couter en HTTP et Websocket sur le mÃªme port :</p>

<div class="wp_syntax" style="position:relative;"><table><tr><td class="code"><pre class="javascript" style="font-family:monospace;"><span style="color: #3366CC;">&quot;transports&quot;</span><span style="color: #339933;">:</span> <span style="color: #009900;">&#91;</span>
<span style="color: #009900;">&#123;</span>
   <span style="color: #3366CC;">&quot;type&quot;</span><span style="color: #339933;">:</span> <span style="color: #3366CC;">&quot;web&quot;</span><span style="color: #339933;">,</span>
   <span style="color: #3366CC;">&quot;endpoint&quot;</span><span style="color: #339933;">:</span> <span style="color: #009900;">&#123;</span>
      <span style="color: #3366CC;">&quot;type&quot;</span><span style="color: #339933;">:</span> <span style="color: #3366CC;">&quot;tcp&quot;</span><span style="color: #339933;">,</span>
      <span style="color: #3366CC;">&quot;port&quot;</span><span style="color: #339933;">:</span> <span style="color: #CC0000;">8080</span>
   <span style="color: #009900;">&#125;</span><span style="color: #339933;">,</span></pre></td></tr></table><p class="theCode" style="display:none;">&quot;transports&quot;: [
{
   &quot;type&quot;: &quot;web&quot;,
   &quot;endpoint&quot;: {
      &quot;type&quot;: &quot;tcp&quot;,
      &quot;port&quot;: 8080
   },</p></div>

<p>A la racine, on sert notre app Django :</p>

<div class="wp_syntax" style="position:relative;"><table><tr><td class="code"><pre class="javascript" style="font-family:monospace;">  <span style="color: #3366CC;">&quot;/&quot;</span><span style="color: #339933;">:</span> <span style="color: #009900;">&#123;</span>
     <span style="color: #3366CC;">&quot;type&quot;</span><span style="color: #339933;">:</span> <span style="color: #3366CC;">&quot;wsgi&quot;</span><span style="color: #339933;">,</span>
     <span style="color: #3366CC;">&quot;module&quot;</span><span style="color: #339933;">:</span> <span style="color: #3366CC;">&quot;django_project.wsgi&quot;</span><span style="color: #339933;">,</span>
     <span style="color: #3366CC;">&quot;object&quot;</span><span style="color: #339933;">:</span> <span style="color: #3366CC;">&quot;application&quot;</span>
  <span style="color: #009900;">&#125;</span><span style="color: #339933;">,</span></pre></td></tr></table><p class="theCode" style="display:none;">  &quot;/&quot;: {
     &quot;type&quot;: &quot;wsgi&quot;,
     &quot;module&quot;: &quot;django_project.wsgi&quot;,
     &quot;object&quot;: &quot;application&quot;
  },</p></div>

<p>Car oui, crossbar peut servir votre app django en prod. Pas besoin de gunicorn. En fait mÃªme pas besoin d&#8217;nginx pour un site simple, car Ã§a tient trÃ¨s bien la charge. On a juste Ã  lui indiquer quelle variable (<code>application</code>) de quel fichier WSGI (<code>django_project/wsgi.py</code>) charger, et il s&#8217;occupe du reste.</p>
<p>Sur &#8216;/ws&#8217;, on Ã©coute en Websocket :</p>

<div class="wp_syntax" style="position:relative;"><table><tr><td class="code"><pre class="javascript" style="font-family:monospace;"><span style="color: #3366CC;">&quot;ws&quot;</span><span style="color: #339933;">:</span> <span style="color: #009900;">&#123;</span>
 <span style="color: #3366CC;">&quot;type&quot;</span><span style="color: #339933;">:</span> <span style="color: #3366CC;">&quot;websocket&quot;</span>
<span style="color: #009900;">&#125;</span><span style="color: #339933;">,</span></pre></td></tr></table><p class="theCode" style="display:none;">&quot;ws&quot;: {
 &quot;type&quot;: &quot;websocket&quot;
},</p></div>

<p>WAMP passe par lÃ , et c&#8217;est pour Ã§a que nos clients se connectent en faisant <code>app.run(url="ws://%s:8080/ws" % SERVER)</code> et <code>autobahn.Connection({url: 'ws://127.0.0.1:8080/ws', realm: 'realm1'});</code>.</p>
<p>&#8216;/notify&#8217; va recevoir le bridge WAMP-HTTP :</p>

<div class="wp_syntax" style="position:relative;"><table><tr><td class="code"><pre class="javascript" style="font-family:monospace;"><span style="color: #3366CC;">&quot;notify&quot;</span><span style="color: #339933;">:</span> <span style="color: #009900;">&#123;</span>
     <span style="color: #3366CC;">&quot;type&quot;</span><span style="color: #339933;">:</span> <span style="color: #3366CC;">&quot;pusher&quot;</span><span style="color: #339933;">,</span>
     <span style="color: #3366CC;">&quot;realm&quot;</span><span style="color: #339933;">:</span> <span style="color: #3366CC;">&quot;realm1&quot;</span><span style="color: #339933;">,</span>
     <span style="color: #3366CC;">&quot;role&quot;</span><span style="color: #339933;">:</span> <span style="color: #3366CC;">&quot;anonymous&quot;</span>
  <span style="color: #009900;">&#125;</span></pre></td></tr></table><p class="theCode" style="display:none;">&quot;notify&quot;: {
     &quot;type&quot;: &quot;pusher&quot;,
     &quot;realm&quot;: &quot;realm1&quot;,
     &quot;role&quot;: &quot;anonymous&quot;
  }</p></div>

<p>Tous les anonymes du <code>realm1</code> peuvent l&#8217;utiliser. GrÃ¢ce Ã  Ã§a, on a pu faire depuis notre signal Django :</p>

<div class="wp_syntax" style="position:relative;"><table><tr><td class="code"><pre class="python" style="font-family:monospace;">    requests.<span style="color: black;">post</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">&quot;http://127.0.0.1:8080/notify&quot;</span><span style="color: #66cc66;">,</span>
                  json<span style="color: #66cc66;">=</span><span style="color: black;">&#123;</span>
                      <span style="color: #483d8b;">'topic'</span>: <span style="color: #483d8b;">'clientconfig.'</span> + instance.<span style="color: black;">ip</span><span style="color: #66cc66;">,</span>
                      <span style="color: #483d8b;">'args'</span>: <span style="color: black;">&#91;</span>model_to_dict<span style="color: black;">&#40;</span>instance<span style="color: black;">&#41;</span><span style="color: black;">&#93;</span>
                  <span style="color: black;">&#125;</span><span style="color: black;">&#41;</span></pre></td></tr></table><p class="theCode" style="display:none;">    requests.post(&quot;http://127.0.0.1:8080/notify&quot;,
                  json={
                      'topic': 'clientconfig.' + instance.ip,
                      'args': [model_to_dict(instance)]
                  })</p></div>

<p>Et donc publier un message WAMP, via un POST HTTP.</p>
<p>Enfin, on sert les fichiers statiques Django avec Crossbar (oui, il fait aussi Ã§a :):</p>

<div class="wp_syntax" style="position:relative;"><table><tr><td class="code"><pre class="javascript" style="font-family:monospace;"> <span style="color: #3366CC;">&quot;static&quot;</span><span style="color: #339933;">:</span> <span style="color: #009900;">&#123;</span>
    <span style="color: #3366CC;">&quot;type&quot;</span><span style="color: #339933;">:</span> <span style="color: #3366CC;">&quot;static&quot;</span><span style="color: #339933;">,</span>
    <span style="color: #3366CC;">&quot;directory&quot;</span><span style="color: #339933;">:</span> <span style="color: #3366CC;">&quot;../static&quot;</span>
<span style="color: #009900;">&#125;</span></pre></td></tr></table><p class="theCode" style="display:none;"> &quot;static&quot;: {
    &quot;type&quot;: &quot;static&quot;,
    &quot;directory&quot;: &quot;../static&quot;
}</p></div>

<p>N&#8217;oubliez pas le de spÃ©cifier <code>STATIC_ROOT</code> dans le fichier settings et lancer <code>./manage.py collecstatic</code>.</p>
<p>Tout Ã§a en place, on lance notre routeur :</p>

<div class="wp_syntax" style="position:relative;"><table><tr><td class="code"><pre class="bash" style="font-family:monospace;"><span style="color: #7a0874; font-weight: bold;">export</span> <span style="color: #007800;">PYTHONPATH</span>=<span style="color: #000000; font-weight: bold;">/</span>chemin<span style="color: #000000; font-weight: bold;">/</span>vers<span style="color: #000000; font-weight: bold;">/</span>votre<span style="color: #000000; font-weight: bold;">/</span>project
crossbar start</pre></td></tr></table><p class="theCode" style="display:none;">export PYTHONPATH=/chemin/vers/votre/project
crossbar start</p></div>

<p>(Remplacer <code>export</code> par <code>set</code> sous Windows></p>
<p>La modification de <code>PYTHONPATH</code> est nÃ©cessaire pour que crossbar trouve votre fichier WSGI.</p>
<p>On visite <a href="http:127.0.0.1:8080/">http:127.0.0.1:8080/</a>, qui va charger notre template Django <code>dashboard.html</code>.</p>
<p>Chaque machine qui lance un client via <code>python client.py</code> va dÃ©clencher l&#8217;apparition des stats sur notre dashboard, qui seront mises Ã  jour en temps rÃ©el.</p>
<p>Si on va sur <a href="http:127.0.0.1:8080/admin/">http:127.0.0.1:8080/admin/</a> et qu&#8217;on change la config d&#8217;un client, notre client s&#8217;adapte, et notre dashboard se met Ã  jour automatiquement.</p>
<h2>Conclusion</h2>
<p>Notre projet ressemble Ã  ceci au final :</p>
<pre>
.
âââ client.py
âââ .crossbar
âÂ Â  âââ config.json
âââ db.sqlite3
âââ django_app
âÂ Â  âââ admin.py
âÂ Â  âââ __init__.py
âÂ Â  âââ models.py
âÂ Â  âââ templates
âÂ Â  âÂ Â  âââ dashboard.html
âÂ Â  âââ views.py
âââ django_project
âÂ Â  âââ __init__.py
âÂ Â  âââ settings.py
âÂ Â  âââ urls.py
âÂ Â  âââ wsgi.py
âââ static
âââ manage.py

</pre>
<p>Vous pouvez rÃ©cupÃ©rer le code <a href="https://github.com/sametmax/codes-des-articles/tree/master/2015/fevrier/tudo_django_wamp">ici</a>.</p>
<p>Finalement, trÃ¨s peu de code WAMP : un peu dans le JS, un peu dans le client. Et la seule chose qui lie WAMP Ã  Django est la config crossbar qui ajoute le service HTTP PUSHER et notre requÃªte POST dans <code>models.py</code></p>
<p>Cette technique n&#8217;est pas limitÃ©e Ã  Django, et fonctionne bien pour toutes techno synchrones qui ne peut pas lancer un client WAMP directement en son sein. Pour le moment, le bridge HTTP-WAMP ne propose que PUB, pas de SUB, de pas de RPC. C&#8217;est dÃ©jÃ  assez sympa pour avoir les notifications en temps rÃ©el un peu partout, et Ã§a Tobias m&#8217;a dit qu&#8217;il ajoutera les autres actions dans un future proche.</p>
<p>En attendant, vous voyez le deal : on peut mÃ©langer allÃ¨grement HTTP, WAMP, Python, JS, Client, Serveur, et monter sa petite architecture comme on le souhaite. Crossbar permet de dÃ©marrer du WSGI, mais aussi les clients WAMP sur la mÃªme machine et mÃªme n&#8217;importe quel process en ligne de commande (par exemple NodeJS) si besoin. C&#8217;est Mac Gyver ce truc.</p>
<p>On aurait pu Ã©crire le client en Python 3 puisqu&#8217;il est sur une autre machine. Et en fait, si on lance Django en dehors de crossbar, aussi la partie Django en Python 3. Le code de crossbar n&#8217;est jamais modifiÃ©, on touche juste la configuration JSON.</p>
<p>Personnellement j&#8217;ai lancÃ© plusieurs images <a href="../le-deploiement-par-conteneurs-avec-docker/index.html">dockers</a> avec un client dedans Ã  chaque fois, et c&#8217;est vraiment sympas de voir les machines se rajouter sur le dashboard en temps rÃ©el. On a une super sensation d&#8217;interactivitÃ© quand on change une valeur dans l&#8217;admin et qu&#8217;on voit le dashboard bouger.</p>
<div class="sharedaddy sd-sharing-enabled"><div class="robots-nocontent sd-block sd-social sd-social-official sd-sharing"><h3 class="sd-title">Partager:</h3><div class="sd-content"><ul><li class="share-twitter"><a href="https://twitter.com/share" class="twitter-share-button" data-url="http://sametmax.com/un-petit-dashboard-de-monitoring-avec-django-et-wamp/" data-text="Un petit dashboard de monitoring avec Django et WAMP"  >Tweet</a></li><li class="share-facebook"><div class="fb-share-button" data-href="http://sametmax.com/un-petit-dashboard-de-monitoring-avec-django-et-wamp/" data-layout="button_count"></div></li><li class="share-google-plus-1"><div class="googleplus1_button"><div class="g-plus" data-action="share" data-annotation="bubble" data-href="http://sametmax.com/un-petit-dashboard-de-monitoring-avec-django-et-wamp/"></div></div></li><li class="share-email"><a rel="nofollow" data-shared="" class="share-email sd-button" href="index.html%3Fshare=email.html" rel="noopener noreferrer" target="_blank" title="Click to email this to a friend"><span>Email</span></a></li><li><a href="index.html%3Fshare=email.html#" class="sharing-anchor sd-button share-more"><span>More</span></a></li><li class="share-end"></li></ul><div class="sharing-hidden"><div class="inner" style="display: none;"><ul><li class="share-reddit"><div class="reddit_button"><iframe src="http://www.reddit.com/static/button/button1.html?newwindow=true&width=120&amp;url=http%3A%2F%2Fsametmax.com%2Fun-petit-dashboard-de-monitoring-avec-django-et-wamp%2F&amp;title=Un%20petit%20dashboard%20de%20monitoring%20avec%20Django%20et%20WAMP" height="22" width="120" scrolling="no" frameborder="0"></iframe></div></li><li class="share-pinterest"><div class="pinterest_button"><a href="https://www.pinterest.com/pin/create/button/?url=http%3A%2F%2Fsametmax.com%2Fun-petit-dashboard-de-monitoring-avec-django-et-wamp%2F&#038;media=http%3A%2F%2Fsametmax.com%2Fwp-content%2Fuploads%2F2015%2F02%2Feded53891380c2bb5fd43858688b0554.jpg&#038;description=Un%20petit%20dashboard%20de%20monitoring%20avec%20Django%20et%20WAMP" data-pin-do="buttonPin" data-pin-config="beside"><img src="http://assets.pinterest.com/images/pidgets/pinit_fg_en_rect_gray_20.png" /></a></div></li><li class="share-end"></li><li class="share-tumblr"><a target="_blank" href="https://www.tumblr.com/share/link/?url=http%3A%2F%2Fsametmax.com%2Fun-petit-dashboard-de-monitoring-avec-django-et-wamp%2F&name=Un%20petit%20dashboard%20de%20monitoring%20avec%20Django%20et%20WAMP" title="Share on Tumblr" style="display:inline-block; text-indent:-9999px; overflow:hidden; width:62px; height:20px; background:url('https://platform.tumblr.com/v1/share_2.png') top left no-repeat transparent;">Share on Tumblr</a></li><li class="share-pocket"><div class="pocket_button"><a href="https://getpocket.com/save" class="pocket-btn" data-lang="en" data-save-url="http://sametmax.com/un-petit-dashboard-de-monitoring-avec-django-et-wamp/" data-pocket-count="horizontal" >Pocket</a></div></li><li class="share-end"></li><li class="share-end"></li></ul></div></div></div></div></div>                        </section><!-- .entry-content -->

        <footer class="entry-meta"><hr class="featurette-divider"><div class="author-info"><div class="row-fluid"><div class="comment-avatar author-avatar span2"><img alt='' src='http://2.gravatar.com/avatar/bf9ecde8f5e286de6ce5c80206cf9dd6?s=100&#038;d=retro&#038;r=x' srcset='http://2.gravatar.com/avatar/bf9ecde8f5e286de6ce5c80206cf9dd6?s=200&#038;d=retro&#038;r=x 2x' class='avatar avatar-100 photo' height='100' width='100' /></div> <div class="author-description span10"><h3>About Sam</h3><p>Waf !</p><div class="author-link"><a href="../author/sam/index.html" rel="author">View all posts by Sam <span class="meta-nav">&rarr;</span></a></div></div></div></div></footer>                                    </article>
                                
                            
                        
                    
<div id="comments" class="comments-area" >
	<h2 id="tc-comment-title" class="comments-title">16 thoughts on &ldquo;<span>Un petit dashboard de monitoring avec Django et WAMP</span>&rdquo;</h2>              <ul class="commentlist">
                        <li class="comment even thread-even depth-1" id="li-comment-157706">
          
            <article id="comment-157706" class="comment"><div class="row-fluid"><div class="comment-avatar span2"><img alt='' src='http://1.gravatar.com/avatar/de1f605572566a8254265a37648c9187?s=80&#038;d=retro&#038;r=x' srcset='http://1.gravatar.com/avatar/de1f605572566a8254265a37648c9187?s=160&#038;d=retro&#038;r=x 2x' class='avatar avatar-80 photo' height='80' width='80' /></div><div class="span10"> <header class="comment-meta comment-author vcard"><cite class="fn">keiser1080  </cite> <a class="comment-date" href="index.html#comment-157706"><time datetime="2015-03-15T12:30:29+00:00">15/03/2015 at 12:30</time></a></header>  <section class="comment-content comment"><p>super tuto,</p>
<p>tres tres utiles.</p>
<p>C&#8217;est accessible Ã  tout public, j&#8217;ai beaucoup apris.</p>
<p>peux tu ajouter :</p>
<p>django-admin startproject django_project</p>
<p>cd django_project/</p>
<p>./manage.py startapp django_app</p>
<p>Ce serais un plus de montrer comment mettre en production. (avec supervisor par example.)</p>
<p>Et l&#8217;organisation des fichiers dans l&#8217;os et des droit sur les fichiers.</p>
<p>Tu peux le faire de maniere generic et joindre le lynk Ã  chaque tuto.</p>
<p>Par exemple la tu as utiliser un nom generic django_project et django_app si tu fais Ã§a dans tout les futur tuto wamp ou autre.</p>
<p>Ã§a rendrais accessible Ã  n&#8217;importe qui, le defaut sur la plus part des tuto que l&#8217;on trouve sur le net c&#8217;est qu&#8217;on peut pas faire une app end to end. La le fait de joindre la config crossbar l&#8217;arborescence de l&#8217;app les commandes Ã§a facilite vraiment la vie et Ã§a aide Ã  comprendre.</p>
</section></div></div></article>          <!-- #comment-## -->
        </li><!-- #comment-## -->
        <li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-159045">
          
            <article id="comment-159045" class="comment"><div class="row-fluid"><div class="comment-avatar span2"><img alt='' src='http://0.gravatar.com/avatar/647dae215d91b81bb1b5da30d6990302?s=80&#038;d=retro&#038;r=x' srcset='http://0.gravatar.com/avatar/647dae215d91b81bb1b5da30d6990302?s=160&#038;d=retro&#038;r=x 2x' class='avatar avatar-80 photo' height='80' width='80' /></div><div class="span10"> <header class="comment-meta comment-author vcard"><cite class="fn">Krypted  </cite> <a class="comment-date" href="index.html#comment-159045"><time datetime="2015-04-13T12:57:00+00:00">13/04/2015 at 12:57</time></a></header>  <section class="comment-content comment"><p>Voici l&#8217;erreur que j&#8217;ai eu aprÃ¨s avoir fait: crossbar start</p>
<p>Exception: invalid type &#8216;pusher&#8217; for sub-path service in Web transport path service &#8216;notify&#8217; configuration</p>
<p>Il semble que le service pusher ait Ã©tÃ© renommÃ© en publisher.</p>
<p>Ce qui donne dans le fichier config.json</p>
<p>&#8220;notify&#8221;: {</p>
<p>&#8220;type&#8221;: &#8220;publisher&#8221;,</p>
<p>&#8220;realm&#8221;: &#8220;realm1&#8221;,</p>
<p>&#8220;role&#8221;: &#8220;anonymous&#8221;</p>
<p>}</p>
</section></div></div></article>          <!-- #comment-## -->
        </li><!-- #comment-## -->
        <li class="comment byuser comment-author-sam bypostauthor even thread-even depth-1" id="li-comment-159047">
          
            <article id="comment-159047" class="comment"><div class="row-fluid"><div class="comment-avatar span2"><img alt='' src='http://2.gravatar.com/avatar/bf9ecde8f5e286de6ce5c80206cf9dd6?s=80&#038;d=retro&#038;r=x' srcset='http://2.gravatar.com/avatar/bf9ecde8f5e286de6ce5c80206cf9dd6?s=160&#038;d=retro&#038;r=x 2x' class='avatar avatar-80 photo' height='80' width='80' /></div><div class="span10"> <header class="comment-meta comment-author vcard"><cite class="fn">Sam <span> Post author</span> </cite> <a class="comment-date" href="index.html#comment-159047"><time datetime="2015-04-13T14:17:00+00:00">13/04/2015 at 14:17</time></a></header>  <section class="comment-content comment"><p>Bien vu. J&#8217;ai ouvert un ticket : <a href="https://github.com/crossbario/crossbarwww/issues/55" rel="nofollow">https://github.com/crossbario/crossbarwww/issues/55</a></p>
</section></div></div></article>          <!-- #comment-## -->
        </li><!-- #comment-## -->
        <li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-166062">
          
            <article id="comment-166062" class="comment"><div class="row-fluid"><div class="comment-avatar span2"><img alt='' src='http://0.gravatar.com/avatar/cc0732cfa12e4a3cc147f4ef0edad256?s=80&#038;d=retro&#038;r=x' srcset='http://0.gravatar.com/avatar/cc0732cfa12e4a3cc147f4ef0edad256?s=160&#038;d=retro&#038;r=x 2x' class='avatar avatar-80 photo' height='80' width='80' /></div><div class="span10"> <header class="comment-meta comment-author vcard"><cite class="fn">JÃ©rÃ´me  </cite> <a class="comment-date" href="index.html#comment-166062"><time datetime="2015-11-06T03:22:46+00:00">06/11/2015 at 03:22</time></a></header>  <section class="comment-content comment"><p>Bonjour,</p>
<p>Je viens de dÃ©couvrir depuis peu de temps le principe Crossbario/WAMP, ce qui m&#8217;intÃ©resse fortement notamment dans un premier temps pour mettre Ã  jour mon application domotique &#8220;maison&#8221; sous Django.</p>
<p>J&#8217;ai donc voulu tester ce topic dans un virtualenv en python 3.5, puisqu&#8217;apparemment c&#8217;est ok maintenant.</p>
<p>Seulement, crossbario me retournait systÃ©matiquement une erreur : WSGI unsupported.</p>
<p>AprÃ¨s plusieurs heures de galÃ¨res Ã  faire de multiples vÃ©rifications, je viens de trouver d&#8217;oÃ¹ vient le problÃ¨me.</p>
<p>C&#8217;est Twisted, qui ne supporte pas encore cette fonctionnalitÃ©!</p>
<p><code>try:</p>
<p>from twisted.web.wsgi import WSGIResource</p>
<p>_HAS_WSGI = True</p>
<p>except ImportError:</p>
<p>## <b>Twisted hasn't ported this to Python 3 yet</b></p>
<p>_HAS_WSGI = False</p>
<p></code></p>
<p>Ce que l&#8217;on peut Ã©galement lire sur leur site dans les derniÃ¨res news de septembre 2015:</p>
<p><i>More Python 3</p>
<p>Twisted 15.5 (coming Oct/Nov) will also contain the first release of twistd (the Twisted Daemon runner) on Python 3. <b>The only plugin shipping with it right now is web, with most base features (file serving, running user-specified Resources). WSGI support and distributed web serving has not yet made it in, but the WSGI support is coming soon</b>.</i></p>
<p>A moins que mon souci vienne d&#8217;ailleurs, ca serait bien de le prÃ©ciser quelque part dans le topic pour d&#8217;autres personnes.</p>
<p>Merci et beau travail.</p>
</section></div></div></article>          <!-- #comment-## -->
        <ul class="children">
        <li class="comment byuser comment-author-sam bypostauthor even depth-2" id="li-comment-166095">
          
            <article id="comment-166095" class="comment"><div class="row-fluid"><div class="comment-avatar span2"><img alt='' src='http://2.gravatar.com/avatar/bf9ecde8f5e286de6ce5c80206cf9dd6?s=80&#038;d=retro&#038;r=x' srcset='http://2.gravatar.com/avatar/bf9ecde8f5e286de6ce5c80206cf9dd6?s=160&#038;d=retro&#038;r=x 2x' class='avatar avatar-80 photo' height='80' width='80' /></div><div class="span10"> <header class="comment-meta comment-author vcard"><cite class="fn">Sam <span> Post author</span> </cite> <a class="comment-date" href="index.html#comment-166095"><time datetime="2015-11-06T08:24:42+00:00">06/11/2015 at 08:24</time></a></header>  <section class="comment-content comment"><p>Merci pour la prÃ©cision :)</p>
</section></div></div></article>          <!-- #comment-## -->
        </li><!-- #comment-## -->
        <li class="comment odd alt depth-2" id="li-comment-166154">
          
            <article id="comment-166154" class="comment"><div class="row-fluid"><div class="comment-avatar span2"><img alt='' src='http://0.gravatar.com/avatar/cc0732cfa12e4a3cc147f4ef0edad256?s=80&#038;d=retro&#038;r=x' srcset='http://0.gravatar.com/avatar/cc0732cfa12e4a3cc147f4ef0edad256?s=160&#038;d=retro&#038;r=x 2x' class='avatar avatar-80 photo' height='80' width='80' /></div><div class="span10"> <header class="comment-meta comment-author vcard"><cite class="fn">JÃ©rÃ´me  </cite> <a class="comment-date" href="index.html#comment-166154"><time datetime="2015-11-06T18:31:56+00:00">06/11/2015 at 18:31</time></a></header>  <section class="comment-content comment"><p>Bonjour,</p>
<p>Pareil dans le script python. J&#8217;ai dÃ» mettre un &#8220;u&#8221; devant &#8220;ws://%s:8080/ws&#8221; % SERVER</p>
<p>On dÃ©marre notre client.</p>
<p>if <strong>name</strong> == &#8216;<strong>main</strong>&#8216;:</p>
<p>app.run(url=<b>u</b>&#8220;ws://%s:8080/ws&#8221; % SERVER)</p>
</section></div></div></article>          <!-- #comment-## -->
        </li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
        <li class="comment byuser comment-author-sam bypostauthor even thread-even depth-1" id="li-comment-166156">
          
            <article id="comment-166156" class="comment"><div class="row-fluid"><div class="comment-avatar span2"><img alt='' src='http://2.gravatar.com/avatar/bf9ecde8f5e286de6ce5c80206cf9dd6?s=80&#038;d=retro&#038;r=x' srcset='http://2.gravatar.com/avatar/bf9ecde8f5e286de6ce5c80206cf9dd6?s=160&#038;d=retro&#038;r=x 2x' class='avatar avatar-80 photo' height='80' width='80' /></div><div class="span10"> <header class="comment-meta comment-author vcard"><cite class="fn">Sam <span> Post author</span> </cite> <a class="comment-date" href="index.html#comment-166156"><time datetime="2015-11-06T19:28:51+00:00">06/11/2015 at 19:28</time></a></header>  <section class="comment-content comment"><p>Ca c&#8217;est pour Python &lt; 3.3.</p>
</section></div></div></article>          <!-- #comment-## -->
        </li><!-- #comment-## -->
        <li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-168076">
          
            <article id="comment-168076" class="comment"><div class="row-fluid"><div class="comment-avatar span2"><img alt='' src='http://2.gravatar.com/avatar/807be0630dcf6ec6065262bbe478ea4f?s=80&#038;d=retro&#038;r=x' srcset='http://2.gravatar.com/avatar/807be0630dcf6ec6065262bbe478ea4f?s=160&#038;d=retro&#038;r=x 2x' class='avatar avatar-80 photo' height='80' width='80' /></div><div class="span10"> <header class="comment-meta comment-author vcard"><cite class="fn">chris  </cite> <a class="comment-date" href="index.html#comment-168076"><time datetime="2015-11-20T17:10:35+00:00">20/11/2015 at 17:10</time></a></header>  <section class="comment-content comment"><p>Super tuto, on apprend beaucoup en le lisant et cela permet d&#8217;imaginer plein de choses</p>
<p>faire son propre monitoring &#8230; un reve</p>
<p>par contre des que l&#8217;on teste c&#8217;est plus difficile</p>
<p>j&#8217;ai bien &#8216;git clone&#8217; le truc</p>
<p>sync_db toussa</p>
<p>lancÃ© le crossbar start avec le python path qu&#8217;il faut</p>
<p>sur le navigateur je vois bien &#8216;Monitoring&#8217; quand je pointe</p>
<p>j&#8217;ai bien mis des clients dans la base de donnÃ©es</p>
<p>je lance client.py qui ne dis rien (j&#8217;ai remplacÃ© SERVER par 127.0.0.1)</p>
<p>et puis c&#8217;est tout</p>
<p>rien ne bouge mÃªme pas un log</p>
<p>le cotÃ© django repond</p>
<p>mais cotÃ© crossbar rien ne bouge,</p>
<p>pas de log</p>
<p>je piges pas ce qu&#8217;il me manque pour que cela fonctionne</p>
<p>bon ok je fais Ã§a depuis une VM sous virtualbox (serveur + client )</p>
<p>j&#8217;interroge avec firefox depuis l&#8217;hote (en redirigeant les ports 8000 8080 et 111)</p>
<p>je dois pas Ãªtre loin, mais le manque de log me perturbe</p>
</section></div></div></article>          <!-- #comment-## -->
        </li><!-- #comment-## -->
        <li class="comment byuser comment-author-sam bypostauthor even thread-even depth-1" id="li-comment-171217">
          
            <article id="comment-171217" class="comment"><div class="row-fluid"><div class="comment-avatar span2"><img alt='' src='http://2.gravatar.com/avatar/bf9ecde8f5e286de6ce5c80206cf9dd6?s=80&#038;d=retro&#038;r=x' srcset='http://2.gravatar.com/avatar/bf9ecde8f5e286de6ce5c80206cf9dd6?s=160&#038;d=retro&#038;r=x 2x' class='avatar avatar-80 photo' height='80' width='80' /></div><div class="span10"> <header class="comment-meta comment-author vcard"><cite class="fn">Sam <span> Post author</span> </cite> <a class="comment-date" href="index.html#comment-171217"><time datetime="2015-12-20T09:32:38+00:00">20/12/2015 at 09:32</time></a></header>  <section class="comment-content comment"><p>Bon, dÃ©solÃ© j&#8217;ai mis du temps Ã  rÃ©pondre.</p>
<p>Je vais regarder le problÃ¨me quand j&#8217;ai un moment.</p>
</section></div></div></article>          <!-- #comment-## -->
        </li><!-- #comment-## -->
        <li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-174036">
          
            <article id="comment-174036" class="comment"><div class="row-fluid"><div class="comment-avatar span2"><img alt='' src='http://2.gravatar.com/avatar/2b609fafba498fcf1f5766bb93b9c137?s=80&#038;d=retro&#038;r=x' srcset='http://2.gravatar.com/avatar/2b609fafba498fcf1f5766bb93b9c137?s=160&#038;d=retro&#038;r=x 2x' class='avatar avatar-80 photo' height='80' width='80' /></div><div class="span10"> <header class="comment-meta comment-author vcard"><cite class="fn">Nasjo  </cite> <a class="comment-date" href="index.html#comment-174036"><time datetime="2016-01-13T14:19:16+00:00">13/01/2016 at 14:19</time></a></header>  <section class="comment-content comment"><p>Hello.</p>
<p>Merci pour ce tuto bien clair. Je cherchais une solution similaire et m&#8217;etais prÃ©alablement tournÃ© vers <a href="http://swampdragon.net/" title="swampdragon" rel="nofollow">swampdragon</a> qui aide a faire du wamp avec Django aussi. Mais un peu plus usine a gaz mÃªme s&#8217;il est assez bien documentÃ©. Et il n&#8217;a plus l&#8217;air mis a jour depuis un bail.</p>
<p>Du coup j&#8217;ai suivi ce tuto Ã  la lettre pour tester. Je fais tout tourner dans un Docker avec un -p 8080:8080.</p>
<p>Le client.py Ã©tant lancÃ© dans le Docker aussi, j&#8217;ai remplacÃ© la variable SERVER par 127.0.0.1 .</p>
<p>J&#8217;avais une <a href="https://github.com/crossbario/crossbarexamples/issues/38" title="" rel="nofollow">AssertionError</a>  au lancement de ce dernier avant d&#8217;Ã©crire en unipre la string url :</p>

<div class="wp_syntax" style="position:relative;"><table><tr><td class="code"><pre class="python" style="font-family:monospace;">app.<span style="color: black;">run</span><span style="color: black;">&#40;</span>url<span style="color: #66cc66;">=</span>u<span style="color: #483d8b;">&quot;ws://%s:80/ws&quot;</span> % SERVER<span style="color: #66cc66;">,</span> debug<span style="color: #66cc66;">=</span><span style="color: #008000;">False</span><span style="color: #66cc66;">,</span> debug_wamp<span style="color: #66cc66;">=</span><span style="color: #008000;">False</span><span style="color: black;">&#41;</span></pre></td></tr></table><p class="theCode" style="display:none;">app.run(url=u&quot;ws://%s:80/ws&quot; % SERVER, debug=False, debug_wamp=False)</p></div>

<p>Mais je me retrouve au lancement de ce client.py avec ceci :</p>

<div class="wp_syntax" style="position:relative;"><table><tr><td class="code"><pre class="python" style="font-family:monospace;">&nbsp;
<span style="color: #ff4500;">2016</span>-<span style="color: #ff4500;">01</span>-13T14:<span style="color: #ff4500;">14</span>:<span style="color: #ff4500;">13</span>+<span style="color: #ff4500;">0000</span> Starting factory &amp;lt<span style="color: #66cc66;">;</span>autobahn.<span style="color: black;">twisted</span>.<span style="color: black;">websocket</span>.<span style="color: black;">WampWebSocketClientFactory</span> <span style="color: #008000;">object</span> at <span style="color: #ff4500;">0x7f65806a6090</span>&amp;gt<span style="color: #66cc66;">;</span>
&nbsp;
<span style="color: #ff4500;">2016</span>-<span style="color: #ff4500;">01</span>-13T14:<span style="color: #ff4500;">14</span>:<span style="color: #ff4500;">13</span>+<span style="color: #ff4500;">0000</span> Stopping factory &amp;lt<span style="color: #66cc66;">;</span>autobahn.<span style="color: black;">twisted</span>.<span style="color: black;">websocket</span>.<span style="color: black;">WampWebSocketClientFactory</span> <span style="color: #008000;">object</span> at <span style="color: #ff4500;">0x7f65806a6090</span>&amp;gt<span style="color: #66cc66;">;</span>
&nbsp;
<span style="color: #ff4500;">2016</span>-<span style="color: #ff4500;">01</span>-13T14:<span style="color: #ff4500;">14</span>:<span style="color: #ff4500;">13</span>+<span style="color: #ff4500;">0000</span> Main loop terminated.
&nbsp;
<span style="color: #ff4500;">2016</span>-<span style="color: #ff4500;">01</span>-13T14:<span style="color: #ff4500;">14</span>:<span style="color: #ff4500;">13</span>+<span style="color: #ff4500;">0000</span> Traceback <span style="color: black;">&#40;</span>most recent call last<span style="color: black;">&#41;</span>:
&nbsp;
<span style="color: #ff4500;">2016</span>-<span style="color: #ff4500;">01</span>-13T14:<span style="color: #ff4500;">14</span>:<span style="color: #ff4500;">13</span>+<span style="color: #ff4500;">0000</span>   File <span style="color: #483d8b;">&quot;client.py&quot;</span><span style="color: #66cc66;">,</span> line <span style="color: #ff4500;">130</span><span style="color: #66cc66;">,</span> <span style="color: #ff7700;font-weight:bold;">in</span> 
&nbsp;
<span style="color: #ff4500;">2016</span>-<span style="color: #ff4500;">01</span>-13T14:<span style="color: #ff4500;">14</span>:<span style="color: #ff4500;">13</span>+<span style="color: #ff4500;">0000</span>     app.<span style="color: black;">run</span><span style="color: black;">&#40;</span>url<span style="color: #66cc66;">=</span>u<span style="color: #483d8b;">&quot;ws://%s:80/ws&quot;</span> % SERVER<span style="color: #66cc66;">,</span> debug<span style="color: #66cc66;">=</span><span style="color: #008000;">False</span><span style="color: #66cc66;">,</span> debug_wamp<span style="color: #66cc66;">=</span><span style="color: #008000;">False</span><span style="color: black;">&#41;</span>
&nbsp;
<span style="color: #ff4500;">2016</span>-<span style="color: #ff4500;">01</span>-13T14:<span style="color: #ff4500;">14</span>:<span style="color: #ff4500;">13</span>+<span style="color: #ff4500;">0000</span>   File <span style="color: #483d8b;">&quot;/usr/local/lib/python2.7/dist-packages/autobahn/twisted/wamp.py&quot;</span><span style="color: #66cc66;">,</span> line <span style="color: #ff4500;">395</span><span style="color: #66cc66;">,</span> <span style="color: #ff7700;font-weight:bold;">in</span> run
&nbsp;
<span style="color: #ff4500;">2016</span>-<span style="color: #ff4500;">01</span>-13T14:<span style="color: #ff4500;">14</span>:<span style="color: #ff4500;">13</span>+<span style="color: #ff4500;">0000</span>     runner.<span style="color: black;">run</span><span style="color: black;">&#40;</span><span style="color: #008000;">self</span>.<span style="color: #66cc66;">&lt;</span>strong<span style="color: #66cc66;">&gt;</span>call<span style="color: #66cc66;">&lt;</span>/strong<span style="color: #66cc66;">&gt;,</span> start_reactor<span style="color: black;">&#41;</span>
&nbsp;
<span style="color: #ff4500;">2016</span>-<span style="color: #ff4500;">01</span>-13T14:<span style="color: #ff4500;">14</span>:<span style="color: #ff4500;">13</span>+<span style="color: #ff4500;">0000</span>   File <span style="color: #483d8b;">&quot;/usr/local/lib/python2.7/dist-packages/autobahn/twisted/wamp.py&quot;</span><span style="color: #66cc66;">,</span> line <span style="color: #ff4500;">272</span><span style="color: #66cc66;">,</span> <span style="color: #ff7700;font-weight:bold;">in</span> run
&nbsp;
<span style="color: #ff4500;">2016</span>-<span style="color: #ff4500;">01</span>-13T14:<span style="color: #ff4500;">14</span>:<span style="color: #ff4500;">13</span>+<span style="color: #ff4500;">0000</span>     <span style="color: #ff7700;font-weight:bold;">raise</span> connect_error.<span style="color: black;">exception</span>
&nbsp;
<span style="color: #ff4500;">2016</span>-<span style="color: #ff4500;">01</span>-13T14:<span style="color: #ff4500;">14</span>:<span style="color: #ff4500;">13</span>+<span style="color: #ff4500;">0000</span> twisted.<span style="color: black;">internet</span>.<span style="color: black;">error</span>.<span style="color: black;">ConnectionRefusedError</span>: Connection was refused by other side: <span style="color: #ff4500;">111</span>: Connection refused.</pre></td></tr></table><p class="theCode" style="display:none;">
2016-01-13T14:14:13+0000 Starting factory &amp;lt;autobahn.twisted.websocket.WampWebSocketClientFactory object at 0x7f65806a6090&amp;gt;

2016-01-13T14:14:13+0000 Stopping factory &amp;lt;autobahn.twisted.websocket.WampWebSocketClientFactory object at 0x7f65806a6090&amp;gt;

2016-01-13T14:14:13+0000 Main loop terminated.

2016-01-13T14:14:13+0000 Traceback (most recent call last):

2016-01-13T14:14:13+0000   File &quot;client.py&quot;, line 130, in 

2016-01-13T14:14:13+0000     app.run(url=u&quot;ws://%s:80/ws&quot; % SERVER, debug=False, debug_wamp=False)

2016-01-13T14:14:13+0000   File &quot;/usr/local/lib/python2.7/dist-packages/autobahn/twisted/wamp.py&quot;, line 395, in run

2016-01-13T14:14:13+0000     runner.run(self.&lt;strong&gt;call&lt;/strong&gt;, start_reactor)

2016-01-13T14:14:13+0000   File &quot;/usr/local/lib/python2.7/dist-packages/autobahn/twisted/wamp.py&quot;, line 272, in run

2016-01-13T14:14:13+0000     raise connect_error.exception

2016-01-13T14:14:13+0000 twisted.internet.error.ConnectionRefusedError: Connection was refused by other side: 111: Connection refused.</p></div>

<p>Si vous avez une idÃ©e, je prend.</p>
<p>Je vais continuer Ã  creuser :)</p>
<p>Merci !</p>
</section></div></div></article>          <!-- #comment-## -->
        </li><!-- #comment-## -->
        <li class="comment even thread-even depth-1" id="li-comment-178475">
          
            <article id="comment-178475" class="comment"><div class="row-fluid"><div class="comment-avatar span2"><img alt='' src='http://0.gravatar.com/avatar/c6d63b81e19851c79dd7dd1d378ed57b?s=80&#038;d=retro&#038;r=x' srcset='http://0.gravatar.com/avatar/c6d63b81e19851c79dd7dd1d378ed57b?s=160&#038;d=retro&#038;r=x 2x' class='avatar avatar-80 photo' height='80' width='80' /></div><div class="span10"> <header class="comment-meta comment-author vcard"><cite class="fn"><a href='http://dotmobo.github.io/' rel='external nofollow' class='url'>.mobo</a>  </cite> <a class="comment-date" href="index.html#comment-178475"><time datetime="2016-05-31T09:29:03+00:00">31/05/2016 at 09:29</time></a></header>  <section class="comment-content comment"><p>Salut Sam et merci pour le tuto.</p>
<p>Actuellement, pour faire du rpc entre crossbar et django, tu conseillerai plutÃ´t de passer par autobahn-sync/crochet ou par le http bridge callee ? En sachant que que la rÃ©ponse json peut Ãªtre assez importante. Merci et bonne continuation !</p>
</section></div></div></article>          <!-- #comment-## -->
        </li><!-- #comment-## -->
        <li class="comment byuser comment-author-sam bypostauthor odd alt thread-odd thread-alt depth-1" id="li-comment-178477">
          
            <article id="comment-178477" class="comment"><div class="row-fluid"><div class="comment-avatar span2"><img alt='' src='http://2.gravatar.com/avatar/bf9ecde8f5e286de6ce5c80206cf9dd6?s=80&#038;d=retro&#038;r=x' srcset='http://2.gravatar.com/avatar/bf9ecde8f5e286de6ce5c80206cf9dd6?s=160&#038;d=retro&#038;r=x 2x' class='avatar avatar-80 photo' height='80' width='80' /></div><div class="span10"> <header class="comment-meta comment-author vcard"><cite class="fn">Sam <span> Post author</span> </cite> <a class="comment-date" href="index.html#comment-178477"><time datetime="2016-05-31T10:47:50+00:00">31/05/2016 at 10:47</time></a></header>  <section class="comment-content comment"><p>Putain j&#8217;ai toujours pas rÃ©pondu Ã  Nasjo depuis 5 mois. La honte.</p>
<p>@.mobo: Ã§a dÃ©pend. Tu ne lanceras jamais django comme Ã§a, en prod il a toujours un truc devant comme uwsgi ou gunicorn, qui va crÃ©er plein de workers django. Du coup tu n&#8217;as pas qu&#8217;un process, mais plein. Le bridge HTTP utilise le routing de Django, donc gunicorn/uwsgi va envoyer le message vers seulement un worker. Le thread de autobahn-sync/crochet lui va se lancer dans tous les workers.</p>
<p>Donc:</p>
<ul>
<li>Si tu veux que l&#8217;appel soit fait dans un seul des workers django, le bridge HTTP.</li>
<li>Si tu veux pouvoir faire un sub dans tous les workers django, autobahn-sync/crochet.</li>
</ul>
</section></div></div></article>          <!-- #comment-## -->
        </li><!-- #comment-## -->
        <li class="comment even thread-even depth-1" id="li-comment-182024">
          
            <article id="comment-182024" class="comment"><div class="row-fluid"><div class="comment-avatar span2"><img alt='' src='http://2.gravatar.com/avatar/847812f6ba91f2e457419dbf9cc57bd4?s=80&#038;d=retro&#038;r=x' srcset='http://2.gravatar.com/avatar/847812f6ba91f2e457419dbf9cc57bd4?s=160&#038;d=retro&#038;r=x 2x' class='avatar avatar-80 photo' height='80' width='80' /></div><div class="span10"> <header class="comment-meta comment-author vcard"><cite class="fn">spoutnik16  </cite> <a class="comment-date" href="index.html#comment-182024"><time datetime="2016-10-20T18:03:11+00:00">20/10/2016 at 18:03</time></a></header>  <section class="comment-content comment"><p>Hello,</p>
<p>Je suis dessus depuis plusieurs heures, et pas moyen de faire que ma page affiche autre chose que &#8220;Monitoring&#8221;.</p>
<p>Est-ce que Ã  tout hasard, la machine qui affiche la page doit Ãªtre la mÃªme que celle sur laquelle crossbar et django tournent ?</p>
</section></div></div></article>          <!-- #comment-## -->
        <ul class="children">
        <li class="comment byuser comment-author-sam bypostauthor odd alt depth-2" id="li-comment-182051">
          
            <article id="comment-182051" class="comment"><div class="row-fluid"><div class="comment-avatar span2"><img alt='' src='http://2.gravatar.com/avatar/bf9ecde8f5e286de6ce5c80206cf9dd6?s=80&#038;d=retro&#038;r=x' srcset='http://2.gravatar.com/avatar/bf9ecde8f5e286de6ce5c80206cf9dd6?s=160&#038;d=retro&#038;r=x 2x' class='avatar avatar-80 photo' height='80' width='80' /></div><div class="span10"> <header class="comment-meta comment-author vcard"><cite class="fn">Sam <span> Post author</span> </cite> <a class="comment-date" href="index.html#comment-182051"><time datetime="2016-10-21T22:00:21+00:00">21/10/2016 at 22:00</time></a></header>  <section class="comment-content comment"><p>Le tutorial est bien vieux maintenant et mÃ©rite d&#8217;Ãªtre rÃ©Ã©crit.</p>
</section></div></div></article>          <!-- #comment-## -->
        </li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
        <li class="comment even thread-odd thread-alt depth-1" id="li-comment-183722">
          
            <article id="comment-183722" class="comment"><div class="row-fluid"><div class="comment-avatar span2"><img alt='' src='http://2.gravatar.com/avatar/2b4535594555702fd43b16a55844c163?s=80&#038;d=retro&#038;r=x' srcset='http://2.gravatar.com/avatar/2b4535594555702fd43b16a55844c163?s=160&#038;d=retro&#038;r=x 2x' class='avatar avatar-80 photo' height='80' width='80' /></div><div class="span10"> <header class="comment-meta comment-author vcard"><cite class="fn"><a href='https://www.ilard.fr/' rel='external nofollow' class='url'>JC</a>  </cite> <a class="comment-date" href="index.html#comment-183722"><time datetime="2016-12-19T19:17:23+00:00">19/12/2016 at 19:17</time></a></header>  <section class="comment-content comment"><p>Bonsoir Ã  tous,</p>
<p>J&#8217;apprends Python et Django, je suis trÃ¨s intÃ©ressÃ© par le temps rÃ©el dans les pages webÂ pour pour animer les entrÃ©es/sorties du Raspberry :</p>
<p>Nâayant pas su reproduire ce tuto (retrouvÃ© en Anglais dans lâexemple de crossbar.ioÂ ;-) )</p>
<p>je reprends les exemples dâAutobahn pour y comprendre les basesÂ :</p>
<p>Rien de mieux quâun bon vieux âHello worldâÂ !!</p>
<p>Donc go github rÃ©cupÃ©rer âautobahn-python-masterâ et voici ce que je voudrais faire tournerÂ :</p>
<p>âautobahn-python-master/examples/twisted/wamp/app/hello/âÂ avec âhello.htmlâ et âhello.pyâ.</p>
<p>En lanÃ§ant brut de fonderie âpython hello.pyâ jâai un message dâerreurÂ :</p>
<p>â2016-12-19T19:07:42+0100 twisted.internet.error.ConnectionRefusedError: Connection was refused by other side: 111: Connection refused.â</p>
<p>oupsÂ !</p>
<p>Dans le âREADME.mdâ Ã§a parle deÂ :</p>
<p>&#8211; âwamp.Application objectsâ,  âApplicationSessionâ</p>
<p>&#8211; âFlask-esque API to WAMPâ</p>
<p>&#8211; il y a un exemple de code source, que je ne sais pas lâutiliserÂ :</p>
<p><code></p>
<p>app = Application()</p>
<p>@app.register('com.example.add2')</p>
<p>def add2(a, b):</p>
<p>return a + b</p>
<p></code></p>
<p>Si vous avez 2 minutes, auriez-vous une petite idÃ©e de ce quâil faut faire pour exÃ©cuter cet exempleÂ ?</p>
<p>PSÂ : jâai tester sous Python 2.7.12 et 3.5.2 du pc et 2.7.9 et 3.4.2 du raspberry (jâutilise virtualenv) l&#8217;erreur est la mÃªme.</p>
<p>PS2Â : Pour ce tuto, je pense que la structure des dossiers projet et app de Django ont changÃ©s, je suis tout neuf dans le domaine donc pas de recul, jâai tentÃ© une rÃ©-organisation des fichiers pour la 1.10.3 sans succÃ¨s.</p>
<p>Câest pas grave, je voudrais dÃ©jÃ  faire des TP avec les exemples Autobahn/Twisted/WAMP  pour comprendre.</p>
<p>PS3Â : Grand merci pour vos articles câest superÂ !! Â ;-)</p>
<p>Jean-Christophe</p>
</section></div></div></article>          <!-- #comment-## -->
        </li><!-- #comment-## -->
        <li class="comment byuser comment-author-sam bypostauthor odd alt thread-even depth-1" id="li-comment-183873">
          
            <article id="comment-183873" class="comment"><div class="row-fluid"><div class="comment-avatar span2"><img alt='' src='http://2.gravatar.com/avatar/bf9ecde8f5e286de6ce5c80206cf9dd6?s=80&#038;d=retro&#038;r=x' srcset='http://2.gravatar.com/avatar/bf9ecde8f5e286de6ce5c80206cf9dd6?s=160&#038;d=retro&#038;r=x 2x' class='avatar avatar-80 photo' height='80' width='80' /></div><div class="span10"> <header class="comment-meta comment-author vcard"><cite class="fn">Sam <span> Post author</span> </cite> <a class="comment-date" href="index.html#comment-183873"><time datetime="2016-12-23T11:26:34+00:00">23/12/2016 at 11:26</time></a></header>  <section class="comment-content comment"><p>Arf, le 3eme qui vient ici me dire que le tuto est dÃ©passÃ©. Putain faut que je me motive pour le mettre Ã  jour.</p>
</section></div></div></article>          <!-- #comment-## -->
        </li><!-- #comment-## -->
              </ul><!-- .commentlist -->
            <p class="nocomments">Comments are closed.</p></div><!-- #comments .comments-area -->


<div class="ie-comment">
Des questions Python sans rapport avec l'article ? Posez-les sur <a href="http://indexerror.net">IndexError</a>.

</div>
        
          <hr class="featurette-divider __after_loop">
          <nav id="nav-below" class="navigation" role="navigation">

              <h3 class="assistive-text">
                Post navigation              </h3>

              <ul class="pager">
                                  <li class="previous">
                    <span class="nav-previous">
                      <a href="http://sametmax.com/recentrer-les-efforts-dans-lopen-source/" rel="prev"><span class="meta-nav">&larr;</span> Recentrer les efforts dans l&#8217;open source</a>                    </span>
                  </li>
                                                  <li class="next">
                    <span class="nav-next">
                        <a href="http://sametmax.com/et-ca-repart/" rel="next">Et Ã§a repart <span class="meta-nav">&rarr;</span></a>                    </span>
                  </li>
                              </ul>

          </nav><!-- #nav-below .navigation -->

        
        
                </div><!--.article-container -->

                    
        <div class="span3 right tc-sidebar">
           <div id="right" class="widget-area" role="complementary">
                                                      <aside id="text-9" class="widget widget_text">			<div class="textwidget"><p style="font-size:1.3em"><a href="../mais-ou-je-suis-tombee-la/index.html">Mais oÃ¹ je suis tombÃ©(e) lÃ  ?</a></p></div>
		</aside><aside id="text-7" class="widget widget_text">			<div class="textwidget"><img src="http://www.adobe.com/images/pdficon_small.png" width="16" height="16"/> <a href="http://pdfcrowd.com/url_to_pdf/">TÃ©lÃ©charger cette page en PDF</a> </div>
		</aside><aside id="text-4" class="widget widget_text">			<div class="textwidget"><br><br><a href="../appel-a-contributeurs-impertinents/index.html"><img src="../wp-content/uploads/2012/07/contributeur.png" width="288px" style="vertical-align: middle;margin-top:-40px;margin-bottom:10px;"></a> </div>
		</aside><aside id="blog_subscription-4" class="widget jetpack_subscription_widget"><h3 class="widget-title">Souscrire Ã  nos conneries</h3>
			<form action="index.html%3Fshare=email.html#" method="post" accept-charset="utf-8" id="subscribe-blog-blog_subscription-4">
				<div id="subscribe-text"><p>Entrez votre adresse mail et vous recevrez une notification Ã  chaque nouvel article.</p>
</div><p>Join 1,492 other subscribers</p>
					<p id="subscribe-email">
						<label id="jetpack-subscribe-label" for="subscribe-field-blog_subscription-4">
							Email Address						</label>
						<input type="email" name="email" required="required" class="required" value="" id="subscribe-field-blog_subscription-4" placeholder="Email Address" />
					</p>

					<p id="subscribe-submit">
						<input type="hidden" name="action" value="subscribe" />
						<input type="hidden" name="source" value="http://sametmax.com/un-petit-dashboard-de-monitoring-avec-django-et-wamp/?shared=email&#038;msg=fail" />
						<input type="hidden" name="sub-type" value="widget" />
						<input type="hidden" name="redirect_fragment" value="blog_subscription-4" />
												<input type="submit" value="J&#039;adhÃ¨re, bon dieu !" name="jetpack_subscriptions_widget" />
					</p>
							</form>

			<script>
			/*
			Custom functionality for safari and IE
			 */
			(function( d ) {
				// In case the placeholder functionality is available we remove labels
				if ( ( 'placeholder' in d.createElement( 'input' ) ) ) {
					var label = d.querySelector( 'label[for=subscribe-field-blog_subscription-4]' );
						label.style.clip 	 = 'rect(1px, 1px, 1px, 1px)';
						label.style.position = 'absolute';
						label.style.height   = '1px';
						label.style.width    = '1px';
						label.style.overflow = 'hidden';
				}

				// Make sure the email value is filled in before allowing submit
				var form = d.getElementById('subscribe-blog-blog_subscription-4'),
					input = d.getElementById('subscribe-field-blog_subscription-4'),
					handler = function( event ) {
						if ( '' === input.value ) {
							input.focus();

							if ( event.preventDefault ){
								event.preventDefault();
							}

							return false;
						}
					};

				if ( window.addEventListener ) {
					form.addEventListener( 'submit', handler, false );
				} else {
					form.attachEvent( 'onsubmit', handler );
				}
			})( document );
			</script>
				
</aside><aside id="tag_cloud-3" class="widget widget_tag_cloud"><h3 class="widget-title">TagCloud</h3><div class="tagcloud"><a href="../tag/0bin/index.html" class="tag-cloud-link tag-link-148 tag-link-position-1" style="font-size: 9.04pt;" aria-label="0bin (11 items)">0bin</a>
<a href="../tag/angularjs/index.html" class="tag-cloud-link tag-link-443 tag-link-position-2" style="font-size: 8.4pt;" aria-label="angularjs (9 items)">angularjs</a>
<a href="../tag/asyncio/index.html" class="tag-cloud-link tag-link-922 tag-link-position-3" style="font-size: 9.04pt;" aria-label="asyncio (11 items)">asyncio</a>
<a href="../tag/autobahn/index.html" class="tag-cloud-link tag-link-979 tag-link-position-4" style="font-size: 8.4pt;" aria-label="autobahn (9 items)">autobahn</a>
<a href="../tag/bash/index.html" class="tag-cloud-link tag-link-14 tag-link-position-5" style="font-size: 10.8pt;" aria-label="bash (19 items)">bash</a>
<a href="../tag/bitcoin/index.html" class="tag-cloud-link tag-link-320 tag-link-position-6" style="font-size: 8.4pt;" aria-label="bitcoin (9 items)">bitcoin</a>
<a href="../tag/blog/index.html" class="tag-cloud-link tag-link-107 tag-link-position-7" style="font-size: 11.84pt;" aria-label="blog (26 items)">blog</a>
<a href="../tag/cache/index.html" class="tag-cloud-link tag-link-333 tag-link-position-8" style="font-size: 8.72pt;" aria-label="cache (10 items)">cache</a>
<a href="../tag/comprehension-lists/index.html" class="tag-cloud-link tag-link-20 tag-link-position-9" style="font-size: 8pt;" aria-label="comprehension-lists (8 items)">comprehension-lists</a>
<a href="../tag/crossbar/index.html" class="tag-cloud-link tag-link-1046 tag-link-position-10" style="font-size: 8.4pt;" aria-label="crossbar (9 items)">crossbar</a>
<a href="../tag/css/index.html" class="tag-cloud-link tag-link-188 tag-link-position-11" style="font-size: 8.4pt;" aria-label="css (9 items)">css</a>
<a href="../tag/cul-2/index.html" class="tag-cloud-link tag-link-33 tag-link-position-12" style="font-size: 9.28pt;" aria-label="cul (12 items)">cul</a>
<a href="../tag/dict/index.html" class="tag-cloud-link tag-link-435 tag-link-position-13" style="font-size: 8pt;" aria-label="dict (8 items)">dict</a>
<a href="../tag/django/index.html" class="tag-cloud-link tag-link-28 tag-link-position-14" style="font-size: 16pt;" aria-label="django (89 items)">django</a>
<a href="../tag/don/index.html" class="tag-cloud-link tag-link-1210 tag-link-position-15" style="font-size: 10.48pt;" aria-label="don (17 items)">don</a>
<a href="../tag/encoding/index.html" class="tag-cloud-link tag-link-54 tag-link-position-16" style="font-size: 8.72pt;" aria-label="encoding (10 items)">encoding</a>
<a href="../tag/git/index.html" class="tag-cloud-link tag-link-18 tag-link-position-17" style="font-size: 12.88pt;" aria-label="git (35 items)">git</a>
<a href="../tag/http/index.html" class="tag-cloud-link tag-link-204 tag-link-position-18" style="font-size: 9.6pt;" aria-label="http (13 items)">http</a>
<a href="../tag/import/index.html" class="tag-cloud-link tag-link-215 tag-link-position-19" style="font-size: 8.4pt;" aria-label="import (9 items)">import</a>
<a href="../tag/ipython/index.html" class="tag-cloud-link tag-link-164 tag-link-position-20" style="font-size: 8.72pt;" aria-label="ipython (10 items)">ipython</a>
<a href="../tag/iterable/index.html" class="tag-cloud-link tag-link-217 tag-link-position-21" style="font-size: 9.84pt;" aria-label="iterable (14 items)">iterable</a>
<a href="../tag/javascript/index.html" class="tag-cloud-link tag-link-96 tag-link-position-22" style="font-size: 14.08pt;" aria-label="javascript (50 items)">javascript</a>
<a href="../tag/jquery/index.html" class="tag-cloud-link tag-link-112 tag-link-position-23" style="font-size: 8pt;" aria-label="jquery (8 items)">jquery</a>
<a href="../tag/linux/index.html" class="tag-cloud-link tag-link-238 tag-link-position-24" style="font-size: 9.04pt;" aria-label="linux (11 items)">linux</a>
<a href="../tag/meta/index.html" class="tag-cloud-link tag-link-102 tag-link-position-25" style="font-size: 17.52pt;" aria-label="meta (138 items)">meta</a>
<a href="../tag/mysql/index.html" class="tag-cloud-link tag-link-82 tag-link-position-26" style="font-size: 8pt;" aria-label="mysql (8 items)">mysql</a>
<a href="../tag/nginx/index.html" class="tag-cloud-link tag-link-183 tag-link-position-27" style="font-size: 9.84pt;" aria-label="nginx (14 items)">nginx</a>
<a href="../tag/nsfw/index.html" class="tag-cloud-link tag-link-319 tag-link-position-28" style="font-size: 9.84pt;" aria-label="nsfw (14 items)">nsfw</a>
<a href="../tag/pep8/index.html" class="tag-cloud-link tag-link-552 tag-link-position-29" style="font-size: 8pt;" aria-label="pep8 (8 items)">pep8</a>
<a href="../tag/pip/index.html" class="tag-cloud-link tag-link-344 tag-link-position-30" style="font-size: 8.72pt;" aria-label="pip (10 items)">pip</a>
<a href="../tag/poo/index.html" class="tag-cloud-link tag-link-549 tag-link-position-31" style="font-size: 10pt;" aria-label="poo (15 items)">poo</a>
<a href="../tag/python/index.html" class="tag-cloud-link tag-link-4 tag-link-position-32" style="font-size: 22pt;" aria-label="python (496 items)">python</a>
<a href="../tag/python-3/index.html" class="tag-cloud-link tag-link-365 tag-link-position-33" style="font-size: 8.4pt;" aria-label="python 3 (9 items)">python 3</a>
<a href="../tag/redis/index.html" class="tag-cloud-link tag-link-196 tag-link-position-34" style="font-size: 8.72pt;" aria-label="redis (10 items)">redis</a>
<a href="../tag/ruby/index.html" class="tag-cloud-link tag-link-325 tag-link-position-35" style="font-size: 8pt;" aria-label="ruby (8 items)">ruby</a>
<a href="../tag/shell/index.html" class="tag-cloud-link tag-link-202 tag-link-position-36" style="font-size: 8.72pt;" aria-label="shell (10 items)">shell</a>
<a href="../tag/sublime-text/index.html" class="tag-cloud-link tag-link-76 tag-link-position-37" style="font-size: 8.4pt;" aria-label="sublime text (9 items)">sublime text</a>
<a href="../tag/ubuntu/index.html" class="tag-cloud-link tag-link-255 tag-link-position-38" style="font-size: 10.24pt;" aria-label="ubuntu (16 items)">ubuntu</a>
<a href="../tag/unicode/index.html" class="tag-cloud-link tag-link-53 tag-link-position-39" style="font-size: 8.4pt;" aria-label="unicode (9 items)">unicode</a>
<a href="../tag/unit-tests/index.html" class="tag-cloud-link tag-link-302 tag-link-position-40" style="font-size: 8.72pt;" aria-label="unit tests (10 items)">unit tests</a>
<a href="../tag/unpacking/index.html" class="tag-cloud-link tag-link-180 tag-link-position-41" style="font-size: 8pt;" aria-label="unpacking (8 items)">unpacking</a>
<a href="../tag/virtualenv/index.html" class="tag-cloud-link tag-link-259 tag-link-position-42" style="font-size: 9.04pt;" aria-label="virtualenv (11 items)">virtualenv</a>
<a href="../tag/wamp/index.html" class="tag-cloud-link tag-link-1039 tag-link-position-43" style="font-size: 10pt;" aria-label="wamp (15 items)">wamp</a>
<a href="../tag/web-2/index.html" class="tag-cloud-link tag-link-758 tag-link-position-44" style="font-size: 8pt;" aria-label="web (8 items)">web</a>
<a href="../tag/yield/index.html" class="tag-cloud-link tag-link-287 tag-link-position-45" style="font-size: 8.4pt;" aria-label="yield (9 items)">yield</a></div>
</aside><aside id="text-5" class="widget widget_text"><h3 class="widget-title"> Envoyez des sioux</h3>			<div class="textwidget"><p><img src="../wp-content/uploads/2013/07/bitcoin.png" width="16" height="16"/> On adooooore les bitcoins :</p>

<p>

<a href="bitcoin:19zAHPPuce4BAhsdy9KaFwVLurEJXMhMAn?amount=1X8&label=SamEtMax">19zAHPPuce4BAhsdy9KaFwVLurEJXMhMAn</a>

</p></div>
		</aside><aside id="nav_menu-3" class="widget widget_nav_menu"><h3 class="widget-title">Nos projets</h3><div class="menu-nos-projets-container"><ul id="menu-nos-projets" class="menu"><li id="menu-item-15841" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-15841"><a href="http://multiboards.net/">Multiboards &#8211; l&#8217;actu geek fr en une page</a></li>
<li id="menu-item-15837" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-15837"><a href="http://0bin.net">0bin &#8211; le pastebin chiffrÃ©</a></li>
<li id="menu-item-15838" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-15838"><a href="http://allthatcounts.net">All that counts &#8211; compteur pour jeux</a></li>
<li id="menu-item-15839" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-15839"><a href="https://github.com/sametmax/django-quicky">Django quicky &#8211; quick views for Django</a></li>
<li id="menu-item-15840" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-15840"><a href="https://github.com/sametmax/VizHash.js">VizHash.js &#8211; Hash visuels</a></li>
<li id="menu-item-15842" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-15842"><a href="https://github.com/sametmax/codes-des-articles">Code des articles du blog</a></li>
</ul></div></aside><aside id="text-11" class="widget widget_text"><h3 class="widget-title"> </h3>			<div class="textwidget"> </div>
		</aside><aside id="meta-3" class="widget widget_meta"><h3 class="widget-title">Meta</h3>			<ul>
						<li><a href="../wp-login.php.html">Log in</a></li>
			<li><a href="../feed.1">Entries <abbr title="Really Simple Syndication">RSS</abbr></a></li>
			<li><a href="../comments/feed/index.html">Comments <abbr title="Really Simple Syndication">RSS</abbr></a></li>
			<li><a href="https://wordpress.org/" title="Powered by WordPress, state-of-the-art semantic personal publishing platform.">WordPress.org</a></li>			</ul>
			</aside>                                              </div><!-- #left or #right-->
        </div><!--.tc-sidebar -->

        
        </div><!--.row -->
    </div><!-- .container role: main -->

    
</div><!--#main-wrapper"-->

		<!-- FOOTER -->
		<footer id="footer" class="">
		 					<div class="container footer-widgets ">
					<div class="row widget-area" role="complementary">
												
							<div id="footer_one" class="span4">
																
										<aside id="nav_menu-2" class="widget widget_nav_menu"><h3 class="widget-title">Hors du blog</h3><div class="menu-bottom-menu-container"><ul id="menu-bottom-menu" class="menu"><li id="menu-item-2391" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2391"><a href="../contactez-nous/index.html">Page de contact</a></li>
<li id="menu-item-12230" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-12230"><a href="http://twitter.com/sam_et_max">@sam_et_max sur twitter</a></li>
<li id="menu-item-12285" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-12285"><a href="http://bridge.suumitsu.eu/?action=display&#038;bridge=TwitterBridge&#038;u=sam_et_max&#038;format=AtomFormat">Nos tweets en RSS</a></li>
<li id="menu-item-12231" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-12231"><a href="https://github.com/sametmax/">Fork me, I&#8217;m famous (github)</a></li>
</ul></div></aside>
																							</div><!-- .{$key}_widget_class -->

						
							<div id="footer_two" class="span4">
																
										<aside id="text-8" class="widget widget_text">			<div class="textwidget">Tous les textes de ce blog, sauf signalement contraire, sont sous licence <a href="http://creativecommons.org/licenses/by/3.0/">creative common 3.0 unported</a>.</div>
		</aside>
																							</div><!-- .{$key}_widget_class -->

						
							<div id="footer_three" class="span4">
																
										<aside id="archives-2" class="widget widget_archive"><h3 class="widget-title">Toi aussi, trouve un article obsolÃ¨te sur notre blog</h3>		<ul>
			<li><a href='../2019/09/index.html'>September 2019</a>&nbsp;(1)</li>
	<li><a href='../2019/06/index.html'>June 2019</a>&nbsp;(1)</li>
	<li><a href='../2019/02/index.html'>February 2019</a>&nbsp;(1)</li>
	<li><a href='../2019/01/index.html'>January 2019</a>&nbsp;(3)</li>
	<li><a href='../2018/12/index.html'>December 2018</a>&nbsp;(1)</li>
	<li><a href='../2018/09/index.html'>September 2018</a>&nbsp;(2)</li>
	<li><a href='../2018/08/index.html'>August 2018</a>&nbsp;(1)</li>
	<li><a href='../2018/07/index.html'>July 2018</a>&nbsp;(3)</li>
	<li><a href='../2018/06/index.html'>June 2018</a>&nbsp;(4)</li>
	<li><a href='../2018/05/index.html'>May 2018</a>&nbsp;(2)</li>
	<li><a href='../2018/03/index.html'>March 2018</a>&nbsp;(2)</li>
	<li><a href='../2018/02/index.html'>February 2018</a>&nbsp;(1)</li>
	<li><a href='../2017/12/index.html'>December 2017</a>&nbsp;(4)</li>
	<li><a href='../2017/11/index.html'>November 2017</a>&nbsp;(5)</li>
	<li><a href='../2017/10/index.html'>October 2017</a>&nbsp;(2)</li>
	<li><a href='../2017/09/index.html'>September 2017</a>&nbsp;(1)</li>
	<li><a href='../2017/07/index.html'>July 2017</a>&nbsp;(5)</li>
	<li><a href='../2017/06/index.html'>June 2017</a>&nbsp;(3)</li>
	<li><a href='../2017/05/index.html'>May 2017</a>&nbsp;(3)</li>
	<li><a href='../2017/04/index.html'>April 2017</a>&nbsp;(2)</li>
	<li><a href='../2017/03/index.html'>March 2017</a>&nbsp;(3)</li>
	<li><a href='../2017/02/index.html'>February 2017</a>&nbsp;(5)</li>
	<li><a href='../2017/01/index.html'>January 2017</a>&nbsp;(5)</li>
	<li><a href='../2016/10/index.html'>October 2016</a>&nbsp;(2)</li>
	<li><a href='../2016/09/index.html'>September 2016</a>&nbsp;(5)</li>
	<li><a href='../2016/08/index.html'>August 2016</a>&nbsp;(2)</li>
	<li><a href='../2016/03/index.html'>March 2016</a>&nbsp;(8)</li>
	<li><a href='../2016/02/index.html'>February 2016</a>&nbsp;(9)</li>
	<li><a href='../2016/01/index.html'>January 2016</a>&nbsp;(16)</li>
	<li><a href='../2015/12/index.html'>December 2015</a>&nbsp;(6)</li>
	<li><a href='../2015/11/index.html'>November 2015</a>&nbsp;(7)</li>
	<li><a href='../2015/10/index.html'>October 2015</a>&nbsp;(2)</li>
	<li><a href='../2015/09/index.html'>September 2015</a>&nbsp;(6)</li>
	<li><a href='../2015/08/index.html'>August 2015</a>&nbsp;(10)</li>
	<li><a href='../2015/07/index.html'>July 2015</a>&nbsp;(18)</li>
	<li><a href='../2015/06/index.html'>June 2015</a>&nbsp;(13)</li>
	<li><a href='../2015/05/index.html'>May 2015</a>&nbsp;(12)</li>
	<li><a href='../2015/04/index.html'>April 2015</a>&nbsp;(13)</li>
	<li><a href='../2015/03/index.html'>March 2015</a>&nbsp;(8)</li>
	<li><a href='../2015/02/index.html'>February 2015</a>&nbsp;(4)</li>
	<li><a href='../2015/01/index.html'>January 2015</a>&nbsp;(21)</li>
	<li><a href='../2014/12/index.html'>December 2014</a>&nbsp;(24)</li>
	<li><a href='../2014/11/index.html'>November 2014</a>&nbsp;(6)</li>
	<li><a href='../2014/10/index.html'>October 2014</a>&nbsp;(18)</li>
	<li><a href='../2014/09/index.html'>September 2014</a>&nbsp;(10)</li>
	<li><a href='../2014/08/index.html'>August 2014</a>&nbsp;(5)</li>
	<li><a href='../2014/07/index.html'>July 2014</a>&nbsp;(11)</li>
	<li><a href='../2014/06/index.html'>June 2014</a>&nbsp;(25)</li>
	<li><a href='../2014/05/index.html'>May 2014</a>&nbsp;(14)</li>
	<li><a href='../2014/04/index.html'>April 2014</a>&nbsp;(10)</li>
	<li><a href='../2014/03/index.html'>March 2014</a>&nbsp;(23)</li>
	<li><a href='../2014/02/index.html'>February 2014</a>&nbsp;(27)</li>
	<li><a href='../2014/01/index.html'>January 2014</a>&nbsp;(17)</li>
	<li><a href='../2013/12/index.html'>December 2013</a>&nbsp;(27)</li>
	<li><a href='../2013/11/index.html'>November 2013</a>&nbsp;(25)</li>
	<li><a href='../2013/10/index.html'>October 2013</a>&nbsp;(27)</li>
	<li><a href='../2013/09/index.html'>September 2013</a>&nbsp;(1)</li>
	<li><a href='../2013/08/index.html'>August 2013</a>&nbsp;(31)</li>
	<li><a href='../2013/07/index.html'>July 2013</a>&nbsp;(32)</li>
	<li><a href='../2013/06/index.html'>June 2013</a>&nbsp;(24)</li>
	<li><a href='../2013/05/index.html'>May 2013</a>&nbsp;(30)</li>
	<li><a href='../2013/04/index.html'>April 2013</a>&nbsp;(31)</li>
	<li><a href='../2013/03/index.html'>March 2013</a>&nbsp;(33)</li>
	<li><a href='../2013/02/index.html'>February 2013</a>&nbsp;(29)</li>
	<li><a href='../2013/01/index.html'>January 2013</a>&nbsp;(34)</li>
	<li><a href='../2012/12/index.html'>December 2012</a>&nbsp;(32)</li>
	<li><a href='../2012/11/index.html'>November 2012</a>&nbsp;(36)</li>
	<li><a href='../2012/10/index.html'>October 2012</a>&nbsp;(35)</li>
	<li><a href='../2012/09/index.html'>September 2012</a>&nbsp;(36)</li>
	<li><a href='../2012/08/index.html'>August 2012</a>&nbsp;(37)</li>
	<li><a href='../2012/07/index.html'>July 2012</a>&nbsp;(33)</li>
	<li><a href='../2012/06/index.html'>June 2012</a>&nbsp;(24)</li>
	<li><a href='../2012/05/index.html'>May 2012</a>&nbsp;(31)</li>
	<li><a href='../2012/04/index.html'>April 2012</a>&nbsp;(20)</li>
	<li><a href='../2012/03/index.html'>March 2012</a>&nbsp;(10)</li>
	<li><a href='../2012/02/index.html'>February 2012</a>&nbsp;(14)</li>
		</ul>
		</aside>
																							</div><!-- .{$key}_widget_class -->

																	</div><!-- .row.widget-area -->
				</div><!--.footer-widgets -->
				    				 <div class="colophon">
			 	<div class="container">
			 		<div class="row-fluid">
					    <div class="span4 social-block pull-left"><span class="tc-footer-social-links-wrapper" ><a class="social-icon icon-feed" href="../feed/rss/index.html" title="Subscribe to my rss feed"  ></a></span></div><div class="span4 credits"><p>&middot; &copy; 2019 <a href="../index.html" title="Sam &amp; Max" rel="bookmark">Sam &amp; Max</a> &middot; Designed by <a href="http://themesandco.com/">Themes &amp; Co</a> &middot;</p></div><div class="span4 backtop"><p class="pull-right"><a class="back-to-top" href="index.html%3Fshare=email.html#">Back to top</a></p></div>	      			</div><!-- .row-fluid -->
	      		</div><!-- .container -->
	      	</div><!-- .colophon -->
	    			</footer>
			<div style="display:none">
	<div class="grofile-hash-map-bf9ecde8f5e286de6ce5c80206cf9dd6">
	</div>
	<div class="grofile-hash-map-de1f605572566a8254265a37648c9187">
	</div>
	<div class="grofile-hash-map-647dae215d91b81bb1b5da30d6990302">
	</div>
	<div class="grofile-hash-map-bf9ecde8f5e286de6ce5c80206cf9dd6">
	</div>
	<div class="grofile-hash-map-cc0732cfa12e4a3cc147f4ef0edad256">
	</div>
	<div class="grofile-hash-map-807be0630dcf6ec6065262bbe478ea4f">
	</div>
	<div class="grofile-hash-map-2b609fafba498fcf1f5766bb93b9c137">
	</div>
	<div class="grofile-hash-map-c6d63b81e19851c79dd7dd1d378ed57b">
	</div>
	<div class="grofile-hash-map-847812f6ba91f2e457419dbf9cc57bd4">
	</div>
	<div class="grofile-hash-map-2b4535594555702fd43b16a55844c163">
	</div>
	</div>

	<script type="text/javascript">
		window.WPCOM_sharing_counts = {"http:\/\/sametmax.com\/un-petit-dashboard-de-monitoring-avec-django-et-wamp\/":15872};
	</script>
			<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
			<div id="fb-root"></div>
			<script>(function(d, s, id) { var js, fjs = d.getElementsByTagName(s)[0]; if (d.getElementById(id)) return; js = d.createElement(s); js.id = id; js.src = 'https://connect.facebook.net/en_US/sdk.js#xfbml=1&appId=249643311490&version=v2.3'; fjs.parentNode.insertBefore(js, fjs); }(document, 'script', 'facebook-jssdk'));</script>
			<script>
			jQuery( document.body ).on( 'post-load', function() {
				if ( 'undefined' !== typeof FB ) {
					FB.XFBML.parse();
				}
			} );
			</script>
						<script>
			function renderGooglePlus1() {
				if ( 'undefined' === typeof gapi ) {
					return;
				}

				jQuery( '.g-plus' ).each(function() {
					var $button = jQuery( this );

					if ( ! $button.data( 'gplus-rendered' ) ) {
						gapi.plusone.render( this, {
							href: $button.attr( 'data-href' ),
							size: $button.attr( 'data-size' ),
							annotation: $button.attr( 'data-annotation' )
						});

						$button.data( 'gplus-rendered', true );
					}
				});
			}

			(function() {
				var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
				po.src = 'https://apis.google.com/js/platform.js';
				po.innerHTML = '{"parsetags": "explicit"}';
				po.onload = renderGooglePlus1;
				var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
			})();

			jQuery( document.body ).on( 'post-load', renderGooglePlus1 );
			</script>
				<div id="sharing_email" style="display: none;">
		<form action="index.html%3Fshare=email.html" method="post">
			<label for="target_email">Send to Email Address</label>
			<input type="email" name="target_email" id="target_email" value="" />

			
				<label for="source_name">Your Name</label>
				<input type="text" name="source_name" id="source_name" value="" />

				<label for="source_email">Your Email Address</label>
				<input type="email" name="source_email" id="source_email" value="" />

						<input type="text" id="jetpack-source_f_name" name="source_f_name" class="input" value="" size="25" autocomplete="off" title="This field is for validation and should not be changed" />
			
			<img style="float: right; display: none" class="loading" src="../wp-content/plugins/jetpack/modules/sharedaddy/images/loading.gif" alt="loading" width="16" height="16" />
			<input type="submit" value="Send Email" class="sharing_send" />
			<a rel="nofollow" href="index.html%3Fshare=email.html#cancel" class="sharing_cancel">Cancel</a>

			<div class="errors errors-1" style="display: none;">
				Post was not sent - check your email addresses!			</div>

			<div class="errors errors-2" style="display: none;">
				Email check failed, please try again			</div>

			<div class="errors errors-3" style="display: none;">
				Sorry, your blog cannot share posts by email.			</div>
		</form>
	</div>
					<script type="text/javascript">
				// Pinterest shared resources
				var s = document.createElement("script");
				s.type = "text/javascript";
				s.async = true;
				s.setAttribute('data-pin-hover', true);				s.src = window.location.protocol + "//assets.pinterest.com/js/pinit.js";
				var x = document.getElementsByTagName("script")[0];
				x.parentNode.insertBefore(s, x);
				// if 'Pin it' button has 'counts' make container wider
				jQuery(window).load( function(){ jQuery( 'li.share-pinterest a span:visible' ).closest( '.share-pinterest' ).width( '80px' ); } );
			</script>
		<script type="text/javascript" src="https://platform.tumblr.com/v1/share.js"></script>		<script>
		// Don't use Pocket's default JS as it we need to force init new Pocket share buttons loaded via JS.
		function jetpack_sharing_pocket_init() {
			jQuery.getScript( 'https://widgets.getpocket.com/v1/j/btn.js?v=1' );
		}
		jQuery( document ).ready( jetpack_sharing_pocket_init );
		jQuery( document.body ).on( 'post-load', jetpack_sharing_pocket_init );
		</script>
		<script type='text/javascript'>
/* <![CDATA[ */
var wpcf7 = {"apiSettings":{"root":"http:\/\/sametmax.com\/wp-json\/contact-form-7\/v1","namespace":"contact-form-7\/v1"},"recaptcha":{"messages":{"empty":"Please verify that you are not a robot."}}};
/* ]]> */
</script>
<script type='text/javascript' src='../wp-content/plugins/contact-form-7/includes/js/scripts.js%3Fver=5.0.2'></script>
<script type='text/javascript' src='https://s0.wp.com/wp-content/js/devicepx-jetpack.js?ver=201936'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var pollsL10n = {"ajax_url":"http:\/\/sametmax.com\/wp-admin\/admin-ajax.php","text_wait":"Your last request is still being processed. Please wait a while ...","text_valid":"Please choose a valid poll answer.","text_multiple":"Maximum number of choices allowed: ","show_loading":"1","show_fading":"1"};
/* ]]> */
</script>
<script type='text/javascript' src='../wp-content/plugins/wp-polls/polls-js.js%3Fver=2.73.8'></script>
<script type='text/javascript' src='../wp-content/plugins/wp-syntax/js/wp-syntax.js%3Fver=1.1'></script>
<script type='text/javascript' src='https://secure.gravatar.com/js/gprofiles.js?ver=2019Sepaa'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var WPGroHo = {"my_hash":""};
/* ]]> */
</script>
<script type='text/javascript' src='../wp-content/plugins/jetpack/modules/wpgroho.js%3Fver=4.9.7'></script>
<script type='text/javascript' src='../wp-includes/js/comment-reply.min.js%3Fver=4.9.7'></script>
<script type='text/javascript' src='../wp-includes/js/jquery/ui/core.min.js%3Fver=1.11.4'></script>
<script type='text/javascript' src='../wp-content/themes/customizr/inc/assets/js/modernizr.min.js%3Fver=3.2.10'></script>
<script type='text/javascript' src='../wp-content/themes/customizr/inc/assets/js/retina.min.js%3Fver=3.2.10'></script>
<script type='text/javascript' src='../wp-includes/js/wp-embed.min.js%3Fver=4.9.7'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var sharing_js_options = {"lang":"en","counts":"1"};
/* ]]> */
</script>
<script type='text/javascript' src='../wp-content/plugins/jetpack/_inc/build/sharedaddy/sharing.min.js%3Fver=6.3.2'></script>
<script type='text/javascript'>
var windowOpen;
			jQuery( document.body ).on( 'click', 'a.share-facebook', function() {
				// If there's another sharing window open, close it.
				if ( 'undefined' !== typeof windowOpen ) {
					windowOpen.close();
				}
				windowOpen = window.open( jQuery( this ).attr( 'href' ), 'wpcomfacebook', 'menubar=1,resizable=1,width=600,height=400' );
				return false;
			});
</script>
<script type='text/javascript' src='https://stats.wp.com/e-201936.js' async='async' defer='defer'></script>
<script type='text/javascript'>
	_stq = window._stq || [];
	_stq.push([ 'view', {v:'ext',j:'1:6.3.2',blog:'32490438',post:'15872',tz:'0',srv:'sametmax.com'} ]);
	_stq.push([ 'clickTrackerInit', '32490438', '15872' ]);
</script>
<div class="tc-btt-wrapper"><i class="btt-arrow" style="color:#394143"></i></div>	</body>
	</html>